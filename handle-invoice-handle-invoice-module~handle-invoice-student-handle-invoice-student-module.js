(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["handle-invoice-handle-invoice-module~handle-invoice-student-handle-invoice-student-module"],{

/***/ "./node_modules/rxjs-compat/_esm5/add/observable/forkJoin.js":
/*!*******************************************************************!*\
  !*** ./node_modules/rxjs-compat/_esm5/add/observable/forkJoin.js ***!
  \*******************************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");

rxjs__WEBPACK_IMPORTED_MODULE_0__["Observable"].forkJoin = rxjs__WEBPACK_IMPORTED_MODULE_0__["forkJoin"];
//# sourceMappingURL=forkJoin.js.map

/***/ }),

/***/ "./src/app/core/library/invoice/my-bsmodel.service.ts":
/*!************************************************************!*\
  !*** ./src/app/core/library/invoice/my-bsmodel.service.ts ***!
  \************************************************************/
/*! exports provided: MyBsModalService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MyBsModalService", function() { return MyBsModalService; });
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var MyBsModalService = /** @class */ (function (_super) {
    __extends(MyBsModalService, _super);
    function MyBsModalService() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return MyBsModalService;
}(ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_0__["BsModalService"]));



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.html":
/*!******************************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.html ***!
  \******************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"row invoice-form\">\r\n  <div class=\"col-md-6\">\r\n    <dx-form [formData]=\"frmData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Mẫu hóa đơn -->\r\n        <dxi-item dataField=\"template_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.templatesTT78, onValueChanged: onChangeTem, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{ _translate.CONTROLL.LABEL.invoice_form }} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Hình thức điều chỉnh, loại điều chỉnh -->\r\n        <dxi-item *ngIf=\"isAdjustInv\" itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"adjustment_form\" [label]=\"{text: _translate.CONTROLL.LABEL.adjustment_form}\"\r\n            editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.adjustment_forms, onValueChanged: adjustmentFormChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.adjustment_form}} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"adjustment_object\" [label]=\"{text: _translate.CONTROLL.LABEL.adjustment_object}\"\r\n            editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.adjustment_objects, onValueChanged: adjustmentObjectChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.adjustment_object}} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Ngày hóa đơn, số hóa đơn -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"invoice_date\" editorType=\"dxDateBox\"\r\n            [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss', disabled: disableInvoiceDate}\">\r\n            <dxo-label text=\"{{ _translate.GRID.INVOICE.invoice_date }}\"></dxo-label>\r\n          </dxi-item>\r\n          <dxi-item cssClass=\"vat invoice-number-create-invoice\" dataField=\"invoice_number\" editorType=\"dxNumberBox\"\r\n            [editorOptions]=\"{ disabled: true}\">\r\n            <dxo-label text=\"{{ _translate.GRID.INVOICE.invoice_number }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Loại tiền, tỷ giá -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"currency_code\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.currency_codes, onValueChanged: currencyCodeChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.currency_code }}\"></dxo-label>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"currency_rate\" editorType=\"dxNumberBox\"\r\n            [editorOptions]=\"{disabled: frmData.currency_code == 'VND',onValueChanged: currencyRateChange, format: '0,###.##'}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.currency_rate }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Hình thức thanh toán, hình thức xuất -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"payment_method_name\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.payment_method_names,onValueChanged: paymentMethodChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.payment_method }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{ _translate.CONTROLL.LABEL.payment_method }} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item name=\"ht-xuat\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.export_form }}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-select-box [(value)]=\"frmData.status\" displayExpr=\"name\" valueExpr=\"code\" [items]=\"htXuatOptions\"\r\n                [disabled]=\"!configs.system_parameter.allow_keep_invoice_number\"></dx-select-box>\r\n            </div>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Tên ngân hàng -->\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.bank_name}\" dataField=\"bank_name\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n        </dxi-item>\r\n        <!-- Số bảng kê, ngày bảng kê -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"list_number\" [editorOptions]=\"{disabled: tod.buyer_address}\">\r\n            <dxo-label text=\"Số bảng kê\"></dxo-label>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"list_date\" [template]=\"'notifydate'\">\r\n            <dxo-label text=\"Ngày bảng kê\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Loại hóa đơn gốc -->\r\n        <dxi-item [visible]=\"isProcessInvOriginOther\" dataField=\"invoice_origin.relate_xml_type\"\r\n          editorType=\"dxSelectBox\" cssClass=\"vat1 layout_input\"\r\n          [editorOptions]=\"{items: typeInvoices, displayExpr: 'name', valueExpr: 'code', disabled: disableTemplateInput(), readOnly: isHoaDonGoc}\">\r\n          <dxo-label text=\"{{oCaption.loai_hd_goc}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{ oCaption.loai_hd_goc }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Mẫu số, ký hiệu hóa đơn gốc -->\r\n        <dxi-item [visible]=\"isProcessInvOriginOther\" itemType=\"group\" [colCount]=\"2\">\r\n          <!-- Mẫu số hóa đơn gốc -->\r\n          <dxi-item cssClass=\"in-hoa vat1 layout_input\" dataField=\"invoice_origin.relate_template_code\"\r\n            [editorOptions]=\"{disabled: disableTemplateInput(), onValueChanged: templateCodeChanged,readOnly: isHoaDonGoc}\">\r\n            <dxo-label text=\"{{oCaption.mau_so_hd_goc}}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{ oCaption.mau_so_hd_goc }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n          <!-- Ký hiệu hóa đơn gốc -->\r\n          <dxi-item dataField=\"invoice_origin.relate_invoice_series\"\r\n            [editorOptions]=\"{disabled: disableTemplateInput(),  onValueChanged: invoiceSeriesChanged,readOnly: isHoaDonGoc}\">\r\n            <dxo-label text=\"{{ oCaption.ky_hieu_hd_goc}}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{ oCaption.ky_hieu_hd_goc }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Số hóa đơn, ngày hóa đơn gốc -->\r\n        <dxi-item [visible]=\"isProcessInvOriginOther\" itemType=\"group\" [colCount]=\"2\">\r\n          <!-- Số hóa đơn gốc -->\r\n          <dxi-item cssClass=\"vat1 invoice-number-create-invoice layout_input\"\r\n            dataField=\"invoice_origin.relate_invoice_number\"\r\n            [editorOptions]=\"{ disabled: disableTemplateInput(),readOnly: isHoaDonGoc}\">\r\n            <dxo-label text=\"{{ oCaption.so_hd_goc }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{ oCaption.so_hd_goc }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n          <!-- Ngày hóa đơn gốc -->\r\n          <dxi-item dataField=\"invoice_origin.relate_invoice_date\" editorType=\"dxDateBox\"\r\n            [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss', disabled: disableTemplateInput(),readOnly: isHoaDonGoc}\">\r\n            <dxo-label text=\"{{ oCaption.ngay_hd_goc }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{ oCaption.ngay_hd_goc }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Lý do -->\r\n        <dxi-item dataField=\"destroy_reason\">\r\n          <dxo-label text=\"Lý do\"></dxo-label>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"note\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.note }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <div *dxTemplate=\"let d of 'notifydate'\">\r\n        <dx-date-box [(value)]=\"frmData.list_date\" type=\"date\" [useMaskBehavior]=\"true\" [displayFormat]=\"'dd/MM/yyyy'\"\r\n          [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n    </dx-form>\r\n  </div>\r\n  <div class=\"col-md-6\">\r\n    <dx-form [formData]=\"frmData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Xuất hóa đơn cho, nhóm khách hàng -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item cssClass=\"vat layout_input\" dataField=\"customer_object_code\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.customer_object_codes, displayExpr: 'name', valueExpr: 'code', onValueChanged: customer_object_codeChange}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.export_invoice_for }}\"></dxo-label>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"customer_type\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.customer_types, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.customer_group }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Mã số thuế, mã khách hàng -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <!-- Mã số thuế -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='vat layout_input group-input-button'>\r\n            <dxi-item name=\"search-mst\">\r\n              <dxo-label text=\"{{ _translate.CONTROLL.LABEL.tax_code }}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-autocomplete valueExpr=\"tax_code\"\r\n                  placeholder=\"{{ _translate.CONTROLL.PLACE_HOLDER.input_content_search }}\" [dataSource]=\"tax_codes\"\r\n                  [(value)]=\"frmData.buyer_tax_code\" [readOnly]=\"readOnlyCacTruongConLai\"\r\n                  (onItemClick)=\"taxCodeChoose($event)\" (onFocusOut)=\"updateTaxcodeInfo($event)\"\r\n                  (onValueChanged)=\"changeTaxCode($event)\">\r\n                  <div *dxTemplate=\"let item of 'item'\">\r\n                    <span>{{item.tax_code}}: {{ item.name }}</span>\r\n                  </div>\r\n                </dx-autocomplete>\r\n              </div>\r\n            </dxi-item>\r\n            <dxi-item cssClass='btn-small'>\r\n              <button (click)=\" searchTaxCode()\" type=\"button\" class=\"button-tax-code\">\r\n                <i class=\"{{_translate.ICONS.search}}\" style=\"font-size: 22px;\"></i>\r\n              </button>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Mã khách hàng -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='vat layout_input group-input-button'>\r\n            <dxi-item name=\"search-mkh\">\r\n              <dxo-label text=\"{{ _translate.CONTROLL.LABEL.customer_code }}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-autocomplete valueExpr=\"code\"\r\n                  placeholder=\"{{ _translate.CONTROLL.PLACE_HOLDER.input_content_search }}\"\r\n                  [dataSource]=\"customer_codes\" [(value)]=\"frmData.customer_code\" [readOnly]=\"readOnlyCacTruongConLai\"\r\n                  (onItemClick)=\"customerCodeChoose($event)\" (onFocusOut)=\"updateCustomerInfo($event)\">\r\n                  <div *dxTemplate=\"let item of 'item'\">\r\n                    <span>{{item.code}}: {{ item.name }}</span>\r\n                  </div>\r\n                </dx-autocomplete>\r\n              </div>\r\n            </dxi-item>\r\n            <dxi-item cssClass='btn-small'>\r\n              <button (click)=\"editTaxCode()\" type=\"button\" class=\"button-tax-code\">\r\n                <i class=\"dx-icon fa fa-plus-circle icon-size\"></i>\r\n              </button>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Tên đơn vị -->\r\n        <dxi-item cssClass=\"vat layout_input\" dataField=\"customer_name\"\r\n          [editorOptions]=\"{disabled: tod.customer_name, isRequired: false,onValueChanged: customerChanged}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.customer_name }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Họ tên người mua, điện thoại di động -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item cssClass=\"vat layout_input\" dataField=\"buyer_name\"\r\n            [editorOptions]=\"{disabled: tod.buyer_name,onValueChanged: customerChanged}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.buyer_name }}\"></dxo-label>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"buyer_mobile\" [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.phone }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.phone\"\r\n              message=\"{{ _translate.CONTROLL.LABEL.phone }} {{ _translate.VALIDATION.not_pattern }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Địa chỉ -->\r\n        <dxi-item cssClass=\"vat layout_input\" *ngIf=\"!configs.system_parameter.view_bank_account_seller\"\r\n          dataField=\"buyer_address\" [editorOptions]=\"{disabled: tod.buyer_address,onValueChanged: customerChanged}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.address }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Email -->\r\n        <dxi-item [label]=\"{text: 'Email'}\" cssClass=\"vat layout_input\"\r\n          [ngClass]=\"configs.system_parameter.view_bank_account_seller? 'vat layout_input' : ''\">\r\n          <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n            <div\r\n              class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n              <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                </app-tag-input-email>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </dxi-item>\r\n        <!-- Các trường cấu hình thêm -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.view_bank_account_seller\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item cssClass=\"vat layout_input\" dataField=\"buyer_address\"\r\n            [editorOptions]=\"{disabled: tod.buyer_address,onValueChanged: customerChanged}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.address }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"configs.system_parameter.view_bank_account_seller\" dataField=\"seller_bank_account_number\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.list_bank_account_seller, onValueChanged: bankAccountSellerChange, displayExpr: 'name_display', valueExpr: 'code', showClearButton: true}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.seller_bank_account_name }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- nơi xuất hóa đơn -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.display_export_place\" dataField=\"export_place\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.export_places, onValueChanged: exportPlaceChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.export_place }}\"></dxo-label>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"configs.system_parameter.display_export_place\" dataField=\"export_address\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.export_address }}\"></dxo-label>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"configs.system_parameter.display_transport_number\" dataField=\"transport_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.transport_number }}\"></dxo-label>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"configs.system_parameter.display_transport_number\" dataField=\"train_name\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.train_name }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- <dxi-item [visible]=\"isProcessInvOriginOther\" itemType=\"group\" [colCount]=\"2\"></dxi-item> -->\r\n        <!-- Loại hóa đơn gốc -->\r\n        <!-- Điều khoản giao hàng -->\r\n        <dxi-item dataField=\"delivery_terms\" *ngIf=\"configs.system_parameter.delivery_terms\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.delivery_terms }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Chứng từ tham chiếu -->\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.vouchers_reference}\" dataField=\"license_number\"\r\n          *ngIf=\"configs.system_parameter.vouchers_reference\">\r\n        </dxi-item>\r\n        <!-- Số S/O -->\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.so_so }\" dataField=\"the_order\"\r\n          *ngIf=\"configs.system_parameter.invoice_the_order\">\r\n        </dxi-item>\r\n        <!-- Thời hạn thanh toán -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.payment_expire\">\r\n          <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.payment_time }\" dataField=\"payment_expire\">\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Số phiếu xuất kho -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.receipts_no\" dataField=\"receipts_no\" [colCount]=\"1\">\r\n          <dxo-label text=\"{{ _translate.GRID.INVOICE.receipts_no }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Ngày giao hàng -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.from_warehouse_date\" dataField=\"from_warehouse_date\"\r\n          [template]=\"'deliverydata'\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.delivery_date }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Xuất cho khách hàng -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.ship_receiving_name\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item dataField=\"ship_receiving_name\">\r\n            <dxo-label text=\"{{ _translate.CONFIGS.ship_receiving_name }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Hình thức bán hàng -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.form_sales\">\r\n          <dxi-item [label]=\"{text: _translate.CONFIGS.form_sales}\" dataField=\"sell_form\">\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!--Thông tin other_id -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.other_id\" dataField=\"other_id\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.other_id }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Địa chỉ nhận hàng -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.ship_receiving_address\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item dataField=\"ship_receiving_address\">\r\n            <dxo-label text=\"{{ _translate.CONFIGS.ship_receiving_address }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <div *dxTemplate=\"let d of 'deliverydata'\">\r\n        <dx-date-box [(value)]=\"frmData.from_warehouse_date\" type=\"date\" [useMaskBehavior]=\"true\"\r\n          [displayFormat]=\"'dd/MM/yyyy'\" [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n    </dx-form>\r\n    <dx-form style=\"margin-top:7px\" [formData]=\"customerTempt\" [items]=\"formItems\" class=\"customer-tempt\">\r\n    </dx-form>\r\n  </div>\r\n</div>\r\n<dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"Thông báo\" [dragEnabled]=\"false\"\r\n  [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">{{_translate.CONFIRM.update_customer}}</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"capNhatDmKhachHang()\" text=\"{{_translate.CONTROLL.LABEL.update}}\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"huy()\" text=\"{{_translate.CONTROLL.BUTTON.cancel}}\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.scss":
/*!******************************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.scss ***!
  \******************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "::ng-deep .vat.invoice-number-create-invoice input{color:red;font-weight:bold}::ng-deep .in-hoa input{text-transform:uppercase}.icon-size{font-size:21px;padding:2px 0}.button-tax-code{background:#337ab7;color:#fff;border-color:transparent;border:none}.button-tax-code:focus{outline:none}::ng-deep .vat.invoice-note input{color:#0070C0;font-weight:bold}::ng-deep .vat.layout_input span.dx-field-item-label-content{width:117px !important}::ng-deep .vat1.layout_input span.dx-field-item-label-content{width:144px !important}::ng-deep .layout_input_left span.dx-field-item-label-content{width:144px !important}::ng-deep .customer-tempt .dx-layout-manager .dx-label-h-align .dx-field-item-label .dx-field-item-label-content{min-width:171px !important}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.ts":
/*!****************************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.ts ***!
  \****************************************************************************************************************************************/
/*! exports provided: AdjustMultiplFormInvoiceComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustMultiplFormInvoiceComponent", function() { return AdjustMultiplFormInvoiceComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @core/library/public/v-select-box.service */ "./src/app/core/library/public/v-select-box.service.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _modules_customers_shared__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @modules/customers/shared */ "./src/app/modules/customers/shared/index.ts");
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _angular_common_http__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @angular/common/http */ "./node_modules/@angular/common/fesm5/http.js");
/* harmony import */ var _modules_lists_shared__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @modules/lists/shared */ "./src/app/modules/lists/shared/index.ts");
/* harmony import */ var _modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @modules/handle-invoice/components/choose-hdck/choose-hdck.component */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};

















var AdjustMultiplFormInvoiceComponent = /** @class */ (function () {
    function AdjustMultiplFormInvoiceComponent(authService, route, modalService, vatService, translate, customersService, http, listService) {
        var _this = this;
        this.authService = authService;
        this.route = route;
        this.modalService = modalService;
        this.vatService = vatService;
        this.translate = translate;
        this.customersService = customersService;
        this.http = http;
        this.listService = listService;
        this.formEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateTypeChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.adjustmentObject = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateTT78TypeChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.select = {};
        this.pattern = _config_index__WEBPACK_IMPORTED_MODULE_8__["pattern"];
        this.tax_codes = [];
        this.customer_codes = [];
        this.showTraLai = false;
        this.disableInvoiceDate = this.authService.isAllowEditInvoiceDate();
        this.htXuatOptions = [];
        this.showPopup = false;
        this.isHoaDonGoc = false;
        this.customerCurent = {};
        this.emails = [];
        this.configs = {};
        this.arrEmail = [];
        // thay đổi disable của 3 input customer_name, buyer_name, buyer_address
        this.tod = {};
        this.formItems = [];
        this.customForms = [];
        this.customerTempt = {};
        this.httpOptions = {
            headers: new _angular_common_http__WEBPACK_IMPORTED_MODULE_14__["HttpHeaders"]({
                'Authorization': "Bearer " + JSON.parse(localStorage.getItem('access_token')).value,
                'TaxCode': JSON.parse(localStorage['currentUser']).account.tax_code,
                'Content-Type': 'application/json',
            })
        };
        this.isAdjustInv = false;
        this.isProcessInvOriginOther = false;
        this.mst_btn_options = {
            text: '', icon: 'fa fa-plus-circle', type: 'default',
            onClick: function () {
                var initialState = {
                    isVisibleGhiVaThemMoi: false
                };
                _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_10__["AddCustomerComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                var submodal = _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveData) {
                        var customer = _this.bsModalRef.content.successSaveData;
                        _this.frmData.customer_name = customer.name;
                        _this.frmData.buyer_tax_code = customer.tax_code;
                        _this.frmData.buyer_name = customer.contact_person_name;
                        _this.frmData.buyer_address = customer.business_address;
                        _this.frmData.customer_code = customer.code;
                        _this.frmData.buyer_mobile = customer.contact_mobile;
                        if (customer.email) {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                            var stringDataEmailGet = customer.email.split(';');
                            for (var i = 0; i < stringDataEmailGet.length; i++) {
                                _this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
                            }
                        }
                        else {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                        }
                        if (customer.bank_account_number) {
                            _this.frmData.bank_account_number = customer.bank_account_number;
                        }
                        if (customer.bank_name) {
                            _this.frmData.bank_name = customer.bank_name;
                        }
                    }
                    submodal.unsubscribe();
                });
            }
        };
        this.updateCustomerInfo = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.code) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.customer_code)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.updateTaxcodeInfo = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.tax_code) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_tax_code)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        // sự kiện
        this.taxCodeKeyUp = function (e) {
            var str = _this.frmData.buyer_tax_code;
            var len = str.length;
            if (len >= 3) {
                _this.vatService.searchMST(str).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        var arr_1 = [];
                        rs.data.customers.forEach(function (item) {
                            arr_1.push(item);
                        });
                        _this.tax_codes = arr_1;
                    }
                });
            }
        };
        this.customerChanged = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.name) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.customer_name)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.contact_person_name) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_name)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.contact_mobile) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_mobile)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.business_address) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_address)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.email) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_email)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.bank_name) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.bank_name)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.bank_account_number) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.bank_account_number)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.customer_object_codeChange = function (e) {
            _this.setDisabledByCustomer_object_code(e.value);
        };
        this.adjustmentObjectChange = function (e) {
        };
        this.templateChange = function (e) {
            _this.select.invoice_releases.forEach(function (item) {
                if (e.value === item.value) {
                    _this.frmData.template_id = item.template_id;
                    _this.frmData.template_code = item.template_code;
                    _this.onTemplateChange.emit(item.is_multi_vat);
                    _this.onTemplateTypeChange.emit(item);
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            var value = item[key];
                            _this._objTemplateSelect[key] = value;
                        }
                    }
                    if (!_this._objTemplateSelect.is_discount) {
                        _this.dataSource.items().forEach(function (item3) {
                            item3.discount = null;
                            item3.amount_discount = null;
                        });
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._objTemplateSelect, _this.configs.system_parameter);
                        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBay
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonXangDau) {
                            _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type));
                        }
                    }
                    // Nếu là mẫu html
                    if (item.fields) {
                        _this.formItems = [];
                        _this.customForms = [];
                        var _arrayGrid = item.fields.filter(function (x) { return x.type === '5'; });
                        if (_arrayGrid && _arrayGrid.length > 0) {
                            _this.extentionGrid.ma_hang = false;
                            _this.extentionGrid.so_lo = false;
                            _this.extentionGrid.han_dung = false;
                            _this.extentionGrid.nuoc_san_xuat = false;
                            _this.extentionGrid.don_hang_hop_dong = false;
                            for (var i = 0; i < _arrayGrid.length; i++) {
                                var column = _arrayGrid[i]['name'];
                                var value = _arrayGrid[i]['is_show'];
                                var _ma = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column);
                                _this.extentionGrid[_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column)] = value;
                            }
                        }
                        var _dulieumorong_1 = item.fields.filter(function (x) { return x.type === '4'; });
                        if (_dulieumorong_1.length > 0) {
                            _dulieumorong_1.forEach(function (item1) {
                                if (item1.is_show) {
                                    if (item1.data_type === 'chu') {
                                        _this.customForms.push({
                                            cssClass: 'vat layout_input',
                                            editorType: 'dxTextBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_1);
                                                }
                                            }
                                        });
                                    }
                                    if (item1.data_type === 'soluong') {
                                        _this.customForms.push({
                                            cssClass: 'vat layout_input',
                                            editorType: 'dxNumberBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_1);
                                                }
                                            }
                                        });
                                    }
                                    if (item1.data_type === 'ngay') {
                                        _this.customForms.push({
                                            cssClass: 'vat layout_input',
                                            editorType: 'dxDateBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_1);
                                                }, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss',
                                            }
                                        });
                                    }
                                    if (item1.data_type === 'danhmuc') {
                                        _this.customForms.push({
                                            cssClass: 'vat layout_input',
                                            editorType: 'dxSelectBox',
                                            dataField: item1.code,
                                            label: { text: item1.name }
                                        });
                                    }
                                }
                            });
                            _this.formItems.push(_this.createCustomGroup());
                        }
                        _dulieumorong_1.forEach(function (value) {
                            _this.customerTempt[value.code] = value.value;
                        });
                    }
                    else {
                        _this.formItems = [];
                        _this.customerTempt = {};
                        _this.extentionGrid.ma_hang = false;
                        _this.extentionGrid.so_lo = false;
                        _this.extentionGrid.han_dung = false;
                        _this.extentionGrid.nuoc_san_xuat = false;
                        _this.extentionGrid.don_hang_hop_dong = false;
                    }
                }
            });
        };
        this.onChangeTem = function (e) {
            _this.select.templatesTT78.forEach(function (item) {
                if (e.value === item.value) {
                    _this.frmData.invoice_release_id = "";
                    _this.frmData.template_id = item.value;
                    _this.frmData.invoice_series = item.invoice_series;
                    _this.frmData.template_code = item.template_code;
                    _this.onTemplateChange.emit(item.is_multi_vat);
                    _this.onTemplateTT78TypeChange.emit(item);
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            var value = item[key];
                            _this._oTemplateTT78[key] = value;
                        }
                    }
                    if (!_this._oTemplateTT78.is_discount) {
                        _this.invoice_products.load().then(function (dataSource) {
                            dataSource.forEach(function (item, index) {
                                item.discount = null;
                                item.amount_discount = null;
                            });
                        });
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._oTemplateTT78, _this.configs.system_parameter);
                        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBay
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonXangDau) {
                            _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type));
                        }
                    }
                    // Nếu là mẫu html
                    if (item.fields) {
                        _this.formItems = [];
                        _this.customForms = [];
                        var _arrayGrid = item.fields.filter(function (x) { return x.type === '5'; });
                        if (_arrayGrid && _arrayGrid.length > 0) {
                            _this.extentionGrid.ma_hang = false;
                            _this.extentionGrid.so_lo = false;
                            _this.extentionGrid.han_dung = false;
                            _this.extentionGrid.nuoc_san_xuat = false;
                            _this.extentionGrid.don_hang_hop_dong = false;
                            _this.extentionGrid.ma_quan_ly = false;
                            for (var i = 0; i < _arrayGrid.length; i++) {
                                var column = _arrayGrid[i]['name'];
                                var value = _arrayGrid[i]['is_show'];
                                var _ma = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column);
                                _this.extentionGrid[_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column)] = value;
                            }
                        }
                        var _dulieumorong_2 = item.fields.filter(function (x) { return x.type === '4'; });
                        if (_dulieumorong_2.length > 0) {
                            _dulieumorong_2.forEach(function (item1) {
                                if (item1.is_show) {
                                    if (item1.data_type === 'chu') {
                                        _this.customForms.push({
                                            //  cssClass: 'vat layout_input',
                                            editorType: 'dxTextBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_2);
                                                }
                                            }
                                        });
                                    }
                                    if (item1.data_type === 'soluong') {
                                        _this.customForms.push({
                                            //    cssClass: 'vat layout_input',
                                            editorType: 'dxNumberBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_2);
                                                }
                                            }
                                        });
                                    }
                                    if (item1.data_type === 'ngay') {
                                        _this.customForms.push({
                                            //   cssClass: 'vat layout_input',
                                            editorType: 'dxDateBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_2);
                                                }, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss',
                                            }
                                        });
                                    }
                                    if (item1.data_type === 'danhmuc') {
                                        _this.customForms.push({
                                            //    cssClass: 'vat layout_input',
                                            editorType: 'dxSelectBox',
                                            dataField: item1.code,
                                            label: { text: item1.name }
                                        });
                                    }
                                }
                            });
                            _this.formItems.push(_this.createCustomGroup());
                            _this.frmData.invoice_options = _dulieumorong_2;
                        }
                        else
                            _this.frmData.invoice_options = [];
                        _dulieumorong_2.forEach(function (value) {
                            _this.customerTempt[value.code] = value.value;
                        });
                    }
                    else {
                        _this.formItems = [];
                        _this.customerTempt = {};
                        _this.extentionGrid.ma_hang = false;
                        _this.extentionGrid.so_lo = false;
                        _this.extentionGrid.han_dung = false;
                        _this.extentionGrid.nuoc_san_xuat = false;
                        _this.extentionGrid.don_hang_hop_dong = false;
                        _this.extentionGrid.ma_quan_ly = false;
                        // this.frmData.invoice_options = [];
                    }
                }
            });
        };
        this.currencyCodeChange = function (e) {
            if (_this.frmData.currency_code === 'VND') {
                _this.frmData.currency_rate = null;
            }
            _this.doctienbangchu(_this.frmData.total_payment, _this.frmData.currency_code);
            // this.frmData.total_payment_in_word = Helper.tienBangChu(this.frmData.total_payment, VChanggeMoneyService.getFormatterToNumber(this.formatter.tong_tien), this.frmData.currency_code, this.configs.system_parameter.display_read_money_english);
        };
        this.currencyRateChange = function (e) {
            if (!_this.isTT78)
                _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._objTemplateSelect, _this.configs.system_parameter);
            else
                _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._oTemplateTT78, _this.configs.system_parameter);
        };
        this.exportPlaceChange = function (e) {
            var _obj = _this.select.export_places.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.export_address = _obj.dia_chi;
                _this.frmData.export_place_name = _obj.name;
            }
        };
        this.bankAccountSellerChange = function (e) {
            var _obj = _this.select.list_bank_account_seller.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.seller_bank_account_name = _obj.name;
                // this.frmData.export_place_name = _obj.name;
            }
            else {
                _this.frmData.seller_bank_account_name = '';
            }
        };
        this.paymentMethodChange = function (e) {
            var _obj = _this.select.payment_method_names.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.payment_method_view_name = _obj.name;
            }
        };
        this.adjustmentFormChange = function (e) {
            _this.adjustmentObject.emit(e.value);
            switch (e.value) {
                case 'THONG_TIN':
                    _this.select.adjustment_objects = [
                        {
                            name: 'Mã số thuế',
                            code: 'MST'
                        },
                        {
                            name: 'Tiền chữ',
                            code: 'TIEN_CHU'
                        },
                        {
                            name: 'Tên khách hàng, Địa chỉ, ...',
                            code: 'KH_DC'
                        },
                    ];
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "");
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "");
                    }
                    break;
                case 'TANG':
                    _this.select.adjustment_objects = [
                        {
                            name: 'Hàng hóa dịch vụ',
                            code: 'HH_DV'
                        },
                        {
                            name: 'Khác',
                            code: 'KHAC_TANG'
                        },
                    ];
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.total_payment_in_word) != "" && _this.frmData.total_payment_in_word != "Không đồng chẵn.") {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "Tăng ");
                        if (_this.isTT78) {
                            if (_this.frmData.total_payment_in_word.includes('Tăng') == false)
                                _this.frmData.total_payment_in_word = "Tăng " + _this.frmData.total_payment_in_word;
                        }
                    }
                    break;
                case 'GIAM':
                    _this.select.adjustment_objects = [
                        {
                            name: 'Hàng hóa dịch vụ',
                            code: 'HH_DV'
                        },
                        {
                            name: 'Khác',
                            code: 'KHAC_GIAM'
                        },
                    ];
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.total_payment_in_word) != "" && _this.frmData.total_payment_in_word != "Không đồng chẵn.") {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "Giảm ");
                        if (_this.isTT78) {
                            if (_this.frmData.total_payment_in_word.includes('Giảm') == false)
                                _this.frmData.total_payment_in_word = "Giảm " + _this.frmData.total_payment_in_word;
                        }
                    }
                    break;
                case 'TANG_GIAM':
                    _this.select.adjustment_objects = [
                        {
                            name: 'Điều chỉnh tăng giảm đồng thời',
                            code: 'TANG_GIAM'
                        },
                    ];
                    _this.frmData.adjustment_object = 'TANG_GIAM';
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "");
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "");
                        if (_this.isTT78) {
                            if (_this.frmData.total_payment > 0) {
                                if (_this.frmData.total_payment_in_word.includes('Tăng') == false)
                                    _this.frmData.total_payment_in_word = "Tăng " + _this.frmData.total_payment_in_word;
                            }
                            if (_this.frmData.total_payment < 0) {
                                if (_this.frmData.total_payment_in_word.includes('Giảm') == false)
                                    _this.frmData.total_payment_in_word = "Giảm " + _this.frmData.total_payment_in_word;
                            }
                        }
                    }
                    break;
                case 'KHAC':
                    _this.select.adjustment_objects = [
                        {
                            name: 'Khác',
                            code: 'KHAC'
                        },
                    ];
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "");
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "");
                    }
                    _this.frmData.adjustment_object = 'KHAC';
                    break;
                default:
                    break;
            }
        };
        this.templateCodeChanged = function (e) {
            _this.frmData.invoice_origin.relate_template_code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._removeNewline(e.value).toUpperCase();
        };
        this.invoiceSeriesChanged = function (e) {
            _this.frmData.invoice_origin.relate_invoice_series = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._removeNewline(e.value).toUpperCase();
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
    }
    AdjustMultiplFormInvoiceComponent.prototype.ngAfterViewInit = function () {
    };
    AdjustMultiplFormInvoiceComponent.prototype.ngOnInit = function () {
        var _this = this;
        if (this.htHoaDonGoc == '4') {
            this.isHoaDonGoc = true;
        }
        else {
            this.isHoaDonGoc = false;
        }
        this.htXuatOptions = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._htXuatOptions(this._translate, this.frmData.status);
        this.role_branch = this.listService.getDataConfigLocalStorage();
        if (this.route.snapshot.queryParams['status'] === 'return') {
            this.showTraLai = true;
            this.frmData.nguoitralai = this.authService.getCurrentUser().user.name;
            this.frmData.ngaytralai = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD');
        }
        this.routeSub = this.route.data.subscribe(function (data) {
            var loaiDieuChinh = data.type;
            if (loaiDieuChinh == "dieu-chinh-nhieu" || loaiDieuChinh == "dieu-chinh-khac") {
                _this.isAdjustInv = true;
                if (loaiDieuChinh == "dieu-chinh-khac")
                    _this.isProcessInvOriginOther = true;
            }
            else if (loaiDieuChinh == "thay-the-khac") {
                _this.isProcessInvOriginOther = true;
            }
            _this.configs = _this.authService.getConfigs();
            var danh_muc = _this.authService.getDMLocal();
            _this.select.unit_codes = danh_muc.DM_DON_VI_TINH ? danh_muc.DM_DON_VI_TINH.data : null;
            _this.select.payment_method_names = danh_muc.DM_HINH_THUC_THANH_TOAN ? danh_muc.DM_HINH_THUC_THANH_TOAN.data : null;
            _this.select.currency_codes = danh_muc.DM_LOAI_TIEN ? danh_muc.DM_LOAI_TIEN.data : null;
            _this.select.customer_types = danh_muc.DM_NHOM_KHACH_HANG ? danh_muc.DM_NHOM_KHACH_HANG.data : null;
            _this.select.export_places = danh_muc.DM_NOI_XUAT_HOA_DON ? danh_muc.DM_NOI_XUAT_HOA_DON.data : null;
            _this.select.list_bank_account_seller = danh_muc.DM_TAI_KHOAN_NGAN_HANG ? danh_muc.DM_TAI_KHOAN_NGAN_HANG.data : null;
            _this.select.list_bank_account_seller.forEach(function (item) {
                item.name_display = item.code + ': ' + item.name;
            });
            if (_this.isTT78) {
                var temptTT78 = [];
                if (!_this.frmData.id) {
                    temptTT78 = data.init[1];
                }
                else {
                    temptTT78 = data.init[3];
                }
                if (temptTT78 && temptTT78.length > 0) {
                    _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.infoDangKy.is_invoice_with_code; });
                    if (Number.parseInt(_this.frmData.invoice_number) > 0) {
                        if (_this.frmData.is_invoice_with_code != _this.infoDangKy.is_invoice_with_code) {
                            _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.frmData.is_invoice_with_code; });
                        }
                    }
                }
                if (_this.frmData.id)
                    _this.changeTemplateInvoice(_this.frmData.invoice_date);
            }
            else {
                _this.select.invoice_releases = data.init[0];
                if (!_this.frmData.id) {
                    _this.select.invoice_releases = _this.select.invoice_releases.filter(function (p) { return p.number_survival > 0 && p.release_status != 'DA_HUY_SO'; });
                }
            }
        });
        this.select.customer_object_codes = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._customerObject(this._translate);
        this.select.adjustment_forms = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._adjustmentForms(this._translate);
        //   this.select.adjustment_forms = this.select.adjustment_forms.filter(p=>p.code !=="TANG_GIAM");
        this.select.adjustment_objects = [];
        if (this.frmData.adjustment_form) {
            this.adjustmentFormChange({ value: this.frmData.adjustment_form });
        }
        // Set disabled cho đơn vị tổ chức
        this.setDisabledByCustomer_object_code(this.frmData.customer_object_code);
        // tìm kiếm mã số thuế
        this.tax_codes = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default.a({
            load: function (loadOptions) {
                return _this.vatService.getDataSourceForm(loadOptions.searchValue, 'tax_code');
            }
        });
        // // tìm kiếm mã khách hàng
        this.customer_codes = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default.a({
            load: function (loadOptions) {
                return _this.vatService.getDataSourceForm(loadOptions.searchValue, 'code');
            }
        });
        if (!this.isTT78) {
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id === _this.frmData.template_id) {
                    // Nếu là mẫu html
                    _this.onTemplateChange.emit(item.is_multi_vat);
                    _this.onTemplateTypeChange.emit(item);
                    if (item.fields && item.fields.length > 0) {
                        _this.formItems = [];
                        _this.customForms = [];
                        var _arrayGrid = item.fields.filter(function (x) { return x.type === '5'; });
                        if (_arrayGrid && _arrayGrid.length > 0) {
                            _this.extentionGrid.ma_hang = false;
                            _this.extentionGrid.so_lo = false;
                            _this.extentionGrid.han_dung = false;
                            _this.extentionGrid.nuoc_san_xuat = false;
                            _this.extentionGrid.don_hang_hop_dong = false;
                            for (var i = 0; i < _arrayGrid.length; i++) {
                                var column = _arrayGrid[i]['name'];
                                var value = _arrayGrid[i]['is_show'];
                                var _ma = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column);
                                _this.extentionGrid[_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column)] = value;
                            }
                        }
                        var _dulieumorong_3 = item.fields.filter(function (x) { return x.type === '4'; });
                        if (_dulieumorong_3.length > 0) {
                            _dulieumorong_3.forEach(function (item1) {
                                if (item1.is_show) {
                                    if (item1.data_type === 'chu') {
                                        _this.customForms.push({
                                            editorType: 'dxTextBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_3);
                                                }
                                            }
                                        });
                                    }
                                    if (item.data_type === 'soluong') {
                                        _this.customForms.push({
                                            editorType: 'dxNumberBox',
                                            dataField: item.code,
                                            label: { text: item.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_3);
                                                }
                                            }
                                        });
                                    }
                                    if (item.data_type === 'ngay') {
                                        _this.customForms.push({
                                            editorType: 'dxDateBox',
                                            dataField: item.code,
                                            label: { text: item.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_3);
                                                }, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss',
                                            }
                                        });
                                    }
                                    if (item.data_type === 'danhmuc') {
                                        _this.customForms.push({
                                            editorType: 'dxSelectBox',
                                            dataField: item.code,
                                            label: { text: item.name }
                                        });
                                    }
                                }
                            });
                            _this.formItems.push(_this.createCustomGroup());
                        }
                        if (_this.frmData.invoice_options && _this.frmData.invoice_options.length > 0) {
                            _this.frmData.invoice_options.forEach(function (iteminv) {
                                _this.customerTempt[iteminv.code] = iteminv.value;
                            });
                        }
                        else {
                            _dulieumorong_3.forEach(function (item2) {
                                _this.customerTempt[item2.code] = item2.value;
                            });
                        }
                    }
                }
            });
        }
        else {
            this.select.templatesTT78.forEach(function (item) {
                if (item.value === _this.frmData.template_id) {
                    _this.frmData.invoice_release_id = "";
                    // Nếu là mẫu html
                    if (item.fields && item.fields.length > 0) {
                        _this.formItems = [];
                        _this.customForms = [];
                        var _arrayGrid = item.fields.filter(function (x) { return x.type === '5'; });
                        if (_arrayGrid && _arrayGrid.length > 0) {
                            _this.extentionGrid.ma_hang = false;
                            _this.extentionGrid.so_lo = false;
                            _this.extentionGrid.han_dung = false;
                            _this.extentionGrid.nuoc_san_xuat = false;
                            _this.extentionGrid.don_hang_hop_dong = false;
                            _this.extentionGrid.ma_quan_ly = false;
                            for (var i = 0; i < _arrayGrid.length; i++) {
                                var column = _arrayGrid[i]['name'];
                                var value = _arrayGrid[i]['is_show'];
                                var _ma = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column);
                                _this.extentionGrid[_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column)] = value;
                            }
                        }
                        var _dulieumorong_4 = item.fields.filter(function (x) { return x.type === '4'; });
                        if (_dulieumorong_4.length > 0) {
                            _dulieumorong_4.forEach(function (item1) {
                                if (item1.is_show) {
                                    if (item1.data_type === 'chu') {
                                        _this.customForms.push({
                                            editorType: 'dxTextBox',
                                            dataField: item1.code,
                                            label: { text: item1.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_4);
                                                }
                                            }
                                        });
                                    }
                                    if (item.data_type === 'soluong') {
                                        _this.customForms.push({
                                            editorType: 'dxNumberBox',
                                            dataField: item.code,
                                            label: { text: item.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_4);
                                                }
                                            }
                                        });
                                    }
                                    if (item.data_type === 'ngay') {
                                        _this.customForms.push({
                                            editorType: 'dxDateBox',
                                            dataField: item.code,
                                            label: { text: item.name },
                                            editorOptions: {
                                                onValueChanged: function () {
                                                    _this.changeItem(_dulieumorong_4);
                                                }, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss',
                                            }
                                        });
                                    }
                                    if (item.data_type === 'danhmuc') {
                                        _this.customForms.push({
                                            editorType: 'dxSelectBox',
                                            dataField: item.code,
                                            label: { text: item.name }
                                        });
                                    }
                                }
                            });
                            _this.formItems.push(_this.createCustomGroup());
                        }
                        if (_this.frmData.invoice_options && _this.frmData.invoice_options.length > 0) {
                            _this.frmData.invoice_options.forEach(function (iteminv) {
                                _this.customerTempt[iteminv.code] = iteminv.value;
                            });
                        }
                        else {
                            _dulieumorong_4.forEach(function (item2) {
                                _this.customerTempt[item2.code] = item2.value;
                            });
                            _this.frmData.invoice_options = _dulieumorong_4;
                        }
                    }
                }
            });
        }
        if (this.frmData.buyer_email) {
            this.emails = [];
            var emailToString = this.frmData.buyer_email;
            var a11 = emailToString.replace(/;/g, ',');
            this.emails = a11.split(',');
        }
        this.oCaption =
            {
                loai_hd_goc: this._translate.CONTROLL.LABEL.type + " " + this._translate.GRID.GENERAL.original_invoice.toLowerCase(),
                mau_so_hd_goc: this._translate.GRID.INVOICE.template_code + " " + this._translate.CONTROLL.BUTTON.invoice_origin,
                ky_hieu_hd_goc: this._translate.GRID.INVOICE.invoice_series + " " + this._translate.CONTROLL.BUTTON.invoice_origin,
                so_hd_goc: this._translate.CONTROLL.LABEL.number + " " + this._translate.CONTROLL.BUTTON.invoice_origin,
                ngay_hd_goc: this._translate.CONFIGS.day + " " + this._translate.CONTROLL.BUTTON.invoice_origin,
            };
        this.typeInvoices = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"].typeEInvoice(this._translate);
    };
    AdjustMultiplFormInvoiceComponent.prototype.createForm = function () {
        this.form.instance.beginUpdate();
        this.form.instance.itemOption('business_addressa', { label: { text: 'Đia chỉaaa' }, editorOptions: { placeholder: 'Nhập địa chỉ' } });
        this.form.instance.endUpdate();
    };
    AdjustMultiplFormInvoiceComponent.prototype.editTaxCode = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var roleUser, _a, _b, initialState, submodal;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        this.listRoleBranchOrigin = [];
                        if (!this.role_branch) return [3 /*break*/, 6];
                        return [4 /*yield*/, this.listService.getDataUserLocalStorege()];
                    case 1:
                        roleUser = _c.sent();
                        if (!roleUser) return [3 /*break*/, 3];
                        _a = this;
                        return [4 /*yield*/, this.handleListRoleBranch(roleUser)];
                    case 2:
                        _a.listRoleBranchOrigin = _c.sent();
                        return [3 /*break*/, 5];
                    case 3:
                        _b = this;
                        return [4 /*yield*/, this.listService.handleListRoleBranchUser()];
                    case 4:
                        _b.listRoleBranchOrigin = _c.sent();
                        _c.label = 5;
                    case 5:
                        if (Array.isArray(this.listRoleBranchOrigin) && this.listRoleBranchOrigin.length) {
                            if (this.listRoleBranchOrigin.length === 2) {
                                this.listRoleBranchOrigin = this.listRoleBranchOrigin.filter(function (value) {
                                    if (value.code !== 'TAT_CA') {
                                        value.checked = true;
                                        return value;
                                    }
                                });
                            }
                        }
                        _c.label = 6;
                    case 6:
                        initialState = {
                            isVisibleGhiVaThemMoi: false,
                            role_branch: this.role_branch,
                            roleBranchStatus: this.listRoleBranchOrigin
                        };
                        this.bsModalRef = this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_10__["AddCustomerComponent"], {
                            class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                            keyboard: false
                        });
                        submodal = this.modalService.onHide.subscribe(function () {
                            if (_this.bsModalRef.content.successSaveData) {
                                var customer = _this.bsModalRef.content.successSaveData;
                                _this.frmData.customer_name = customer.name;
                                _this.frmData.buyer_tax_code = customer.tax_code;
                                _this.frmData.buyer_name = customer.contact_person_name;
                                _this.frmData.buyer_address = customer.business_address;
                                _this.frmData.customer_code = customer.code;
                                _this.frmData.buyer_mobile = customer.contact_mobile;
                                if (customer.email) {
                                    _this.frmData.buyer_email = customer.email;
                                    _this.emails = [];
                                    var stringDataEmailGet = customer.email.split(';');
                                    for (var i = 0; i < stringDataEmailGet.length; i++) {
                                        _this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
                                    }
                                }
                                else {
                                    _this.frmData.buyer_email = customer.email;
                                    _this.emails = [];
                                }
                                if (customer.bank_account_number) {
                                    _this.frmData.bank_account_number = customer.bank_account_number;
                                }
                                if (customer.bank_name) {
                                    _this.frmData.bank_name = customer.bank_name;
                                }
                            }
                            submodal.unsubscribe();
                        });
                        return [2 /*return*/];
                }
            });
        });
    };
    ////// Tạo form mở rộng
    AdjustMultiplFormInvoiceComponent.prototype.createCustomGroup = function () {
        return {
            itemType: 'group',
            colCount: '1',
            items: this.customForms
        };
    };
    /////// sự kiện thay đổi các trường mở rộng
    AdjustMultiplFormInvoiceComponent.prototype.changeItem = function (_dulieumorong) {
        var _this = this;
        _dulieumorong.forEach(function (item) {
            for (var key in _this.customerTempt) {
                if (item.code === key) {
                    item.value = _this.customerTempt[key];
                }
            }
            _this.frmData.invoice_options = _dulieumorong;
        });
    };
    AdjustMultiplFormInvoiceComponent.prototype.handleListRoleBranch = function (roleUser) {
        return __awaiter(this, void 0, void 0, function () {
            var arrList;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.listService.handleGetDMtoCustomer(roleUser)];
                    case 1:
                        arrList = _a.sent();
                        if (Array.isArray(arrList) && arrList.length) {
                            return [2 /*return*/, this.listService.handleCheckAll(arrList)];
                        }
                        return [2 /*return*/, null];
                }
            });
        });
    };
    AdjustMultiplFormInvoiceComponent.prototype.disableTemplateInput = function () {
        if (this.frmData.invoice_number) {
            return true;
        }
        return false;
    };
    AdjustMultiplFormInvoiceComponent.prototype.readonlyAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = true;
        });
        this.readOnlyCacTruongConLai = true;
    };
    AdjustMultiplFormInvoiceComponent.prototype.removeReadonlyAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = false;
            // item.instance.resetValues();
        });
        this.readOnlyCacTruongConLai = false;
    };
    AdjustMultiplFormInvoiceComponent.prototype.setDisabledByCustomer_object_code = function (value) {
        this.tod.customer_name = false;
        this.tod.buyer_name = false;
        this.tod.buyer_address = false;
        switch (value) {
            case 'DOANH_NGHIEP':
                break;
            case 'CA_NHAN':
                this.frmData.customer_name = '';
                this.tod.customer_name = true;
                break;
            case 'KHACH_LE':
                this.frmData.customer_name = '';
                this.frmData.buyer_address = '';
                this.tod.customer_name = true;
                this.tod.buyer_address = true;
                break;
            default:
                break;
        }
    };
    // gửi data lên parent component
    AdjustMultiplFormInvoiceComponent.prototype.onFieldDataChanged = function () {
        this.formEvent.emit(this.frmData);
    };
    AdjustMultiplFormInvoiceComponent.prototype.getHtXuatValue = function () {
        return this.frmData.status;
    };
    AdjustMultiplFormInvoiceComponent.prototype.getFrmData = function () {
        return this.frmData;
    };
    AdjustMultiplFormInvoiceComponent.prototype.taxCodeChoose = function (e) {
        var customer = e.itemData;
        if (this.frmData.customer_object_code !== 'CA_NHAN' && this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.customer_name = customer.name;
        }
        this.frmData.buyer_name = customer.contact_person_name;
        if (this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.buyer_address = customer.business_address;
        }
        this.frmData.customer_code = customer.code;
        this.frmData.buyer_mobile = customer.contact_mobile;
        if (customer.email) {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
            var stringDataEmailGet = customer.email.split(';');
            for (var i = 0; i < stringDataEmailGet.length; i++) {
                this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
            }
        }
        else {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
        }
        this.frmData.customer_id = customer.id;
        this.frmData.bank_account_number = customer.bank_account_number ? customer.bank_account_number : '';
        this.frmData.bank_name = customer.bank_name ? customer.bank_name : '';
        ////
        this.onFieldDataChanged();
    };
    AdjustMultiplFormInvoiceComponent.prototype.customerCodeChoose = function (e) {
        var customer = e.itemData;
        if (this.frmData.customer_object_code !== 'CA_NHAN' && this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.customer_name = customer.name;
        }
        this.frmData.buyer_name = customer.contact_person_name;
        if (this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.buyer_address = customer.business_address;
        }
        this.frmData.buyer_tax_code = customer.tax_code;
        this.frmData.buyer_mobile = customer.contact_mobile;
        if (customer.email) {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
            var stringDataEmailGet = customer.email.split(';');
            for (var i = 0; i < stringDataEmailGet.length; i++) {
                this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
            }
        }
        else {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
        }
        this.frmData.customer_id = customer.id;
        this.frmData.bank_account_number = customer.bank_account_number ? customer.bank_account_number : '';
        this.frmData.bank_name = customer.bank_name ? customer.bank_name : '';
        this.onFieldDataChanged();
    };
    AdjustMultiplFormInvoiceComponent.prototype.ngOnDestroy = function () {
        this.routeSub.unsubscribe();
    };
    AdjustMultiplFormInvoiceComponent.prototype.capNhatDmKhachHang = function () {
        var _this = this;
        this.customerCurent.tax_code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_tax_code);
        this.customerCurent.name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.customer_name);
        this.customerCurent.code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.customer_code);
        this.customerCurent.contact_person_name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_name);
        this.customerCurent.contact_mobile = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_mobile);
        this.customerCurent.business_address = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_address);
        this.customerCurent.email = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_email);
        this.customerCurent.bank_name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.bank_name);
        this.customerCurent.bank_account_number = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.bank_account_number);
        var data = { customer: this.customerCurent };
        this.customersService.edit(data, this.customerCurent.id).subscribe(function (response) {
            if (response.status === 'success') {
                _this.showPopup = false;
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(response.message, 'error');
            }
        }, function (err) {
        }, function () {
        });
    };
    AdjustMultiplFormInvoiceComponent.prototype.huy = function () {
        this.showPopup = false;
    };
    AdjustMultiplFormInvoiceComponent.prototype.renderDataEmail = function ($event) {
        this.arrEmail = [];
        this.emails = $event;
        if (this.emails.length > 0) {
            for (var i = 0; i < this.emails.length; i++) {
                if (typeof this.emails[i] === 'object')
                    this.arrEmail.push(this.emails[i].value);
                else if (typeof this.emails[i] === 'string')
                    this.arrEmail.push(this.emails[i]);
            }
            var emailToString = this.arrEmail.toString();
            this.frmData.buyer_email = emailToString.replace(/,/g, ';');
        }
        else {
            this.frmData.buyer_email = null;
        }
        this.customerChanged(null);
        this.formEvent.emit(this.frmData);
    };
    /* Chọn hóa đơn chờ ký */
    AdjustMultiplFormInvoiceComponent.prototype.showModalHdck = function () {
        var _this = this;
        var release = this.select.invoice_releases.filter(function (p) { return p.template_id == _this.frmData.template_id; })[0];
        if (release) {
            var invoiceReleaseId = release.value;
            var initialState = {
                invoiceNumberOrigin: 0,
                invoiceDateOrigin: "1900-01-01 00:00:00",
                invoiceReleaseId: invoiceReleaseId,
                onSave: function (data) {
                    _this.frmData.status = _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].statusInv.ChoKy;
                    _this.frmData.id = data.id;
                    _this.frmData.invoice_date = data.invoice_date;
                    _this.frmData.invoice_number = data.invoice_number;
                }
            };
            this.bsModalHdckRef = this.modalService.show(_modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_16__["ChooseHdckComponent"], {
                backdrop: 'static',
                keyboard: false,
                class: 'modal-lg full-modal',
                initialState: initialState
            });
        }
    };
    AdjustMultiplFormInvoiceComponent.prototype.changeTemplateInvoice = function (strDate) {
        var _this = this;
        if (this.isTT78) {
            var year_1 = "";
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(strDate) != "")
                year_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(strDate).substring(4, 2);
            else {
                var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                year_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(invoiceDate).substring(4, 2);
            }
            var templates = this.select.templatesTT78;
            this.select.templatesTT78 = [];
            if (templates && templates.length > 0) {
                templates.forEach(function (item) {
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(item.name) != "")
                        item.name = item.name.replace(item.name.substring(4, 2), year_1);
                    if (item.value === _this.frmData.template_id) {
                        _this.onTemplateTT78TypeChange.emit(item);
                    }
                    _this.select.templatesTT78.push(item);
                });
            }
        }
    };
    AdjustMultiplFormInvoiceComponent.prototype.doctienbangchu = function (total_payment, currency_code) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.adjustment_object) == "TANG_GIAM" && this.isTT78) {
            var number_money = Math.abs(total_payment);
            var c_money = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].tienBangChu(number_money, _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            this.frmData.total_payment_in_word = c_money;
            if (total_payment < 0) {
                this.frmData.total_payment_in_word = "Giảm " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                }
            }
            else if (total_payment > 0) {
                this.frmData.total_payment_in_word = "Tăng " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                }
            }
        }
        else {
            this.frmData.total_payment_in_word = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].tienBangChu(total_payment, _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            if (this.isTT78) {
                if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.total_payment_in_word) != "" && this.frmData.total_payment_in_word != "Không đồng chẵn.") {
                    if (this.frmData.adjustment_form === 'TANG') {
                        this.frmData.total_payment_in_word = "Tăng " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                        }
                    }
                    if (this.frmData.adjustment_form == 'GIAM') {
                        this.frmData.total_payment_in_word = "Giảm " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                        }
                    }
                }
            }
        }
    };
    AdjustMultiplFormInvoiceComponent.prototype.changeTaxCode = function (e) {
        this.tax_code_search = e.value;
    };
    // searchTaxCode() {
    //   this.tax_code_search = this.frmData.buyer_tax_code;
    //   if (!this.tod.customer_name) {
    //     this.vatService.getInfoCompany(this.tax_code_search).subscribe(res => {
    //       if (res.status == "success") {
    //         this.dataTaxCode = res.data.customer;
    //         this.frmData.customer_name = this.dataTaxCode.name;
    //         this.frmData.buyer_address = this.dataTaxCode.business_address;
    //       }
    //     })
    //   }
    //   this.onFieldDataChanged();
    // }
    AdjustMultiplFormInvoiceComponent.prototype.searchTaxCode = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].showloading();
        if (!this.tax_code_search) {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify("Vui lòng nhập mã số thuế!", "error");
        }
        else {
            this.vatService.getInfoCompany(this.tax_code_search).subscribe(function (res) {
                if (res.status == "success") {
                    _this.dataTaxCode = res.data.customer;
                    _this.frmData.customer_name = _this.dataTaxCode.name;
                    _this.frmData.buyer_address = _this.dataTaxCode.business_address;
                }
            });
        }
        this.onFieldDataChanged();
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
        }, 1000);
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChildren"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "listDxForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"])
    ], AdjustMultiplFormInvoiceComponent.prototype, "form", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "frmData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "type", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "dataSource", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "htHoaDonGoc", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "invoice_products", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "formatter", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "_objTemplateSelect", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "extentionGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustMultiplFormInvoiceComponent.prototype, "isShowButtonWaiteSign", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onFormChange'),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "formEvent", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateChange'),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "onTemplateChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateTypeChange'),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "onTemplateTypeChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('adjustmentObjectChange'),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "adjustmentObject", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateTT78TypeChange'),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "onTemplateTT78TypeChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustMultiplFormInvoiceComponent.prototype, "isTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "infoDangKy", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplFormInvoiceComponent.prototype, "_oTemplateTT78", void 0);
    AdjustMultiplFormInvoiceComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-adjust-multipl-form-invoice',
            template: __webpack_require__(/*! ./adjust-multipl-form-invoice.component.html */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.html"),
            styles: [__webpack_require__(/*! ./adjust-multipl-form-invoice.component.scss */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_7__["AuthService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__["VatService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__["TranslateService"],
            _modules_customers_shared__WEBPACK_IMPORTED_MODULE_12__["CustomersService"],
            _angular_common_http__WEBPACK_IMPORTED_MODULE_14__["HttpClient"],
            _modules_lists_shared__WEBPACK_IMPORTED_MODULE_15__["ListsService"]])
    ], AdjustMultiplFormInvoiceComponent);
    return AdjustMultiplFormInvoiceComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.html":
/*!********************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.html ***!
  \********************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<form>\r\n  <div class=\"invoice-container\">\r\n    <!-- phần form thông tin -->\r\n    <app-adjust-multipl-form-invoice [dataSource]=\"dataSource\" [invoice_products]=\"invoice_products\" [formatter]=\"formatter\"\r\n                      [frmData]=\"frmData\" [_objTemplateSelect]=\"_objTemplateSelect\" [extentionGrid]=\"extentionGrid\" [htHoaDonGoc] =\"htHoaDonGoc\"\r\n                      (onFormChange)=\"getDataInChildForm($event)\"\r\n                      (onTemplateChange)=\"onTemplateChange($event)\"\r\n                      (adjustmentObjectChange)=\"adjustmentObjectChange($event)\"\r\n                      [isShowButtonWaiteSign] = \"isShowButtonWaiteSign\"\r\n                      [_oTemplateTT78] = \"_oTemplateTT78\"\r\n                      [isTT78] = \"isTT78\"\r\n                      [infoDangKy] = \"infoDangKy\"\r\n                      (onTemplateTT78TypeChange)=\"onTemplateTT78TypeChange($event)\"\r\n                      (onTemplateTypeChange)=\"onTemplateTypeChange($event)\"></app-adjust-multipl-form-invoice>\r\n    <!-- table product -->\r\n    <app-adjust-multipl-product-grip #child [dataSource]=\"dataSource\" [invoice_products]=\"invoice_products\"\r\n                      [formDataInInvoice]=\"frmData\" [formatter]=\"formatter\" [isHdGTGT]=\"isHdGTGT\"\r\n                      [_objTemplateSelect]=\"_objTemplateSelect\" [extentionGrid]=\"extentionGrid\"\r\n                      [isTT78] = \"isTT78\"\r\n                      [_oTemplateTT78] = \"_oTemplateTT78\"\r\n                      (importExcel)=\"fillDataToForm($event)\">\r\n    </app-adjust-multipl-product-grip>\r\n\r\n    <div *ngIf=\"isHdGTGT\" class=\"table-footer\">\r\n      <div class=\"table-footer-1\">\r\n        <div class=\"vat amount-table-footer\">\r\n          <dx-number-box [value]=\"frmData.amount_after_vat\" step=\"0\" [format]=\"formatter.tong_tien\" [disabled]=\"true\">\r\n          </dx-number-box>\r\n        </div>\r\n      </div>\r\n      <div class=\"table-footer-2\">\r\n        <div class=\"vat amount-vat-table-footer\">\r\n          <dx-number-box [value]=\"frmData.total_amount_vat\" step=\"0\" [format]=\"formatter.tien_thue\" [disabled]=\"true\">\r\n          </dx-number-box>\r\n        </div>\r\n      </div>\r\n      <div class=\"table-footer-3\">\r\n        <div class=\"vat amount-after-vat-table-footer\">\r\n          <dx-number-box [value]=\"frmData.amount\" step=\"0\" [format]=\"formatter.thanh_tien\"\r\n                         [disabled]=\"true\"></dx-number-box>\r\n        </div>\r\n      </div>\r\n      <div class=\"table-footer-4\">\r\n        <div class=\"vat amount-table-footer\">\r\n          <dx-number-box [value]=\"frmData.amount_without_discount\" step=\"0\" [format]=\"formatter.thanh_tien_chua_ck\"\r\n                         [disabled]=\"true\">\r\n          </dx-number-box>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div *ngIf=\"!isHdGTGT\" class=\"table-footer\">\r\n      <div class=\"table-footer-1\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-table-footer\" dataField=\"amount_after_vat\" editorType=\"dxNumberBox\"\r\n                      [editorOptions]=\"{format: formatter.thanh_tien, disabled: true, step:'0'}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-3\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-after-vat-table-footer\" dataField=\"amount\" editorType=\"dxNumberBox\"\r\n                      [editorOptions]=\"{format: formatter.tong_tien, disabled: true, step:'0'}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n    </div>\r\n    <!-- <dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"Thông báo\" [dragEnabled]=\"false\"\r\n  [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">Chưa có VAT. Bạn có muốn cập nhật VAT cho hàng hóa này không?</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"yes(true)\" text=\"Yes\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"yes(false)\" text=\"No\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup> -->\r\n    <dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"Thông báo\" [dragEnabled]=\"false\"\r\n              [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n      <div *dxTemplate=\"let data of 'content'\">\r\n        <p style=\"margin-bottom: 35px;\">Bạn có muốn cập nhật lại dữ liệu vào danh mục khách hàng không?</p>\r\n        <div class=\"pull-right\">\r\n          <dx-button text=\"Cập nhật\" type=\"default\"></dx-button>\r\n          <dx-button text=\"Hủy\" type=\"default\"></dx-button>\r\n        </div>\r\n      </div>\r\n    </dx-popup>\r\n    <!-- vùng chọn file -->\r\n    <div class=\"row after-table\">\r\n      <div class=\"col-md-5\">\r\n        <file-upload-multiple [fileData]=\"fileData\" (fileChange)=\"getFileData($event)\"></file-upload-multiple>\r\n      </div>\r\n      <div class=\"col-md-3\">\r\n      </div>\r\n      <div class=\"col-md-4\">\r\n        <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY' && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY_THU_TIEN' && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY_HOAN_TIEN') \r\n        ||(invoiceTemplateTT78 && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY' && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY_THU_TIEN' && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY_HOAN_TIEN') )\" class=\"vat money-pull-right\">\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.on_currency_amount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.on_currency_amount\" tabIndex=\"-1\" format=\"0,###\"\r\n                             [disabled]=\"!frmData.auto_value\" step=\"0\"\r\n                             (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount\" tabIndex=\"-1\" [format]=\"formatter.thanh_tien\"\r\n                             [disabled]=\"!frmData.auto_value\" step=\"0\"\r\n                             (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_amount_discount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_discount\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tien_chiet_khau\"\r\n                             (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat5}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat5\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tien_thue\"\r\n                             [disabled]=\"!frmData.auto_value\" (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat8}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat8\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tien_thue\"\r\n                             [disabled]=\"!frmData.auto_value\" (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat10}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat10\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tien_thue\"\r\n                             [disabled]=\"!frmData.auto_value\" (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat_other\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tien_thue\"\r\n                             [disabled]=\"!frmData.auto_value\" (onValueChanged)=\"onNumberChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_DANG_KIEM')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_DANG_KIEM'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.fees}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.registry_fee\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tong_tien\"\r\n                             (onKeyDown)=\"keyDown($event)\"\r\n                             (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_XANG_DAU') \r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_XANG_DAU'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_fee\" tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             [format]=\"formatter.tong_tien\"\r\n                             (onKeyDown)=\"keyDown($event)\"\r\n                             (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_TONG_HOP')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_TONG_HOP'))\" class=\"dx-field\">\r\n            <div  class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertax}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.other_tax\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                [disabled]=\"!frmData.auto_value\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_TONG_HOP')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_TONG_HOP'))\" class=\"dx-field\">\r\n            <div  class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.other_charge\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [disabled]=\"!frmData.auto_value\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\r\n        || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')))\" class=\"vat money-pull-right\">\r\n         \r\n        <div *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\r\n        || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.surcharge}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.other_charge\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                (onValueChanged)=\"onNumberTicketChange()\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n         \r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n               [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [(value)]=\"frmData.total_other\"\r\n                (onValueChanged)=\"onNumberTicketChange()\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n              [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [(value)]=\"frmData.other_fee\"\r\n                (onValueChanged)=\"onNumberTicketChange()\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY')))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.refund_fee}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.money_ticket_return\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                (onValueChanged)=\"onNumberTicketChange()\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_fare_after_tax}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.total_ticket_with_vat\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [disabled]=\"!frmData.auto_value\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')))\" class=\"dx-field\">\r\n            <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n            || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertax}}</div>\r\n            <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n            || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertaxair}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.other_tax\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                (onValueChanged)=\"onNumberTicketChange()\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n              [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [(value)]=\"frmData.other_fee\"\r\n                (onValueChanged)=\"onNumberTicketChange()\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_fare}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.total_ticket\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [disabled]=\"!frmData.auto_value\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box\r\n                [(value)]=\"frmData.total_other\"\r\n                [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\"\r\n                step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\"\r\n                [disabled]=\"!frmData.auto_value\"\r\n              ></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n\r\n      <div *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\r\n      || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')))\" class=\"col-md-12\" style=\"margin:10px 0 !important;\">\r\n        <h3 class=\"font-weight-bold\">{{ _translate.CONTROLL.LABEL.ticketing_service_fee}}</h3>\r\n        <div class=\"row\">\r\n          <div class=\"col-md-3 pr-0 money-pull-right\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 52%\"\r\n                   class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.ticketing_service_charge}}</div>\r\n              <div style=\"width: 48%\" class=\"dx-field-value\">\r\n                <dx-number-box\r\n                  [(value)]=\"frmData.money_service_ticket\"\r\n                  format=\"#,###\"\r\n                  tabIndex=\"-1\"\r\n                  step=\"0\"\r\n                  (onValueChanged)=\"onVatChange()\"\r\n                ></dx-number-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-3 pr-0 money-pull-right\" style=\"max-width: 23%\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 50%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.tax_GTGT}}</div>\r\n              <div style=\"width: 50%\" class=\"dx-field-value\">\r\n                <dx-select-box\r\n                  [(value)]=\"frmData.vat_service_ticket\"\r\n                  displayExpr=\"name\"\r\n                  valueExpr=\"code\"\r\n                  tabIndex=\"-1\"\r\n                  [items]=\"select.vats\"\r\n                  (onValueChanged)=\"onVatChange()\"\r\n                ></dx-select-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-3 pr-0 money-pull-right\" style=\"max-width: 19%\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 50%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat}}</div>\r\n              <div style=\"width: 50%\" class=\"dx-field-value\">\r\n                <dx-number-box\r\n                  [(value)]=\"frmData.total_vat_service_ticket\"\r\n                  format=\"#,###\"\r\n                  tabIndex=\"-1\"\r\n                  step=\"0\"\r\n                  [disabled]=\"!frmData.auto_value\"\r\n                  (onValueChanged)=\"onNumberChange()\"\r\n                ></dx-number-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-4 \" style=\"max-width: 33%\">\r\n            <div class=\"prt-1 money-pull-right\">\r\n              <div class=\"dx-field\" style=\"width: 395px\">\r\n                <div style=\"width: 44.3%\"\r\n                     class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_after_tax_service_charge}}</div>\r\n                <div style=\"width: 55.7%\" class=\"dx-field-value\">\r\n                  <dx-number-box\r\n                    [(value)]=\"frmData.total_service_ticket_with_vat\"\r\n                    format=\"#,###\"\r\n                    tabIndex=\"-1\"\r\n                    step=\"0\"\r\n                    [disabled]=\"!frmData.auto_value\"\r\n                    (onValueChanged)=\"onNumberTicketChange()\"\r\n                  ></dx-number-box>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Nghị định 92 -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_exemption_decree\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Đã giảm </p>\r\n          <dx-number-box [format]=\"formatter.tong_tien\" [(value)]=\"frmData.text_exemption_decree\" [readOnly]=\"!frmData.auto_value\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> tương ứng 30% mức tỷ lệ để tính thuế giá trị gia tăng theo Nghị quyết số 406/NQ-UBTVQH15</p>\r\n        </div>\r\n      </div>\r\n      <!-- Nghị định 43 -->\r\n      <!-- Tỷ lệ % doanh thu -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_resolution_43\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Tỷ lệ % trên doanh thu </p>\r\n\r\n          <div class=\"toggle normal\" style=\"display: flex; align-items: center; margin-top: -6px;\">\r\n            <img id=\"link14\" style=\"cursor: pointer;padding-left: 2px;padding-right: 7px\" src=\"assets\\img\\icons\\Icon_Information.png\"  (click)=\"guideSales()\"  alt=\"efy.vn\" alt=\"Efy.vn\">\r\n          </div>\r\n          <dx-popover\r\n          target=\"#link14\"\r\n                  position=\"top\"\r\n                  [width]=\"350\"\r\n                  [(visible)]=\"isDisplayGuideSale\">\r\n                  <div *dxTemplate=\"let data of 'content'\">\r\n                      <p>- 1% : Phân phối, cung cấp hàng hóa dịch vụ</p>\r\n                      <p>- 5% : Dịch vụ xây dựng không bao thầu nguyên vật liệu</p>\r\n                      <p>- 3% : Sản xuất, vận tải, dịch vụ có gắn với hàng hóa, xây dựng có bao thầu nguyên vật liệu</p>\r\n                      <p>- 2% : Hoạt động kinh doanh khác</p>\r\n                  </div>\r\n              </dx-popover>\r\n\r\n          <dx-number-box [width] = \"50\" [(value)]=\"frmData.sales_percentage\" (onValueChanged)=\"onChangeSalePercen($event)\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> %</p>\r\n        </div>\r\n      </div>\r\n      <!-- Đã giảm 20% -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_resolution_43\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Đã giảm </p>\r\n          <dx-number-box [format]=\"formatter.tong_tien\" [(value)]=\"frmData.money_resolution_43\" [readOnly]=\"!frmData.auto_value\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> {{ _translate.THONG_TIN.tinh_thue_nq101}}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-md-4\" style=\"margin-top: 10px\">\r\n        <div class=\"vat money-pull-right\">\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_after_vat}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_payment\" [format]=\"formatter.tong_tien\"\r\n                             [disabled]=\"!frmData.auto_value\"\r\n                             tabIndex=\"-1\"\r\n                             step=\"0\"\r\n                             (onKeyDown)=\"keyDown($event)\"\r\n                             (onValueChanged)=\"totalPaymentChange($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-md-12\">\r\n        <div class=\"vat total-payment-in-word\">\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_payment_in_word}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-text-box [(value)]=\"frmData.total_payment_in_word\" [disabled]=\"!frmData.auto_value\"></dx-text-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"row button-action\">\r\n      <div class=\"col-md-12\">\r\n        <div class=\"pull-left\">\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon\" (click)=\"preview()\" [(icon)]=\"this._translate.ICONS.view\"\r\n                     text=\"{{ _translate.CONTROLL.BUTTON.preview_invoice}}\" type=\"default\"></dx-button>\r\n          <dx-button *ngIf=\"ttDaXuatHoaDon\" (click)=\"view()\" [(icon)]=\"this._translate.ICONS.view\"\r\n                     text=\"{{ _translate.CONTROLL.BUTTON.view_invoice}}\" type=\"default\"></dx-button>\r\n          <dx-button *ngIf=\"ttDaXuatHoaDon\" (click)=\"inChuyenDoi()\" [(icon)]=\"this._translate.ICONS.print\"\r\n                     [text]=\"inChuyenDoiText()\" type=\"default\"></dx-button>\r\n          <dx-button *ngIf=\"isTuChoi\" (click)=\"xemlydotuchoi()\" [(icon)]=\"this._translate.ICONS.view\"\r\n                     text=\"{{_translate.CONTROLL.BUTTON.reason_reject}}\"\r\n                     type=\"default\"></dx-button>\r\n        </div>\r\n        <div class=\"pull-right\">\r\n          <!-- <button type=\"button\" (click)=\"test()\">Test</button> -->\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon && !isAccessExportInv\" text=\"{{ _translate.CONTROLL.BUTTON.sign_approval}}\"\r\n                     icon=\"assets\\img\\icons\\XuatFile.png\" (click)=\"eSubmit('TRINH_KY')\" type=\"default\"\r\n                     validationGroup=\"formData\"\r\n                     [useSubmitBehavior]=\"true\"></dx-button>\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon && !showTraLai && !showKyDuyet\" appScrollToInvalid\r\n                     text=\"{{ _translate.CONTROLL.BUTTON.export_invoice}}\" [(icon)]=\"this._translate.ICONS.export_inv\"\r\n                     (click)=\"eSubmit('XUAT',true)\" type=\"default\" validationGroup=\"formData\"\r\n                     [useSubmitBehavior]=\"true\">\r\n          </dx-button>\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon && !showTraLai && !showKyDuyet\" appScrollToInvalid\r\n                     text=\"{{ _translate.CONTROLL.BUTTON.save_temporary}}\" [(icon)]=\"this._translate.ICONS.save\"\r\n                     (click)=\"eSubmit('GHI_TAM')\" type=\"default\" validationGroup=\"formData\" [useSubmitBehavior]=\"true\" [disabled]=\"isDisable\">\r\n          </dx-button>\r\n          <dx-button *ngIf=\"!showTraLai && !showKyDuyet\" text=\"{{ _translate.CONTROLL.BUTTON.create_new}}\"\r\n                     [(icon)]=\"this._translate.ICONS.add_new\" (click)=\"handleAddNew()\" type=\"default\"></dx-button>\r\n          <dx-button *ngIf=\"showTraLai\" text=\"{{ _translate.CONTROLL.BUTTON.return}}\"\r\n                     icon=\"assets\\img\\icons\\XuatFile.png\" (click)=\"traLai()\" type=\"default\"></dx-button>\r\n          <dx-button appBackButton type=\"default\" [(icon)]=\"this._translate.ICONS.come_back\"\r\n                     text=\"{{ _translate.CONTROLL.BUTTON.close}}\"></dx-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</form>\r\n<ngx-spinner\r\nbdColor=\"rgba(51,51,51,0.8)\"\r\nsize=\"medium\"\r\ncolor=\"#fff\"\r\ntype=\"timer\">\r\n<p style=\"font-size: 20px; color: white\">Loading...</p>\r\n</ngx-spinner>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.scss":
/*!********************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.scss ***!
  \********************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".invoice-container{padding-top:15px}.after-table{margin-top:10px}::ng-deep .vat.total-payment-in-word{margin-top:15px}::ng-deep .vat.total-payment-in-word input{color:#000000;font-weight:bold;text-align:right}.vat.total-payment-in-word .dx-field-label{width:12%}.vat.total-payment-in-word .dx-field-value{width:88% !important}::ng-deep .vat.money-pull-right input{text-align:right}::ng-deep .pr-0.money-pull-right input{text-align:right}::ng-deep .prt-1.money-pull-right input{text-align:right}.vat.money-pull-right .dx-field-label{width:45%}.vat.money-pull-right .dx-field-value{width:55% !important}::ng-deep .vat.amount-table-footer input,::ng-deep .vat.amount-vat-table-footer input,::ng-deep .vat.amount-after-vat-table-footer input{font-weight:bold;text-align:right;color:#0034F5}.button-action{margin-top:18px}.table-footer{height:40px;background:#E3E3E3;padding-top:3px}.table-footer .table-footer-1{display:inline-block;width:109px;float:right}.table-footer .table-footer-2{display:inline-block;width:120px;margin-right:32px;float:right}.table-footer .table-footer-3{display:inline-block;width:150px;margin-right:90px;float:right}.table-footer .table-footer-4{display:inline-block;width:109px;margin-right:190px;float:right}.dx-field-value.dx-widget,.dx-field-value:not(.dx-widget)>.dx-widget{height:25px}.pr-0.dx-selectbox .dx-texteditor-input:-moz-read-only{padding-bottom:17px}.pr-0.dx-selectbox .dx-texteditor-input:read-only{padding-bottom:17px}::ng-deep .prv-s-invoice .modal-content{border:0px;border-radius:0px}::ng-deep .v-s-invoice{max-width:100%;margin:0px;height:100%}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.ts":
/*!******************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.ts ***!
  \******************************************************************************************************************************/
/*! exports provided: AdjustMultiplInvoiceComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustMultiplInvoiceComponent", function() { return AdjustMultiplInvoiceComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _adjust_multipl_product_grip_adjust_multipl_product_grip_component__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../adjust-multipl-product-grip/adjust-multipl-product-grip.component */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.ts");
/* harmony import */ var _adjust_multipl_form_invoice_adjust_multipl_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../adjust-multipl-form-invoice/adjust-multipl-form-invoice.component */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! devextreme/data/array_store */ "./node_modules/devextreme/data/array_store.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _modules_customers_shared__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @modules/customers/shared */ "./src/app/modules/customers/shared/index.ts");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_12__);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var _core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @core/library/invoice/invoices.service */ "./src/app/core/library/invoice/invoices.service.ts");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! typescript-string-operations */ "./node_modules/typescript-string-operations/dist/index.min.js");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(typescript_string_operations__WEBPACK_IMPORTED_MODULE_15__);
/* harmony import */ var _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @shared/service/confirm.service */ "./src/app/shared/service/confirm.service.ts");
/* harmony import */ var ngx_spinner__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ngx-spinner */ "./node_modules/ngx-spinner/fesm5/ngx-spinner.js");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _modules_configs_shared__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @modules/configs/shared */ "./src/app/modules/configs/shared/index.ts");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
/* harmony import */ var _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @core/library/invoice/my-bsmodel.service */ "./src/app/core/library/invoice/my-bsmodel.service.ts");
/* harmony import */ var _shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @shared/components/preview-invoice/preview-invoice.component */ "./src/app/shared/components/preview-invoice/preview-invoice.component.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};























var AdjustMultiplInvoiceComponent = /** @class */ (function () {
    function AdjustMultiplInvoiceComponent(route, router, modalService, vatService, socketService, authService, cdRef, translate, customersService, confirmService, spinner, configsService, vPreviewInvService, customeModalService) {
        var _this = this;
        this.route = route;
        this.router = router;
        this.modalService = modalService;
        this.vatService = vatService;
        this.socketService = socketService;
        this.authService = authService;
        this.cdRef = cdRef;
        this.translate = translate;
        this.customersService = customersService;
        this.confirmService = confirmService;
        this.spinner = spinner;
        this.configsService = configsService;
        this.vPreviewInvService = vPreviewInvService;
        this.customeModalService = customeModalService;
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["InvoiceModel"](1);
        this.frmTraLai = {
            reason: ''
        };
        this.isDisable = false;
        this.ttDaXuatHoaDon = false; // Trạng thái đã xuất hóa đơn hay chưa
        this.showTraLai = false;
        this.showKyDuyet = false;
        this.isHdGTGT = false;
        this.isAccessExportInv = false;
        this.showPopup = false;
        this.formatter = {};
        this.select = {};
        this._objTemplateSelect = {};
        this.formatNumber = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].numberInvoiceFormatDev;
        this.extentionGrid = {};
        //danh sách data trong file
        this.fileData = [];
        this.tempKiFile = 0;
        this.confirmCheckPreview = false;
        this._isValid = false;
        this.isTuChoi = false;
        this.isShowButtonWaiteSign = true;
        this.isTT78 = false;
        this._oTemplateTT78 = {};
        this.productCodePattern = _config_index__WEBPACK_IMPORTED_MODULE_18__["pattern"].productCodePattern;
        this.isProcessInvOriginOther = false;
        this.isDisplayGuideSale = false;
        this.loaiHoaDonGoc = null;
        this.mauHoaDonGoc = null;
        this.kyHieuHoaDonGoc = null;
        this.soHoaDonGoc = null;
        this.ngayHoaDonGoc = null;
        this.idHoaDonGoc = null;
        this.htHoaDonGoc = null;
        this.dcHoaDonGoc = null;
        // sự kiện form
        this.totalPaymentChange = function (e) {
            _this.onNumberChange();
            var currency_code = _this.frmData.currency_code;
            if (_this.configs.system_parameter.view_price_nte) {
                currency_code = 'VND';
            }
            _this.doctienbangchu(e.value, currency_code);
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
    }
    AdjustMultiplInvoiceComponent.prototype.ngAfterViewInit = function () {
        if (this.frmData.status === 'DA_XUAT') {
            this.disablleScreen();
            this.cdRef.detectChanges();
        }
        var a = moment__WEBPACK_IMPORTED_MODULE_2__(new Date(), 's').toDate();
        var b = a - this.timeeeeeeeeeee;
        this.setDataSessionStorage(this.frmData);
    };
    AdjustMultiplInvoiceComponent.prototype.disablleScreen = function () {
        this.formInvoice.readonlyAllForm();
        this.productGrip.ttDaXuatHoaDon = true;
        this.ttDaXuatHoaDon = true;
    };
    AdjustMultiplInvoiceComponent.prototype.xuLiApiKhiXuat = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var status;
        if (!this.frmData.id && !this.frmData.invoice_number) {
            status = 'THEM_MOI';
        }
        if (this.frmData.id && !this.frmData.invoice_number) {
            status = 'GHI_TAM';
        }
        if (this.frmData.id && this.frmData.invoice_number) {
            status = 'GIU_SO';
        }
        var xmlInvoice = "";
        var isNewXml = 0;
        if (status === 'THEM_MOI') {
            if (!this.isTT78) {
                var sub_1 = this.vatService.ghiTam(this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss'); // moment(rs.data.invoice_date).format('DD/MM/YYYY');
                        _this.frmData.id = rs.data.id;
                        _this.setDataSessionStorage(_this.frmData);
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_1.unsubscribe();
                });
            }
            else {
                var sub_2 = this.vatService.ghiTamTT78(this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss'); // moment(rs.data.invoice_date).format('DD/MM/YYYY');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        _this.frmData.id = rs.data.id;
                        _this.setDataSessionStorage(_this.frmData);
                        // demo kí số vào file
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        //  Lấy xml từ serer
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_2.unsubscribe();
                });
            }
        }
        else if (status === 'GHI_TAM') {
            if (!this.isTT78) {
                var sub_3 = this.vatService.edit(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    // Library.hideloading();
                    sub_3.unsubscribe();
                });
            }
            else {
                var sub_4 = this.vatService.editTT78(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ server
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    sub_4.unsubscribe();
                });
            }
        }
        else if (status === 'GIU_SO') {
            if (!this.isTT78) {
                var sub_5 = this.vatService.edit(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_5.unsubscribe();
                });
            }
            else {
                var sub_6 = this.vatService.editTT78(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_6.unsubscribe();
                });
            }
        }
    };
    AdjustMultiplInvoiceComponent.prototype.xuLyKiFile = function (xmlInvoice, signDate) {
        var _this = this;
        if (this.isTT78) {
            var ListSerialNumber = "DSCKS";
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
            }
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate, 'InvoiceData', ListSerialNumber, true);
        }
        else
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate);
    };
    AdjustMultiplInvoiceComponent.prototype.goiApiXuatHoaDon = function (xml_string) {
        var _this = this;
        // Helper.dowloadFile('hoadon.xml', 'xml', xml_string);
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        }, 20);
        var sub = this.vatService.xuatHoaDon({
            id: this.frmData.id,
            xml_string: xml_string,
            invoice_files: this.frmData.invoice_files
        }).subscribe(function (rs) {
            if (rs.status === 'success') {
                _this.disablleScreen();
                _this.fileData = _this.frmData.invoice_files;
                _this.isShowButtonWaiteSign = false;
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
                _this.isExportInvoice = true;
                _this.setDataSessionStorage(_this.frmData);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    AdjustMultiplInvoiceComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.timeeeeeeeeeee = moment__WEBPACK_IMPORTED_MODULE_2__(new Date(), 's').toDate();
        if (this.route.snapshot.queryParams['status'] === 'return') {
            this.showTraLai = true;
        }
        if (this.route.snapshot.queryParams['status'] === 'sign') {
            this.showKyDuyet = true;
        }
        var isViewTT32 = false;
        if (this.route.snapshot.queryParams['status'] === 'viewInvTT32') {
            isViewTT32 = true;
        }
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['loaiHoaDonGoc']) != "")
            this.loaiHoaDonGoc = parseInt(this.route.snapshot.queryParams['loaiHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['mauHoaDonGoc']) != "")
            this.mauHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['mauHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['kyHieuHoaDonGoc']) != "")
            this.kyHieuHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['kyHieuHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['soHoaDonGoc']) != "")
            this.soHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['soHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['ngayHoaDonGoc']) != "")
            this.ngayHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['ngayHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['idHoaDonGoc']) != "")
            this.idHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['idHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['htHoaDonGoc']) != "")
            this.htHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['htHoaDonGoc']);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['dcHoaDonGoc']) != "")
            this.dcHoaDonGoc = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.route.snapshot.queryParams['dcHoaDonGoc']);
        // kết nối websocket 
        this.connectWebsocket();
        this.routeSub = this.route.data.subscribe(function (data) {
            var loaiDieuChinh = data.type;
            if (loaiDieuChinh == "dieu-chinh-nhieu" || loaiDieuChinh == "dieu-chinh-khac") {
                _this.adjustment_type = 5;
                if (loaiDieuChinh == "dieu-chinh-khac")
                    _this.isProcessInvOriginOther = true;
            }
            else if (loaiDieuChinh == "thay-the-khac") {
                _this.adjustment_type = 3;
                _this.isProcessInvOriginOther = true;
            }
            _this.isHdGTGT = true;
            var danh_muc = _this.authService.getDMLocal();
            _this.configs = _this.authService.getConfigs();
            _this.infoDangKy = _this.authService.getInfoRegister();
            _this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(_this.configs.decimal_places_json);
            _this.frmData.display_currency = JSON.stringify(_this.configs.display_currency);
            _this.formatter.display_int = _this.configs.system_parameter.display_int;
            _this.select.unit_codes = danh_muc.DM_DON_VI_TINH ? danh_muc.DM_DON_VI_TINH.data : null;
            _this.select.select_provisions_on_accounts = danh_muc.DM_DINH_KHOAN ? danh_muc.DM_DINH_KHOAN.data : null;
            _this.select.payment_method_names = danh_muc.DM_HINH_THUC_THANH_TOAN ? danh_muc.DM_HINH_THUC_THANH_TOAN.data : null;
            _this.select.vats = danh_muc.DM_TY_LE_VAT ? danh_muc.DM_TY_LE_VAT.data : null;
            if (_this.infoDangKy) {
                if (_this.infoDangKy.status == "CHAP_NHAN")
                    _this.isTT78 = true;
            }
            if (_this.isTT78 == true && isViewTT32)
                _this.isTT78 = false;
            var isEdit = false;
            var invoice;
            if (data.init[2] == true)
                isEdit = true;
            if (_this.isTT78) {
                var temptTT78 = [];
                if (isEdit) {
                    temptTT78 = data.init[3];
                    invoice = data.init[1];
                }
                else {
                    temptTT78 = data.init[1];
                }
                if (temptTT78 && temptTT78.length > 0) {
                    _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.infoDangKy.is_invoice_with_code; });
                    if (invoice && Number.parseInt(invoice.invoice_number) > 0) {
                        if (invoice.is_invoice_with_code != _this.infoDangKy.is_invoice_with_code) {
                            _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == invoice.is_invoice_with_code; });
                        }
                    }
                }
            }
            else {
                _this.select.invoice_releases = data.init[0];
                if (isEdit)
                    invoice = data.init[3];
            }
            if (isEdit || _this.vatService.isCopy) {
                if (_this.vatService.isCopy) {
                    _this.khoiTaoKhiSua(_this.vatService.data);
                }
                else {
                    _this.khoiTaoKhiSua(invoice);
                }
            }
            else {
                _this.khoiTaoKhiThemMoi();
            }
            _this.setTypeInvoice();
        });
        var currentUser = this.authService.getCurrentUser();
        var listpermissions = currentUser.user.permissions.split(',');
        var _obj = listpermissions.filter(function (p) { return p === 'phe_duyet'; });
        if (_obj.length > 0) {
            this.isAccessExportInv = true;
        }
        else {
            this.isAccessExportInv = false;
        }
        this.setDataSessionStorage(this.frmData);
    };
    AdjustMultiplInvoiceComponent.prototype.setDataSessionStorage = function (data) {
        this.valueChange = JSON.stringify(data);
    };
    AdjustMultiplInvoiceComponent.prototype.checkDataFormChange = function (dataChange, dataForm) {
        var dataBefore = JSON.parse(dataChange);
        var dataAfter = JSON.parse(JSON.stringify(dataForm));
        return lodash__WEBPACK_IMPORTED_MODULE_12__["isEqual"](dataBefore, dataAfter);
    };
    AdjustMultiplInvoiceComponent.prototype.connectWebsocket = function () {
        var _this = this;
        this.ioSignature = this.socketService.lapHoaDon().subscribe(function (message) {
            var data = message;
            if (data.SvcName === 'efy_Sign') {
                // Helper.dowloadFile('test.xml', 'xml', data.Data.Content);
                if (data.Data.Name === 'hoadon.xml') {
                    _this.goiApiXuatHoaDon(data.Data.Content);
                }
                else if (data.Data.Name === 'ten_filek_the_trung-dc-nhi.xml') {
                    _this.frmData.issuer_name = data.Data.IssuerName;
                    _this.xuLiApiKhiXuat();
                }
                else {
                    _this.frmData.invoice_files.forEach(function (item) {
                        if (item.file_name === data.Data.Name) {
                            item.file_content = data.Data.Content;
                        }
                    });
                    _this.tempKiFile++;
                    if (_this.tempKiFile === _this.frmData.invoice_files.length) {
                        _this.xuLiApiKhiXuat();
                    }
                }
            }
        });
    };
    AdjustMultiplInvoiceComponent.prototype.khoiTaoKhiThemMoi = function () {
        var _this = this;
        // khởi tạo mới lưới
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_8___default.a({
            key: 'id',
            data: this.frmData.invoice_products_data()
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_9___default.a({
            store: this.invoice_products
        });
        this.select.payment_method_names.some(function (item) {
            if (item.is_default) {
                _this.frmData.payment_method_name = item.code;
                var _obj = _this.select.payment_method_names.filter(function (p) { return p.code === item.code; })[0];
                if (_obj) {
                    _this.frmData.payment_method_view_name = _obj.name;
                }
            }
        });
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.payment_method_name) === '') {
            this.frmData.payment_method_name = 'TMCK';
            this.frmData.payment_method_view_name = 'TM/CK';
        }
        // tạo mới đối tượng file
        this.fileData = [];
        // cấu hình thập phân thêm mới
        // set value default
        if (!this.isTT78) {
            if (this.select.invoice_releases.length) {
                this.select.invoice_releases = this.select.invoice_releases.filter(function (p) { return p.number_survival > 0 && p.release_status != 'DA_HUY_SO'; });
                this.frmData.invoice_release_id = this.select.invoice_releases[0].value;
                this.frmData.template_id = this.select.invoice_releases[0].template_id;
                this.frmData.template_code = this.select.invoice_releases[0].template_code;
                for (var key in this.select.invoice_releases[0]) {
                    if (this.select.invoice_releases[0].hasOwnProperty(key)) {
                        this._objTemplateSelect[key] = this.select.invoice_releases[0][key];
                    }
                }
                this.is_multi_vat = this.select.invoice_releases[0].is_multi_vat;
                this.invoicereleaseTempt = this.select.invoice_releases[0];
            }
        }
        else {
            if (this.select.templatesTT78.length) {
                this.frmData.template_id = this.select.templatesTT78[0].value;
                this.frmData.invoice_series = this.select.templatesTT78[0].invoice_series;
                this.frmData.template_code = this.select.templatesTT78[0].template_code;
                for (var key in this.select.templatesTT78[0]) {
                    if (this.select.templatesTT78[0].hasOwnProperty(key)) {
                        this._oTemplateTT78[key] = this.select.templatesTT78[0][key];
                    }
                }
                this.is_multi_vat = this.select.templatesTT78[0].is_multi_vat;
                this.invoiceTemplateTT78 = this.select.templatesTT78[0];
            }
        }
        this.frmData.currency_code = 'VND';
        this.frmData.invoice_origin.relate_xml_type = this.loaiHoaDonGoc;
        this.frmData.invoice_origin.relate_template_code = this.mauHoaDonGoc;
        this.frmData.invoice_origin.relate_invoice_series = this.kyHieuHoaDonGoc;
        this.frmData.invoice_origin.relate_invoice_number = this.soHoaDonGoc;
        this.frmData.invoice_origin.relate_invoice_date = this.ngayHoaDonGoc;
        this.frmData.invoice_origin.relate_invoice_type = this.htHoaDonGoc;
        this.frmData.invoice_origin.relate_adjustment_type = this.dcHoaDonGoc;
        this.frmData.origin_id = this.idHoaDonGoc;
    };
    AdjustMultiplInvoiceComponent.prototype.khoiTaoKhiSua = function (data) {
        var _this = this;
        // khởi tạo lưới từ dữ liệu sửa
        var _lst = this.frmData.setInvoice_products_data(data.invoice_products);
        if (_lst) {
            _lst.forEach(function (item) {
                if (item.product_name && item.unit_name) {
                    var obj1 = _this.select.unit_codes.filter(function (p) { return p.name === item.unit_name; })[0];
                    if (!obj1) {
                        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.unit_code) == "")
                            item.unit_code = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._convertToViKdau(item.unit_name);
                        var oDuplicate = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                        if (oDuplicate)
                            item.unit_code = item.unit_code + _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].addtionalUnitCode();
                    }
                    else if (!item.unit_code || (item.unit_code && item.unit_code != obj1.code))
                        item.unit_code = obj1.code;
                }
            });
        }
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_8___default.a({
            key: 'id',
            data: _lst
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_9___default.a({
            store: this.invoice_products
        });
        // mẫu nhiều loại thuế suất ko
        // khởi tạo dữ liệu form
        this.frmData.fillFormData(data);
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.adjustment_object) == "TANG_GIAM" && !this.isTT78) {
            this.productGrip.ShowAndHidePhuongThucDC(true);
        }
        if (this.frmData.vat_service_ticket != null) {
            this.frmData.vat_service_ticket = this.frmData.vat_service_ticket.toString();
        }
        // this.is_multi_vat = data.is_multi_vat;
        // lấy file
        if (this.vatService.isCopy) {
            this.frmData.time_print_conversion = null;
            this.fileData = [];
            if (!this.isTT78) {
                var _objRelease_1 = this.select.invoice_releases.filter(function (p) { return p.value === _this.frmData.invoice_release_id; })[0];
                if (_objRelease_1) {
                    if (_objRelease_1.number_survival === 0) {
                        var _lstReleaseOther = this.select.invoice_releases.filter(function (p) { return p.number_survival > 0 && p.invoice_series == _objRelease_1.invoice_series && p.template_code == _objRelease_1.template_code && p.release_status != 'DA_HUY_SO'; });
                        if (_lstReleaseOther && _lstReleaseOther.length > 0) {
                            this.frmData.invoice_release_id = _lstReleaseOther[0].value;
                            this.frmData.template_id = _lstReleaseOther[0].template_id;
                        }
                        else {
                            this.frmData.invoice_release_id = null;
                            this.frmData.template_id = null;
                        }
                    }
                }
                this.select.invoice_releases = this.select.invoice_releases.filter(function (p) { return p.number_survival > 0 && p.release_status !== 'DA_HUY_SO'; });
            }
            else {
                var _oTempt = this.select.templatesTT78.filter(function (p) { return p.value === _this.frmData.template_id; })[0];
                if (_oTempt) {
                    this.frmData.template_id = _oTempt.value;
                    this.frmData.invoice_series = _oTempt.invoice_series;
                    this.frmData.template_code = _oTempt.template_code;
                }
                else {
                    this.frmData.template_id = null;
                    this.frmData.invoice_series = null;
                    this.frmData.template_code = null;
                }
            }
        }
        else {
            this.fileData = data.invoice_files;
        }
        if (!this.isTT78) {
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id === _this.frmData.template_id) {
                    _this.invoicereleaseTempt = item;
                }
            });
            this.select.invoice_releases.some(function (item) {
                if (item.value === _this.frmData.invoice_release_id) {
                    _this.is_multi_vat = item.is_multi_vat;
                    //  this._objTemplateSelect = item; // không mở(đối tượng _objTemplateSelect bị chuyển thành đối tượng item)
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            _this._objTemplateSelect[key] = item[key];
                        }
                    }
                    return true;
                }
            });
        }
        else {
            this.select.templatesTT78.forEach(function (item) {
                if (item.value === _this.frmData.template_id) {
                    _this.invoiceTemplateTT78 = item;
                }
            });
            this.select.templatesTT78.some(function (item) {
                if (item.value === _this.frmData.template_id) {
                    _this.is_multi_vat = item.is_multi_vat;
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            _this._oTemplateTT78[key] = item[key];
                        }
                    }
                    return true;
                }
            });
        }
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.approve_status) == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.TuChoi) {
            this.isTuChoi = true;
        }
        if (this.frmData.status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.DaXuat || this.frmData.status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.ChoKy)
            this.isShowButtonWaiteSign = false;
        // cấu hình thập phân thêm mới
        this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(JSON.parse(data.decimal_places_json));
    };
    /** Tương tác giữa các component */
    AdjustMultiplInvoiceComponent.prototype.onTemplateChange = function (e) {
        this.is_multi_vat = e;
    };
    AdjustMultiplInvoiceComponent.prototype.onTemplateTypeChange = function (e) {
        this.invoicereleaseTempt = e;
        if (this.invoicereleaseTempt.invoice_type === '01GTKT') {
            this.isHdGTGT = true;
        }
        else {
            this.isHdGTGT = false;
        }
        this.setTypeInvoice();
    };
    AdjustMultiplInvoiceComponent.prototype.onTemplateTT78TypeChange = function (e) {
        this.invoiceTemplateTT78 = e;
        this.setTypeInvoice();
    };
    AdjustMultiplInvoiceComponent.prototype.fillDataToForm = function (e) {
        this.frmData.customer_name = e[0];
        this.frmData.buyer_tax_code = e[1];
        this.frmData.buyer_address = e[2];
    };
    AdjustMultiplInvoiceComponent.prototype.getDataInChildForm = function (e) {
        this.frmData = e;
        this.frmTraLai.reason = e.lido;
    };
    AdjustMultiplInvoiceComponent.prototype.onNumberChange = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._calTotalMoney(this.frmData, this.formatter, !this.frmData.auto_value);
    };
    AdjustMultiplInvoiceComponent.prototype.updateSomeTotalInput = function (e) {
    };
    AdjustMultiplInvoiceComponent.prototype.fillAutoInput = function (e) {
    };
    // Lấy data khi chọn file đính kèm bảng kê
    AdjustMultiplInvoiceComponent.prototype.getFileData = function (fileData) {
        this.fileData = fileData;
    };
    /** Kết thúc */
    AdjustMultiplInvoiceComponent.prototype.roundNumber = function (number, n) {
        if (number == null) {
            return number;
        }
        else {
            var p = Math.pow(10, n);
            return Math.round(number * p) / p;
        }
    };
    AdjustMultiplInvoiceComponent.prototype.getFormatterToNumber = function (formatter) {
        var s1 = formatter.replace('0,###', '');
        if (s1 === '') {
            return 0;
        }
        else {
            var s2 = s1.replace('.', '');
            return s2.split('').length;
        }
    };
    AdjustMultiplInvoiceComponent.prototype.formatDecimalColumn = function (number) {
        if (number === 0) {
            return '0,###';
        }
        else {
            return '0,###.' + '0'.repeat(number);
        }
    };
    AdjustMultiplInvoiceComponent.prototype.inChuyenDoiText = function () {
        if (this.frmData.time_print_conversion > 0) {
            return this._translate.CONTROLL.BUTTON.view_conversion;
        }
        else {
            return this._translate.CONTROLL.BUTTON.print_conversion;
        }
    };
    AdjustMultiplInvoiceComponent.prototype.onNumberTicketChange = function () {
        if (!this.isTT78) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyItem(this.dataSource, this.invoice_products, this.frmData, this.formatter, !this.frmData.auto_value, this.frmData.auto_value_price, null, this._objTemplateSelect, this.configs.system_parameter);
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonVeMayBay
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonXangDau) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyTicket(this.frmData, this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type));
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyItem(this.dataSource, this.invoice_products, this.frmData, this.formatter, !this.frmData.auto_value, this.frmData.auto_value_price, null, this._oTemplateTT78, this.configs.system_parameter);
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonVeMayBay
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].templatetype.HoaDonXangDau) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyTicket(this.frmData, this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type));
            }
        }
    };
    // Các hàm chức năng chính
    AdjustMultiplInvoiceComponent.prototype.preview = function () {
        var _this = this;
        setTimeout(function () {
            _this.handleFormData();
            if (!_this._validForm(true)) {
                return;
            }
            var data = _this.vatService.taodulieuXemTruocMau(_this.frmData);
            data['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].cauhinhxemmau.hoadon;
            _this.vPreviewInvService.xemMau(data);
        }, 300);
    };
    AdjustMultiplInvoiceComponent.prototype.view = function () {
        var ids = [];
        ids.push(this.frmData.id);
        var data = this.vatService.taodulieuXemMau(ids);
        data['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].cauhinhxemmau.hoadon;
        this.vPreviewInvService.xemMau(data);
    };
    AdjustMultiplInvoiceComponent.prototype.inChuyenDoi = function () {
        var ids = [];
        ids.push(this.frmData.id);
        var data = this.vatService.taodulieuInChuyenDoi(ids);
        data['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].cauhinhxemmau.hoadon;
        this.vPreviewInvService.xemMau(data);
    };
    AdjustMultiplInvoiceComponent.prototype.ghiTam = function (data) {
        var _this = this;
        this.isDisable = true;
        if (this.frmData.id) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_7 = this.vatService.edit(this.frmData.id, data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        if (_this.frmData.approve_status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        }
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_7.unsubscribe();
                });
            }
            else {
                var sub_8 = this.vatService.editTT78(this.frmData.id, data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        if (_this.frmData.approve_status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        }
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_8.unsubscribe();
                });
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_9 = this.vatService.ghiTam(data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_9.unsubscribe();
                });
            }
            else {
                var sub_10 = this.vatService.ghiTamTT78(data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_10.unsubscribe();
                });
            }
        }
    };
    AdjustMultiplInvoiceComponent.prototype.xuatChoKy = function (data) {
        var _this = this;
        // if (this.frmData.invoice_number) {
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        if (!this.isTT78) {
            var sub_11 = this.vatService.xuatChoKy(data).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.isShowButtonWaiteSign = false;
                    _this.frmData.id = rs.data.id;
                    _this.frmData.invoice_number = rs.data.invoice_number;
                    _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (_this.frmData.approve_status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_wait_sign_success, 'success');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_11.unsubscribe();
            });
        }
        else {
            var sub_12 = this.vatService.xuatChoKyTT78(data).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.isShowButtonWaiteSign = false;
                    _this.frmData.id = rs.data.id;
                    _this.frmData.invoice_number = rs.data.invoice_number;
                    _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (_this.frmData.approve_status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_wait_sign_success, 'success');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_12.unsubscribe();
            });
        }
    };
    AdjustMultiplInvoiceComponent.prototype.xuatHoaDon = function (data) {
        var _this = this;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.xuLiApiKhiXuat();
        }
        else {
            if (this.frmData.invoice_files.length) {
                this.frmData.invoice_files.forEach(function (item) {
                    _this.socketService.kiFile(function () { return _this.connectWebsocket(); }, item.file_content, item.file_name, item.file_name.split('.').pop(), true, _this.frmData.invoice_date);
                });
            }
            else {
                if (this.isTT78) {
                    var ListSerialNumber = "DSCKS";
                    if (this.infoDangKy && this.infoDangKy.registration_signature) {
                        var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                        if (signatures && signatures.length > 0)
                            ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                    }
                    var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
                }
                else
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
            }
        }
    };
    AdjustMultiplInvoiceComponent.prototype.traLai = function () {
        var _this = this;
        if (this.frmTraLai.reason === undefined || this.frmTraLai.reason === '') {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.reason_return + ' ' + this._translate.VALIDATION.required, 'error');
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            var sub_13 = this.vatService.traLaiHoaDon({
                id: this.frmData.id,
                reason: this.frmTraLai.reason
            }).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.router.navigate(['/system/invoice-sync']);
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.return_success, 'success');
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_13.unsubscribe();
            });
        }
    };
    AdjustMultiplInvoiceComponent.prototype._validForm = function (isOnlyCheckAm) {
        var _this = this;
        var _isValid = true;
        if (this.frmData.adjustment_object == "TANG_GIAM" && this.isTT78) {
        }
        else {
            if ((this.frmData.amount_vat5 < 0 || this.frmData.amount_vat10 < 0 || this.frmData.total_payment < 0)
                && !this.configs.system_parameter.allow_export_with_negative) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.discount_same_vat, 'error');
                return false;
            }
        }
        if (isOnlyCheckAm) {
            return true;
        }
        if (this.frmData.currency_code && this.frmData.currency_code != "VND" && this.frmData.currency_rate === null) {
            this.formInvoice.form.instance.getEditor('currency_rate').focus();
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.currency_rate + ' ' + this._translate.VALIDATION.required, 'error');
            return false;
        }
        if (this.frmData.customer_object_code === 'DOANH_NGHIEP') {
            if (!this.frmData.customer_name) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.customer_name + ' ' + this._translate.VALIDATION.required, 'error');
                this.formInvoice.form.instance.getEditor('customer_name').focus();
                return false;
            }
            if (!this.frmData.buyer_address) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.address + ' ' + this._translate.VALIDATION.required, 'error');
                this.formInvoice.form.instance.getEditor('buyer_address').focus();
                return false;
            }
        }
        if (this.frmData.adjustment_object == "TANG_GIAM" && !this.isTT78) {
            var _oProduct = this.frmData.invoice_products.filter(function (w) { return _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(w.adjustment_form) == ""; })[0];
            if (_oProduct) {
                var index = this.frmData.invoice_products.indexOf(_oProduct);
                this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(index, 'adjustment_form'));
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Phương thức điều chỉnh không được để trống.', 'error');
                return false;
            }
        }
        if (this.frmData.customer_object_code === 'CA_NHAN') {
            if (!this.frmData.buyer_name) {
                this.formInvoice.form.instance.getEditor('buyer_name').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.buyer_name + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (!this.frmData.buyer_address) {
                this.formInvoice.form.instance.getEditor('buyer_address').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.address + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
        }
        if (this.frmData.customer_object_code === 'KHACH_LE') {
            if (!this.frmData.buyer_name) {
                this.formInvoice.form.instance.getEditor('buyer_name').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.buyer_name + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
        }
        var _lst = this.dataSource.items().filter(function (p) { return p.product_name; });
        if (_lst.length === 0) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.no_product, 'error');
            this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'product_code'));
            return false;
        }
        else {
            if (!this.isTT78) {
                var numberRow = this.invoicereleaseTempt.numberRow;
                if (numberRow == 100) {
                    if (_lst.length > 1) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.only_seclected_1_product_to_export_invoice, 'error', 5000);
                        this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'product_code'));
                        return false;
                    }
                }
            }
            else {
                var numberRow = this.invoiceTemplateTT78.numberRow;
                if (numberRow == 100) {
                    if (_lst.length > 1) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.only_seclected_1_product_to_export_invoice, 'error', 5000);
                        this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'product_code'));
                        return false;
                    }
                }
                if (this.frmData.list_date && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.list_number) == "") {
                    this.formInvoice.form.instance.getEditor('list_number').focus();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Số bảng kê" + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
                if (!this.frmData.list_date && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.list_number) != "") {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ngày bảng kê" + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
                if (this.frmData.invoice_origin && this.frmData.invoice_origin.relate_xml_type != null) {
                    if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.invoice_origin.relate_template_code) != "") {
                        var validTemplateCode = false;
                        /* Thông tư 78 */
                        if (this.frmData.invoice_origin.relate_xml_type == 1) {
                            if (this.frmData.invoice_origin.relate_template_code != "1" && this.frmData.invoice_origin.relate_template_code != "2" && this.frmData.invoice_origin.relate_template_code != "3" && this.frmData.invoice_origin.relate_template_code != "4"
                                && this.frmData.invoice_origin.relate_template_code != "5" && this.frmData.invoice_origin.relate_template_code != "6") {
                                validTemplateCode = true;
                            }
                        }
                        else if (this.frmData.invoice_origin.relate_xml_type == 4) {
                            if (this.frmData.invoice_origin.relate_template_code.length == 11) {
                                var char1 = this.frmData.invoice_origin.relate_template_code.substring(0, 6);
                                var char2 = this.frmData.invoice_origin.relate_template_code.substring(7, 6);
                                var char3 = this.frmData.invoice_origin.relate_template_code.substring(8, 7);
                                var char4 = this.frmData.invoice_origin.relate_template_code.substring(8);
                                if (char1 != "01GTKT" && char1 != "02GTTT" && char1 != "03XKNB" && char1 != "04HGDL" && char1 != "07KPTQ") {
                                    validTemplateCode = true;
                                }
                                else {
                                    if (isNaN(+Number(char2)))
                                        validTemplateCode = true;
                                    else {
                                        if (this.frmData.invoice_origin.relate_xml_type == 4 && Number(char2) == 0)
                                            validTemplateCode = true;
                                    }
                                }
                                if (char3.length != 1 || char3 != "/")
                                    validTemplateCode = true;
                                if (char4.length != 3 || isNaN(+Number(char4)))
                                    validTemplateCode = true;
                            }
                            else
                                validTemplateCode = true;
                        }
                        if (validTemplateCode) {
                            this.formInvoice.form.instance.getEditor('invoice_origin.relate_template_code').focus();
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Mẫu số" + " " + "không đúng định dạng", 'error');
                            return false;
                        }
                    }
                    if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.invoice_origin.relate_invoice_series) != "") {
                        var validInvoiceSeries = false;
                        /* Thông tư 78 */
                        if (this.frmData.invoice_origin.relate_xml_type == 1) {
                            if (this.frmData.invoice_origin.relate_invoice_series.length == 6) {
                                var char1 = this.frmData.invoice_origin.relate_invoice_series.substring(1, 0);
                                var char2 = this.frmData.invoice_origin.relate_invoice_series.substring(3, 1);
                                var char3 = this.frmData.invoice_origin.relate_invoice_series.substring(4, 3);
                                var char4 = this.frmData.invoice_origin.relate_invoice_series.substring(5, 4);
                                var char5 = this.frmData.invoice_origin.relate_invoice_series.substring(6, 5);
                                if (char1 != "C" && char1 != "K")
                                    validInvoiceSeries = true;
                                if (char2.length != 2 || isNaN(+Number(char2)))
                                    validInvoiceSeries = true;
                                if (char3 != "T" && char3 != "D" && char3 != "L" && char3 != "M"
                                    && char3 != "N" && char3 != "B" && char3 != "G" && char3 != "H")
                                    validInvoiceSeries = true;
                                if (!isNaN(+Number(char4)) || !isNaN(+Number(char5)))
                                    validInvoiceSeries = true;
                            }
                            else {
                                validInvoiceSeries = true;
                            }
                        }
                        else if (this.frmData.invoice_origin.relate_xml_type == 4) {
                            if (this.frmData.invoice_origin.relate_invoice_series.length == 8) {
                                var char1 = this.frmData.invoice_origin.relate_invoice_series.substring(3, 2);
                                var char2 = this.frmData.invoice_origin.relate_invoice_series.substring(4, 3);
                                var char3 = this.frmData.invoice_origin.relate_invoice_series.substring(5, 4);
                                var char4 = this.frmData.invoice_origin.relate_invoice_series.substring(7, 5);
                                var char5 = this.frmData.invoice_origin.relate_invoice_series.substring(8, 7);
                                var char6 = this.frmData.invoice_origin.relate_invoice_series.substring(2, 0);
                                if (!isNaN(+Number(char1)) || !isNaN(+Number(char2)))
                                    validInvoiceSeries = true;
                                if (char3.length != 1 || char3 != "/")
                                    validInvoiceSeries = true;
                                if (char4.length != 2 || isNaN(+Number(char4)))
                                    validInvoiceSeries = true;
                                if (char5 != "P")
                                    validInvoiceSeries = true;
                                if (isNaN(+Number(char6))) {
                                    validInvoiceSeries = true;
                                }
                                else {
                                    if (Number(char6) == 0 || Number(char6) > 65)
                                        validInvoiceSeries = true;
                                }
                            }
                            else
                                validInvoiceSeries = true;
                        }
                        if (validInvoiceSeries) {
                            this.formInvoice.form.instance.getEditor('invoice_origin.relate_invoice_series').focus();
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ký hiệu" + " " + "không đúng định dạng", 'error');
                            return false;
                        }
                    }
                }
                if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.invoice_origin.relate_invoice_date) != "") {
                    var dateProcess = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                    if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.invoice_date) != "")
                        dateProcess = moment__WEBPACK_IMPORTED_MODULE_2__(this.frmData.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    var dateOrigin = moment__WEBPACK_IMPORTED_MODULE_2__(this.frmData.invoice_origin.relate_invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (dateOrigin > dateProcess) {
                        this.formInvoice.form.instance.getEditor('invoice_origin.relate_invoice_series').focus();
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ngày hóa đơn điều chỉnh phải lớn hơn hoặc bằng ngày hóa đơn gốc.", 'error');
                        return false;
                    }
                }
                this.invoice_products.load().then(function (dataSource) {
                    dataSource.forEach(function (item, index) {
                        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.product_name) != "" && !item.is_promotion && !item.is_promotion_new && !item.commercial_discount && _isValid) {
                        }
                        else if (item.is_promotion || item.is_promotion_new || item.commercial_discount) {
                            if ((item.product_name == null || item.product_name == '') && _isValid) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tên hàng hóa" + " " + _this._translate.VALIDATION.required, 'error');
                                _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'product_name'));
                                return false;
                            }
                        }
                        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.product_name) != "" && !item.is_promotion) {
                            if (_this.isHdGTGT) {
                                if (item.vat == null && _isValid) {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Thuế suất" + " " + _this._translate.VALIDATION.required, 'error');
                                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'vat'));
                                    return false;
                                }
                                if (item.vat != "-1" && item.vat != "-2" && item.amount_vat == null && _isValid) {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tiền thuế" + " " + _this._translate.VALIDATION.required, 'error');
                                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'amount_vat'));
                                    return false;
                                }
                            }
                            if (item.amount == null && _isValid) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Thành tiền" + " " + _this._translate.VALIDATION.required, 'error');
                                _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'amount'));
                                return false;
                            }
                        }
                    });
                });
            }
            if (isNaN(+Number(this.frmData.invoice_origin.relate_invoice_number)) || this.frmData.invoice_origin.relate_invoice_number.includes(".") || this.frmData.invoice_origin.relate_invoice_number.includes(",") || this.frmData.invoice_origin.relate_invoice_number.includes("-")) {
                this.formInvoice.form.instance.getEditor('invoice_origin.relate_invoice_number').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Số hóa đơn gốc" + " " + "không đúng định dạng", 'error');
                return false;
            }
            /* Hóa đơn bán hàng NQ43 */
            if (this.frmData.is_resolution_43) {
                if (!this.frmData.sales_percentage) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tỷ lệ % trên doanh thu không được để trống", 'error');
                    return false;
                }
                else if (this.frmData.sales_percentage != 1 && this.frmData.sales_percentage != 2
                    && this.frmData.sales_percentage != 3 && this.frmData.sales_percentage != 5) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tỷ lệ % trên doanh thu chỉ bao gồm các giá trị: 1, 2, 3, 5", 'error');
                    return false;
                }
            }
        }
        return _isValid;
    };
    AdjustMultiplInvoiceComponent.prototype.eSubmit = function (type, isCheckNoVat) {
        var _this = this;
        var checkValid = this.formInvoice.form.instance.validate();
        this.total_payment = "";
        if (!checkValid.isValid) {
            return;
        }
        if (this.windowPreviewBeforeSubmit) {
            this.windowPreviewBeforeSubmit.focus();
            return;
        }
        setTimeout(function () {
            _this.handleFormData();
            if (type !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.GhiTam) {
                _this._isValid = _this._validForm(false);
                if (!_this._isValid) {
                    return;
                }
                _this._isValid = _core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_14__["InvoicesService"].checkTimeExportInv(_this.configs.system_parameter);
                if (!_this._isValid) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(typescript_string_operations__WEBPACK_IMPORTED_MODULE_15__["String"].Format(_this._translate.NOTIFY.time_export_inv, moment__WEBPACK_IMPORTED_MODULE_2__(_this.configs.system_parameter.time_start).format('HH:mm'), moment__WEBPACK_IMPORTED_MODULE_2__(_this.configs.system_parameter.time_end).format('HH:mm')), 'error');
                    return;
                }
            }
            else {
                _this._isValid = _this.checkProductCode();
                if (!_this._isValid) {
                    return;
                }
            }
            if (_this.frmData.invoice_options) {
                _this.frmData.invoice_options.forEach(function (item) {
                    delete item['is_show'];
                    delete item['type'];
                    delete item['width'];
                    delete item['statusData'];
                });
            }
            if (_this.frmData.adjustment_form === 'GIAM') {
                /* Áp dụng thuế giảm trừ theo Nghị quyết số 43/2022/QH15 */
                var _objNQ43 = _this.frmData.invoice_products.filter(function (p) { return (p.vat == "8"); })[0];
                // if (_objNQ43 || this.frmData.is_resolution_43) {
                //   let dateFromNQ43 = moment("01/02/2022", 'DD/MM/YYYY').format('YYYY-MM-DD');
                //   let dateToNQ43 = moment("31/12/2022", 'DD/MM/YYYY').format('YYYY-MM-DD');
                //   let invoiceDateNQ43 = moment(this.frmData.invoice_origin.relate_invoice_date).format('YYYY-MM-DD')
                //   if (invoiceDateNQ43 < dateFromNQ43 || invoiceDateNQ43 > dateToNQ43) {
                //     Library.notify("Chỉ áp dụng giảm thuế GTGT theo Nghị quyết số 43/2022/QH15 cho hóa đơn bị điều chỉnh có ngày từ 01/02/2022 đến 31/12/2022", 'error');
                //     return false;
                //   }
                // }
            }
            if (_this.frmData.adjustment_object == "TANG_GIAM" && !_this.isTT78) {
                var _oProduct = _this.frmData.invoice_products.filter(function (w) { return _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(w.adjustment_form) == ""; })[0];
                if (_oProduct) {
                    var index = _this.frmData.invoice_products.indexOf(_oProduct);
                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'adjustment_form'));
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Phương thức điều chỉnh không được để trống.', 'error');
                    return false;
                }
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_this.frmData.bank_name) != "" && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_this.frmData.bank_name).length > 400) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.bank_name_less_than_400_character, 'error');
                return false;
            }
            if (_this.frmData.total_payment > 20000000 && (_this.frmData.payment_method_name === 'TM')) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.payment_method_more_than_20_million, 'error');
                return false;
            }
            if (!_this.isAccessExportInv && type === 'XUAT' && _this.formInvoice.getHtXuatValue() !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.you_not_permissions, 'error');
                return false;
            }
            if (type === 'XUAT' || (type === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.TrinhKy && _this.frmData.status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy)) {
                if (!_this.frmData.invoice_date && !_this.confirmCheckPreview && !_this.isTT78) {
                    var setInvoiceDate = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(_this._translate.NOTIFY.warning_invoice_date, _this._translate.NOTIFY.notify);
                    setInvoiceDate.then(function (dialog) {
                        if (!dialog) {
                            _this.formInvoice.form.instance.getEditor('invoice_date').focus();
                        }
                        else {
                            _this.processXuatHoaDon(type, isCheckNoVat);
                        }
                    });
                }
                else
                    _this.processXuatHoaDon(type, isCheckNoVat);
            }
            else {
                _this.processGhiTam(type);
            }
        }, 300);
    };
    /* Xử lý xuất hóa đơn */
    AdjustMultiplInvoiceComponent.prototype.processXuatHoaDon = function (type, isCheckNoVat) {
        var _this = this;
        var _index = 0;
        var _lstInv = [];
        this.invoice_products.load().then(function (dataSource) {
            _lstInv = dataSource.filter(function (p) { return p.product_name; });
        });
        if (this.isHdGTGT) {
            for (var i = 0; i < _lstInv.length; i++) {
                if (_lstInv[i].amount > 0 && !_lstInv[i].vat && !_lstInv[i].is_refund_ticket) {
                    var it = _lstInv[i];
                    _index = i;
                    this._isValid = false;
                    break;
                }
            }
        }
        if (!this.vatService.checkVatMauHoaDon(_lstInv, this.is_multi_vat)) {
            return false;
        }
        if (!this._isValid && isCheckNoVat) {
            var result = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(this._translate.CONFIRM.no_vat, this._translate.NOTIFY.notify);
            result.then(function (dialogResult) {
                if (dialogResult) {
                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(_index, 'vat'));
                    return false;
                }
                else {
                    if (type === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.TrinhKy && _this.frmData.status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy) {
                        _this.confirmCheckPreview = true;
                    }
                    if (_this.confirmCheckPreview) {
                        if (_this.formInvoice.getHtXuatValue() !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy) {
                            _this.xuatHoaDon(_this.frmData);
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].confirmXuatChoKy(function () {
                                if (!_this.isAccessExportInv) {
                                    if (type === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.TrinhKy) {
                                        _this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet;
                                        _this.frmData.refuse_reason = '';
                                    }
                                    else {
                                        if (_this.frmData.approve_status !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.TuChoi) {
                                            _this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChuaTrinhKy;
                                        }
                                    }
                                }
                                _this.xuatChoKy(_this.frmData);
                            });
                        }
                        _this.confirmCheckPreview = false;
                    }
                    else {
                        _this.previewBeforeExport(type);
                    }
                }
            });
        }
        else {
            if (type === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.TrinhKy && this.frmData.status === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy) {
                this.confirmCheckPreview = true;
            }
            if (this.confirmCheckPreview) {
                if (this.formInvoice.getHtXuatValue() !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy) {
                    this.xuatHoaDon(this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].confirmXuatChoKy(function () {
                        if (!_this.isAccessExportInv) {
                            if (type === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.TrinhKy) {
                                _this.frmData.refuse_reason = '';
                                _this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet;
                            }
                            else {
                                if (_this.frmData.approve_status !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.TuChoi) {
                                    _this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChuaTrinhKy;
                                }
                            }
                        }
                        _this.xuatChoKy(_this.frmData);
                    });
                }
                this.confirmCheckPreview = false;
            }
            else {
                this.previewBeforeExport(type);
            }
        }
    };
    AdjustMultiplInvoiceComponent.prototype.previewBeforeExport = function (type) {
        var _this = this;
        this.handleFormData();
        var trang_thai = '';
        if (this.formInvoice.getHtXuatValue() !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].hinhThucXuat.XuatChoKy) {
            trang_thai = this._translate.THONG_TIN.xuat_va_ky;
        }
        else {
            trang_thai = this._translate.THONG_TIN.xuat_cho_ky;
        }
        var du_lieu = this.vatService.taodulieuXemTruocMau(this.frmData);
        du_lieu['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].cauhinhxemmau.hoadon;
        var content_invoice = {
            du_lieu: du_lieu,
            ngay_hoa_don: "",
            trang_thai: trang_thai,
            tong_tien: "",
            title_invoice_type: this._translate.THONG_TIN.ban_du_thao_hoa_don.toUpperCase(),
            note_warn: this._translate.THONG_TIN.luu_y_truoc_khi_xuat,
            is_display_img_note: true,
            text_ngay_hoa_don: this._translate.THONG_TIN.ngay_hoa_don,
            text_tong_tien: this._translate.THONG_TIN.tong_tien,
            question_again: this._translate.THONG_TIN.ban_co_chac_chan_xuat_hoa_don_khong
        };
        var initialState = {
            content_invoice: content_invoice,
        };
        this.bsModalRef = this.customeModalService.show(_shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_22__["PreviewInvoiceComponent"], {
            backdrop: 'static',
            keyboard: false,
            class: 'modal-xl prv-s-invoice v-s-invoice',
            initialState: initialState
        });
        var subModal = this.customeModalService.onHide.subscribe(function () {
            if (_this.bsModalRef.content.successSaveItem == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].actionHander.DongY) {
                _this.confirmCheckPreview = true;
                _this.eSubmit(type);
            }
            subModal.unsubscribe();
        });
    };
    /* Xử lý ghi tạm hóa đơn */
    AdjustMultiplInvoiceComponent.prototype.processGhiTam = function (type) {
        if (!this.isAccessExportInv) {
            if (type === _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusInv.TrinhKy) {
                this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet;
                this.frmData.refuse_reason = '';
            }
            else {
                if (this.frmData.approve_status !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.TuChoi) {
                    this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChuaTrinhKy;
                }
            }
        }
        this.ghiTam(this.frmData);
    };
    AdjustMultiplInvoiceComponent.prototype.subData = function (type, data) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var checkValid;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        checkValid = this.formInvoice.form.instance.validate();
                        if (!checkValid.isValid) {
                            return [2 /*return*/, false];
                        }
                        if (this.windowPreviewBeforeSubmit) {
                            this.windowPreviewBeforeSubmit.focus();
                            return [2 /*return*/, false];
                        }
                        return [4 /*yield*/, this.handleFormData()];
                    case 1:
                        _a.sent();
                        if (this.frmData.invoice_options) {
                            this.frmData.invoice_options.forEach(function (item) {
                                delete item['is_show'];
                                delete item['type'];
                                delete item['width'];
                                delete item['statusData'];
                            });
                        }
                        if (this.frmData.total_payment > 20000000 && (this.frmData.payment_method_name === 'TM')) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.payment_method_more_than_20_million, 'error');
                            return [2 /*return*/, false];
                        }
                        if (!this.isAccessExportInv) {
                            if (type === 'TRINH_KY') {
                                this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChoDuyet;
                                this.frmData.refuse_reason = '';
                            }
                            else {
                                if (this.frmData.approve_status !== _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.TuChoi) {
                                    this.frmData.approve_status = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].statusApprove.ChuaTrinhKy;
                                }
                            }
                        }
                        if (!data.id) return [3 /*break*/, 6];
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                        if (!!this.isTT78) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.vatService.edit(data.id, data).toPromise().then(function (res) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                                if (res.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                    return true;
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                    return false;
                                }
                            })];
                    case 2: return [2 /*return*/, _a.sent()];
                    case 3: return [4 /*yield*/, this.vatService.editTT78(data.id, data).toPromise().then(function (res) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                            if (res.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                return true;
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                return false;
                            }
                        })];
                    case 4: return [2 /*return*/, _a.sent()];
                    case 5: return [3 /*break*/, 10];
                    case 6:
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                        if (!!this.isTT78) return [3 /*break*/, 8];
                        return [4 /*yield*/, this.vatService.ghiTam(data).toPromise().then(function (res) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                                if (res.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                    return true;
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                    return false;
                                }
                            })];
                    case 7: return [2 /*return*/, _a.sent()];
                    case 8: return [4 /*yield*/, this.vatService.ghiTamTT78(data).toPromise().then(function (res) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                            if (res.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                return true;
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                return false;
                            }
                        })];
                    case 9: return [2 /*return*/, _a.sent()];
                    case 10: return [2 /*return*/];
                }
            });
        });
    };
    AdjustMultiplInvoiceComponent.prototype.handleAddNew = function () {
        var _this = this;
        if (this.isExportInvoice) {
            this.addNew();
        }
        else {
            if (!this.checkDataFormChange(this.valueChange, this.frmData)) {
                this.confirmService.confirm()
                    .subscribe(function (value) {
                    switch (value) {
                        case 'yes':
                            _this.subData('GHI_TAM', _this.frmData).then(function (res) {
                                if (res) {
                                    _this.addNew();
                                }
                                else {
                                    return;
                                }
                            });
                            break;
                        case 'no':
                            _this.addNew();
                            break;
                        case 'cancel':
                            _this.addNew();
                            break;
                        default:
                            break;
                    }
                });
            }
            else {
                this.addNew();
            }
        }
    };
    AdjustMultiplInvoiceComponent.prototype.addNew = function () {
        var inv = Object.assign({}, this.frmData);
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["InvoiceModel"](1);
        this.frmData.invoice_date = null;
        this.frmData.template_id = inv.template_id;
        this.frmData.invoice_release_id = inv.invoice_release_id;
        this.frmData.payment_method_name = inv.payment_method_name;
        this.frmData.payment_method_view_name = inv.payment_method_view_name;
        this.frmData.currency_code = inv.currency_code;
        this.frmData.template_code = inv.template_code;
        this.frmData.invoice_series = inv.invoice_series;
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_8___default.a({
            key: 'id',
            data: this.frmData.invoice_products_data()
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_9___default.a({
            store: this.invoice_products
        });
        this.productGrip.ttDaXuatHoaDon = false;
        this.productGrip.createUpdateEvent();
        this.formInvoice.removeReadonlyAllForm();
        this.formInvoice.emails = [];
        this.ttDaXuatHoaDon = false;
        this.setDataSessionStorage(this.frmData);
    };
    AdjustMultiplInvoiceComponent.prototype.handleFormData = function () {
        var _this = this;
        this.tempKiFile = 0;
        var invoice_products = [];
        this.invoice_products.load().then(function (dataSource) {
            var transport = "";
            dataSource.forEach(function (item, index) {
                delete item.error;
                if (item.product_code || item.product_name || (!item.product_name && item.is_promotion)) {
                    item.row_content = item.product_name;
                    invoice_products.push(item);
                    if (item.is_transport_number) {
                        transport += item.product_name + "; ";
                    }
                }
            });
            if (transport != "") {
                transport = transport.trim();
                transport = transport.slice(0, -1);
                _this.frmData.transport_number = transport;
            }
            if (_this.isProcessInvOriginOther)
                _this.frmData.is_outside_process = true;
            else
                _this.frmData.is_adjustment_invoices = true;
            _this.frmData.adjustment_type = _this.adjustment_type;
            if (_this.isProcessInvOriginOther) {
                if (_this.frmData.adjustment_type == 5)
                    _this.frmData.note_view_on_invoice = "H\u00F3a \u0111\u01A1n n\u00E0y \u0111i\u1EC1u ch\u1EC9nh cho h\u00F3a \u0111\u01A1n s\u1ED1 " + _this.frmData.invoice_origin.relate_invoice_number + ", m\u1EABu s\u1ED1 " + _this.frmData.invoice_origin.relate_template_code + ", k\u00FD hi\u1EC7u " + _this.frmData.invoice_origin.relate_invoice_series + " ng\u00E0y " + moment__WEBPACK_IMPORTED_MODULE_2__(_this.frmData.invoice_origin.relate_invoice_date).format('DD/MM/YYYY');
                else if (_this.frmData.adjustment_type == 3)
                    _this.frmData.note_view_on_invoice = "H\u00F3a \u0111\u01A1n n\u00E0y thay th\u1EBF cho h\u00F3a \u0111\u01A1n s\u1ED1 " + _this.frmData.invoice_origin.relate_invoice_number + ", m\u1EABu s\u1ED1 " + _this.frmData.invoice_origin.relate_template_code + ", k\u00FD hi\u1EC7u " + _this.frmData.invoice_origin.relate_invoice_series + " ng\u00E0y " + moment__WEBPACK_IMPORTED_MODULE_2__(_this.frmData.invoice_origin.relate_invoice_date).format('DD/MM/YYYY');
            }
            _this.frmData.invoice_files = JSON.parse(JSON.stringify(_this.fileData));
            _this.frmData.invoice_products = invoice_products;
            _this.frmData.decimal_places_json = JSON.stringify(_core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getObjFormatterToColumn(_this.formatter));
        });
    };
    AdjustMultiplInvoiceComponent.prototype.dong = function () {
        if (this.isHdGTGT) {
            this.router.navigate(['/system/vat-invoice']);
        }
        else {
            this.router.navigate(['/system/sale-invoice']);
        }
    };
    AdjustMultiplInvoiceComponent.prototype.ngOnDestroy = function () {
        this.ioSignature.unsubscribe();
        this.routeSub.unsubscribe();
        // this.socketService.close();
    };
    AdjustMultiplInvoiceComponent.prototype.xemlydotuchoi = function () {
        // Library.showloading();
        // const sub = this.vatService.showToSendInvoice(this.frmData.id).subscribe(rs => {
        //   if (rs.status === 'success') {
        //     const initialState = {
        //       invoice: rs.data.invoice,
        //       listDM: this.listDM
        //     };
        //     this.bsModalRef = this.modalService.show(SendInvoicesComponent, {
        //       class: 'modal-lg full-modal', initialState, backdrop: 'static',
        //       keyboard: false
        //     });
        //     this.modalService.onHide.subscribe(() => {
        //       if (this.bsModalRef.content.successSaveItem) {
        //       }
        //     });
        //   } else {
        //     Library.notify(rs.message, 'error');
        //   }
        // }, err => {
        // }, () => {
        //   Library.hideloading();
        //   sub.unsubscribe();
        // });
    };
    AdjustMultiplInvoiceComponent.prototype.onVatChange = function () {
        var decimal_amount = this.getFormatterToNumber(this.formatter.thanh_tien);
        var decimal_amount_vat = this.getFormatterToNumber(this.formatter.tien_thue);
        if (this.frmData.vat_service_ticket === '5' || this.frmData.vat_service_ticket === '10') {
            this.frmData.total_vat_service_ticket = this.roundNumber((Number.parseInt(this.frmData.vat_service_ticket) * this.frmData.money_service_ticket) / 100, decimal_amount_vat);
        }
        else {
            this.frmData.total_vat_service_ticket = 0;
        }
        this.frmData.total_service_ticket_with_vat = this.roundNumber(this.frmData.money_service_ticket + this.frmData.total_vat_service_ticket, decimal_amount);
    };
    AdjustMultiplInvoiceComponent.prototype.canDeactivate = function () {
        var _this = this;
        if (!this.checkDataFormChange(this.valueChange, this.frmData)) {
            return new rxjs__WEBPACK_IMPORTED_MODULE_13__["Observable"](function (observer) {
                _this.confirmService.confirm().subscribe(function (value) {
                    switch (value) {
                        case 'yes':
                            _this.subData('GHI_TAM', _this.frmData).then(function (value1) {
                                observer.next(value1);
                                observer.complete();
                            });
                            break;
                        case 'no':
                            observer.next(true);
                            observer.complete();
                            break;
                        case 'cancel':
                            observer.next(false);
                            observer.complete();
                            break;
                        default:
                            observer.next(true);
                            observer.complete();
                            break;
                    }
                });
            });
        }
        else {
            return true;
        }
    };
    AdjustMultiplInvoiceComponent.prototype.onSubmit = function () {
    };
    AdjustMultiplInvoiceComponent.prototype.keyDown = function (e) {
        // setTimeout(() => {
        if (e.event.key === 'Delete') {
            e.event.srcElement.value = null;
        }
        // }, 100);
    };
    AdjustMultiplInvoiceComponent.prototype.adjustmentObjectChange = function (v) {
        if (v == 'TANG_GIAM' && !this.isTT78)
            this.productGrip.ShowAndHidePhuongThucDC(true);
        else
            this.productGrip.ShowAndHidePhuongThucDC(false);
    };
    AdjustMultiplInvoiceComponent.prototype.xemhoadonPDF = function (rs) {
        var _this = this;
        //Xem hóa đơn từ server
        if (this.configs.system_parameter.display_template_from_server) {
            var w = 1920, h = 900;
            w = window.screen.availWidth * 100 / 100;
            h = window.screen.availHeight * 93 / 100;
            var pdf_file = rs.data.invoice.pdf_file;
            var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_3__["VPreviewInvService"]._getUrlInvoice(pdf_file);
            var win = window.open(objectUrl, 'name', 'width=' + w + ', height=' + h);
            win.resizeTo(screen.availWidth, screen.availHeight);
            win.focus();
            this.spinner.hide();
        }
        else {
            /* Xem hóa đơn từ Client */
            var json_data = rs.data.invoice.json_data;
            var appCode = "REPX";
            if (rs.data.invoice.is_html_template)
                appCode = "HTML";
            this.socketService.xemhoadon(function () { return _this.connectWebsocket(); }, json_data, appCode, "XEM_TRUOC");
        }
    };
    /* Kiểm tra Mã hàng phải nhập không dấu, không chứa ký tự đặc biệt và tối đa 50 ký tự */
    AdjustMultiplInvoiceComponent.prototype.checkProductCode = function () {
        var isValid = true;
        var _lst = this.frmData.invoice_products.filter(function (p) { return p.product_name; });
        if (_lst.length > 0) {
            for (var i = 0; i < _lst.length; i++) {
                if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_lst[i].product_code) != "" && !this.productCodePattern.test(_lst[i].product_code)) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.VALIDATION.required_productCode, 'error', 5000);
                    this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(i, 'product_code'));
                    return false;
                }
            }
        }
        return isValid;
    };
    AdjustMultiplInvoiceComponent.prototype.doctienbangchu = function (total_payment, currency_code) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.adjustment_object) == "TANG_GIAM" && this.isTT78) {
            var number_money = Math.abs(total_payment);
            var c_money = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].tienBangChu(number_money, _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            this.frmData.total_payment_in_word = c_money;
            if (total_payment < 0) {
                this.frmData.total_payment_in_word = "Giảm " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                }
            }
            else if (total_payment > 0) {
                this.frmData.total_payment_in_word = "Tăng " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                }
            }
        }
        else {
            this.frmData.total_payment_in_word = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].tienBangChu(total_payment, _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            if (this.isTT78) {
                if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.total_payment_in_word) != "" && this.frmData.total_payment_in_word != "Không đồng chẵn.") {
                    if (this.frmData.adjustment_form === 'TANG') {
                        this.frmData.total_payment_in_word = "Tăng " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                        }
                    }
                    if (this.frmData.adjustment_form == 'GIAM') {
                        this.frmData.total_payment_in_word = "Giảm " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                        }
                    }
                }
            }
        }
    };
    AdjustMultiplInvoiceComponent.prototype.setTypeInvoice = function () {
        var template_code = this.frmData.template_code.split('/');
        if (template_code[0].indexOf('02GTTT') >= 0 || template_code[0].indexOf('07KPTQ') >= 0
            || template_code[0] == "2")
            this.isHdGTGT = false;
        else
            this.isHdGTGT = true;
    };
    AdjustMultiplInvoiceComponent.prototype.onChangeSalePercen = function (e) {
        var _this = this;
        this.configs.system_parameter.value_rate_percent = e.value;
        var data = {
            config: {
                value: JSON.stringify(this.configs.system_parameter)
            }
        };
        this.configsService.update(this.configs.id.system_parameter, data).subscribe(function (response) {
            if (response.status == "success") {
                _this.configsService.getAll().subscribe(function (res) {
                    if (res.data && res.data.configs)
                        _this.authService.setConfigs(res.data.configs);
                    _this.configs = _this.authService.getConfigs();
                });
            }
            else {
            }
        }, function (err) { }, function () {
        });
        this.onNumberTicketChange();
    };
    AdjustMultiplInvoiceComponent.prototype.guideSales = function () {
        this.isDisplayGuideSale = !this.isDisplayGuideSale;
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_adjust_multipl_product_grip_adjust_multipl_product_grip_component__WEBPACK_IMPORTED_MODULE_4__["AdjustMultiplProductGripComponent"]),
        __metadata("design:type", _adjust_multipl_product_grip_adjust_multipl_product_grip_component__WEBPACK_IMPORTED_MODULE_4__["AdjustMultiplProductGripComponent"])
    ], AdjustMultiplInvoiceComponent.prototype, "productGrip", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_adjust_multipl_form_invoice_adjust_multipl_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__["AdjustMultiplFormInvoiceComponent"]),
        __metadata("design:type", _adjust_multipl_form_invoice_adjust_multipl_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__["AdjustMultiplFormInvoiceComponent"])
    ], AdjustMultiplInvoiceComponent.prototype, "formInvoice", void 0);
    AdjustMultiplInvoiceComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-adjust-multipl-invoice',
            template: __webpack_require__(/*! ./adjust-multipl-invoice.component.html */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.html"),
            styles: [__webpack_require__(/*! ./adjust-multipl-invoice.component.scss */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.scss")]
        }),
        __metadata("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_7__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["VatService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["SocketService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["AuthService"],
            _angular_core__WEBPACK_IMPORTED_MODULE_0__["ChangeDetectorRef"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__["TranslateService"],
            _modules_customers_shared__WEBPACK_IMPORTED_MODULE_11__["CustomersService"],
            _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_16__["ConfirmService"],
            ngx_spinner__WEBPACK_IMPORTED_MODULE_17__["NgxSpinnerService"],
            _modules_configs_shared__WEBPACK_IMPORTED_MODULE_19__["ConfigsService"],
            _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_20__["ViewInvoiceService"],
            _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_21__["MyBsModalService"]])
    ], AdjustMultiplInvoiceComponent);
    return AdjustMultiplInvoiceComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.html":
/*!******************************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.html ***!
  \******************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<!-- Phần không tự tính giá trị, nhập mẫu bảng kê -->\r\n<div class=\"row support-invoice\">\r\n  <div class=\"col-md-12\">\r\n    <div class=\"pull-left\">\r\n      <div style=\"float: left;width:  30%; padding-top: 4px\">{{ _translate.CONTROLL.BUTTON.add_row }}</div>\r\n      <div style=\"float: left; width: 30%\">\r\n        <dx-number-box #numberBox [max]=\"100\" [min]=\"1\" [showSpinButtons]=\"true\" [(value)]=\"rowData\"></dx-number-box>\r\n      </div>\r\n      <div>\r\n        <dx-button style=\"height: 27px\" icon=\"fa fa-plus-circle\" type=\"default\" text=\"\"\r\n                   (onClick)=\"addRow()\"></dx-button>\r\n      </div>\r\n\r\n      <!-- <div class=\"dx-fieldset\" style=\"width: 170px;\">\r\n        <div class=\"dx-field\">\r\n          <div class=\"dx-field-label\" style=\"width: 51%;\">Thêm dòng</div>\r\n          <div class=\"dx-field-value\" style=\"width: 49%;\">\r\n            <div style=\"float: left\">\r\n\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field-value\" style=\"width: 49%;\">\r\n\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </div> -->\r\n    </div>\r\n    <div class=\"pull-right\">\r\n      <!-- Hóa đơn bán hàng NĐ 92 -->\r\n      <dx-check-box *ngIf=\"!isHdGTGT\" style=\"margin-right: 42px\" [(value)]=\"formDataInInvoice.is_exemption_decree\" text=\"Giảm thuế theo NĐ số 92/2021\" (onValueChanged)=\"_changeND92($event)\"></dx-check-box>\r\n      <!-- <div *ngIf=\"!isHdGTGT\" class=\"toggle normal\" style=\"display: inline-block; align-items: center;margin-right: 42px;margin-left: 7px;\">\r\n        <img id=\"link3\" style=\"cursor: pointer\" src=\"assets\\img\\icons\\Icon_Information.png\" (click)=\"onClickGuidReduce()\" alt=\"efy.vn\" alt=\"Efy.vn\">\r\n      </div> -->\r\n      <!-- Nghị định 43 -->\r\n      <dx-check-box *ngIf=\"!isHdGTGT\" style=\"margin-right:20px\" [(value)]=\"formDataInInvoice.is_resolution_43\" text=\"{{ _translate.THONG_TIN.giam_thue_theo_nq43 }}\" (onValueChanged)=\"_changeNQ43($event)\"></dx-check-box>\r\n      <dx-check-box *ngIf=\"configs.system_parameter.view_sale_by_phone\" class=\"auto-input\"\r\n                    text=\"{{ _translate.CONTROLL.LABEL.sale_by_phone }}\"\r\n                    [(value)]=\"formDataInInvoice.sale_by_phone\"></dx-check-box>\r\n      <dx-check-box class=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.no_calculation }}\"\r\n                    [(value)]=\"formDataInInvoice.auto_value\" (onValueChanged)=\"checboxTinhgiatri()\"></dx-check-box>\r\n      <dx-check-box *ngIf=\"isHdGTGT\" class=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.auto_value_price }}\"\r\n                    [(value)]=\"formDataInInvoice.auto_value_price\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- <a href=\"javascript:void(0)\" (click)=\"layMauBangKe()\" class=\"support-link mgr-15\">\r\n        <i [class]=\"_translate.ICONS.download\"></i><span> {{ _translate.CONTROLL.BUTTON.get_the_sample_file }}</span>\r\n      </a>\r\n      <a href=\"javascript:void(0)\" (click)=\"napDuLieuTuBangKe()\" [class.disabled-link]=\"ttDaXuatHoaDon\"\r\n         class=\"support-link\">\r\n        <input type=\"file\" id=\"file-bang-ke\" accept=\".xlsx\" (change)=\"onFileBangKeChange($event)\" multiple=\"false\"\r\n               style=\"display: none;\"/>\r\n        <i [class]=\"_translate.ICONS.excel\"></i><span> {{ _translate.CONTROLL.BUTTON.import_data }}</span>\r\n      </a> -->\r\n      <dx-menu\r\n            [dataSource]=\"extras\"\r\n            displayExpr=\"name\"\r\n            orientation=\"horizontal\"\r\n            submenuDirection=\"auto\"\r\n            (onItemClick)=\"itemExtrasClick($event)\"\r\n            cssClass='button-dropdown-extend'>\r\n          </dx-menu>\r\n          <input type=\"file\" id=\"file-bang-ke\" accept=\".xlsx\" (change)=\"onFileBangKeChange($event)\" multiple=\"false\"\r\n               style=\"display: none;\"/>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- popup -->\r\n<dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"{{ _translate.NOTIFY.notify }}\"\r\n          [dragEnabled]=\"false\"\r\n          [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">{{ _translate.CONFIRM.import_type }}</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"thayTheToanBo()\" text=\"{{ _translate.CONTROLL.BUTTON.replace_all }}\"\r\n                 type=\"default\"></dx-button>\r\n      <dx-button (click)=\"themTiep()\" text=\"{{ _translate.CONTROLL.BUTTON.add_more }}\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"huy()\" text=\"{{ _translate.CONTROLL.BUTTON.cancel }}\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup>\r\n\r\n<!-- phần table hiển thị -->\r\n<div class=\"row invoice-table\">\r\n  <div class=\"col-md-12\">\r\n    <dx-data-grid id=\"gridInvoice\" [dataSource]=\"dataSource\" [showBorders]=\"true\" [showRowLines]=\"true\"\r\n                  [allowColumnResizing]=\"true\" [columnResizingMode]=\"true\" [wordWrapEnabled]=\"true\"\r\n                  (onKeyDown)=\"onGripKeyDown($event)\"\r\n                  (onContextMenuPreparing)=\"onContextMenuPreparing($event)\"\r\n                  (onEditorPrepared)=\"onEditorPrepared($event)\"\r\n                  (onEditorPreparing)=\"onEditorPreparing($event)\" (onRowPrepared)=\"onRowPrepared($event)\"\r\n    >\r\n      <!-- [wordWrapEnabled]=\"true\" (onEditorPrepared)=\"onEditorPrepared($event)\" -->\r\n      <dxo-editing mode=\"cell\" [allowUpdating]=\"!ttDaXuatHoaDon\"></dxo-editing>\r\n      <dxo-sorting mode=\"false\"></dxo-sorting>\r\n      <dxi-column cellTemplate=\"deleteColumn\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.delete }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.delete_column }}\"\r\n                  [allowEditing]=\"false\" alignment=\"center\" [fixed]=\"true\" fixedPosition=\"left\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"view_order\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.view_order }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.stt }}\"\r\n                  alignment=\"center\" [fixed]=\"true\" fixedPosition=\"left\"></dxi-column>\r\n      <!-- Phương thức điều chỉnh -->\r\n      <dxi-column *ngIf=\"isPhuongThucDC\" dataField=\"adjustment_form\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.unit_code }}\" width=\"{{ _translate.GRID_WIDTH.unit_code }}\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.modes_of_adjustment }}\"\r\n                  alignment=\"center\" [fixed]=\"true\" fixedPosition=\"left\" [editorOptions]=\"{showClearButton: true}\">\r\n       <dxo-lookup [dataSource]=\"select.adjustment_methods\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"(extentionGrid && extentionGrid.don_hang_hop_dong) || (configs && configs.system_parameter && configs.system_parameter.display_contract_order)\" dataField=\"contract_order\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.po_no_contract_no }}\"\r\n                  alignment=\"left\"></dxi-column>\r\n      <!-- <dxi-column *ngIf=\"!isPhuongThucDC\" cssClass=\"overlay-content123\" dataField=\"product_code\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_code }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.ma_hang }}\"\r\n                  alignment=\"center\" [fixed]=\"true\" fixedPosition=\"left\" [editorOptions]=\"{showClearButton: true}\">\r\n        <dxo-lookup *ngIf=\"reloadSelectProduct\"\r\n                    [dataSource]=\"select.productsView\"\r\n                    displayExpr=\"mhvth\" valueExpr=\"code\"\r\n        >\r\n        </dxo-lookup>\r\n      </dxi-column> -->\r\n      <!-- Mã hàng hóa -->\r\n      <dxi-column *ngIf=\"isInvoiceReplace || configs.system_parameter.is_add_product_code\" cssClass=\"overlay-content123\" dataField=\"product_code\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_code }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.ma_hang }}\"\r\n                  alignment=\"center\" [fixed]=\"true\" fixedPosition=\"left\" [editorOptions]=\"{showClearButton: true}\">\r\n        <dxo-lookup *ngIf=\"reloadSelectProduct\"\r\n                    [dataSource]=\"select.productsView\"\r\n                    displayExpr=\"mhvth\" valueExpr=\"code\"\r\n        >\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column dataField=\"product_name\" minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_name }}\"\r\n                  alignment=\"left\" [fixed]=\"true\" fixedPosition=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.incurred_refund_ticket\" cellTemplate=\"PhiHoanVe\"\r\n                  caption=\"{{ _translate.CONTROLL.LABEL.refund_fee }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.cktm }}\" [allowEditing]=\"false\"\r\n                  alignment=\"center\"></dxi-column>\r\n      <!-- Số máy -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.template_type=='HOA_DON_KINH_DOANH_XE') || (_oTemplateTT78 && _oTemplateTT78.template_type=='HOA_DON_KINH_DOANH_XE'))\"\r\n                  dataField=\"engine_number\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.engine_number }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.so_may }}\" alignment=\"center\"></dxi-column>\r\n      <!-- Số khung -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.template_type=='HOA_DON_KINH_DOANH_XE') || (_oTemplateTT78 && _oTemplateTT78.template_type=='HOA_DON_KINH_DOANH_XE'))\"\r\n                  dataField=\"chassis_number\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.chassis_number }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.so_khung }}\" alignment=\"center\"></dxi-column>\r\n      <!-- Phí dịch vụ -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.template_type=='HOA_DON_NHA_HANG_KHACH_SAN') || (_oTemplateTT78 && _oTemplateTT78.template_type=='HOA_DON_NHA_HANG_KHACH_SAN'))\" cellTemplate=\"phi_dich_vu\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.money_service }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n                  [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_promotion\" cellTemplate=\"dien_giai\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.explain }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n                  [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.promotional_goods_on_the_invoice\" cellTemplate=\"khuyen_mai\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.promotion }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n                  [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_lot || extentionGrid.so_lo\" dataField=\"lot\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.lot }}\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.lot }}\"\r\n                  alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_expiration_date || extentionGrid.han_dung\" dataField=\"expiration_date\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.expiration_date }}\"\r\n                  alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_country || extentionGrid.nuoc_san_xuat\"\r\n                  [editorOptions]=\"{showClearButton: true}\" dataField=\"country_code\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.country }}\" minWidth=\"{{ _translate.GRID_WIDTH.country }}\"\r\n                  alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.countrys\" displayExpr=\"name\" valueExpr=\"code\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n\r\n      <dxi-column *ngIf=\"configs.system_parameter.display_transport_number_from_product\" cellTemplate=\"is_transport_number\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.transport_number  }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.is_transport_number  }}\"\r\n                  [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.commercial_discount\" cellTemplate=\"cktm\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.commercial_discount }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.cktm }}\" [allowEditing]=\"false\"\r\n                  alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_provisions_on_accounts\" dataField=\"provisions_on_accounts\"\r\n                  caption=\"{{ _translate.GRID.INVOICE_DETAILS.provisions_on_accounts }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.dinh_khoan }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.select_provisions_on_accounts\" displayExpr=\"name\" valueExpr=\"code\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column dataField=\"unit_code\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.unit_code }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.unit_code }}\"\r\n                  alignment=\"center\" [editorOptions]=\"lookupColumnOptions\">\r\n        <dxo-lookup [dataSource]=\"select.unit_codes\" displayExpr=\"name\" valueExpr=\"code\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column dataField=\"quantity\" headerCellTemplate=\"quantityHeader\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.so_luong }}\"\r\n                  [editorOptions]=\"{ format: formatter.so_luong,step: '0' }\" [format]=\"formatter.so_luong\"\r\n                  dataType=\"number\"\r\n                  alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_price_nte\" dataField=\"price_nte\" headerCellTemplate=\"price_nteHeader\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n                  [editorOptions]=\"{ format: formatter.don_gia_nte, step:'0' }\"\r\n                  [format]=\"formatter.don_gia_nte\" dataType=\"number\"\r\n                  alignment=\"right\"></dxi-column>\r\n      <dxi-column dataField=\"price\" headerCellTemplate=\"priceHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n                  [editorOptions]=\"{ format: formatter.don_gia,step: '0' }\" [format]=\"formatter.don_gia\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\">\r\n      </dxi-column>\r\n      <!-- Thành tiền chưa trừ CK -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && _objTemplateSelect.template_type!='HOA_DON_BAN_GIAO_XE' && _objTemplateSelect.template_type!='HOA_DON_BAO_DUONG_XE')\r\n      || (_oTemplateTT78 && _oTemplateTT78.is_discount && _oTemplateTT78.template_type!='HOA_DON_BAN_GIAO_XE' && _oTemplateTT78.template_type!='HOA_DON_BAO_DUONG_XE'))\" dataField=\"amount_without_discount\"\r\n                  headerCellTemplate=\"amountNoDiscountHeader\" minWidth=\"{{ _translate.GRID_WIDTH.thanh_tien }}\"\r\n                  [editorOptions]=\"{ format: formatter.thanh_tien_chua_ck ,step: '0'}\"\r\n                  [format]=\"formatter.thanh_tien_chua_ck\" dataType=\"number\"\r\n                  alignment=\"right\">\r\n      </dxi-column>\r\n      <!-- Chiết khấu -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && _objTemplateSelect.template_type!='HOA_DON_BAN_GIAO_XE' && _objTemplateSelect.template_type!='HOA_DON_BAO_DUONG_XE')\r\n      || (_oTemplateTT78 && _oTemplateTT78.is_discount && _oTemplateTT78.template_type!='HOA_DON_BAN_GIAO_XE' && _oTemplateTT78.template_type!='HOA_DON_BAO_DUONG_XE'))\" dataField=\"discount\" headerCellTemplate=\"discountHeader\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.chiet_khau }}\"\r\n                  [editorOptions]=\"{ format: formatter.ty_le_chiet_khau,step: '0' }\"\r\n                  [format]=\"formatter.ty_le_chiet_khau\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\">\r\n      </dxi-column>\r\n      <!-- Tiền chiết khấu -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount) || (_oTemplateTT78 && _oTemplateTT78.is_discount))\" dataField=\"amount_discount\"\r\n                  headerCellTemplate=\"amount_discountHeader\" minWidth=\"{{ _translate.GRID_WIDTH.tien_chiet_khau }}\"\r\n                  [editorOptions]=\"{ format: formatter.tien_chiet_khau }\"\r\n                  [format]=\"formatter.tien_chiet_khau\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"amount\" headerCellTemplate=\"amountHeader\" minWidth=\"{{ _translate.GRID_WIDTH.thanh_tien }}\"\r\n                  [editorOptions]=\"{ format: formatter.thanh_tien ,step: '0'}\" [format]=\"formatter.thanh_tien\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column cssClass=\"vat-invoices\" *ngIf=\"isHdGTGT\" dataField=\"vat\" headerCellTemplate=\"vatHeader\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.vat }}\" alignment=\"center\"\r\n                  [editorOptions]=\"{showClearButton: true ,step: '0'}\">\r\n        <dxo-lookup [dataSource]=\"select.vats\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"isHdGTGT\" dataField=\"amount_vat\" headerCellTemplate=\"amountVatHeader\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\"\r\n                  [editorOptions]=\"{ format: formatter.tien_thue, step: '0' }\" [format]=\"formatter.tien_thue\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\"></dxi-column>\r\n      <!-- Thuế khác -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.template_type=='HOA_DON_VE_MAY_TONG_HOP') || (_oTemplateTT78 && _oTemplateTT78.template_type=='HOA_DON_VE_MAY_TONG_HOP') )\" dataField=\"other_tax\"\r\n                  caption=\"{{ _translate.CONTROLL.LABEL.othertax  }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\"\r\n                  [editorOptions]=\"{ format: formatter.thanh_tien, step: '0' }\" [format]=\"formatter.thanh_tien\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\"></dxi-column>\r\n      <!-- Tiền phí khác -->\r\n      <dxi-column *ngIf=\"((_objTemplateSelect && _objTemplateSelect.template_type=='HOA_DON_VE_MAY_TONG_HOP') || (_oTemplateTT78 && _oTemplateTT78.template_type=='HOA_DON_VE_MAY_TONG_HOP'))\" dataField=\"other_charge\"\r\n                  caption=\"{{ _translate.CONTROLL.LABEL.money_other  }}\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\"\r\n                  [editorOptions]=\"{ format: formatter.thanh_tien, step: '0' }\" [format]=\"formatter.thanh_tien\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\"></dxi-column>\r\n      <dxi-column dataField=\"amount_after_vat\" headerCellTemplate=\"amountAfterVatHeader\"\r\n                  minWidth=\"{{ _translate.GRID_WIDTH.tong_tien_sau_thue }}\"\r\n                  [editorOptions]=\"{ format: formatter.tong_tien, step:'0'}\" [format]=\"formatter.tong_tien\"\r\n                  dataType=\"number\"\r\n                  alignment=\"right\"></dxi-column>\r\n      <!-- config column header -->\r\n      <div *dxTemplate=\"let d of 'quantityHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.quantity }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeader'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.price }}<img\r\n          src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'price_nteHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_nte')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.price_nte }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.amount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountNoDiscountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien_chua_ck')\"\r\n           style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.amount_without_discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'discountHeader'\">\r\n        <p (click)=\"configDecimal('ty_le_chiet_khau')\"\r\n           style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amount_discountHeader'\">\r\n        <p (click)=\"configDecimal('tien_chiet_khau')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.amount_discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'vatHeader'\">\r\n        <p>VAT</p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountVatHeader'\">\r\n        <p (click)=\"configDecimal('tien_thue')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.amount_vat }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountAfterVatHeader'\">\r\n        <p (click)=\"configDecimal('tong_tien')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.total_money }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <!-- config column -->\r\n      <div id=\"context-table\" *dxTemplate=\"let d of 'deleteColumn'\">\r\n        <a class=\"delete-row\" href=\"javascript:void(0)\" (click)=\"deleteRow(d.data)\"><i class=\"fa fa-times\"></i></a>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'dien_giai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion\" [disabled]=\"d.data.is_promotion_new\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'khuyen_mai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion_new\" [disabled]=\"d.data.is_promotion\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'phi_dich_vu'\">\r\n        <dx-check-box [(value)]=\"d.data.is_money_service\" (onValueChanged)=\"changePhiDV(d.data)\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'is_transport_number'\">\r\n        <dx-check-box [(value)]=\"d.data.is_transport_number\"></dx-check-box>\r\n      </div>\r\n\r\n      <div *dxTemplate=\"let d of 'cktm'\">\r\n        <dx-check-box [(value)]=\"d.data.commercial_discount\" (onValueChanged)=\"changeCKTM(d.data)\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'PhiHoanVe'\">\r\n          <dx-check-box [(value)]=\"d.data.is_refund_ticket\" (onValueChanged)=\"changePhiHoanVe(d.data)\"></dx-check-box>\r\n        </div>\r\n      <div *dxTemplate=\"let d of 'product_code'\">\r\n        <!-- <dx-autocomplete valueExpr=\"code\"\r\n          [dataSource]=\"select.products\" [(value)]=\"d.data.code\">\r\n          <div *dxTemplate=\"let item of 'item'\">\r\n            <span>{{item.mhvth}}</span>\r\n          </div>\r\n        </dx-autocomplete> -->\r\n        <dxi-item editorType=\"dxSelectBox\"\r\n                  [editorOptions]=\"{items: select.productsView, displayExpr: 'name', valueExpr: 'code'}\"\r\n        >\r\n        </dxi-item>\r\n      </div>\r\n      <!-- <dxo-summary >\r\n        <dxi-total-item\r\n            summaryType=\"custom\"\r\n            [customizeText]=\"customizeText\"\r\n            showInColumn=\"amount\">\r\n        </dxi-total-item>\r\n      </dxo-summary> -->\r\n      <dxo-paging [enabled]=\"false\"></dxo-paging>\r\n      <dxo-remote-operations [sorting]=\"false\" [filtering]=\"false\"></dxo-remote-operations>\r\n      <!-- <dxo-summary [calculateCustomSummary]=\"calculateSummary\"> -->\r\n      <!-- <dxi-total-item\r\n            column=\"OrderNumber\"\r\n            summaryType=\"count\">\r\n        </dxi-total-item>\r\n        <dxi-total-item\r\n            column=\"OrderDate\"\r\n            summaryType=\"min\"\r\n            [customizeText]=\"customizeDate\">\r\n        </dxi-total-item> -->\r\n      <!-- <dxi-total-item cssClass=\"vat amount-table-footer\"\r\n            name=\"amount\"\r\n            column=\"amount\"\r\n            summaryType=\"sum\"\r\n            [valueFormat]=\"formatter.thanh_tien\">\r\n        </dxi-total-item> -->\r\n      <!-- <dxi-total-item *ngIf=\"isHdGTGT\"\r\n        name=\"amount_vat\"\r\n            column=\"amount_vat\"\r\n            summaryType=\"sum\"\r\n            [valueFormat]=\"formatter.tien_thue\">\r\n        </dxi-total-item> -->\r\n      <!-- <dxi-total-item\r\n        name=\"amount_after_vat\"\r\n            column=\"amount_after_vat\"\r\n            summaryType=\"custom\"\r\n            [valueFormat]=\"formatter.tong_tien\">\r\n        </dxi-total-item> -->\r\n      <!-- </dxo-summary> -->\r\n    </dx-data-grid>\r\n  </div>\r\n</div>\r\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.scss":
/*!******************************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.scss ***!
  \******************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".delete-row i{color:#0E77BB;font-size:18px}.support-invoice{margin-top:20px;margin-bottom:10px}.support-invoice .support-link{padding:6px 15px;border:1px solid #007bff;text-decoration:none}.support-invoice .support-link.mgr-15{margin-right:8px}.support-invoice .support-link img,.support-invoice .support-link i{margin-right:15px;margin-top:-2px}.support-invoice .auto-input{margin-right:40px !important}::ng-deep .vat.amount-table-footer input,::ng-deep .vat.amount-vat-table-footer input,::ng-deep .vat.amount-after-vat-table-footer input{font-weight:bold;text-align:right;color:#0034F5}::ng-deep .styleItemToList{color:dodgerblue}.button-dropdown-extend{display:inline-flex}::ng-deep .vat-invoices .dx-texteditor-buttons-container{display:-ms-inline-grid;display:inline-grid}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.ts":
/*!****************************************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.ts ***!
  \****************************************************************************************************************************************/
/*! exports provided: AdjustMultiplProductGripComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustMultiplProductGripComponent", function() { return AdjustMultiplProductGripComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! devextreme/data/custom_store */ "./node_modules/devextreme/data/custom_store.js");
/* harmony import */ var devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! xlsx */ "./node_modules/xlsx/xlsx.js");
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(xlsx__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _modules_products_shared__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @modules/products/shared */ "./src/app/modules/products/shared/index.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @core/library/public/v-select-box.service */ "./src/app/core/library/public/v-select-box.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};













var AdjustMultiplProductGripComponent = /** @class */ (function () {
    function AdjustMultiplProductGripComponent(route, router, modalService, vatService, productsService, authService, translate) {
        this.route = route;
        this.router = router;
        this.modalService = modalService;
        this.vatService = vatService;
        this.productsService = productsService;
        this.authService = authService;
        this.translate = translate;
        this.select = {};
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_8__["InvoiceModel"](1);
        this.showPopup = false; // Popup
        this.dataExcelFile = null;
        this.dataExcelFileInfo = null;
        this.ttDaXuatHoaDon = false;
        this.amount_after_vat = 0;
        this.reloadSelectProduct = true;
        this.isPhuongThucDC = false;
        this.extras = [];
        this.rowData = 1;
        this.ruleError = {
            '': 'này',
            '-1': 'Không chịu thuế',
            '0': '0%',
            '5': '5%',
            '10': '10%'
        };
        this.isInvoiceReplace = false;
        // Thêm giá trị mới vào đơn vị tính
        this.lookupColumnOptions = {
            acceptCustomValue: true,
            showClearButton: true,
            onCustomItemCreating: function (args) {
                var _this = this;
                //
                //
                var newItem = {};
                newItem.code = _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._convertToViKdau(args.text);
                var oDuplicate = this.select.unit_codes.filter(function (p) { return p.code === newItem.code; })[0];
                if (oDuplicate)
                    newItem.code = newItem.code + _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].addtionalUnitCode();
                newItem.name = args.text;
                this.select.unit_codes.unshift(newItem);
                setTimeout(function () {
                    _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                        dataSource: _this.select.unit_codes,
                        displayExpr: 'name',
                        valueExpr: 'code'
                    });
                });
                return newItem;
            }.bind(this)
        };
        this.configs = this.authService.getConfigs();
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
        this.extras = [{
                id: '1',
                name: this._translate.CONTROLL.BUTTON.import_from_excel,
                items: [
                    {
                        id: 'LAY_MAU_BANG_KE',
                        name: this._translate.CONTROLL.BUTTON.get_the_sample_file,
                        icon: this._translate.ICONS.download
                    },
                    {
                        id: 'NAP_DU_LIEU_BANG_KE',
                        name: this._translate.CONTROLL.BUTTON.import_data,
                        icon: this._translate.ICONS.excel
                    }
                ]
            }];
    }
    AdjustMultiplProductGripComponent.prototype.ngAfterViewInit = function () {
        // let a = moment(new Date()).format('HH:mm:ss.SSS');
    };
    AdjustMultiplProductGripComponent.prototype.ngOnInit = function () {
        var _this = this;
        if (!this.isHdGTGT) {
            this.formDataInInvoice.amount_vatx = null;
            this.formDataInInvoice.amount_vat5 = null;
            this.formDataInInvoice.amount_vat10 = null;
        }
        this.configs = this.authService.getConfigs();
        // let a = moment(new Date()).format('HH:mm:ss.SSS');
        this.routeSub = this.route.data.subscribe(function (data) {
            var loaiDieuChinh = data.type;
            if (loaiDieuChinh == "thay-the-khac")
                _this.isInvoiceReplace = true;
            // put data DM for select
            var danh_muc = _this.authService.getDMLocal();
            _this.select.unit_codes = danh_muc.DM_DON_VI_TINH ? danh_muc.DM_DON_VI_TINH.data : null;
            _this.select.select_provisions_on_accounts = danh_muc.DM_DINH_KHOAN ? danh_muc.DM_DINH_KHOAN.data : null;
            _this.select.vats = danh_muc.DM_TY_LE_VAT ? danh_muc.DM_TY_LE_VAT.data : null;
            _this.select.countrys = danh_muc.DM_QUOC_GIA ? danh_muc.DM_QUOC_GIA.data : null;
            _this.select.adjustment_methods = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_12__["VSelectBoxService"]._adjustmentMethods(_this._translate);
            ///
            if (_this.select.select_provisions_on_accounts && _this.select.select_provisions_on_accounts.length > 0) {
                _this.select.select_provisions_on_accounts.forEach(function (item) {
                    item.mdk = item.code + ': ' + item.name;
                });
            }
            ///
            var isEdit = false;
            var invoice;
            if (data.init[2] == true)
                isEdit = true;
            if (_this.isTT78) {
                _this.select.products = data.init[0];
                if (isEdit)
                    invoice = data.init[1];
                _this.select.productsView = {
                    store: new devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default.a({
                        key: 'code',
                        loadMode: 'raw',
                        load: function (loadOptions) {
                            return _this.select.products;
                        },
                        byKey: function (key) {
                            var _data = data.init[0].filter(function (p) { return p.code === key.toString(); });
                            return _data;
                        }
                    }),
                    paginate: true,
                    sort: 'name'
                };
            }
            else {
                _this.select.products = data.init[1];
                if (isEdit)
                    invoice = data.init[3];
                _this.select.productsView = {
                    store: new devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default.a({
                        key: 'code',
                        loadMode: 'raw',
                        load: function (loadOptions) {
                            return _this.select.products;
                        },
                        byKey: function (key) {
                            var _data = data.init[1].filter(function (p) { return p.code === key.toString(); });
                            return _data;
                        }
                    }),
                    paginate: true,
                    sort: 'name'
                };
            }
            _this.select.products.forEach(function (item) {
                item.mhvth = item.code + ': ' + item.name;
            });
            if (isEdit) {
                if (invoice.invoice_products) {
                    invoice.invoice_products.forEach(function (item) {
                        if (item.product_name && item.unit_name) {
                            var obj1 = _this.select.unit_codes.filter(function (p) { return p.name === item.unit_name; })[0];
                            if (!obj1) {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(item.unit_code) == "")
                                    item.unit_code = _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._convertToViKdau(item.unit_name);
                                var oDuplicate = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                                if (oDuplicate)
                                    item.unit_code = item.unit_code + _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].addtionalUnitCode();
                                _this.select.unit_codes.push({ code: item.unit_code, name: item.unit_name });
                            }
                            else {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(item.unit_code) != "") {
                                    var oExistUnitCode = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                                    if (!oExistUnitCode)
                                        _this.select.unit_codes.push({ code: item.unit_code, name: item.unit_name });
                                }
                            }
                        }
                    });
                }
            }
            else {
                _this.invoice_products.load().then(function (dataSource) {
                    dataSource.forEach(function (item, index) {
                        if (item.product_name && item.unit_name) {
                            var obj1 = _this.select.unit_codes.filter(function (p) { return p.name === item.unit_name; })[0];
                            if (!obj1) {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(item.unit_code) == "")
                                    item.unit_code = _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._convertToViKdau(item.unit_name);
                                var oDuplicate = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                                if (oDuplicate)
                                    item.unit_code = item.unit_code + _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].addtionalUnitCode();
                                _this.select.unit_codes.push({ code: item.unit_code, name: item.unit_name });
                            }
                            else {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(item.unit_code) != "") {
                                    var oExistUnitCode = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                                    if (!oExistUnitCode)
                                        _this.select.unit_codes.push({ code: item.unit_code, name: item.unit_name });
                                }
                            }
                        }
                    });
                });
            }
        });
        // Event
        this.createUpdateEvent();
    };
    // khởi tạo sự kiện khi update
    AdjustMultiplProductGripComponent.prototype.createUpdateEvent = function () {
        var _this = this;
        setTimeout(function () {
            _this.invoice_products.on('updated', function (key, value) {
                var column = Object.keys(value)[0];
                if (value.product_code !== 'add') {
                    _this.invoice_products.byKey(key).then(function (row) {
                        switch (column) {
                            case 'view_order':
                                _this.view_orderChange();
                                break;
                            case 'product_code':
                                _this.product_codeChange(row);
                                break;
                            case 'unit_code':
                                _this.unit_codeChange(row);
                                break;
                            case 'country_code':
                                _this.country_codeChange(row);
                                break;
                            case 'quantity':
                            case 'price':
                            case 'price_nte':
                            case 'vat':
                            case 'amount':
                            case 'amount_vat':
                            case 'amount_after_vat':
                            case 'amount_discount':
                            case 'discount':
                            case 'amount_without_discount':
                            case 'other_tax':
                            case 'other_charge':
                                _this._tinhGiaTri();
                                break;
                            case 'adjustment_form':
                                if (row.adjustment_form == "TANG") {
                                    if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(row.product_name) == "" || row.product_name === "Điều chỉnh giảm") {
                                        row.product_name = 'Điều chỉnh tăng';
                                        _this.invoice_products.update(row.id, row);
                                    }
                                }
                                else if (row.adjustment_form == "GIAM") {
                                    if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(row.product_name) == "" || row.product_name === "Điều chỉnh tăng") {
                                        row.product_name = 'Điều chỉnh giảm';
                                        _this.invoice_products.update(row.id, row);
                                    }
                                }
                                else if (row.adjustment_form == "THONG_TIN") {
                                    if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(row.product_name) == "" || row.product_name === "Điều chỉnh tăng" || row.product_name === "Điều chỉnh giảm")
                                        row.product_name = "";
                                    row.contract_order = null;
                                    row.chassis_number = null;
                                    row.lot = null;
                                    row.expiration_date = null;
                                    row.country_code = null;
                                    row.provisions_on_accounts = null;
                                    row.unit_code = null;
                                    row.quantity = null;
                                    row.price_nte = null;
                                    row.price = null;
                                    row.amount_without_discount = null;
                                    row.discount = null;
                                    row.amount_discount = null;
                                    row.discount_on_price = null;
                                    row.price_after_discount = null;
                                    row.amount = null;
                                    row.vat = null;
                                    row.other_tax = null;
                                    row.other_charge = null;
                                    row.amount_vat = null;
                                    row.amount_after_vat = null;
                                    _this.invoice_products.update(row.id, row);
                                }
                                _this._tinhGiaTri();
                                break;
                            default:
                                break;
                        }
                    }, function (error) {
                        alert(error);
                    });
                }
                else {
                    _this.invoice_products.remove(key);
                    _this.addRow();
                }
            });
        }, 100);
    };
    AdjustMultiplProductGripComponent.prototype.onGripKeyDown = function (e) {
        if (e.event.code === 'Delete') {
            e.event.srcElement.value = null;
        }
    };
    AdjustMultiplProductGripComponent.prototype.onRowPrepared = function (e) {
        if (e.rowType === 'data') {
            e.rowElement.style.whiteSpace = 'pre-wrap';
            // const eles = e.rowElement.getElementsByTagName('td');
            // if (!e.isEditing) {
            //   eles[2].innerHTML = e.data.product_code;
        }
        // if (e.data.error) {
        //   const ele = eles[eles.length - 1];
        //   ele.style.background = 'red url(\'assets/img/icons/fa-remove.png\') no-repeat 2% center';
        //   ele.title = e.data.error;
        // }
        //}
    };
    AdjustMultiplProductGripComponent.prototype.onEditorPreparing = function (e) {
        if (e.parentType === 'dataRow') {
            if (e.dataField === 'product_code') {
                e.editorOptions.onOpened = function (arg) {
                    var popupInstance = arg.component._popup;
                    popupInstance.option('width', 400);
                    popupInstance.option('minWidth', 400);
                };
            }
            if (e.dataField === 'product_name') {
                e.editorName = 'dxTextArea';
            }
            if (e.dataField !== 'product_name' && e.dataField !== 'adjustment_form' && e.dataField !== 'unit_code') {
                if (e.row.data.adjustment_form == 'THONG_TIN')
                    e.editorOptions.disabled = true;
            }
        }
    };
    AdjustMultiplProductGripComponent.prototype.onEditorPrepared = function (e) {
        if ((e.dataField === 'amount_without_discount' || e.dataField === 'discount' || e.dataField === 'amount_discount' || e.dataField === 'quantity' || e.dataField === 'price' || e.dataField === 'amount' || e.dataField === 'amount_vat' || e.dataField === 'amount_after_vat') && e.parentType === 'dataRow') {
            e.editorElement.childNodes[1].firstChild.onwheel = function (evt) {
                e.component.cancelEditData();
            };
            e.editorElement.childNodes[1].firstChild.addEventListener('select', function () {
                this.selectionStart = this.selectionEnd;
            }, false);
        }
    };
    AdjustMultiplProductGripComponent.prototype.onContextMenuPreparing = function (e) {
        var _this = this;
        if (e.row.rowType === 'data') {
            e.items = [
                {
                    text: this._translate.CONTROLL.BUTTON.add_goods,
                    onItemClick: function () {
                        _this.addProduct(e.row.data);
                    }
                },
                {
                    text: this._translate.CONTROLL.BUTTON.add_row,
                    onItemClick: function () {
                        _this.addRow();
                    }
                },
                {
                    text: this._translate.CONTROLL.BUTTON.delete_row,
                    onItemClick: function () {
                        _this.deleteRow(e.row.data);
                    }
                },
            ];
        }
    };
    AdjustMultiplProductGripComponent.prototype.addProduct = function (row) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].showloading();
        this.productsService.getAllListbyListtypeByCode('DM_NHOM_HANG_HOA,DM_DON_VI_TINH,DM_TY_LE_VAT').subscribe(function (response) {
            var initialState = {
                totalCount: 0,
                groupProducts: response.data['DM_NHOM_HANG_HOA'],
                unitCalculations: response.data['DM_DON_VI_TINH'],
                vats: response.data['DM_TY_LE_VAT'],
                groupProductListTypeId: response.data['ids']['DM_NHOM_HANG_HOA'],
                unitCalculationListTypeId: response.data['ids']['DM_DON_VI_TINH'],
                vatListTypeId: response.data['ids']['DM_TY_LE_VAT'],
                wavehourses: [],
                formatter: _this.formatter,
                onSaveProduct: function (data, unitCodes) {
                    _this.select.unit_codes = unitCodes;
                    data.mhvth = data.code + ': ' + data.name;
                    _this.select.products.push(data);
                    _this.reloadSelectProduct = false;
                    setTimeout(function () {
                        _this.reloadSelectProduct = true;
                    }, 50);
                    row.product_code = data.code;
                    row.product_name = data.name;
                    row.unit_code = _this.checkUnitCode(data.unit_code);
                    row.quantity = null;
                    row.price = data.price ? parseFloat(data.price) : data.price;
                    row.amount = data.price ? parseFloat(data.price) : 0;
                    row.vat = data.vat ? data.vat.toString() : null;
                    row.amount_vat = (row.vat >= 0) ? _this.caculatorAmountVat(row.amount, row.vat) : null;
                    row.amount_after_vat = row.amount + row.amount_vat;
                    _this.invoice_products.update(row.id, row);
                }
            };
            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_7__["AddComponent"], {
                class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                keyboard: false
            });
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].hideloading();
        });
    };
    AdjustMultiplProductGripComponent.prototype.addRow = function () {
        var len, order, orderLast;
        len = this.dataSource.items().length;
        orderLast = this.dataSource.items()[len - 1].order;
        for (var i = 0; i < this.rowData; i++) {
            if (this.dataSource.items().length >= 1) {
                order = ++orderLast;
            }
            else {
                order = 1;
            }
            var data = this.frmData.add_invoice_products_data(order, order);
            this.invoice_products.insert(data);
        }
        this.dataSource.reload();
    };
    AdjustMultiplProductGripComponent.prototype.view_orderChange = function () {
        var _this = this;
        if (!this.isTT78) {
            var _index_1 = 0;
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (item.view_order && _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) != _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                        item.view_order = ++_index_1;
                    }
                    if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                        if (!item.is_money_service) {
                            item.view_order = ++_index_1;
                        }
                        else {
                            item.view_order = null;
                        }
                    }
                });
            });
        }
        else {
            var _index_2 = 0;
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (item.view_order && _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) != _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                        item.view_order = ++_index_2;
                    }
                    if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                        if (!item.is_money_service) {
                            item.view_order = ++_index_2;
                        }
                        else {
                            item.view_order = null;
                        }
                    }
                });
            });
        }
    };
    // Thay đổi cột mã hàng
    AdjustMultiplProductGripComponent.prototype.product_codeChange = function (row) {
        var _this = this;
        this.select.products.some(function (item) {
            if (item.code === row.product_code) {
                _this.productsService.getProduct(item.id).subscribe(function (rs) {
                    if (rs.status == "success") {
                        var product = rs.data.product;
                        if (product) {
                            row.product_name = product.name;
                            row.unit_code = _this.checkUnitCode(product.unit_code);
                            row.quantity = null;
                            row.price = product.price ? parseFloat(product.price) : product.price;
                            row.amount = product.price ? parseFloat(product.price) : 0;
                            if (_this.isHdGTGT) {
                                row.vat = product.vat != null ? product.vat.toString() : null;
                            }
                            else {
                                row.vat = null;
                            }
                            if (_this.isHdGTGT) {
                                row.amount_vat = (row.vat >= 0) ? _this.caculatorAmountVat(row.amount, row.vat) : null;
                            }
                            else {
                                row.amount_vat = null;
                            }
                            row.amount_after_vat = row.amount + (row.amount_vat != null ? row.amount_vat : 0);
                            var test = _this.invoice_products;
                            _this.invoice_products.update(row.id, row);
                            _this._tinhGiaTri();
                            return true;
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].notify(rs.message, 'error');
                    }
                });
            }
        });
    };
    AdjustMultiplProductGripComponent.prototype.unit_codeChange = function (row) {
        var _obj = this.select.unit_codes.filter(function (p) { return p.code === row.unit_code; })[0];
        if (_obj) {
            row.unit_name = _obj.name;
            this.invoice_products.update(row.id, row);
        }
        else {
            row.unit_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    AdjustMultiplProductGripComponent.prototype.country_codeChange = function (row) {
        var _obj = this.select.countrys.filter(function (p) { return p.code === row.country_code; })[0];
        if (_obj) {
            row.country_name = _obj.name;
            this.invoice_products.update(row.id, row);
        }
        else {
            row.country_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    AdjustMultiplProductGripComponent.prototype.checkUnitCode = function (unitCode) {
        var items = this.select.unit_codes;
        for (var i = 0; i < items.length; i++) {
            if (items[i].code === unitCode) {
                return unitCode;
            }
        }
        return null;
    };
    AdjustMultiplProductGripComponent.prototype.ShowAndHidePhuongThucDC = function (value) {
        var _this = this;
        this.isPhuongThucDC = value;
        setTimeout(function () {
            _this.dataGrid.instance.refresh();
        }, 100);
    };
    AdjustMultiplProductGripComponent.prototype.checboxTinhgiatri = function () {
        var _this = this;
        this._tinhGiaTri();
        setTimeout(function () {
            _this.dataGrid.instance.refresh();
        }, 150);
    };
    AdjustMultiplProductGripComponent.prototype._tinhGiaTri = function () {
        var _this = this;
        setTimeout(function () {
            if (!_this.isTT78) {
                _core_index__WEBPACK_IMPORTED_MODULE_6__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.formDataInInvoice, _this.formatter, !_this.formDataInInvoice.auto_value, _this.formDataInInvoice.auto_value_price, _this.select, _this._objTemplateSelect, _this.configs.system_parameter);
                if ((_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBay
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayChung
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayHoanVe
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonXangDau) && !_this.formDataInInvoice.auto_value) {
                    _core_index__WEBPACK_IMPORTED_MODULE_6__["VChanggeMoneyService"]._changeMoneyTicket(_this.formDataInInvoice, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type));
                }
                _this.amount_after_vat = _this.formDataInInvoice.amount_after_vat;
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_6__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.formDataInInvoice, _this.formatter, !_this.formDataInInvoice.auto_value, _this.formDataInInvoice.auto_value_price, _this.select, _this._oTemplateTT78, _this.configs.system_parameter);
                if ((_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBay
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayChung
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonVeMayBayHoanVe
                    || _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_11__["sEnum"].templatetype.HoaDonXangDau) && !_this.formDataInInvoice.auto_value) {
                    _core_index__WEBPACK_IMPORTED_MODULE_6__["VChanggeMoneyService"]._changeMoneyTicket(_this.formDataInInvoice, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type));
                }
                _this.amount_after_vat = _this.formDataInInvoice.amount_after_vat;
            }
        }, 100);
    };
    AdjustMultiplProductGripComponent.prototype.caculatorAmountVat = function (amount, vat) {
        var temp = amount / 100 * vat;
        return this.roundNumber(temp, 5);
    };
    AdjustMultiplProductGripComponent.prototype.roundNumber = function (number, n) {
        var p = Math.pow(10, n);
        return Math.round(number * p) / p;
    };
    // Bật modal thay đổi số thập phân
    AdjustMultiplProductGripComponent.prototype.configDecimal = function (n) {
        var _this = this;
        var initialState = {
            column: n,
            formatter: this.formatter,
            showDonGiaNte: this.configs.system_parameter.view_price_nte,
        };
        this.bsModalRef = this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_7__["ConfigDecimalComponent"], {
            class: 'modal-lg', initialState: initialState, backdrop: 'static',
            keyboard: false
        });
        var subModal = this.modalService.onHide.subscribe(function () {
            var data = _this.bsModalRef.content.successSaveItem;
            if (data) {
                // this.formatter[data.column] = data.character;
                _this._tinhGiaTri();
            }
            subModal.unsubscribe();
        });
    };
    // Xóa hàng
    AdjustMultiplProductGripComponent.prototype.deleteRow = function (item) {
        var _this = this;
        setTimeout(function () {
            var check = confirm(_this._translate.CONFIRM.delete);
            if (check && !_this.ttDaXuatHoaDon) {
                setTimeout(function () {
                    _this.invoice_products.remove(item.id);
                    // this.dataSource.store().remove(item.id);
                    _this.dataSource.reload();
                    _this._tinhGiaTri();
                }, 100);
            }
        }, 200);
    };
    // Lấy mẫu bảng kê
    AdjustMultiplProductGripComponent.prototype.layMauBangKe = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].showloading();
        this.vatService.layFileMau({
            customer_name: this.formDataInInvoice.customer_name,
            buyer_tax_code: this.formDataInInvoice.buyer_tax_code,
            buyer_address: this.formDataInInvoice.buyer_address,
            buyer_name: this.formDataInInvoice.buyer_name,
            invoice_type_name: ""
        }).subscribe(function (rs) {
            if (rs.status === 'success') {
                var file = rs.data.invoice;
                _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].hideloading();
        });
    };
    // Nạp dữ liệu bảng kê
    AdjustMultiplProductGripComponent.prototype.napDuLieuTuBangKe = function () {
        document.getElementById('file-bang-ke').click();
    };
    AdjustMultiplProductGripComponent.prototype.onFileBangKeChange = function (evt) {
        var _this = this;
        var target = (evt.target);
        if (target.files.length !== 1) {
            throw new Error('Không thể chọn nhiều file');
        }
        var reader = new FileReader();
        reader.onload = function (e) {
            /* read workbook */
            var bstr = e.target.result;
            var wb = xlsx__WEBPACK_IMPORTED_MODULE_5__["read"](bstr, { type: 'binary' });
            /* grab first sheet */
            var wsname = wb.SheetNames[0];
            var ws = wb.Sheets[wsname];
            /* save data */
            var data = (xlsx__WEBPACK_IMPORTED_MODULE_5__["utils"].sheet_to_json(ws, { header: 'A', range: 9 }));
            var account = (xlsx__WEBPACK_IMPORTED_MODULE_5__["utils"].sheet_to_json(ws, { header: 'A', range: 0 }));
            var fileBangKe = document.getElementById('file-bang-ke');
            fileBangKe.value = '';
            var _arrData = [];
            if (data && data[0]) {
                var columnsName = data.map(function (e) { return e.A; });
                var _index = columnsName.indexOf("view_order");
                if (_index == -1) {
                    _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].notify("File mẫu không đúng định dạng. Vui lòng nhấn vào Tại đây để lấy lại file mẫu", "error");
                    return false;
                }
                else {
                    if (_index > 0) {
                        data.splice(0, _index);
                    }
                    for (var i = 1; i < data.length; i++) {
                        var _row = {};
                        for (var key in data[i]) {
                            if (data[i].hasOwnProperty(key)) {
                                var column = data[0][key];
                                var value = data[i][key];
                                _row[column] = value;
                            }
                        }
                        _arrData.push(_row);
                    }
                }
            }
            _this.dataExcelFile = _arrData;
            _this.dataExcelFileInfo = account.slice(0, 4);
            _this.showPopup = true;
        };
        reader.readAsBinaryString(target.files[0]);
    };
    AdjustMultiplProductGripComponent.prototype.thayTheToanBo = function () {
        this.fillDataFromFile(this.dataExcelFile, this.dataExcelFileInfo, 'thaythe');
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    AdjustMultiplProductGripComponent.prototype.themTiep = function () {
        this.fillDataFromFile(this.dataExcelFile, this.dataExcelFileInfo, 'themtiep');
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    AdjustMultiplProductGripComponent.prototype.huy = function () {
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    AdjustMultiplProductGripComponent.prototype.fillDataFromFile = function (fileData, info, status) {
        var _this = this;
        if (info.length === 4) {
            var customer_name = info[0].A.split(':');
            if (customer_name.length > 1 && customer_name[1].trim() != '') {
                this.formDataInInvoice.customer_name = customer_name[1].trim();
            }
            ////
            var buyer_tax_code = info[1].A.split(':');
            if (buyer_tax_code.length > 1 && buyer_tax_code[1].trim() != '') {
                this.formDataInInvoice.buyer_tax_code = buyer_tax_code[1].trim();
            }
            ////
            var buyer_name = info[2].A.split(':');
            if (buyer_name.length > 1 && buyer_name[1].trim() != '') {
                this.formDataInInvoice.buyer_name = buyer_name[1].trim();
            }
            ////
            var buyer_address = info[3].A.split(':');
            if (buyer_address.length > 1 && buyer_address[1].trim() != '') {
                this.formDataInInvoice.buyer_address = buyer_address[1].trim();
            }
        }
        if (status === 'thaythe') {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    _this.invoice_products.remove(item.id);
                });
            });
        }
        else {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (!item.product_code && !item.product_name && !item.quantity && !item.price && !item.amount && !item.amount_vat && !item.amount_after_vat) {
                        _this.invoice_products.remove(item.id);
                    }
                });
            });
        }
        fileData.forEach(function (element) {
            if (element.product_name) {
                var invoice_1 = new Object;
                invoice_1["id"] = _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].makeid();
                invoice_1["view_order"] = element.view_order ? parseInt(element.view_order) : null;
                invoice_1["product_code"] = element.product_code ? element.product_code : "";
                invoice_1["product_name"] = element.product_name ? element.product_name : "";
                invoice_1["unit_code"] = element.unit_name ? _this.getUnitCodeByUnitName(element.unit_name) : "";
                invoice_1["unit_name"] = element.unit_name ? element.unit_name : "";
                invoice_1["quantity"] = element.quantity ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.quantity) : null;
                invoice_1["vat"] = (element.vat && _this.isHdGTGT) ? element.vat : null;
                invoice_1["contract_order"] = element.contract_order ? element.contract_order : "";
                if (element.price) {
                    if (_this.configs.system_parameter.price_after_vat) {
                        invoice_1["price_after_vat"] = element.price ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.price) : null;
                        if ((invoice_1["vat"] == 5 || invoice_1["vat"] == 10 || invoice_1["vat"] == 7 || invoice_1["vat"] == 3.5) && invoice_1["price_after_vat"] !== null)
                            invoice_1["price"] = (invoice_1["price_after_vat"] / (1 + invoice_1["vat"] / 100));
                        else
                            invoice_1["price"] = invoice_1["price_after_vat"];
                    }
                    else
                        invoice_1["price"] = element.price ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.price) : null;
                }
                invoice_1["amount"] = element.amount ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.amount) : null;
                invoice_1["amount_vat"] = element.amount_vat ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.amount_vat) : null;
                // invoice["note"] = element.note ? element.note : null;
                invoice_1["other_tax"] = element.other_tax ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.other_tax) : null;
                invoice_1["other_charge"] = element.other_charge ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.other_charge) : null;
                invoice_1["product_exchange_rate"] = element.product_exchange_rate ? _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].toNumber(element.product_exchange_rate) : null;
                invoice_1["product_date"] = element.product_date ? element.product_date : null;
                invoice_1["engine_number"] = element.engine_number ? element.engine_number : null;
                invoice_1["chassis_number"] = element.chassis_number ? element.chassis_number : null;
                invoice_1["management_code"] = element.management_code ? element.management_code : null;
                invoice_1["is_money_service"] = element.is_money_service && (element.is_money_service == "X" || element.is_money_service == "x") ? true : false;
                invoice_1["is_refund_ticket"] = element.is_refund_ticket && (element.is_refund_ticket == "X" || element.is_refund_ticket == "x") ? true : false;
                invoice_1["is_promotion"] = element.is_promotion && (element.is_promotion == "X" || element.is_promotion == "x") ? true : false;
                invoice_1["is_promotion_new"] = element.is_promotion_new && (element.is_promotion_new == "X" || element.is_promotion_new == "x") ? true : false;
                invoice_1["lot"] = element.lot ? element.lot : null;
                invoice_1["expiration_date"] = element.expiration_date ? element.expiration_date : null;
                if (invoice_1["amount_vat"] !== null && invoice_1["amount"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_vat"] + invoice_1["amount"];
                else if (invoice_1["amount"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount"];
                else if (invoice_1["amount_vat"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_vat"];
                else
                    invoice_1["amount_after_vat"] = null;
                if (invoice_1["other_tax"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_after_vat"] + invoice_1["other_tax"];
                if (invoice_1["other_charge"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_after_vat"] + invoice_1["other_charge"];
                var _obj = _this.select.products.filter(function (p) { return p.code === invoice_1["product_code"]; })[0];
                if (!_obj && invoice_1["product_code"] !== '') {
                    var _objPush = {
                        code: invoice_1["product_code"],
                        name: invoice_1["product_name"],
                        mhvth: invoice_1["product_code"] + ': ' + invoice_1["product_name"],
                    };
                    _this.select.products.push(_objPush);
                }
                invoice_1["commercial_discount"] = false;
                _this.invoice_products.insert(invoice_1);
            }
        });
        this._tinhGiaTri();
        _core_index__WEBPACK_IMPORTED_MODULE_6__["Library"].hideloading();
        setTimeout(function () {
            _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                dataSource: _this.select.unit_codes,
                displayExpr: 'name',
                valueExpr: 'code'
            });
            _this.dataGrid.instance.refresh();
        });
    };
    AdjustMultiplProductGripComponent.prototype.getUnitCodeByUnitName = function (unitName) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(unitName) !== '') {
            if (this.select.unit_codes && this.select.unit_codes.length > 0) {
                var _obj = this.select.unit_codes.filter(function (p) { return p.name === unitName; })[0];
                if (_obj) {
                    return _obj.code;
                }
                else {
                    var code_1 = _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._convertToViKdau(unitName);
                    var oDuplicate = this.select.unit_codes.filter(function (p) { return p.code === code_1; })[0];
                    if (oDuplicate)
                        code_1 = code_1 + _core_index__WEBPACK_IMPORTED_MODULE_6__["Helper"].addtionalUnitCode();
                    this.select.unit_codes.push({ code: code_1, name: unitName });
                    return code_1;
                }
            }
            else {
                this.select.unit_codes = [];
            }
        }
        return null;
    };
    AdjustMultiplProductGripComponent.prototype.ngOnDestroy = function () {
        this.routeSub.unsubscribe();
    };
    AdjustMultiplProductGripComponent.prototype.calculateSummary = function (options) {
        var amount_after_vat;
        // Calculating "CustomSummary1"
        if (options.name === 'amount_after_vat' && options.summaryProcess) {
            if (options.summaryProcess === 'start') {
                // Initializing "totalValue" here
                if (this.formDataInInvoice !== undefined) {
                    options.totalValue = this.formDataInInvoice.amount_after_vat;
                    amount_after_vat = this.formDataInInvoice.amount_after_vat;
                }
            }
            if (options.summaryProcess === 'calculate') {
                if (this.formDataInInvoice !== undefined) {
                    options.totalValue = this.formDataInInvoice.amount_after_vat;
                    amount_after_vat = this.formDataInInvoice.amount_after_vat;
                }
                // Modifying "totalValue" here
            }
            if (options.summaryProcess === 'finalize') {
                options.totalValue = amount_after_vat;
                // Assigning the final value to "totalValue" here
            }
        }
        // Calculating "CustomSummary2"
        if (options.name === 'CustomSummary2') {
            // ...
            // Same "if" statements here
        }
    };
    AdjustMultiplProductGripComponent.prototype.changePhiDV = function (row) {
        this.view_orderChange();
        if (row.is_money_service) {
            row.commercial_discount = false;
        }
        if (row.is_money_service && _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(row.product_name) == '') {
            row.product_name = 'Phí dịch vụ';
            this.invoice_products.update(row.id, row);
        }
        else if (!row.is_money_service && _core_index__WEBPACK_IMPORTED_MODULE_6__["VStringService"]._getValueToString(row.product_name) === 'Phí dịch vụ') {
            row.product_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    AdjustMultiplProductGripComponent.prototype.changeCKTM = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    AdjustMultiplProductGripComponent.prototype.changePhiHoanVe = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    AdjustMultiplProductGripComponent.prototype.itemExtrasClick = function (e) {
        if (e.itemData.id === 'LAY_MAU_BANG_KE') {
            this.layMauBangKe();
        }
        else if (e.itemData.id === 'NAP_DU_LIEU_BANG_KE') {
            this.napDuLieuTuBangKe();
        }
    };
    AdjustMultiplProductGripComponent.prototype._changeND92 = function (e) {
        if (e.value)
            this.formDataInInvoice.is_resolution_43 = !e.value;
        this._tinhGiaTri();
    };
    AdjustMultiplProductGripComponent.prototype._changeNQ43 = function (e) {
        if (e.value) {
            this.formDataInInvoice.is_exemption_decree = !e.value;
            if (this.formDataInInvoice.sales_percentage == null && parseInt(this.configs.system_parameter.value_rate_percent) > 0) {
                this.formDataInInvoice.sales_percentage = parseInt(this.configs.system_parameter.value_rate_percent);
            }
        }
        else {
            this.formDataInInvoice.sales_percentage = null;
        }
        this._tinhGiaTri();
    };
    AdjustMultiplProductGripComponent.prototype.onClickGuidReduce = function () {
        this.router.navigate([]).then(function (result) { window.open('https://ihoadon.vn/hddt/danh-muc-hang-hoa-dich-vu-duoc-giam-thue-gtgt-theo-nghi-quyet-so-406-nq-ubtvqh15.html', '_blank'); });
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxDataGridComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxDataGridComponent"])
    ], AdjustMultiplProductGripComponent.prototype, "dataGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "dataSource", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "invoice_products", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "formatter", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "isHdGTGT", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "_objTemplateSelect", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "extentionGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "_oTemplateTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustMultiplProductGripComponent.prototype, "isTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustMultiplProductGripComponent.prototype, "formDataInInvoice", void 0);
    AdjustMultiplProductGripComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-adjust-multipl-product-grip',
            template: __webpack_require__(/*! ./adjust-multipl-product-grip.component.html */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.html"),
            styles: [__webpack_require__(/*! ./adjust-multipl-product-grip.component.scss */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.scss")]
        }),
        __metadata("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_2__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_8__["VatService"],
            _modules_products_shared__WEBPACK_IMPORTED_MODULE_9__["ProductsService"],
            _core_index__WEBPACK_IMPORTED_MODULE_6__["AuthService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__["TranslateService"]])
    ], AdjustMultiplProductGripComponent);
    return AdjustMultiplProductGripComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.html":
/*!*****************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.html ***!
  \*****************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"row invoice-form\" *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n  <div class=\"col-md-6\">\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item *ngIf=\"!isTT78\" [label]=\"{text: _translate.CONTROLL.LABEL.invoice_form }\"\r\n          dataField=\"invoice_release_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.invoice_releases, onValueChanged: templateChange, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.invoice_form }} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"isTT78\" dataField=\"template_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.templatesTT78, onValueChanged: onChangeTem, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{ _translate.CONTROLL.LABEL.invoice_form }} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item dataField=\"adjustment_form\" [label]=\"{text: _translate.CONTROLL.LABEL.adjustment_form}\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.adjustment_forms, onItemClick: adjustmentFormChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.adjustment_form}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"adjustment_object\" [label]=\"{text: _translate.CONTROLL.LABEL.adjustment_object}\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.adjustment_objects, onItemClick: adjustmentObjectChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.adjustment_object}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"invoice_date\" [label]=\"{text: _translate.GRID.INVOICE.invoice_date}\" editorType=\"dxDateBox\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss', disabled: disableInvoiceDate, onValueChanged: changeDateTime}\">\r\n        </dxi-item>\r\n        <dxi-item cssClass=\"vat invoice-number-create-invoice\" dataField=\"invoice_number\"\r\n          [label]=\"{text: _translate.GRID.INVOICE.invoice_number}\" editorType=\"dxNumberBox\"\r\n          [editorOptions]=\"{ disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.currency_code}\" dataField=\"currency_code\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.currency_codes, onValueChanged: currencyCodeChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n        </dxi-item>\r\n        <dxi-item dataField=\"currency_rate\" [label]=\"{text: _translate.CONTROLL.LABEL.currency_rate}\"\r\n          editorType=\"dxNumberBox\"\r\n          [editorOptions]=\"{disabled: frmData.currency_code == 'VND',onValueChanged: currencyRateChange, format: formatter.ty_gia}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.payment_method}\" dataField=\"payment_method_name\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.payment_method_names,onValueChanged: paymentMethodChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.payment_method}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item name=\"ht-xuat\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.export_form}}\"></dxo-label>\r\n          <div *dxTemplate>\r\n            <dx-select-box [(value)]=\"frmData.status\" displayExpr=\"name\" valueExpr=\"code\" [items]=\"htXuatOptions\"\r\n              [disabled]=\"!configs.system_parameter.allow_keep_invoice_number\"></dx-select-box>\r\n          </div>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item name=\"origin-invoice-number\">\r\n            <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number_original}}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-text-box [(value)]=\"oldForm.invoice_number\" disabled=\"true\"></dx-text-box>\r\n            </div>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"origin_btn_options\" cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"soXacThucGoc\" [label]=\"{text: _translate.CONTROLL.LABEL.certificate_code}\"\r\n          [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <!-- <dxi-item dataField=\"doc_relate_symbol\" [label]=\"{text: _translate.CONTROLL.LABEL.doc_relate_symbol}\">\r\n          <dxi-validation-rule type=\"required\"\r\n                               message=\"{{_translate.CONTROLL.LABEL.doc_relate_symbol}} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"doc_relate_date\" [label]=\"{text: _translate.CONTROLL.LABEL.doc_relate_date}\"\r\n                  editorType=\"dxDateBox\"\r\n                  [editorOptions]=\"{displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd'}\">\r\n          <dxi-validation-rule type=\"required\"\r\n                               message=\"{{_translate.CONTROLL.LABEL.doc_relate_date}} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          <dxi-validation-rule type=\"range\" [min]=\"minNgayVB\"\r\n                               message=\"{{_translate.CONTROLL.LABEL.doc_relate_date}} {{ _translate.VALIDATION.less_date_inv }}\"></dxi-validation-rule>\r\n          <dxi-validation-rule type=\"range\" [max]=\"maxNgayVB\"\r\n                               message=\"{{_translate.CONTROLL.LABEL.doc_relate_date}} {{ _translate.VALIDATION.than_date_curent }}\"></dxi-validation-rule>\r\n        </dxi-item> -->\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số phiếu xuất kho -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.receipts_no\" dataField=\"receipts_no\" [colCount]=\"1\">\r\n          <dxo-label text=\"{{ _translate.GRID.INVOICE.receipts_no }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Ngày giao hàng -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.from_warehouse_date\" dataField=\"from_warehouse_date\"\r\n          [template]=\"'deliverydata'\" [colCount]=\"1\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.delivery_date }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_export_place\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.export_place}\" dataField=\"export_place\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.export_places, onValueChanged: exportPlaceChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Xuất cho khách hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.ship_receiving_name\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_name\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.ship_receiving_name }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Địa chỉ nhận hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.ship_receiving_address\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_address\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.ship_receiving_address }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_transport_number\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"transport_number\" [label]=\"{text: _translate.CONTROLL.LABEL.transport_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn pepsi -->\r\n      <!-- Tên khách hàng(TT giao hàng) -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_name\" [label]=\"{text: _translate.CONTROLL.LABEL.ship_receiving_name}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Địa chỉ giao hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_address\" [label]=\"{text: _translate.CONTROLL.LABEL.shipping_address}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Đơn đặt hàng( Mã số đơn hàng) -->\r\n        <dxi-item dataField=\"the_order\" [label]=\"{text: _translate.CONTROLL.LABEL.the_order}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số tham khảo -->\r\n        <dxi-item dataField=\"consult_number\" [label]=\"{text: _translate.CONTROLL.LABEL.consult_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Chứng từ tham chiếu -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.vouchers_reference\">\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.vouchers_reference}\" dataField=\"license_number\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Số S/O -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.invoice_the_order\">\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.so_so }\" dataField=\"the_order\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Thời hạn thanh toán -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.payment_expire\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.payment_time }\" dataField=\"payment_expire\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hình thức bán hàng -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.vouchers_reference\">\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.form_sales}\" dataField=\"sell_form\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n\r\n\r\n      <!-- Hóa đơn bảo dưỡng xe -->\r\n      <!-- Địa chỉ giao hàng -->\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"place_of_delivery\" [label]=\"{text: _translate.CONTROLL.LABEL.address_delivery}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Thời hạn thanh toán -->\r\n        <dxi-item dataField=\"payment_expire\" [label]=\"{text: _translate.CONTROLL.LABEL.payment_time}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số wip -->\r\n        <dxi-item dataField=\"wip_number\" [label]=\"{text: _translate.CONTROLL.LABEL.wip_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Biển số xe -->\r\n        <dxi-item dataField=\"license_plate\" [label]=\"{text: _translate.CONTROLL.LABEL.license_plate}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số khung -->\r\n        <dxi-item dataField=\"invoice_chassis_number\" [label]=\"{text: _translate.GRID.INVOICE_DETAILS.chassis_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bàn giao xe -->\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số hợp đồng -->\r\n        <dxi-item dataField=\"contract_number\" [label]=\"{text: _translate.CONTROLL.LABEL.vehicle_contract_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số VSB -->\r\n        <dxi-item dataField=\"vsb_number\" [label]=\"{text: _translate.CONTROLL.LABEL.vehicle_vsb}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Màu xe -->\r\n        <dxi-item dataField=\"color\" [label]=\"{text: _translate.CONTROLL.LABEL.vehicle_color}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số máy -->\r\n        <dxi-item dataField=\"invoice_engine_number\" [label]=\"{text: _translate.GRID.INVOICE_DETAILS.engine_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn nhà thuốc -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số tham chiếu -->\r\n        <dxi-item dataField=\"license_number\" [label]=\"{text: _translate.CONTROLL.LABEL.reference_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Tuyến -->\r\n        <dxi-item dataField=\"route\" [label]=\"{text: _translate.CONTROLL.LABEL.route}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Đơn đặt hàng -->\r\n        <dxi-item dataField=\"the_order\" [label]=\"{text: _translate.CONTROLL.LABEL.the_order}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số tham khảo -->\r\n        <dxi-item dataField=\"consult_number\" [label]=\"{text: _translate.CONTROLL.LABEL.consult_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Nhân viên thu tiền -->\r\n        <dxi-item dataField=\"cash_staff\" [label]=\"{text: _translate.CONTROLL.LABEL.cash_staff}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isTT78\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Lý do thay thế -->\r\n        <dxi-item dataField=\"destroy_reason\">\r\n          <dxo-label text=\"Lý do điều chỉnh\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\" message=\"Lý do điều chỉnh {{_translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isTT78\" itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item dataField=\"list_number\">\r\n          <dxo-label text=\"Số bảng kê\"></dxo-label>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"list_date\" [template]=\"'notifydate'\">\r\n          <dxo-label text=\"Ngày bảng kê\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <div *dxTemplate=\"let d of 'notifydate'\">\r\n        <dx-date-box [(value)]=\"frmData.list_date\" type=\"date\" [useMaskBehavior]=\"true\" [displayFormat]=\"'dd/MM/yyyy'\"\r\n          [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'deliverydata'\">\r\n        <dx-date-box [(value)]=\"frmData.from_warehouse_date\" type=\"date\" [useMaskBehavior]=\"true\"\r\n          [displayFormat]=\"'dd/MM/yyyy'\" [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n    </dx-form>\r\n  </div>\r\n  <div class=\"col-md-6\">\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.export_invoice_for}\" dataField=\"customer_object_code\"\r\n          editorType=\"dxSelectBox\" [cssClass]=\"'max_left'\"\r\n          [editorOptions]=\"{items: select.customer_object_codes, displayExpr: 'name', valueExpr: 'code', onValueChanged: customer_object_codeChange, disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.customer_group}\" dataField=\"customer_type\"\r\n          editorType=\"dxSelectBox\" [cssClass]=\"'max_right'\"\r\n          [editorOptions]=\"{items: select.customer_types, displayExpr: 'name', valueExpr: 'code', disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item name=\"search-mst\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.tax_code }}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-autocomplete valueExpr=\"tax_code\" [dataSource]=\"tax_codes\" [(value)]=\"frmData.buyer_tax_code\"\r\n                [readOnly]=\"readOnlyCacTruongConLai\" (onItemClick)=\"taxCodeChoose($event)\"\r\n                [disabled]=\"disableForm.tax_code\" (onValueChanged)=\"changeTaxCode($event)\"\r\n                (onFocusOut)=\"updateTaxcodeInfo($event)\">\r\n                <div *dxTemplate=\"let item of 'item'\">\r\n                  <span>{{item.tax_code}}: {{ item.name }}</span>\r\n                </div>\r\n              </dx-autocomplete>\r\n            </div>\r\n          </dxi-item>\r\n          <dxi-item cssClass='btn-small'>\r\n            <button (click)=\"searchTaxCode()\" type=\"button\" class=\"button-tax-code\">\r\n              <i class=\"{{_translate.ICONS.search}}\" style=\"font-size: 22px;\"></i>\r\n            </button>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button vat-handle'>\r\n          <dxi-item name=\"search-mkh\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.customer_code}}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-autocomplete valueExpr=\"code\" [dataSource]=\"customer_codes\" [(value)]=\"frmData.customer_code\"\r\n                [readOnly]=\"readOnlyCacTruongConLai\" (onItemClick)=\"customerCodeChoose($event)\"\r\n                (onFocusOut)=\"updateCustomerInfo($event)\">\r\n                <div *dxTemplate=\"let item of 'item'\">\r\n                  <span>{{item.code}}: {{ item.name }}</span>\r\n                </div>\r\n              </dx-autocomplete>\r\n            </div>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"mst_btn_options\" cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.customer_name}\" dataField=\"customer_name\"\r\n          [editorOptions]=\"{disabled: tod.customer_name || disableForm.rest, isRequired: false,onValueChanged:onFieldDataChanged}\">\r\n          <!-- <dxi-validation-rule *ngIf=\"!tod.customer_name\" type=\"required\" message=\"Tên đơn vị {{ _translate.VALIDATION.required }}\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.buyer_name}\" dataField=\"buyer_name\"\r\n          [editorOptions]=\"{disabled: tod.buyer_name || disableForm.rest, onValueChanged:onFieldDataChanged}\">\r\n          <!-- <dxi-validation-rule *ngIf=\"frmData.customer_object_code != 'DOANH_NGHIEP'\" type=\"required\" message=\"Họ tên người mua {{ _translate.VALIDATION.required }}\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.phone}\" dataField=\"buyer_mobile\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n          <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.phone\"\r\n            message=\"{{_translate.CONTROLL.LABEL.phone}} {{ _translate.VALIDATION.not_pattern }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isShowToKhai\">\r\n        <!-- Số hộ chiều -->\r\n        <dxi-item cssClass=\"in-hoa vat2 layout_input\" dataField=\"passport\"\r\n          [editorOptions]=\"{disabled: disableTemplateInput() }\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.passport}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.passport}} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Quốc tịch -->\r\n        <dxi-item cssClass=\"in-hoa vat3 layout_input\" dataField=\"nationality\"\r\n          [editorOptions]=\"{disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.nationality}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.nationality}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isShowToKhai\">\r\n        <!-- Ngày cấp hộ chiếu -->\r\n        <dxi-item cssClass=\"vat2 layout_input\" editorType=\"dxDateBox\" dataField=\"passport_date\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.passport_date}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.passport_date}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Ngày hết hạn hộ chiếu -->\r\n        <dxi-item dataField=\"passport_expiration_date\" editorType=\"dxDateBox\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.passport_expiration_date}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.passport_expiration_date}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.address}\" dataField=\"buyer_address\"\r\n          [editorOptions]=\"{disabled: tod.buyer_address || disableForm.rest,onValueChanged:onFieldDataChanged}\">\r\n          <!-- <dxi-validation-rule *ngIf=\"!tod.buyer_address\" type=\"required\" message=\"Địa chỉ {{ _translate.VALIDATION.required }}\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: 'Email'}\">\r\n          <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n            <div\r\n              class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n              <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                </app-tag-input-email>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </dxi-item>\r\n        <!--        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.bank_account_number}\" dataField=\"bank_account_number\"-->\r\n        <!--                  [editorOptions]=\"{disabled: disableForm.rest}\">-->\r\n        <!--        </dxi-item>-->\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.bank_name}\" dataField=\"bank_name\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!--Thông tin other_id -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.other_id\" dataField=\"other_id\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.other_id }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_export_place\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.export_address }\" dataField=\"export_address\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_transport_number\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"train_name\" [label]=\"{text: _translate.CONTROLL.LABEL.train_name}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn pepsi -->\r\n      <!-- Thời hạn thanh toán -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" dataField=\"payment_expire\"\r\n          [label]=\"{text: _translate.CONTROLL.LABEL.payment_time}\" [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bảo dưỡng xe -->\r\n      <!-- Địa chỉ xuất hàng -->\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"shiping_point\" [label]=\"{text: _translate.CONTROLL.LABEL.address_shipping}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Ngày ra, vào xe -->\r\n        <dxi-item dataField=\"in_out_date\" [label]=\"{text: _translate.CONTROLL.LABEL.in_out_date}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Số hóa đơn nội bộ -->\r\n        <dxi-item dataField=\"invoice_internal_number\"\r\n          [label]=\"{text: _translate.CONTROLL.LABEL.invoice_internal_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Số km -->\r\n        <dxi-item dataField=\"kilometer_number\" [label]=\"{text: _translate.CONTROLL.LABEL.kilometer_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bàn giao xe -->\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số chứng từ -->\r\n        <dxi-item cssClass=\"vat layout_input\" dataField=\"license_number\"\r\n          [label]=\"{text: _translate.CONTROLL.LABEL.vehicle_license_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Kiểu xe -->\r\n        <dxi-item dataField=\"model\" [label]=\"{text: _translate.CONTROLL.LABEL.vehicle_model}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số khung -->\r\n        <dxi-item cssClass=\"vat layout_input\" dataField=\"invoice_chassis_number\"\r\n          [label]=\"{text: _translate.GRID.INVOICE_DETAILS.chassis_number}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Năm sản xuất -->\r\n        <dxi-item dataField=\"manufacture_year\" [label]=\"{text: _translate.CONTROLL.LABEL.year_manufacture}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn nhà thuốc -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Địa chỉ giao hàng -->\r\n        <dxi-item dataField=\"place_of_delivery\" [label]=\"{text: _translate.CONTROLL.LABEL.address_delivery}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Kho -->\r\n        <dxi-item dataField=\"from_warehouse_name\" [label]=\"{text: _translate.CONTROLL.LABEL.warehouse}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n        <!-- Phiếu nhận hàng -->\r\n        <dxi-item dataField=\"receive_bill\" [label]=\"{text: _translate.CONTROLL.LABEL.receive_bill}\"\r\n          [editorOptions]=\"{disabled: disableForm.rest}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Điều khoản giao hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.delivery_terms\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"delivery_terms\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.delivery_terms }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Ghi chú -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"note\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.note }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- trường mở rộng -->\r\n\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <app-form-extend [disableForm]=\"ttDaXuatHoaDon\" [formData]=\"frmData\" [customerTempt]=\"customerTempt\"\r\n          [formItems]=\"formItems\" [typeOptions]=\"'invoice_options'\"></app-form-extend>\r\n      </dxi-item>\r\n    </dx-form>\r\n  </div>\r\n  <div class=\"col-md-12\" style=\"margin-top:7px;margin-bottom:7px\">\r\n    <dx-form *ngIf=\"!isTT78\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <ng-container *ngIf=\"configs.system_parameter.allow_keep_invoice_number && isShowButtonWaiteSign\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item name=\"btn-chossen-hdck\">\r\n              <dx-button id=\"btn-chossen-hdck\" (click)=\"showModalHdck()\" icon=\"assets\\img\\icons\\GiuSo.png\"\r\n                text=\"{{_translate.CONTROLL.BUTTON.select_inv_wait_sign}}\" type=\"default\"></dx-button>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </ng-container>\r\n\r\n      </dxi-item>\r\n    </dx-form>\r\n  </div>\r\n</div>\r\n\r\n\r\n<!-- Phiếu xuất kho -->\r\n<div class=\"row invoice-form\" *ngIf=\"isPXKDaiLy || isPXKNB\">\r\n  <div class=\"col-md-12\">\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item *ngIf=\"!isTT78\" dataField=\"invoice_release_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.invoice_releases, onValueChanged: templateChange, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.invoice_form }} {{_translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Mẫu hóa đơn -->\r\n        <dxi-item *ngIf=\"isTT78\" dataField=\"template_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.templatesTT78, onValueChanged: onChangeTem, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{ _translate.CONTROLL.LABEL.invoice_form }} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Hợp đồng kinh tế số, ngày -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"delivery_order_number\" [cssClass]=\"'max_left'\">\r\n            <dxo-label text=\"{{strTextHDKT}}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\" message=\"{{strTextHDKT}} {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item [cssClass]=\"'max_right'\" dataField=\"delivery_order_date\" editorType=\"dxDateBox\"\r\n            [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n            <dxo-label text=\"{{strtextHDKTNgay}}\"></dxo-label>\r\n            <dxi-validation-rule *ngIf=\"isPXKDaiLy\" type=\"required\"\r\n              message=\"{{ strtextHDKTNgay }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Hình thức, lí do điều chỉnh -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"adjustment_form\" [label]=\"{text: _translate.CONTROLL.LABEL.adjustment_form}\"\r\n            editorType=\"dxSelectBox\" cssClass='pxk-left'\r\n            [editorOptions]=\"{items: select.adjustment_forms, onItemClick: adjustmentFormChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.adjustment_form}} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"adjustment_object\" [label]=\"{text: _translate.CONTROLL.LABEL.adjustment_object}\"\r\n            editorType=\"dxSelectBox\" cssClass='pxk'\r\n            [editorOptions]=\"{items: select.adjustment_objects, onItemClick: adjustmentObjectChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.adjustment_object}} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Của -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item dataField=\"delivery_order_by\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.of }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Ngày hóa đơn, số hóa đơn -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"invoice_date\" editorType=\"dxDateBox\"\r\n            [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss', disabled: disableInvoiceDate , onValueChanged: changeDateTime}\">\r\n            <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_date }}\"></dxo-label>\r\n          </dxi-item>\r\n          <dxi-item cssClass=\"vat invoice-number-create-invoice\" dataField=\"invoice_number\" editorType=\"dxNumberBox\"\r\n            [editorOptions]=\"{ disabled: true}\" cssClass='pxk'>\r\n            <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Với -->\r\n        <dxi-item *ngIf=\"isPXKDaiLy\" itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item name=\"search-mkh\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.with }}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-autocomplete valueExpr=\"code\"\r\n                placeholder=\"{{ _translate.CONTROLL.PLACE_HOLDER.input_content_search }}\" [dataSource]=\"customer_codes\"\r\n                [(value)]=\"frmData.customer_name\" (onItemClick)=\"customerCodeChoose($event)\"\r\n                (onFocusOut)=\"updateCustomerInfo($event)\">\r\n                <div *dxTemplate=\"let item of 'item'\">\r\n                  <span>{{item.code}}: {{ item.name }}</span>\r\n                </div>\r\n              </dx-autocomplete>\r\n            </div>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.with }} {{_translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"add_customer\" cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Email -->\r\n        <dxi-item *ngIf=\"!isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item [label]=\"{text: 'Email'}\"\r\n            [ngClass]=\"configs.system_parameter.view_bank_account_seller? 'vat layout_input' : ''\">\r\n            <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n              <div\r\n                class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n                <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                  <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                  </app-tag-input-email>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Loại tiền, tỷ giá -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item dataField=\"currency_code\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.currency_codes, onValueChanged: currencyCodeChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.currency_code }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.currency_code }} {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"currency_rate\" editorType=\"dxNumberBox\" cssClass='pxk'\r\n            [editorOptions]=\"{disabled: frmData.currency_code == 'VND',onValueChanged: currencyRateChange, format: '0,###.##'}\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.currency_rate }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- <dxi-item *ngIf=\"!isPXKDaiLy\"  itemType=\"group\" [colCount]=\"1\">\r\n         \r\n        </dxi-item> -->\r\n        <!-- Về việc -->\r\n        <dxi-item *ngIf=\"!isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item dataField=\"delivery_order_content\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.delivery_order_content }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Người vận chuyển -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"isTT78 && !isPXKDaiLy\">\r\n          <dxi-item dataField=\"delivery_by\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.delivery_by }}\"></dxo-label>\r\n            <dxi-validation-rule *ngIf=\"isPXKDaiLy\" type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.delivery_by }} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Mã số thuế -->\r\n        <dxi-item *ngIf=\"isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item dataField=\"buyer_tax_code\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.tax_code }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <!-- Hình thức xuất -->\r\n          <dxi-item name=\"ht-xuat\" [cssClass]=\"'max_left'\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.export_form }}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-select-box [(value)]=\"frmData.status\" displayExpr=\"name\" valueExpr=\"code\" [items]=\"htXuatOptions\"\r\n                [disabled]=\"!configs.system_parameter.allow_keep_invoice_number\"></dx-select-box>\r\n            </div>\r\n          </dxi-item>\r\n          <!-- Số hóa đơn gốc -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button' *ngIf=\"isPXKDaiLy\">\r\n            <dxi-item name=\"origin-invoice-number\" cssClass='pxk-shd2 max_right'>\r\n              <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number_original}}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-text-box [(value)]=\"oldForm.invoice_number\" disabled=\"true\"></dx-text-box>\r\n              </div>\r\n            </dxi-item>\r\n            <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"origin_btn_options\" cssClass='btn-small'>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- MST kho nhận -->\r\n          <dxi-item *ngIf=\"isTT78 && !isPXKDaiLy\" dataField=\"buyer_tax_code\" [cssClass]=\"'max_right'\">\r\n            <dxo-label text=\"MST kho nhận\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Số hóa đơn gốc -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\" cssClass='group-input-button' *ngIf=\"!isPXKDaiLy\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n            <dxi-item name=\"origin-invoice-number\" cssClass='pxk-shd'>\r\n              <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number_original}}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-text-box [(value)]=\"oldForm.invoice_number\" disabled=\"true\"></dx-text-box>\r\n              </div>\r\n            </dxi-item>\r\n            <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"origin_btn_options\" cssClass='btn-small'>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- hợp đồng -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"isTT78 && !isPXKDaiLy\">\r\n          <dxi-item dataField=\"transportation_contract\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.contract_number }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Hợp đồng số, Người vận chuyển -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isTT78 && isPXKDaiLy\">\r\n          <dxi-item dataField=\"delivery_by\" [cssClass]=\"'max_left'\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.delivery_by }}\"></dxo-label>\r\n            <dxi-validation-rule *ngIf=\"isPXKDaiLy\" type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.delivery_by }} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"transportation_contract\" [cssClass]=\"'max_right'\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.contract_number }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Lý do điều chỉnh -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\" cssClass='group-input-button'>\r\n          <dxi-item dataField=\"destroy_reason\">\r\n            <dxo-label text=\"Lý do điều chỉnh \"></dxo-label>\r\n            <dxi-validation-rule type=\"required\" message=\"Lý do điều chỉnh {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Phương thức vận chuyển -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item dataField=\"transportation_method\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.transportation_method }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.transportation_method }} {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Xuất tại kho -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item name=\"search-mst\" dataField=\"from_warehouse\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: wavehourses, onValueChanged: from_warehouseChange, displayExpr: 'name', valueExpr: 'id',searchEnabled:true}\"\r\n            [cssClass]=\"'max_left'\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.from_warehouse }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.from_warehouse }} {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"from_warehouse_btn_options\"\r\n            cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Nhập tại kho -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item dataField=\"to_warehouse\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: wavehourses, onValueChanged: to_warehouseChange, displayExpr: 'name', valueExpr: 'id',searchEnabled:true}\"\r\n            [cssClass]=\"'max_left'\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.to_warehouse }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.to_warehouse }} {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"to_warehouse_btn_options\" cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Địa chỉ kho xuất -->\r\n        <dxi-item *ngIf=\"isTT78  && !isPXKDaiLy\" itemType=\"group\">\r\n          <dxi-item dataField=\"shiping_point\">\r\n            <dxo-label text=\"Địa chỉ kho xuất\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\" message=\"Địa chỉ kho xuất {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Địa chỉ kho nhập -->\r\n        <dxi-item *ngIf=\"isTT78  && !isPXKDaiLy\" itemType=\"group\">\r\n          <dxi-item dataField=\"place_of_delivery\">\r\n            <dxo-label text=\"Địa chỉ kho nhập\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\" message=\"Địa chỉ kho nhập {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"isTT78\" itemType=\"group\" [colCount]=\"2\">\r\n          <!-- Số bảng kê -->\r\n          <dxi-item dataField=\"list_number\" [cssClass]=\"'max_left'\">\r\n            <dxo-label text=\"Số bảng kê\"></dxo-label>\r\n          </dxi-item>\r\n          <!-- Ngày bảng kê -->\r\n          <dxi-item dataField=\"list_date\" [template]=\"'notifydate'\" [cssClass]=\"'max_right'\">\r\n            <dxo-label text=\"Ngày bảng kê\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\"\r\n          *ngIf=\"configs.integrate_parameter.integrate_econtract && configs.integrate_parameter.integrate_econtract.is_delivery\">\r\n          <!-- Số điện thoại người vận chuyển -->\r\n          <dxi-item dataField=\"carrier_mobile\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.carrier_mobile }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.phone\"\r\n              message=\"{{_translate.CONTROLL.LABEL.carrier_mobile }} {{_translate.VALIDATION.not_pattern}}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <!-- Email người vận chuyển -->\r\n          <dxi-item dataField=\"carrier_email\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.carrier_email }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.email\"\r\n              message=\"{{_translate.CONTROLL.LABEL.carrier_email }} {{_translate.VALIDATION.not_pattern}}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- Ghi chú -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item cssClass=\"vat invoice-note\" dataField=\"note\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.note }}\"></dxo-label>\r\n          </dxi-item>\r\n        </dxi-item>\r\n\r\n        <!-- Email -->\r\n        <dxi-item *ngIf=\"isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n          <dxi-item [label]=\"{text: 'Email'}\"\r\n            [ngClass]=\"configs.system_parameter.view_bank_account_seller? 'vat layout_input' : ''\">\r\n            <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n              <div\r\n                class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n                <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                  <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                  </app-tag-input-email>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </dxi-item>\r\n        </dxi-item>\r\n\r\n        <!-- Trường mở rộng -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n          <app-form-extend [disableForm]=\"ttDaXuatHoaDon\" [formData]=\"frmData\" [customerTempt]=\"customerTempt\"\r\n            [formItems]=\"formItems\" [typeOptions]=\"'invoice_options'\"></app-form-extend>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <div *dxTemplate=\"let d of 'notifydate'\">\r\n        <dx-date-box [(value)]=\"frmData.list_date\" type=\"date\" [useMaskBehavior]=\"true\" [displayFormat]=\"'dd/MM/yyyy'\"\r\n          [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n    </dx-form>\r\n  </div>\r\n</div>\r\n<dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"Thông báo\" [dragEnabled]=\"false\"\r\n  [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">{{_translate.CONFIRM.update_customer}}</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"capNhatDmKhachHang()\" text=\"{{_translate.CONTROLL.LABEL.update}}\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"huy()\" text=\"{{_translate.CONTROLL.BUTTON.cancel}}\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.scss":
/*!*****************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.scss ***!
  \*****************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "::ng-deep .vat.invoice-number-create-invoice input{color:red;font-weight:bold}::ng-deep .customer-tempt .dx-layout-manager .dx-label-h-align .dx-field-item-label .dx-field-item-label-content{min-width:171px !important}::ng-deep .vat1.layout_input span.dx-field-item-label-content{width:128px !important}::ng-deep .vat3.layout_input span.dx-field-item-label-content{width:153px !important}.button-tax-code{background:#337ab7;color:#fff;border-color:transparent;border:none}.button-tax-code:focus{outline:none}::ng-deep .pxk span.dx-field-item-label-content{width:135px !important}::ng-deep .dx-item .pxk-left{min-width:315px !important}::ng-deep .dx-item .pxk-shd dx-text-box .dx-texteditor-input{padding:0px 10px !important}::ng-deep .dx-item .pxk-shd2 dx-text-box .dx-texteditor-input{padding:0px 10px !important}::ng-deep .dx-item .pxk-shd2 span.dx-field-item-label-content{width:135px !important}::ng-deep .vat-handle span.dx-field-item-label-content{width:153px !important}.tmr{display:flex;flex-wrap:nowrap;padding:0 !important}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.ts":
/*!***************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.ts ***!
  \***************************************************************************************************************/
/*! exports provided: AdjustFormInvoiceComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustFormInvoiceComponent", function() { return AdjustFormInvoiceComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @core/library/public/v-select-box.service */ "./src/app/core/library/public/v-select-box.service.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @modules/handle-invoice/components/choose-hdck/choose-hdck.component */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _modules_customers_shared__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @modules/customers/shared */ "./src/app/modules/customers/shared/index.ts");
/* harmony import */ var _modules_products_shared__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @modules/products/shared */ "./src/app/modules/products/shared/index.ts");
/* harmony import */ var _shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @shared/modules/some/components/add-wavehourse/add-wavehourse.component */ "./src/app/shared/modules/some/components/add-wavehourse/add-wavehourse.component.ts");
/* harmony import */ var _shared_components_form_extend_form_extend_component__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @shared/components/form-extend/form-extend.component */ "./src/app/shared/components/form-extend/form-extend.component.ts");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_18___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_18__);
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};



















var AdjustFormInvoiceComponent = /** @class */ (function () {
    function AdjustFormInvoiceComponent(authService, route, modalService, vatService, translate, customersService) {
        var _this = this;
        this.authService = authService;
        this.route = route;
        this.modalService = modalService;
        this.vatService = vatService;
        this.translate = translate;
        this.customersService = customersService;
        this.ttDaXuatHoaDon = false;
        this.formEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onRefreshForm = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.adjustmentObject = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateTypeChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateTT78TypeChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.emails = [];
        this.arrEmail = [];
        this.select = {};
        this.pattern = _config_index__WEBPACK_IMPORTED_MODULE_8__["pattern"];
        this.tax_codes = [];
        this.customer_codes = [];
        this.customerCurent = {};
        this.showPopup = false;
        this.isShowToKhai = false;
        this.isPXKDaiLy = false;
        this.isPXKNB = false;
        this.disableForm = {
            tax_code: true,
            rest: true
        };
        this.formItems = [];
        this.customForms = [];
        this.customerTempt = {};
        // thay đổi disable của 3 input customer_name, buyer_name, buyer_address
        this.tod = {};
        this.disableInvoiceDate = this.authService.isAllowEditInvoiceDate();
        this.htXuatOptions = [];
        this.origin_btn_options = {
            text: '', icon: 'fa fa-eye', type: 'default',
            onClick: function () {
                if (_this.oldForm.template_code.indexOf('02GTTT') >= 0 || _this.oldForm.template_code == "2" || _this.oldForm.template_code.indexOf('07KPTQ') >= 0) {
                    window.open("/system/sale-invoice/" + _this.oldForm.id, '_blank');
                }
                else {
                    if (_this.loaiHoaDon == "03XKNB" || _this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].loaihoadon.HGDL04) {
                        if (_this.loaiHoaDon == "03XKNB") {
                            window.open("/system/transport-invoice/" + _this.oldForm.id, '_blank');
                        }
                        else {
                            window.open("/system/agent-invoice/" + _this.oldForm.id, '_blank');
                        }
                    }
                    else {
                        window.open("/system/vat-invoice/" + _this.oldForm.id, '_blank');
                    }
                }
            }
        };
        this.mst_btn_options = {
            text: '', icon: 'assets/img/icons/Them.png', type: 'default',
            onClick: function () {
                var initialState = {
                    isVisibleGhiVaThemMoi: false
                };
                _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_10__["AddCustomerComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                var submodal = _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveData) {
                        var customer = _this.bsModalRef.content.successSaveData;
                        _this.frmData.customer_name = customer.name;
                        _this.frmData.buyer_tax_code = customer.tax_code;
                        _this.frmData.buyer_name = customer.contact_person_name;
                        _this.frmData.buyer_address = customer.business_address;
                        _this.frmData.customer_code = customer.code;
                        _this.frmData.buyer_mobile = customer.contact_mobile;
                        if (customer.email) {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                            var stringDataEmailGet = customer.email.split(';');
                            for (var i = 0; i < stringDataEmailGet.length; i++) {
                                _this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
                            }
                        }
                        else {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                        }
                        if (customer.bank_account_number) {
                            _this.frmData.bank_account_number = customer.bank_account_number;
                        }
                        if (customer.bank_name) {
                            _this.frmData.bank_name = customer.bank_name;
                        }
                    }
                    submodal.unsubscribe();
                });
            }
        };
        this.add_customer = {
            text: "",
            icon: "assets/img/icons/Them.png",
            type: "default",
            onClick: function () {
                var initialState = {
                    isVisibleGhiVaThemMoi: false,
                };
                _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_10__["AddCustomerComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                var submodal = _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveData) {
                        var customer = _this.bsModalRef.content.successSaveData;
                        _this.frmData.customer_name = customer.name;
                        _this.frmData.buyer_tax_code = customer.tax_code;
                        _this.frmData.buyer_name = customer.contact_person_name;
                        _this.frmData.buyer_address = customer.business_address;
                        _this.frmData.customer_code = customer.code;
                        _this.frmData.buyer_mobile = customer.contact_mobile;
                        if (customer.email) {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                            var stringDataEmailGet = customer.email.split(';');
                            for (var i = 0; i < stringDataEmailGet.length; i++) {
                                _this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
                            }
                        }
                        else {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                        }
                        if (customer.bank_account_number) {
                            _this.frmData.bank_account_number = customer.bank_account_number;
                        }
                        if (customer.bank_name) {
                            _this.frmData.bank_name = customer.bank_name;
                        }
                    }
                    submodal.unsubscribe();
                });
            }
        };
        this.from_warehouse_btn_options = {
            text: "",
            icon: "assets/img/icons/Them.png",
            type: "default",
            onClick: function () {
                _this.wavehourse = new _modules_products_shared__WEBPACK_IMPORTED_MODULE_15__["Wavehourse"]();
                _this.wavehourse.order = _this.wavehourses.length + 1;
                var initialState = {
                    wavehourse: _this.wavehourse,
                    onSave: function (wavehourse) {
                        _this.wavehourse = wavehourse;
                        _this.wavehourses.unshift(_this.wavehourse);
                        _this.frmData.from_warehouse = _this.wavehourse.id;
                        _this.frmData.from_warehouse_name = _this.wavehourse.name;
                    }
                };
                _this.bsModalRef = _this.modalService.show(_shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_16__["AddWavehourseComponent"], {
                    class: 'second child-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
            }
        };
        this.to_warehouse_btn_options = {
            text: "",
            icon: "assets/img/icons/Them.png",
            type: "default",
            onClick: function () {
                _this.wavehourse = new _modules_products_shared__WEBPACK_IMPORTED_MODULE_15__["Wavehourse"]();
                _this.wavehourse.order = _this.wavehourses.length + 1;
                var initialState = {
                    wavehourse: _this.wavehourse,
                    onSave: function (wavehourse) {
                        _this.wavehourse = wavehourse;
                        _this.wavehourses.unshift(_this.wavehourse);
                        _this.frmData.to_warehouse = _this.wavehourse.id;
                        _this.frmData.to_warehouse_name = _this.wavehourse.name;
                    }
                };
                _this.bsModalRef = _this.modalService.show(_shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_16__["AddWavehourseComponent"], {
                    class: 'second child-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
            }
        };
        // sự kiện
        this.taxCodeKeyUp = function (e) {
            var str = _this.frmData.buyer_tax_code;
            var len = str.length;
            if (len >= 3) {
                _this.vatService.searchMST(str).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        var arr_1 = [];
                        rs.data.customers.forEach(function (item) {
                            arr_1.push(item);
                        });
                        _this.tax_codes = arr_1;
                    }
                });
            }
        };
        this.adjustmentFormChange = function (e) {
            _this.disableForm = { tax_code: true, rest: true };
            var value = e.value;
            if (!e.isInit) {
                _this.onRefreshForm.emit();
                value = e.itemData.code;
            }
            switch (value) {
                case 'THONG_TIN':
                    if (!e.isInit)
                        _this.frmData.adjustment_object = '';
                    _this.select.adjustment_objects = [
                        {
                            name: 'Mã số thuế',
                            code: 'MST'
                        },
                        {
                            name: 'Tiền chữ',
                            code: 'TIEN_CHU'
                        },
                        {
                            name: 'Tên khách hàng, Địa chỉ, ...',
                            code: 'KH_DC'
                        },
                    ];
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "");
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "");
                    }
                    break;
                case 'TANG':
                    if (!e.isInit)
                        _this.frmData.adjustment_object = '';
                    _this.select.adjustment_objects = [
                        {
                            name: 'Hàng hóa dịch vụ',
                            code: 'HH_DV'
                        },
                        {
                            name: 'Khác',
                            code: 'KHAC_TANG'
                        },
                    ];
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "Tăng ");
                        if (_this.isTT78) {
                            if (_this.frmData.total_payment_in_word.includes('Tăng') == false)
                                _this.frmData.total_payment_in_word = "Tăng " + _this.frmData.total_payment_in_word;
                        }
                    }
                    break;
                case 'GIAM':
                    if (!e.isInit)
                        _this.frmData.adjustment_object = '';
                    _this.select.adjustment_objects = [
                        {
                            name: 'Hàng hóa dịch vụ',
                            code: 'HH_DV'
                        },
                        {
                            name: 'Khác',
                            code: 'KHAC_GIAM'
                        },
                    ];
                    if (_this.frmData.total_payment_in_word)
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "Giảm ");
                    if (_this.isTT78) {
                        if (_this.frmData.total_payment_in_word && _this.frmData.total_payment_in_word.includes('Giảm') == false)
                            _this.frmData.total_payment_in_word = "Giảm " + _this.frmData.total_payment_in_word;
                    }
                    break;
                case 'TANG_GIAM':
                    if (_this.isPXKNB || _this.isPXKDaiLy) {
                        _this.select.adjustment_objects = [
                            {
                                name: 'Điều chỉnh tăng giảm đồng thời và Khác',
                                code: 'TANG_GIAM'
                            },
                        ];
                    }
                    else {
                        _this.select.adjustment_objects = [
                            {
                                name: 'Điều chỉnh tăng giảm đồng thời',
                                code: 'TANG_GIAM'
                            },
                        ];
                    }
                    _this.frmData.adjustment_object = 'TANG_GIAM';
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "");
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "");
                    }
                    _this.disableForm = { tax_code: false, rest: false };
                    _this.setPropertyOfForm(_this.frmData.adjustment_form, _this.frmData.adjustment_object, e.isInit);
                    break;
                case 'KHAC':
                    if (!e.isInit)
                        _this.frmData.adjustment_object = '';
                    _this.select.adjustment_objects = [
                        {
                            name: 'Khác',
                            code: 'KHAC'
                        },
                    ];
                    if (_this.frmData.total_payment_in_word) {
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Tăng ", "");
                        _this.frmData.total_payment_in_word = _this.frmData.total_payment_in_word.replace("Giảm ", "");
                    }
                    _this.disableForm = { tax_code: false, rest: false };
                    _this.frmData.adjustment_object = 'KHAC';
                    _this.setPropertyOfForm(_this.frmData.adjustment_form, _this.frmData.adjustment_object, e.isInit);
                    break;
                default:
                    break;
            }
        };
        this.adjustmentObjectChange = function (e) {
            _this.onRefreshForm.emit();
            _this.setPropertyOfForm(_this.frmData.adjustment_form, e.itemData.code, false);
        };
        this.customer_object_codeChange = function (e) {
            _this.setDisabledByCustomer_object_code(e.value);
        };
        this.templateChange = function (e) {
            _this.select.invoice_releases.forEach(function (item) {
                if (e.value === item.value) {
                    _this.frmData.template_id = item.template_id;
                    _this._objTemplateSelect = item;
                    _this.onTemplateTypeChange.emit(item);
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    if (!_this._objTemplateSelect.is_discount) {
                        _this.dataSource.items().forEach(function (item) {
                            item.discount = null;
                            item.amount_discount = null;
                        });
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._objTemplateSelect, _this.configs.system_parameter);
                        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBay
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonXangDau) {
                            _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type));
                        }
                    }
                    // Nếu là mẫu html
                    _this.formDuLieuMoRong(item);
                }
            });
        };
        this.onChangeTem = function (e) {
            _this.select.templatesTT78.forEach(function (item) {
                if (e.value === item.value) {
                    _this.frmData.template_id = item.value;
                    _this.frmData.invoice_series = item.invoice_series;
                    _this.frmData.template_code = item.template_code;
                    _this.onTemplateTT78TypeChange.emit(item);
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe)
                        _this.isShowToKhai = true;
                    else
                        _this.isShowToKhai = false;
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            var value = item[key];
                            _this._oTemplateTT78[key] = value;
                        }
                    }
                    if (!_this._oTemplateTT78.is_discount) {
                        _this.invoice_products.load().then(function (dataSource) {
                            dataSource.forEach(function (item, index) {
                                item.discount = null;
                                item.amount_discount = null;
                            });
                        });
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._oTemplateTT78, _this.configs.system_parameter);
                        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBay
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonXangDau) {
                            _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type));
                        }
                    }
                    // Nếu là mẫu html
                    _this.formDuLieuMoRong(item);
                }
            });
        };
        this.currencyCodeChange = function (e) {
            if (_this.frmData.currency_code === 'VND') {
                _this.frmData.currency_rate = null;
            }
            _this.doctienbangchu(_this.frmData.total_payment, _this.frmData.currency_code);
            // this.frmData.total_payment_in_word = Helper.tienBangChu(this.frmData.total_payment, VChanggeMoneyService.getFormatterToNumber(this.formatter.tong_tien), this.frmData.currency_code, this.configs.system_parameter.display_read_money_english);
        };
        this.exportPlaceChange = function (e) {
            _this.select.export_places.forEach(function (item) {
                if (e.value === item.code) {
                    _this.frmData.export_address = item.dia_chi;
                }
            });
        };
        this.currencyRateChange = function (e) {
            if (!_this.isTT78)
                _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._objTemplateSelect, _this.configs.system_parameter);
            else
                _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._oTemplateTT78, _this.configs.system_parameter);
        };
        this.updateCustomerInfo = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.code) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.customer_code)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.updateTaxcodeInfo = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.tax_code) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_tax_code)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.paymentMethodChange = function (e) {
            var _obj = _this.select.payment_method_names.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.payment_method_view_name = _obj.name;
            }
        };
        this.changeDateTime = function (e) {
            _this.changeTemplateInvoice(e.value);
        };
        this.from_warehouseChange = function (e) {
            var _obj = _this.wavehourses.filter(function (p) { return p.id == e.value; })[0];
            if (_obj) {
                _this.frmData.from_warehouse_name = _obj.name;
                _this.frmData.shiping_point = _obj.address;
            }
        };
        this.to_warehouseChange = function (e) {
            var _obj = _this.wavehourses.filter(function (p) { return p.id == e.value; })[0];
            if (_obj) {
                _this.frmData.to_warehouse_name = _obj.name;
                _this.frmData.place_of_delivery = _obj.address;
            }
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
    }
    AdjustFormInvoiceComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.minNgayVB = moment__WEBPACK_IMPORTED_MODULE_2__(this.oldForm.invoice_date).format('YYYY-MM-DD');
        this.maxNgayVB = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD');
        this.loaiHoaDon = this.route.snapshot.data.type;
        if (this.loaiHoaDon == '03XKNB')
            this.isPXKNB = true;
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].loaihoadon.HGDL04)
            this.isPXKDaiLy = true;
        if (this.isPXKDaiLy) {
            this.strTextHDKT = this._translate.CONTROLL.LABEL.deconomic_contract_number;
            this.strtextHDKTNgay = "Hợp đồng kinh tế ngày";
        }
        else {
            this.strTextHDKT = this._translate.CONTROLL.LABEL.delivery_order_number;
            this.strtextHDKTNgay = this._translate.CONTROLL.LABEL.date;
        }
        this.routeSub = this.route.data.subscribe(function (data) {
            _this.configs = _this.authService.getConfigs();
            // put data DM for select
            _this.select.unit_codes = data.init[1].DM_DON_VI_TINH;
            _this.select.payment_method_names = data.init[1].DM_HINH_THUC_THANH_TOAN;
            _this.select.currency_codes = data.init[1].DM_LOAI_TIEN;
            _this.select.customer_types = data.init[1].DM_NHOM_KHACH_HANG;
            _this.select.export_places = data.init[1].DM_NOI_XUAT_HOA_DON;
            _this.htXuatOptions = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._htXuatOptions(_this._translate, _this.frmData.status);
            if (_this.loaiHoaDon == '03XKNB' || _this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].loaihoadon.HGDL04) {
                _this.select.adjustment_forms = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._adjustmentFormsPXK(_this._translate);
            }
            else {
                _this.select.adjustment_forms = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._adjustmentForms(_this._translate);
            }
            _this.select.customer_object_codes = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._customerObject(_this._translate);
            if (_this.configs.system_parameter.allow_keep_invoice_number === false) {
                _this.htXuatOptions = _this.htXuatOptions.filter(function (e) { return e.code !== _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].hinhThucXuat.XuatChoKy; });
            }
            if (_this.isTT78) {
                // this.select.adjustment_forms = this.select.adjustment_forms.filter(p => p.code != 'TANG_GIAM');
                var temptTT78 = [];
                temptTT78 = data.init[0].filter(function (item) { return item.template_type !== 'HOA_DON_KHOI_TAO_TU_MAY_TINH_TIEN' && item.template_type !== 'PHIEU_THU_MAY_TINH_TIEN'; });
                if (temptTT78 && temptTT78.length > 0) {
                    _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.infoDangKy.is_invoice_with_code; });
                    if (Number.parseInt(_this.frmData.invoice_number) > 0) {
                        if (_this.frmData.is_invoice_with_code != _this.infoDangKy.is_invoice_with_code) {
                            _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.frmData.is_invoice_with_code; });
                        }
                    }
                }
                if (_this.frmData.id)
                    _this.changeTemplateInvoice(_this.frmData.invoice_date);
            }
            else {
                _this.select.invoice_releases = data.init[0];
            }
        });
        var buyer_address = this.frmData.buyer_address;
        this.select.adjustment_objects = [];
        if (this.frmData.adjustment_form) {
            this.adjustmentFormChange({ value: this.frmData.adjustment_form, isInit: true });
        }
        // Set disabled cho đơn vị tổ chức
        this.setDisabledByCustomer_object_code(this.frmData.customer_object_code);
        this.setPropertyOfForm(this.frmData.adjustment_form, this.frmData.adjustment_object, true);
        // tìm kiếm mã số thuế
        buyer_address = this.frmData.buyer_address;
        this.tax_codes = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default.a({
            load: function (loadOptions) {
                return _this.vatService.getDataSourceForm(loadOptions.searchValue, 'tax_code');
            }
        });
        // // tìm kiếm mã khách hàng
        this.customer_codes = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default.a({
            load: function (loadOptions) {
                return _this.vatService.getDataSourceForm(loadOptions.searchValue, 'code');
            }
        });
        // Khởi tạo ban đầu
        this.extentionGrid.ma_hang = false;
        this.extentionGrid.so_lo = false;
        this.extentionGrid.han_dung = false;
        this.extentionGrid.nuoc_san_xuat = false;
        this.extentionGrid.don_hang_hop_dong = false;
        this.extentionGrid.ma_quan_ly = false;
        if (!this.isTT78) {
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id === _this.frmData.template_id) {
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    // Nếu là mẫu html
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe)
                        _this.isShowToKhai = true;
                    else
                        _this.isShowToKhai = false;
                    // setTimeout(() => {
                    _this.template_temp = item;
                    // })
                }
            });
        }
        else {
            this.select.templatesTT78.forEach(function (item) {
                if (item.value === _this.frmData.template_id) {
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    // Nếu là mẫu html
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe)
                        _this.isShowToKhai = true;
                    else
                        _this.isShowToKhai = false;
                    _this.template_temp = item;
                    // })
                }
            });
        }
        if (this.frmData.buyer_email) {
            this.emails = [];
            var emailToString = this.frmData.buyer_email;
            var a11 = emailToString.replace(/;/g, ',');
            this.emails = a11.split(',');
        }
    };
    AdjustFormInvoiceComponent.prototype.formDuLieuMoRong = function (item) {
        var _this = this;
        this.customForms = [];
        this.customerTempt = {};
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].resetObject(this.formItems);
        if (item.fields && item.fields.length > 0) {
            var _arrayGrid = item.fields.filter(function (x) { return x.type === '5'; });
            if (_arrayGrid && _arrayGrid.length > 0) {
                this.extentionGrid.ma_hang = false;
                this.extentionGrid.so_lo = false;
                this.extentionGrid.han_dung = false;
                this.extentionGrid.nuoc_san_xuat = false;
                this.extentionGrid.don_hang_hop_dong = false;
                this.extentionGrid.ma_quan_ly = false;
                for (var i = 0; i < _arrayGrid.length; i++) {
                    var column = _arrayGrid[i]['name'];
                    var value = _arrayGrid[i]['is_show'];
                    var _ma = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column);
                    this.extentionGrid[_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column)] = value;
                }
            }
            var _dulieumorong = lodash__WEBPACK_IMPORTED_MODULE_18__["cloneDeep"](item.fields).filter(function (x) { return x.type === '4'; });
            var invoice_options_1 = this.frmData.invoice_options;
            if (invoice_options_1.length > 0) {
                _dulieumorong = _dulieumorong.map(function (dl) {
                    var option = invoice_options_1.find(function (x) { return x.code == dl.code; });
                    if (option) {
                        dl.value = option.value;
                    }
                    return dl;
                });
            }
            this.frmData.invoice_options = _dulieumorong;
            if (_dulieumorong.length > 0) {
                this.formExtend.createForm(this.customForms, _dulieumorong);
            }
            _dulieumorong.forEach(function (value) {
                _this.customerTempt[value.code] = value.value;
            });
        }
        else {
            this.frmData.invoice_options = [];
            this.extentionGrid.ma_hang = false;
            this.extentionGrid.so_lo = false;
            this.extentionGrid.han_dung = false;
            this.extentionGrid.nuoc_san_xuat = false;
            this.extentionGrid.don_hang_hop_dong = false;
            this.extentionGrid.ma_quan_ly = false;
        }
    };
    AdjustFormInvoiceComponent.prototype.ngAfterViewInit = function () {
        // this.listDxForm._results[1].readOnly = true;
        this.formDuLieuMoRong(this.template_temp);
        var arrD = document.querySelectorAll('.btn-small');
        arrD.forEach(function (item) {
            item.parentElement.parentElement.style.flex = '0 0 0 ';
        });
    };
    AdjustFormInvoiceComponent.prototype.readonlyAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = true;
        });
        this.readOnlyCacTruongConLai = true;
    };
    AdjustFormInvoiceComponent.prototype.removeReadonlyAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = false;
            // item.instance.resetValues();
        });
        this.readOnlyCacTruongConLai = false;
    };
    ////// Tạo form mở rộng
    AdjustFormInvoiceComponent.prototype.createCustomGroup = function () {
        return {
            itemType: 'group',
            colCount: '2',
            items: this.customForms
        };
    };
    /////// sự kiện thay đổi các trường mở rộng
    AdjustFormInvoiceComponent.prototype.changeItem = function (_dulieumorong) {
        var _this = this;
        _dulieumorong.forEach(function (item) {
            for (var key in _this.customerTempt) {
                if (item.code === key) {
                    item.value = _this.customerTempt[key];
                }
            }
            _this.frmData.invoice_options = _dulieumorong;
        });
    };
    AdjustFormInvoiceComponent.prototype.setDisabledByCustomer_object_code = function (value) {
        this.tod.customer_name = false;
        this.tod.buyer_name = false;
        this.tod.buyer_address = false;
        switch (value) {
            case 'DOANH_NGHIEP':
                break;
            case 'CA_NHAN':
                this.frmData.customer_name = '';
                this.tod.customer_name = true;
                break;
            case 'KHACH_LE':
                this.frmData.customer_name = '';
                this.frmData.buyer_address = '';
                this.tod.customer_name = true;
                this.tod.buyer_address = true;
                break;
            default:
                break;
        }
    };
    AdjustFormInvoiceComponent.prototype.getHtXuatValue = function () {
        return this.frmData.status;
    };
    // gửi data lên parent component
    AdjustFormInvoiceComponent.prototype.onFieldDataChanged = function () {
        if (this.frmData) {
            if (this.frmData.adjustment_object === 'MST') {
                this.adjustmentObject.emit('THONG_TIN_MST');
            }
            if (this.frmData.adjustment_object === 'KH_DC') {
                this.adjustmentObject.emit('THONG_TIN_KH_DC');
            }
        }
    };
    AdjustFormInvoiceComponent.prototype.setPropertyOfForm = function (adjustment_form, adjustment_object, isInit) {
        if (adjustment_object === 'MST') {
            this.disableForm = { tax_code: false, rest: true };
            this.adjustmentObject.emit('THONG_TIN_MST');
        }
        else if (adjustment_form === 'THONG_TIN' && adjustment_object === 'KH_DC') {
            this.disableForm = { tax_code: false, rest: false };
            this.adjustmentObject.emit('THONG_TIN_KH_DC');
        }
        else if (adjustment_form === 'THONG_TIN' && adjustment_object === 'TIEN_CHU') {
            this.disableForm = { tax_code: true, rest: true };
            this.adjustmentObject.emit('THONG_TIN_TIEN_CHU');
        }
        else if (adjustment_form === 'KHAC' && adjustment_object === 'KHAC') {
            this.disableForm = { tax_code: false, rest: false };
            this.adjustmentObject.emit('KHAC_KHAC');
        }
        else if (adjustment_form === 'TANG' && adjustment_object === 'HH_DV') {
            this.disableForm = { tax_code: true, rest: true };
            this.adjustmentObject.emit('TANG_HH_DV');
        }
        else if (adjustment_form === 'TANG' && adjustment_object === 'KHAC_TANG') {
            this.disableForm = { tax_code: true, rest: true };
            this.adjustmentObject.emit('TANG_KHAC_TANG');
        }
        else if (adjustment_form === 'GIAM' && adjustment_object === 'HH_DV') {
            this.disableForm = { tax_code: true, rest: true };
            this.adjustmentObject.emit('GIAM_HH_DV');
        }
        else if (adjustment_form === 'GIAM' && adjustment_object === 'KHAC_GIAM') {
            this.disableForm = { tax_code: true, rest: true };
            this.adjustmentObject.emit('GIAM_KHAC_GIAM');
        }
        else if (adjustment_form === 'TANG_GIAM' && adjustment_object === 'TANG_GIAM') {
            this.disableForm = { tax_code: false, rest: false };
            this.adjustmentObject.emit('TANG_GIAM');
        }
        if (adjustment_object !== 'TANG_GIAM' && !isInit) {
            this.frmData.buyer_tax_code = this.oldForm.buyer_tax_code;
            this.frmData.customer_name = this.oldForm.customer_name;
            this.frmData.buyer_address = this.oldForm.buyer_address;
            this.frmData.buyer_name = this.oldForm.buyer_name;
            this.frmData.buyer_mobile = this.oldForm.buyer_mobile;
        }
    };
    // reset trường mở rộng
    AdjustFormInvoiceComponent.prototype.resetTMR = function () {
        this.formExtend.resetForm();
        this.formExtend.resetOptions();
    };
    AdjustFormInvoiceComponent.prototype.taxCodeChoose = function (e) {
        var customer = e.itemData;
        if (this.frmData.customer_object_code !== 'CA_NHAN' && this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.customer_name = customer.name;
        }
        this.frmData.buyer_name = customer.contact_person_name;
        if (this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.buyer_address = customer.business_address;
        }
        this.frmData.customer_code = customer.code;
        this.frmData.buyer_mobile = customer.contact_mobile;
        if (customer.email) {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
            var stringDataEmailGet = customer.email.split(';');
            for (var i = 0; i < stringDataEmailGet.length; i++) {
                this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
            }
        }
        else {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
        }
        this.frmData.customer_id = customer.id;
        this.onFieldDataChanged();
    };
    // total_payment_in_wordChange = (e) => {
    //   if (this.frmData.adjustment_form === "THONG_TIN" && this.frmData.adjustment_object === "TIEN_CHU") {
    //     let invoice_date = moment(this.oldForm.invoice_date).format("DD/MM/YYYY");
    //     this.dataSource.items()[0].product_name = `Điều chỉnh dòng số tiền bằng chữ của hóa đơn số ${this.oldForm.invoice_number}, ký hiệu ${this.oldForm.invoice_series} ngày ${invoice_date} từ: ${this.oldForm.total_payment_in_word} thành ${e.value}`;
    //     this.productGrip.dataGrid.instance.refresh();
    //   }
    // }
    AdjustFormInvoiceComponent.prototype.customerCodeChoose = function (e) {
        var customer = e.itemData;
        if (this.frmData.customer_object_code !== 'CA_NHAN' && this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.customer_name = customer.name;
        }
        this.frmData.buyer_name = customer.contact_person_name;
        if (this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.buyer_address = customer.business_address;
        }
        this.frmData.buyer_tax_code = customer.tax_code;
        this.frmData.buyer_mobile = customer.contact_mobile;
        if (customer.email) {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
            var stringDataEmailGet = customer.email.split(';');
            for (var i = 0; i < stringDataEmailGet.length; i++) {
                this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
            }
        }
        else {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
        }
        this.frmData.customer_id = customer.id;
        if (customer.bank_account_number) {
            this.frmData.bank_account_number = customer.bank_account_number;
        }
        if (customer.bank_name) {
            this.frmData.bank_name = customer.bank_name;
        }
        this.onFieldDataChanged();
    };
    AdjustFormInvoiceComponent.prototype.ngOnDestroy = function () {
        this.routeSub.unsubscribe();
    };
    AdjustFormInvoiceComponent.prototype.xuatMauBienBan = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].showloading();
        var inv = Object.assign({}, this.oldForm);
        inv.doc_relate_date = this.frmData.doc_relate_date;
        inv.doc_relate_symbol = this.frmData.doc_relate_symbol;
        inv.destroy_reason = this.frmData.destroy_reason;
        inv.invoice_files = [];
        this.vatService.xuatMauBienBanDc(inv).subscribe(function (rs) {
            if (rs.status === 'success') {
                var file = rs.data.invoice;
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
        });
        // if (!this.frmData.doc_relate_symbol) {
        //   Library.notify(this._translate.CONTROLL.LABEL.doc_relate_symbol +" "+this._translate.VALIDATION.required, 'error');
        // } else if (!this.frmData.doc_relate_date) {
        //   Library.notify(this._translate.CONTROLL.LABEL.doc_relate_date +" "+this._translate.VALIDATION.required, 'error');
        // }
        // //  else if (!this.frmData.destroy_reason) {
        // //   Library.notify(this._translate.CONTROLL.LABEL.destroy_reason +" "+this._translate.VALIDATION.required, 'error');
        // // }
        // else {
        //   const initialState = {
        //     oldForm: this.oldForm,
        //     frmData: this.frmData,
        //     _objTemplateSelect: this._objTemplateSelect,
        //     fileData: this.fileData,
        //     onSave: (data) => {
        //       console.log(data);
        //       this.frmData.id = data.id;
        //       this.frmData.invoice_date = data.invoice_date;
        //       this.frmData.invoice_number = data.invoice_number;
        //     }
        //   };
        //   this.bsModalRef = this.modalService.show(ReportAdjustInvComponent, {
        //     backdrop: 'static',
        //     keyboard: false,
        //     class: 'modal-lg full-modal',
        //     initialState
        //   });
        // }
    };
    AdjustFormInvoiceComponent.prototype.showModalHdck = function () {
        var _this = this;
        var initialState = {
            invoiceNumberOrigin: this.oldForm.invoice_number,
            invoiceDateOrigin: this.oldForm.invoice_date,
            invoiceReleaseId: this.frmData.invoice_release_id,
            onSave: function (data) {
                _this.frmData.status = _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].statusInv.ChoKy;
                _this.frmData.id = data.id;
                _this.frmData.invoice_date = data.invoice_date;
                _this.frmData.invoice_number = data.invoice_number;
            }
        };
        this.bsModalHdckRef = this.modalService.show(_modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_11__["ChooseHdckComponent"], {
            backdrop: 'static',
            keyboard: false,
            class: 'modal-lg full-modal',
            initialState: initialState
        });
    };
    AdjustFormInvoiceComponent.prototype.renderDataEmail = function ($event) {
        this.arrEmail = [];
        this.emails = $event;
        if (this.emails.length > 0) {
            for (var i = 0; i < this.emails.length; i++) {
                if (typeof this.emails[i] === 'object')
                    this.arrEmail.push(this.emails[i].value);
                else if (typeof this.emails[i] === 'string')
                    this.arrEmail.push(this.emails[i]);
            }
            var emailToString = this.arrEmail.toString();
            this.frmData.buyer_email = emailToString.replace(/,/g, ';');
        }
        else {
            this.frmData.buyer_email = null;
        }
        this.formEvent.emit(this.frmData);
    };
    AdjustFormInvoiceComponent.prototype.capNhatDmKhachHang = function () {
        var _this = this;
        this.customerCurent.tax_code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_tax_code);
        this.customerCurent.name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.customer_name);
        this.customerCurent.code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.customer_code);
        this.customerCurent.contact_person_name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_name);
        this.customerCurent.contact_mobile = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_mobile);
        this.customerCurent.business_address = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_address);
        this.customerCurent.email = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_email);
        this.customerCurent.bank_name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.bank_name);
        this.customerCurent.bank_account_number = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.bank_account_number);
        var data = { customer: this.customerCurent };
        this.customersService.edit(data, this.customerCurent.id).subscribe(function (response) {
            if (response.status === 'success') {
                _this.showPopup = false;
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(response.message, 'error');
            }
        }, function (err) {
        }, function () {
        });
    };
    AdjustFormInvoiceComponent.prototype.huy = function () {
        this.showPopup = false;
    };
    AdjustFormInvoiceComponent.prototype.changeTemplateInvoice = function (strDate) {
        var _this = this;
        if (this.isTT78) {
            var year_1 = "";
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(strDate) != "")
                year_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(strDate).substring(4, 2);
            else {
                var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                year_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(invoiceDate).substring(4, 2);
            }
            var templates = this.select.templatesTT78;
            this.select.templatesTT78 = [];
            if (templates && templates.length > 0) {
                templates.forEach(function (item) {
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(item.name) != "")
                        item.name = item.name.replace(item.name.substring(4, 2), year_1);
                    // for (const key in item) {
                    //   if (item.hasOwnProperty(key)) {
                    //     const value = item[key];
                    //     this._oTemplateTT78[key] = value;
                    //   }
                    // }
                    if (item.value === _this.frmData.template_id) {
                        _this.onTemplateTT78TypeChange.emit(item);
                        //  item.invoice_series = item.invoice_series.replace(item.invoice_series.substring(3, 1), year);
                        // this.frmData.invoice_series = item.invoice_series;
                        // this.frmData.template_code = item.template_code;
                    }
                    _this.select.templatesTT78.push(item);
                });
            }
        }
    };
    AdjustFormInvoiceComponent.prototype.disableTemplateInput = function () {
        if (this.frmData.invoice_number) {
            return true;
        }
        return false;
    };
    AdjustFormInvoiceComponent.prototype.doctienbangchu = function (total_payment, currency_code) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.adjustment_object) == "TANG_GIAM" && this.isTT78) {
            var number_money = Math.abs(total_payment);
            var c_money = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].tienBangChu(number_money, _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            this.frmData.total_payment_in_word = c_money;
            if (total_payment < 0) {
                this.frmData.total_payment_in_word = "Giảm " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                }
            }
            else if (total_payment > 0) {
                this.frmData.total_payment_in_word = "Tăng " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                }
            }
        }
        else {
            this.frmData.total_payment_in_word = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].tienBangChu(total_payment, _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            if (this.isTT78) {
                if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.total_payment_in_word) != "" && this.frmData.total_payment_in_word != "Không đồng chẵn.") {
                    if (this.frmData.adjustment_form === 'TANG') {
                        this.frmData.total_payment_in_word = "Tăng " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                        }
                    }
                    if (this.frmData.adjustment_form == 'GIAM') {
                        this.frmData.total_payment_in_word = "Giảm " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                        }
                    }
                }
            }
        }
    };
    AdjustFormInvoiceComponent.prototype.changeTaxCode = function (e) {
        this.tax_code_search = e.value;
        this.onFieldDataChanged();
    };
    AdjustFormInvoiceComponent.prototype.searchTaxCode = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].showloading();
        this.tax_code_search = this.frmData.buyer_tax_code;
        if (!this.tax_code_search) {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify("Vui lòng nhập mã số thuế!", "error");
        }
        else {
            if (!this.disableForm.rest) {
                this.vatService.getInfoCompany(this.tax_code_search).subscribe(function (res) {
                    if (res.status == "success") {
                        _this.dataTaxCode = res.data.customer;
                        _this.frmData.customer_name = _this.dataTaxCode.name;
                        _this.frmData.buyer_address = _this.dataTaxCode.business_address;
                    }
                });
            }
        }
        this.onFieldDataChanged();
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
        }, 1000);
    };
    AdjustFormInvoiceComponent.prototype.allowEditAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = false;
        });
        this.readOnlyCacTruongConLai = false;
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChildren"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "listDxForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"])
    ], AdjustFormInvoiceComponent.prototype, "form", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "wavehourses", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustFormInvoiceComponent.prototype, "ttDaXuatHoaDon", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "frmData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "dataSource", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "oldForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "type", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "invoice_products", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "formatter", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "_objTemplateSelect", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "extentionGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onFormChange'),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "formEvent", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onRefreshForm'),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "onRefreshForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('adjustmentObjectChange'),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "adjustmentObject", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateTypeChange'),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "onTemplateTypeChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateTT78TypeChange'),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "onTemplateTT78TypeChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "infoDangKy", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustFormInvoiceComponent.prototype, "isTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "_oTemplateTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustFormInvoiceComponent.prototype, "fileData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustFormInvoiceComponent.prototype, "isShowButtonWaiteSign", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_shared_components_form_extend_form_extend_component__WEBPACK_IMPORTED_MODULE_17__["FormExtendComponent"]),
        __metadata("design:type", _shared_components_form_extend_form_extend_component__WEBPACK_IMPORTED_MODULE_17__["FormExtendComponent"])
    ], AdjustFormInvoiceComponent.prototype, "formExtend", void 0);
    AdjustFormInvoiceComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'adjust-vat-form-invoice',
            template: __webpack_require__(/*! ./adjust-form-invoice.component.html */ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.html"),
            styles: [__webpack_require__(/*! ./adjust-form-invoice.component.scss */ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_7__["AuthService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__["VatService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_12__["TranslateService"],
            _modules_customers_shared__WEBPACK_IMPORTED_MODULE_14__["CustomersService"]])
    ], AdjustFormInvoiceComponent);
    return AdjustFormInvoiceComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.html":
/*!*******************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.html ***!
  \*******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"container-fluid\" style=\"margin-bottom: 0!important; padding-left: 0!important;\"\r\n  *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n  <div class=\"row\">\r\n    <div class=\"pl-0 col-md-12\">\r\n      <div class=\"button-redirect\">\r\n        <ul class=\"nav nav-tabs\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link active\" href=\"javascript:void(0)\">{{_translate.CONTROLL.BUTTON.report_adjustment}}</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link \" (click)=\"routeReport()\" href=\"javascript:void(0)\">\r\n              {{this.textReport}}\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n<form (ngSubmit)=\"onSubmit()\">\r\n  <div class=\"invoice-container\">\r\n    <!-- phần form thông tin -->\r\n    <adjust-vat-form-invoice [type]=\"1\" [frmData]=\"frmData\" [oldForm]=\"oldForm\" [dataSource]=\"dataSource\"\r\n      [invoice_products]=\"invoice_products\" [formatter]=\"formatter\" [_objTemplateSelect]=\"_objTemplateSelect\"\r\n      [fileData]=\"fileData\" (adjustmentObjectChange)=\"adjustmentObjectChange($event)\"\r\n      (onTemplateTypeChange)=\"onTemplateTypeChange($event)\" [extentionGrid]=\"extentionGrid\"\r\n      [_oTemplateTT78]=\"_oTemplateTT78\" [isTT78]=\"isTT78\" [infoDangKy]=\"infoDangKy\"\r\n      (onTemplateTT78TypeChange)=\"onTemplateTT78TypeChange($event)\" [isShowButtonWaiteSign]=\"isShowButtonWaiteSign\"\r\n      [wavehourses]=\"wavehourses\" (onRefreshForm) = \"onRefreshForm()\" [ttDaXuatHoaDon]=\"ttDaXuatHoaDon\"></adjust-vat-form-invoice>\r\n\r\n    <!-- <dx-button id=\"btn-chossen-hdck\" (click)=\"showModalHdck()\" icon=\"assets\\img\\icons\\GiuSo.png\" text=\"Chọn hóa đơn chờ ký\" type=\"default\"></dx-button> -->\r\n\r\n    <!-- table product -->\r\n    <adjust-vat-product-grip #child [dataSource]=\"dataSource\" [invoice_products]=\"invoice_products\"\r\n      [formatter]=\"formatter\" [oldForm]=\"oldForm\" [frmData]=\"frmData\" [extentionGrid]=\"extentionGrid\" [isTT78]=\"isTT78\"\r\n      [_oTemplateTT78]=\"_oTemplateTT78\" [_objTemplateSelect]=\"_objTemplateSelect\">\r\n    </adjust-vat-product-grip>\r\n\r\n    <!-- <button type=\"button\" (click)=\"updateCustomer()\">aa</button> -->\r\n\r\n    <div class=\"table-footer\">\r\n      <div class=\"table-footer-1\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-table-footer\" dataField=\"amount_after_vat\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tong_tien, disabled: true,step:'0'}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-2\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-vat-table-footer\" dataField=\"total_amount_vat\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tien_thue, disabled: true, step:'0'}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-3\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-after-vat-table-footer\" dataField=\"amount\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.thanh_tien, disabled: true}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-4\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-table-footer\" dataField=\"amount_without_discount\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.thanh_tien_chua_ck, disabled: true}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- vùng chọn file -->\r\n    <div class=\"row after-table\">\r\n      <div class=\"col-md-5\">\r\n        <file-upload-multiple [fileData]=\"fileData\" (fileChange)=\"getFileData($event)\"></file-upload-multiple>\r\n      </div>\r\n      <div class=\"col-md-2\">\r\n      </div>\r\n      <div class=\"col-md-5\">\r\n        <!-- <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item dataField=\"aaa\" [label]=\"{text: 'Tiền phí khác'}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: '0,###'}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"on_currency_amount\" [label]=\"{text: _translate.CONTROLL.LABEL.on_currency_amount}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: '0,###', disabled: checkDisabledTotalPaymentInWord(),onKeyDown:keyDown}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"amount\" [label]=\"{text: _translate.CONTROLL.LABEL.amount}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: formatter.thanh_tien, disabled: checkDisabledTotalPaymentInWord(),onKeyDown:keyDown}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"amount_vat5\" [label]=\"{text: _translate.CONTROLL.LABEL.amount_vat5}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: formatter.tien_thue, disabled: checkDisabledTotalPaymentInWord(),onKeyDown:keyDown}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"amount_vat10\" [label]=\"{text: _translate.CONTROLL.LABEL.amount_vat10}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: formatter.tien_thue, disabled: checkDisabledTotalPaymentInWord(),onKeyDown:keyDown}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"total_payment\" [label]=\"{text: _translate.CONTROLL.LABEL.amount_after_vat}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: formatter.tong_tien, onValueChanged: totalPaymentChange, disabled: checkDisabledTotalPaymentInWord(),onKeyDown:keyDown}\"></dxi-item>\r\n          </dxi-item>\r\n        </dx-form> -->\r\n        <div\r\n          *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY' && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY_THU_TIEN' && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n        ||(invoiceTemplateTT78 && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY' && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY_THU_TIEN' && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n          class=\"vat money-pull-right\">\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.on_currency_amount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.on_currency_amount\" tabIndex=\"-1\" format=\"0,###\" step=\"0\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount\" tabIndex=\"-1\" [format]=\"formatter.thanh_tien\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_amount_discount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_discount\" tabIndex=\"-1\" [format]=\"formatter.tien_chiet_khau\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat5}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat5\" [format]=\"formatter.tien_thue\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\" (onValueChanged)=\"onNumberChange()\"\r\n                (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat8}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat8\" [format]=\"formatter.tien_thue\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\" (onValueChanged)=\"onNumberChange()\"\r\n                (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat10}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat10\" [format]=\"formatter.tien_thue\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\" (onValueChanged)=\"onNumberChange()\"\r\n                (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat_other\" [format]=\"formatter.tien_thue\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\" (onValueChanged)=\"onNumberChange()\"\r\n                (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_DANG_KIEM') || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_DANG_KIEM'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.fees}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.registry_fee\" tabIndex=\"-1\" step=\"0\" (onKeyDown)=\"keyDown($event)\"\r\n                [format]=\"formatter.tong_tien\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_XANG_DAU') || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_XANG_DAU'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_fee\" tabIndex=\"-1\" step=\"0\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE')) || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertax}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_tax\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\"\r\n                [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE')) || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_charge\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\" [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div\r\n          *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\r\n        || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')))\"\r\n          class=\"vat money-pull-right\">\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.surcharge}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_charge\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" (onValueChanged)=\"onNumberTicketChange()\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY') || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [format]=\"formatter.tong_tien\" (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\"\r\n                [(value)]=\"frmData.total_other\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN') || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\" (onKeyDown)=\"keyDown($event)\"\r\n                [(value)]=\"frmData.other_fee\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.refund_fee}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.money_ticket_return\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" (onValueChanged)=\"onNumberTicketChange()\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_fare_after_tax}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_ticket_with_vat\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" [disabled]=\"checkDisabledTotalPaymentInWord()\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')))\"\r\n            class=\"dx-field\">\r\n            <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n            || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n              class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertax}}</div>\r\n            <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n            || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\"\r\n              class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertaxair}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_tax\" [format]=\"formatter.tong_tien\" (onKeyDown)=\"keyDown($event)\"\r\n                tabIndex=\"-1\" step=\"0\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')|| (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [format]=\"formatter.tong_tien\" (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\"\r\n                [(value)]=\"frmData.other_fee\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')|| (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_fare}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_ticket\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_other\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n      <div\r\n        *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\r\n      || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')))\"\r\n        class=\"col-md-12\" style=\"margin:10px 0 !important;\">\r\n        <h3 class=\"font-weight-bold\">{{ _translate.CONTROLL.LABEL.ticketing_service_fee}}</h3>\r\n        <div class=\"row\">\r\n          <div class=\"col-md-3 pr-0 money-pull-right\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 52%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.ticketing_service_charge}}\r\n              </div>\r\n              <div style=\"width: 48%\" class=\"dx-field-value\">\r\n                <dx-number-box [(value)]=\"frmData.money_service_ticket\" format=\"#,###\" tabIndex=\"-1\" step=\"0\"\r\n                  (onValueChanged)=\"onVatChange()\"></dx-number-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-3 pr-0 money-pull-right\" style=\"max-width: 23%\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 50%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.tax_GTGT}}</div>\r\n              <div style=\"width: 50%\" class=\"dx-field-value\">\r\n                <dx-select-box [(value)]=\"frmData.vat_service_ticket\" displayExpr=\"name\" valueExpr=\"code\" tabIndex=\"-1\"\r\n                  [items]=\"select.vats\" (onValueChanged)=\"onVatChange()\"></dx-select-box>\r\n\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-3 pr-0 money-pull-right\" style=\"max-width: 19%\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 50%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat}}</div>\r\n              <div style=\"width: 50%\" class=\"dx-field-value\">\r\n                <dx-number-box [(value)]=\"frmData.total_vat_service_ticket\" format=\"#,###\" tabIndex=\"-1\"\r\n                  [disabled]=\"checkDisabledTotalPaymentInWord()\" step=\"0\"></dx-number-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-4 \" style=\"max-width: 33%\">\r\n            <div class=\"prt-1 money-pull-right\">\r\n              <div class=\"dx-field\" style=\"width: 395px\">\r\n                <div style=\"width: 44.3%\" class=\"dx-field-label\">{{\r\n                  _translate.CONTROLL.LABEL.total_after_tax_service_charge}}</div>\r\n                <div style=\"width: 55.7%\" class=\"dx-field-value\">\r\n                  <dx-number-box [(value)]=\"frmData.total_service_ticket_with_vat\" format=\"#,###\" tabIndex=\"-1\" step=\"0\"\r\n                    [disabled]=\"checkDisabledTotalPaymentInWord()\" (onValueChanged)=\"onNumberTicketChange()\">\r\n                  </dx-number-box>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- Nghị định 92 -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_exemption_decree\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Đã giảm </p>\r\n          <dx-number-box [format]=\"formatter.tong_tien\" [(value)]=\"frmData.text_exemption_decree\"\r\n            [readOnly]=\"!frmData.auto_value\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> tương ứng 30% mức tỷ lệ để tính thuế giá trị gia tăng theo Nghị\r\n            quyết số 406/NQ-UBTVQH15</p>\r\n        </div>\r\n      </div>\r\n      <!-- Nghị định 43 -->\r\n      <!-- Tỷ lệ % doanh thu -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_resolution_43\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Tỷ lệ % trên doanh thu </p>\r\n\r\n          <div class=\"toggle normal\" style=\"display: flex; align-items: center; margin-top: -6px;\">\r\n            <img id=\"link14\" style=\"cursor: pointer;padding-left: 2px;padding-right: 7px\"\r\n              src=\"assets\\img\\icons\\Icon_Information.png\" (click)=\"guideSales()\" alt=\"efy.vn\" alt=\"Efy.vn\">\r\n          </div>\r\n          <dx-popover target=\"#link14\" position=\"top\" [width]=\"350\" [(visible)]=\"isDisplayGuideSale\">\r\n            <div *dxTemplate=\"let data of 'content'\">\r\n              <p>- 1% : Phân phối, cung cấp hàng hóa dịch vụ</p>\r\n              <p>- 5% : Dịch vụ xây dựng không bao thầu nguyên vật liệu</p>\r\n              <p>- 3% : Sản xuất, vận tải, dịch vụ có gắn với hàng hóa, xây dựng có bao thầu nguyên vật liệu</p>\r\n              <p>- 2% : Hoạt động kinh doanh khác</p>\r\n            </div>\r\n          </dx-popover>\r\n\r\n          <dx-number-box [width]=\"50\" [(value)]=\"frmData.sales_percentage\"\r\n            (onValueChanged)=\"onChangeSalePercen($event)\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> %</p>\r\n        </div>\r\n      </div>\r\n      <!-- Đã giảm 20% -->\r\n      <div class=\"col-md-7\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_resolution_43\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Đã giảm </p>\r\n          <dx-number-box [format]=\"formatter.tong_tien\" [(value)]=\"frmData.money_resolution_43\"\r\n            [readOnly]=\"!frmData.auto_value\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> {{ _translate.THONG_TIN.tinh_thue_nq101}}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-md-5\" style=\"margin-top: 10px\">\r\n        <div class=\"vat money-pull-right\">\r\n          <!-- Tổng tiền giảm trừ không chịu thuế -->\r\n          <div class=\"dx-field\" *ngIf=\"isHdGTGT\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_deduction_not_taxable}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_deduction_not_taxable\" [format]=\"formatter.tong_tien\"\r\n                tabIndex=\"-1\" step=\"0\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <!-- Tổng tiền giảm trừ khác -->\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.other_total_deduction}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_total_deduction\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\"\r\n                step=\"0\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_after_vat}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_payment\" [format]=\"formatter.tong_tien\"\r\n                [disabled]=\"checkDisabledTotalPaymentInWord()\" tabIndex=\"-1\" step=\"0\" (onKeyDown)=\"keyDown($event)\"\r\n                (onValueChanged)=\"totalPaymentChange($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-md-12\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item *ngIf=\"frmData.adjustment_form == 'THONG_TIN' && frmData.adjustment_object == 'TIEN_CHU'\"\r\n              cssClass=\"vat total-payment-in-word\" name=\"origin-invoice-number\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.amount_pre_adjusted}}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-text-box [(value)]=\"oldForm.total_payment_in_word\" readOnly=\"true\"></dx-text-box>\r\n              </div>\r\n            </dxi-item>\r\n            <dxi-item cssClass=\"vat total-payment-in-word\"\r\n              [label]=\"{text: _translate.CONTROLL.LABEL.total_payment_in_word}\" dataField=\"total_payment_in_word\"\r\n              [editorOptions]=\"{readOnly: checkDisabledTotalPaymentInWord(), onValueChanged: total_payment_in_wordChange}\">\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n    </div>\r\n    <div class=\"row button-action\" *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n      <div class=\"col-md-12\">\r\n        <div class=\"pull-left\">\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" (click)=\"preview()\" icon=\"{{_translate.ICONS.view}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.preview_invoice}}\" type=\"default\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"ttDaXuatHoaDon\" (click)=\"view()\" icon=\"{{_translate.ICONS.view}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.view_invoice}}\" type=\"default\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"ttDaXuatHoaDon\" (click)=\"inChuyenDoi()\" icon=\"{{_translate.ICONS.print}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.print_conversion}}\" type=\"default\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"isTuChoi\" (click)=\"xemlydotuchoi()\" [(icon)]=\"this._translate.ICONS.view\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.reason_reject}}\" type=\"default\"></dx-button>\r\n        </div>\r\n        <div class=\"pull-right\">\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon && !isAccessExportInv\" text=\"{{ _translate.CONTROLL.BUTTON.sign_approval}}\"\r\n            icon=\"assets\\img\\icons\\XuatFile.png\" (click)=\"eSubmit('TRINH_KY')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\"></dx-button>\r\n          <!-- <button type=\"button\" (click)=\"test()\">Test</button> -->\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" text=\"{{ _translate.CONTROLL.BUTTON.export_invoice}}\" appScrollToInvalid\r\n            icon=\"{{_translate.ICONS.export_inv}}\" (click)=\"eSubmit('XUAT')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" text=\"{{ _translate.CONTROLL.BUTTON.save_temporary}}\" appScrollToInvalid\r\n            icon=\"{{_translate.ICONS.save}}\" (click)=\"eSubmit('GHI_TAM')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\"></dx-button>\r\n          <dx-button appBackButton type=\"default\" icon=\"{{_translate.ICONS.come_back}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.close}}\"></dx-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"row button-action\" *ngIf=\"isPXKDaiLy || isPXKNB\">\r\n      <div class=\"col-md-12\">\r\n        <div class=\"pull-left\">\r\n          <!-- Xem trước PXK -->\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon\" (click)=\"preview()\" icon=\"assets\\img\\icons\\Xem.png\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.preview_internal_transport }}\" type=\"default\"></dx-button>\r\n          <!-- Xem PXK -->\r\n          <dx-button *ngIf=\"ttDaXuatHoaDon\" (click)=\"view()\" icon=\"assets\\img\\icons\\Xem.png\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.view_internal_transport }}\" type=\"default\"></dx-button>\r\n          <!-- In chuyển đổi PXK -->\r\n          <dx-button *ngIf=\"ttDaXuatHoaDon\" (click)=\"inChuyenDoi()\" [(icon)]=\"this._translate.ICONS.print\"\r\n            [text]=\"inChuyenDoiText()\" type=\"default\"></dx-button>\r\n        </div>\r\n        <div class=\"pull-right\">\r\n          <!-- Thủ kho xuất ký (đang chờ biến cấu hình để bắt ràng buộc nếu biến đó là true thì k hiện nút này)-->\r\n          <dx-button (click)=\"thukhoxuatky()\" *ngIf=\"isPXKNB && isShowThuKhoXuatKy\"\r\n            [(icon)]=\"this._translate.ICONS.pencil\" text=\"{{_translate.CONTROLL.BUTTON.warehouse_keeper_sign }}\"\r\n            type=\"default\"></dx-button>\r\n          <!-- Hủy lệnh điều động -->\r\n          <dx-button *ngIf=\"isShowKyLenhDieuDong && isShowHuyLenhDD && isPXKNB\" (click)=\"huylenhdieudong()\"\r\n            [(icon)]=\"this._translate.ICONS.delete\" text=\"{{_translate.CONTROLL.BUTTON.cancel_maneuver_command }}\"\r\n            type=\"default\"></dx-button>\r\n          <!-- Ký lệnh điều động -->\r\n          <dx-button *ngIf=\"isShowKyLenhDieuDong && isPXKNB\" (click)=\"submitlenhdieudong()\"\r\n            [(icon)]=\"this._translate.ICONS.pencil\" text=\"{{_translate.CONTROLL.BUTTON.sign_maneuver_command }}\"\r\n            type=\"default\"></dx-button>\r\n          <!-- Xuất phiếu xuất kho -->\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon && !showTraLai && !showKyDuyet && isAccessExportInv\" appScrollToInvalid\r\n            text=\"{{_translate.CONTROLL.BUTTON.export_internal_transport }}\" icon=\"assets\\img\\icons\\XuatHD.png\"\r\n            (click)=\"eSubmit('XUAT')\" type=\"default\" validationGroup=\"formData\" [useSubmitBehavior]=\"true\"></dx-button>\r\n          <!-- Ghi tạm -->\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon && !showTraLai && !showKyDuyet\" appScrollToInvalid\r\n            text=\"{{_translate.CONTROLL.BUTTON.save_temporary }}\" icon=\"assets\\img\\icons\\GhiTam.png\"\r\n            [disabled]=\"isDisable\" (click)=\"eSubmit('GHI_TAM')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\">\r\n          </dx-button>\r\n          <!-- Tạo mới -->\r\n          <dx-button *ngIf=\"!showTraLai && !showKyDuyet\" text=\"{{_translate.CONTROLL.BUTTON.create_new }}\"\r\n            icon=\"assets\\img\\icons\\LapHD.png\" (click)=\"handleAddNew()\" type=\"default\"></dx-button>\r\n          <!-- Trả lại -->\r\n          <!-- <dx-button *ngIf=\"showTraLai\" text=\"{{_translate.CONTROLL.BUTTON.return }}\"\r\n            icon=\"assets\\img\\icons\\XuatFile.png\" (click)=\"traLai()\" type=\"default\"></dx-button>\r\n          <dx-button *ngIf=\"!ttDaXuatHoaDon && showKyDuyet\" text=\"Ký duyệt\" icon=\"assets\\img\\icons\\XuatFile.png\"\r\n            (click)=\"eSubmit('XUAT')\" type=\"default\" validationGroup=\"formData\" [useSubmitBehavior]=\"true\"></dx-button> -->\r\n          <!-- Quay lại -->\r\n          <dx-button appBackButton type=\"default\" icon=\"assets\\img\\icons\\QuayLai.png\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.close }}\"></dx-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n</form>\r\n<ngx-spinner bdColor=\"rgba(51,51,51,0.8)\" size=\"medium\" color=\"#fff\" type=\"timer\">\r\n  <p style=\"font-size: 20px; color: white\">Loading...</p>\r\n</ngx-spinner>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.scss":
/*!*******************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.scss ***!
  \*******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".invoice-container{padding-top:15px}.after-table{margin-top:10px}::ng-deep .vat.total-payment-in-word{margin-top:15px}::ng-deep .vat.total-payment-in-word input{color:#000000;font-weight:bold;text-align:right}::ng-deep .vat.amount-table-footer input,::ng-deep .vat.amount-vat-table-footer input,::ng-deep .vat.amount-after-vat-table-footer input{font-weight:bold;text-align:right;color:#0034F5}::ng-deep .vat.money-pull-right input{text-align:right}::ng-deep .pr-0.money-pull-right input{text-align:right}::ng-deep .prt-1.money-pull-right input{text-align:right}.vat.money-pull-right .dx-field-label{width:45%}.vat.money-pull-right .dx-field-value{width:55% !important}.button-action{margin-top:18px}.table-footer{height:40px;background:#E3E3E3;padding-top:3px}.table-footer .table-footer-1{display:inline-block;width:109px;float:right}.table-footer .table-footer-2{display:inline-block;width:120px;margin-right:32px;float:right}.table-footer .table-footer-3{display:inline-block;width:150px;margin-right:90px;float:right}.table-footer .table-footer-4{display:inline-block;width:109px;margin-right:190px;float:right}#btn-chossen-hdck{margin-top:10px;margin-left:50%;margin-bottom:10px}.dx-field-value.dx-widget,.dx-field-value:not(.dx-widget)>.dx-widget{height:25px}::ng-deep .mauhoadon .modal-content{width:67%}::ng-deep .mauhoadon43 .modal-content{width:72%}::ng-deep .prv-s-invoice .modal-content{border:0px;border-radius:0px}::ng-deep .v-s-invoice{max-width:100%;margin:0px;height:100%}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.ts":
/*!*****************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.ts ***!
  \*****************************************************************************************************/
/*! exports provided: AdjustInvoiceComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustInvoiceComponent", function() { return AdjustInvoiceComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _adjust_product_grip_adjust_product_grip_component__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../adjust-product-grip/adjust-product-grip.component */ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.ts");
/* harmony import */ var _adjust_form_invoice_adjust_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../adjust-form-invoice/adjust-form-invoice.component */ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @modules/handle-invoice/shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! devextreme/data/array_store */ "./node_modules/devextreme/data/array_store.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @core/library/invoice/invoices.service */ "./src/app/core/library/invoice/invoices.service.ts");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! typescript-string-operations */ "./node_modules/typescript-string-operations/dist/index.min.js");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(typescript_string_operations__WEBPACK_IMPORTED_MODULE_14__);
/* harmony import */ var _modules_handle_invoice_components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @modules/handle-invoice/components/send-invoices/send-invoices.component */ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.ts");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_17___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_17__);
/* harmony import */ var _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @shared/service/confirm.service */ "./src/app/shared/service/confirm.service.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var ngx_spinner__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ngx-spinner */ "./node_modules/ngx-spinner/fesm5/ngx-spinner.js");
/* harmony import */ var _modules_configs_shared__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @modules/configs/shared */ "./src/app/modules/configs/shared/index.ts");
/* harmony import */ var _shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @shared/components/preview-invoice/preview-invoice.component */ "./src/app/shared/components/preview-invoice/preview-invoice.component.ts");
/* harmony import */ var _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @core/library/invoice/my-bsmodel.service */ "./src/app/core/library/invoice/my-bsmodel.service.ts");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};

























var AdjustInvoiceComponent = /** @class */ (function () {
    function AdjustInvoiceComponent(route, modalService, vatService, handleInvoiceService, socketService, authService, cdRef, translate, router, confirmService, spinner, configsService, customeModalService, vPreviewInvService) {
        var _this = this;
        this.route = route;
        this.modalService = modalService;
        this.vatService = vatService;
        this.handleInvoiceService = handleInvoiceService;
        this.socketService = socketService;
        this.authService = authService;
        this.cdRef = cdRef;
        this.translate = translate;
        this.router = router;
        this.confirmService = confirmService;
        this.spinner = spinner;
        this.configsService = configsService;
        this.customeModalService = customeModalService;
        this.vPreviewInvService = vPreviewInvService;
        this.frmTraLai = {
            reason: ""
        };
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["InvoiceModel"](5);
        this.showKyDuyet = false;
        this.showTraLai = false;
        this.isCheckLenhDieuDong = false;
        this.isDisable = false;
        this.ttDaXuatHoaDon = false; // Trạng thái đã xuất hóa đơn hay chưa
        this.formatter = {};
        this.select = {};
        this._objTemplateSelect = {};
        this.formatNumber = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].numberInvoiceFormatDev;
        this.tempKiFile = 0;
        this.extentionGrid = {};
        this.confirmCheckPreview = false;
        this.isTuChoi = false;
        this.isAccessExportInv = false;
        this.isRoleThuKhoXuatKy = false;
        // danh sách data trong file
        this.fileData = [];
        this.isHdGTGT = true;
        this.isShowButtonWaiteSign = true;
        this._oTemplateTT78 = {};
        this.isTT78 = false;
        this.isPassNQ43 = false;
        this.isPXKDaiLy = false;
        this.isPXKNB = false;
        this.isShowHuyLenhDD = false;
        this.isDisplayGuideSale = false;
        this.invoices = [];
        this.total_payment_in_wordChange = function (e) {
            if (_this.frmData.adjustment_form === 'THONG_TIN' && _this.frmData.adjustment_object === 'TIEN_CHU') {
                var invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(_this.oldForm.invoice_date).format('DD/MM/YYYY');
                _this.dataSource.items()[0].product_name = "\u0110i\u1EC1u ch\u1EC9nh d\u00F2ng s\u1ED1 ti\u1EC1n b\u1EB1ng ch\u1EEF c\u1EE7a h\u00F3a \u0111\u01A1n s\u1ED1 " + _this.oldForm.invoice_number + ", k\u00FD hi\u1EC7u " + _this.oldForm.invoice_series + " ng\u00E0y " + invoice_date + " t\u1EEB: " + _this.oldForm.total_payment_in_word + " th\u00E0nh " + e.value;
                _this.productGrip.dataGrid.instance.refresh();
            }
        };
        // sự kiện form
        this.totalPaymentChange = function (e) {
            // this.onNumberChange();
            var currency_code = _this.frmData.currency_code;
            if (_this.configs.system_parameter.view_price_nte) {
                currency_code = 'VND';
            }
            _this.doctienbangchu(e.value, currency_code);
            // this.frmData.total_payment_in_word = Helper.tienBangChu(e.value, VChanggeMoneyService.getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
        this.configs = this.authService.getConfigs();
    }
    AdjustInvoiceComponent.prototype.ngAfterViewInit = function () {
        if (this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.DaXuat) {
            this.disablleScreen();
            this.cdRef.detectChanges();
        }
        this.setDataSessionStorage(this.frmData);
    };
    AdjustInvoiceComponent.prototype.disablleScreen = function () {
        this.formInvoice.readonlyAllForm();
        this.productGrip.ttDaXuatHoaDon = true;
        this.ttDaXuatHoaDon = true;
    };
    AdjustInvoiceComponent.prototype.routeReport = function () {
        if (this.dataInvoice.origin_id !== null) {
            if (this.dataInvoice.status === 'GHI_TAM') {
                this.router.navigate(['/system/handle-report/create-report/', this.dataInvoice.origin_id, 'DIEU_CHINH']);
            }
            else {
                this.router.navigate(['/system/handle-report/create-report/', this.dataInvoice.id, 'DIEU_CHINH']);
            }
        }
        else {
            this.router.navigate(['/system/handle-report/create-report/', this.dataInvoice.id, 'DIEU_CHINH']);
        }
    };
    AdjustInvoiceComponent.prototype.xuLiApiKhiXuat = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var status;
        if (!this.frmData.id && !this.frmData.invoice_number) {
            status = 'THEM_MOI';
        }
        if (this.frmData.id && !this.frmData.invoice_number) {
            status = 'GHI_TAM';
        }
        if (this.frmData.id && this.frmData.invoice_number) {
            status = 'GIU_SO';
        }
        var xmlInvoice = "";
        var isNewXml = 0;
        if (status === 'THEM_MOI') {
            if (!this.isTT78) {
                var sub_1 = this.vatService.ghiTam(this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        _this.frmData.id = rs.data.id;
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_1.unsubscribe();
                });
            }
            else {
                var sub_2 = this.vatService.ghiTamTT78(this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        _this.frmData.id = rs.data.id;
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_2.unsubscribe();
                });
            }
        }
        else if (status === 'GHI_TAM') {
            if (!this.isTT78) {
                var sub_3 = this.vatService.edit(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_3.unsubscribe();
                });
            }
            else {
                var sub_4 = this.vatService.editTT78(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_4.unsubscribe();
                });
            }
        }
        else if (status === 'GIU_SO') {
            if (!this.isTT78) {
                var sub_5 = this.vatService.edit(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_5.unsubscribe();
                });
            }
            else {
                var sub_6 = this.vatService.editTT78(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_6.unsubscribe();
                });
            }
        }
    };
    AdjustInvoiceComponent.prototype.xuLyKiFile = function (xmlInvoice, signDate) {
        var _this = this;
        if (this.isTT78) {
            var ListSerialNumber = "DSCKS";
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
            }
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate, 'InvoiceData', ListSerialNumber, true);
        }
        else
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate);
    };
    AdjustInvoiceComponent.prototype.goiApiXuatHoaDon = function (xml_string) {
        var _this = this;
        // Helper.dowloadFile('hoadon.xml', 'xml', xml_string);
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        }, 20);
        var sub = this.vatService.xuatHoaDon({
            id: this.frmData.id,
            xml_string: xml_string,
            invoice_files: this.frmData.invoice_files
        }).subscribe(function (rs) {
            if (rs.status === 'success') {
                _this.isExportInvoice = true;
                _this.disablleScreen();
                _this.isShowButtonWaiteSign = false;
                _this.fileData = _this.frmData.invoice_files;
                _this.setDataSessionStorage(_this.frmData);
                if (_this.isRoleThuKhoXuatKy && !_this.frmData.warehouse_keeper_signed)
                    _this.isShowThuKhoXuatKy = true;
                if (_this.configs.system_parameter.enable_send_wrong_process && _this.isTT78) {
                    if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                        || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing))
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
                    else
                        _this.startProcess_TBSaiSot();
                }
                else
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    AdjustInvoiceComponent.prototype.ngOnInit = function () {
        var _this = this;
        // kết nối websocket
        this.connectWebsocket();
        var currentUsers = this.authService.getCurrentUser();
        var listpermission = currentUsers.user.permissions.split(',');
        var oThuKhoXuat = listpermission.filter(function (p) { return p == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].permissions.ThuKhoXuatKy; });
        if (oThuKhoXuat.length > 0)
            this.isRoleThuKhoXuatKy = true;
        else
            this.isRoleThuKhoXuatKy = false;
        this.loaiHoaDon = this.route.snapshot.data.type;
        if (this.loaiHoaDon == '03XKNB')
            this.isPXKNB = true;
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].loaihoadon.HGDL04)
            this.isPXKDaiLy = true;
        var isViewTT32 = false;
        if (this.route.snapshot.queryParams['status'] === 'viewInvTT32') {
            isViewTT32 = true;
        }
        this.routeSub = this.route.data.subscribe(function (data) {
            if (data.init[4].length > 0) {
                _this.textReport = _this._translate.CONTROLL.BUTTON.view_report;
            }
            else {
                _this.textReport = _this._translate.CONTROLL.BUTTON.create_report;
            }
            _this.configs = _this.authService.getConfigs();
            _this.infoDangKy = _this.authService.getInfoRegister();
            _this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(_this.configs.decimal_places_json);
            _this.formatter.display_int = _this.configs.system_parameter.display_int;
            // put data DM for select
            _this.select.unit_codes = data.init[1].DM_DON_VI_TINH;
            _this.select.select_provisions_on_accounts = data.init[1].DM_DINH_KHOAN;
            _this.select.payment_method_names = data.init[1].DM_HINH_THUC_THANH_TOAN;
            _this.select.vats = data.init[1].DM_TY_LE_VAT;
            _this.frmData.total_payment_in_word = null;
            if (_this.infoDangKy) {
                if (_this.infoDangKy.status == "CHAP_NHAN")
                    _this.isTT78 = true;
            }
            if (_this.isTT78 == true && isViewTT32)
                _this.isTT78 = false;
            if (_this.isTT78) {
                var temptTT78 = [];
                temptTT78 = data.init[0];
                if (temptTT78 && temptTT78.length > 0) {
                    _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.infoDangKy.is_invoice_with_code; });
                    if (data.init[3] && Number.parseInt(data.init[3].invoice_number) > 0) {
                        if (data.init[3].is_invoice_with_code != _this.infoDangKy.is_invoice_with_code && data.init[3].xml_type != '1') {
                            _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == data.init[3].is_invoice_with_code; });
                        }
                    }
                }
            }
            else {
                _this.select.invoice_releases = data.init[0];
            }
            if (data.status === 'dieuchinhmoi') {
                _this.khoiTaoKhiThemMoi(data.init[3]);
                _this.oldForm = data.init[3];
                _this.wavehourses = data.init[6];
            }
            else {
                _this.khoiTaoKhiSua(data.init[3]);
                _this.oldForm = data.init[3].origin;
                _this.wavehourses = data.init[6];
            }
            if (data.init[4].length > 0 && _this.isTT78) {
                var oReport = data.init[4][data.init[4].length - 1];
                if (oReport)
                    _this.frmData.destroy_reason = oReport.adjustment_reason;
            }
            if (_this.oldForm.template_code.indexOf('02GTTT') >= 0 || _this.oldForm.template_code == "2" || _this.oldForm.template_code.indexOf('07KPTQ') >= 0) {
                _this.isHdGTGT = false;
            }
            _this.dataInvoice = data.init[3];
        });
        if (!this.isTT78) {
            this.select.invoice_releases.some(function (item) {
                if (item.value === _this.oldForm.invoice_release_id) {
                    _this._objTemplateSelect = item;
                    return true;
                }
            });
        }
        else {
            this.select.templatesTT78.some(function (item) {
                if (item.value === _this.oldForm.template_id) {
                    _this.invoiceTemplateTT78 = item;
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            _this._oTemplateTT78[key] = item[key];
                        }
                    }
                    return true;
                }
            });
        }
        var currentUser = this.authService.getCurrentUser();
        if (currentUser && currentUser.account && (currentUser.account.tax_code == "0102519041-999" || currentUser.account.tax_code == "8888888803" || currentUser.account.tax_code == "9999999671"))
            this.isPassNQ43 = true;
        var listpermissions = currentUser.user.permissions.split(',');
        var _obj = listpermissions.filter(function (p) { return p === 'phe_duyet'; });
        if (_obj.length > 0) {
            this.isAccessExportInv = true;
        }
        else {
            this.isAccessExportInv = false;
        }
    };
    AdjustInvoiceComponent.prototype.connectWebsocket = function () {
        var _this = this;
        this.ioSignature = this.socketService.lapHoaDon().subscribe(function (message) {
            var data = message;
            if (data.SvcName === 'efy_Sign') {
                if (data.Data.Name === 'hoadon.xml') {
                    if (_this.ttDaXuatHoaDon)
                        _this.sendData_TBSaiSot(data.Data.Content);
                    else
                        _this.goiApiXuatHoaDon(data.Data.Content);
                }
                else if (data.Data.Name === 'ten_filek_the_trung-dc-nhi.xml') {
                    if (_this.ttDaXuatHoaDon)
                        _this.getXml_TBSaiSot();
                    else {
                        _this.frmData.issuer_name = data.Data.IssuerName;
                        _this.xuLiApiKhiXuat();
                    }
                }
                else {
                    _this.frmData.invoice_files.forEach(function (item) {
                        if (item.file_name === data.Data.Name) {
                            item.file_content = data.Data.Content;
                        }
                    });
                    _this.tempKiFile++;
                    if (_this.tempKiFile === _this.frmData.invoice_files.length) {
                        _this.xuLiApiKhiXuat();
                    }
                }
            }
        });
    };
    AdjustInvoiceComponent.prototype.khoiTaoKhiThemMoi = function (data) {
        var _this = this;
        // khởi tạo mới lưới
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: 'id',
            data: this.frmData.invoice_products_data()
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        this.invoice_products_old = data.invoice_products;
        this.invoice_old = data;
        // tạo mới đối tượng file
        this.fileData = [];
        // khởi tạo dữ liệu form điều chỉnh
        this.frmData.fillFormDieuChinh(data);
        if (this.frmData.vat_service_ticket != null) {
            this.frmData.vat_service_ticket = this.frmData.vat_service_ticket.toString();
        }
        if (!this.isTT78) {
            this.select.invoice_releases = this.select.invoice_releases.filter(function (p) { return p.number_survival > 0; });
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id == _this.frmData.template_id) {
                    _this.invoicereleaseTempt = item;
                }
            });
        }
        else {
            if (this.select.templatesTT78.length) {
                this.select.templatesTT78.forEach(function (item) {
                    if (item.value === _this.frmData.template_id) {
                        _this.invoiceTemplateTT78 = item;
                    }
                });
            }
        }
    };
    AdjustInvoiceComponent.prototype.checkDisabledTotalPaymentInWord = function () {
        if ((this.frmData.adjustment_form == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].adjustmentForm.thong_tin && this.frmData.adjustment_object == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].adjustmentForm.tien_chu) || this.frmData.adjustment_form == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].adjustmentForm.khac || this.frmData.auto_value) {
            return false;
        }
        return true;
    };
    AdjustInvoiceComponent.prototype.khoiTaoKhiSua = function (data) {
        var _this = this;
        // khởi tạo lưới từ dữ liệu sửa
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: 'id',
            data: this.frmData.setInvoice_products_data(data.invoice_products)
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        // khởi tạo dữ liệu form
        this.frmData.fillFormData(data);
        this.frmData.adjustment_type = 5;
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.approve_status) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.TuChoi) {
            this.isTuChoi = true;
        }
        if (this.frmData.vat_service_ticket != null) {
            this.frmData.vat_service_ticket = this.frmData.vat_service_ticket.toString();
        }
        if (!this.isTT78) {
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id == _this.frmData.template_id) {
                    _this.invoicereleaseTempt = item;
                }
            });
        }
        else {
            this.select.templatesTT78.forEach(function (item) {
                if (item.value === _this.frmData.template_id) {
                    _this.invoiceTemplateTT78 = item;
                }
            });
        }
        // lấy file
        // this.fileData = [];
        this.fileData = data.invoice_files;
        // this.fileData = data.invoice_files;
        // cấu hình thập phân thêm mới
        this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(JSON.parse(data.decimal_places_json));
        // co cho sua luoi hang hoa ko
        var temp = this.frmData.adjustment_form + '_' + this.frmData.adjustment_object;
        if (temp === 'THONG_TIN_MST' || temp === 'THONG_TIN_KH_DC' || temp === 'THONG_TIN_TIEN_CHU') {
            this.productGrip.gripAllowEdit = false;
        }
        else {
            this.productGrip.gripAllowEdit = true;
        }
        if (temp === 'TANG_HH_DV' || temp === 'GIAM_HH_DV') {
            this.setContentProductNameV2('', 'select');
        }
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.adjustment_object) == "TANG_GIAM" && !this.isTT78) {
            this.productGrip.ShowAndHidePhuongThucDC(true);
            this.productGrip.gripAllowEdit = true;
        }
        var ts = this.frmData.buyer_address;
        if (this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.DaXuat || this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.ChoKy)
            this.isShowButtonWaiteSign = false;
    };
    /** Tương tác giữa các component */
    AdjustInvoiceComponent.prototype.getDataInChildForm = function (e) {
        this.frmData = e;
        if (this.frmData.adjustment_form === 'THONG_TIN' && this.frmData.adjustment_object === 'MST') {
            this.dataSource.items()[0].product_name = "\u0110i\u1EC1u ch\u1EC9nh m\u00E3 s\u1ED1 thu\u1EBF C\u00F4ng ty/\u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.buyer_tax_code + " th\u00E0nh " + this.frmData.buyer_tax_code;
            this.productGrip.dataGrid.instance.refresh();
        }
        else if (this.frmData.adjustment_form === 'THONG_TIN' && this.frmData.adjustment_object === 'KH_DC') {
            if (this.oldForm.customer_name !== this.frmData.customer_name && this.oldForm.buyer_address === this.frmData.buyer_address) {
                this.dataSource.items()[0].product_name = "\u0110i\u1EC1u ch\u1EC9nh t\u00EAn \u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.customer_name + " th\u00E0nh " + this.frmData.customer_name;
            }
            else if (this.oldForm.customer_name === this.frmData.customer_name && this.oldForm.buyer_address !== this.frmData.buyer_address) {
                this.dataSource.items()[0].product_name = "\u0110i\u1EC1u ch\u1EC9nh \u0111\u1ECBa ch\u1EC9 c\u1EE7a \u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.buyer_address + " th\u00E0nh " + this.frmData.buyer_address;
            }
            else if (this.oldForm.customer_name === this.frmData.customer_name && this.oldForm.buyer_address === this.frmData.buyer_address) {
                this.dataSource.items()[0].product_name = '';
            }
            else {
                this.dataSource.items()[0].product_name = "\u0110i\u1EC1u ch\u1EC9nh t\u00EAn \u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.customer_name + " th\u00E0nh " + this.frmData.customer_name + "\n\u0110i\u1EC1u ch\u1EC9nh \u0111\u1ECBa ch\u1EC9 c\u1EE7a \u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.buyer_address + " th\u00E0nh " + this.frmData.buyer_address;
            }
            this.productGrip.dataGrid.instance.refresh();
        }
    };
    AdjustInvoiceComponent.prototype.updateSomeTotalInput = function (e) {
        // this.dataSource = e[0];
        // this.invoice_products = e[1];
        // this.formatter = e[2];
        // let
        //   amount = null, total_amount_vat = null, amount_after_vat = null, total_amount_product_vat0 = null, amount_vat5 = null, amount_vat10 = null,
        //   total_amount_product_vat5 = null, total_amount_product_vat10 = null, total_amount_product_vatx = null;
        // let decimal_amount_after_vat = VChanggeMoneyService.getFormatterToNumber(this.formatter.tong_tien);
        // let decimal_amount = VChanggeMoneyService.getFormatterToNumber(this.formatter.thanh_tien);
        // let decimal_amount_vat = VChanggeMoneyService.getFormatterToNumber(this.formatter.tien_thue);
        // this.dataSource.items().forEach(item => {
        //   item.amount = (item.amount !== null) ? this.roundNumber(item.amount, decimal_amount) : null;
        //   item.amount_vat = (item.amount_vat !== null) ? this.roundNumber(item.amount_vat, decimal_amount_vat) : null;
        //   item.amount_after_vat = (item.amount_after_vat !== null) ? this.roundNumber(item.amount_after_vat, decimal_amount_after_vat) : null;
        //   if (item.amount !== null) amount += item.amount;
        //   if (item.amount_vat !== null) total_amount_vat += item.amount_vat;
        //   if (item.amount_after_vat !== null) amount_after_vat += item.amount_after_vat;
        //   if (item.vat == 5) amount_vat5 += item.amount_vat;
        //   if (item.vat == 10) amount_vat10 += item.amount_vat;
        //   if (item.vat == -1) total_amount_product_vatx += item.amount;
        //   if (item.vat == 0 && item.vat != "") total_amount_product_vat0 += item.amount;
        //   if (item.vat == 5) total_amount_product_vat5 += item.amount;
        //   if (item.vat == 10) total_amount_product_vat10 += item.amount;
        // });
        // //set value
        // this.frmData.amount = this.roundNumber(amount, decimal_amount);
        // this.frmData.total_amount_vat = this.roundNumber(total_amount_vat, decimal_amount_vat);
        // this.frmData.amount_after_vat = this.roundNumber(amount_after_vat, decimal_amount_after_vat);
        // this.frmData.amount_vat5 = this.roundNumber(amount_vat5, decimal_amount_vat);
        // this.frmData.amount_vat10 = this.roundNumber(amount_vat10, decimal_amount_vat);
        // this.frmData.total_amount_product_vatx = this.roundNumber(total_amount_product_vatx, decimal_amount);
        // this.frmData.total_amount_product_vat0 = this.roundNumber(total_amount_product_vat0, decimal_amount);
        // this.frmData.total_amount_product_vat5 = this.roundNumber(total_amount_product_vat5, decimal_amount);
        // this.frmData.total_amount_product_vat10 = this.roundNumber(total_amount_product_vat10, decimal_amount);
        // this.frmData.total_payment = this.roundNumber(this.frmData.amount_after_vat, decimal_amount_after_vat);
    };
    AdjustInvoiceComponent.prototype.fillAutoInput = function (e) {
        this.frmData.auto_value = e;
    };
    // Lấy data khi chọn file đính kèm bảng kê
    AdjustInvoiceComponent.prototype.getFileData = function (fileData) {
        this.fileData = fileData;
    };
    AdjustInvoiceComponent.prototype.adjustmentObjectChange = function (v) {
        var _this = this;
        this.doctienbangchu(this.frmData.total_payment, this.frmData.currency_code);
        var _noiDungDC = '';
        var isDC = false;
        switch (v) {
            case 'TANG_HH_DV':
                this.setContentProductNameV2('', 'select');
                this.productGrip.gripAllowEdit = true;
                this.productGrip.ShowAndHidePhuongThucDC(false, 'TANG_HH_DV');
                break;
            case 'TANG_KHAC_TANG':
                this.setContentProductName('', 'text');
                this.productGrip.gripAllowEdit = true;
                this.productGrip.ShowAndHidePhuongThucDC(false);
                break;
            case 'GIAM_HH_DV':
                this.setContentProductNameV2('', 'select');
                this.productGrip.gripAllowEdit = true;
                this.productGrip.ShowAndHidePhuongThucDC(false, 'GIAM_HH_DV');
                break;
            case 'GIAM_KHAC_GIAM':
                this.setContentProductName('', 'text');
                this.productGrip.gripAllowEdit = true;
                this.productGrip.ShowAndHidePhuongThucDC(false);
                break;
            case 'THONG_TIN_MST':
                isDC = true;
                if (this.frmData.buyer_tax_code && this.oldForm.buyer_tax_code !== this.frmData.buyer_tax_code) {
                    _noiDungDC = "\u0110i\u1EC1u ch\u1EC9nh m\u00E3 s\u1ED1 thu\u1EBF C\u00F4ng ty/\u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.buyer_tax_code + " th\u00E0nh " + this.frmData.buyer_tax_code;
                }
                break;
            case 'THONG_TIN_KH_DC':
                isDC = true;
                if (this.frmData.customer_name && this.oldForm.customer_name !== this.frmData.customer_name) {
                    _noiDungDC = "\u0110i\u1EC1u ch\u1EC9nh t\u00EAn \u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.customer_name + " th\u00E0nh " + this.frmData.customer_name;
                }
                if (this.frmData.buyer_name && this.oldForm.buyer_name !== this.frmData.buyer_name) {
                    if (_noiDungDC) {
                        _noiDungDC += '\n';
                    }
                    _noiDungDC += "\u0110i\u1EC1u ch\u1EC9nh t\u00EAn ng\u01B0\u1EDDi mua t\u1EEB " + this.oldForm.buyer_name + " th\u00E0nh " + this.frmData.buyer_name;
                }
                if (this.frmData.buyer_address && this.oldForm.buyer_address !== this.frmData.buyer_address) {
                    if (_noiDungDC) {
                        _noiDungDC += '\n';
                    }
                    _noiDungDC += "\u0110i\u1EC1u ch\u1EC9nh \u0111\u1ECBa ch\u1EC9 c\u1EE7a \u0111\u01A1n v\u1ECB mua h\u00E0ng t\u1EEB " + this.oldForm.buyer_address + " th\u00E0nh " + this.frmData.buyer_address;
                }
                break;
            case 'THONG_TIN_TIEN_CHU':
                isDC = true;
                if (this.frmData.total_payment_in_word && this.oldForm.total_payment_in_word !== this.frmData.total_payment_in_word) {
                    var invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(this.oldForm.invoice_date).format('DD/MM/YYYY');
                    _noiDungDC = "\u0110i\u1EC1u ch\u1EC9nh d\u00F2ng s\u1ED1 ti\u1EC1n b\u1EB1ng ch\u1EEF c\u1EE7a h\u00F3a \u0111\u01A1n s\u1ED1 " + this.oldForm.invoice_number + ", k\u00FD hi\u1EC7u " + this.oldForm.invoice_series + " ng\u00E0y " + invoice_date + " t\u1EEB: " + this.oldForm.total_payment_in_word + " th\u00E0nh " + this.frmData.total_payment_in_word;
                }
                break;
            case 'KHAC_KHAC':
                setTimeout(function () {
                    _this.productGrip.changeColumnProductNameToText();
                }, 100);
                this.productGrip.ShowAndHidePhuongThucDC(false);
                this.productGrip.gripAllowEdit = true;
                break;
            case 'TANG_GIAM':
                this.setContentProductName('', 'text');
                if (!this.isTT78)
                    this.productGrip.ShowAndHidePhuongThucDC(true);
                else
                    this.productGrip.ShowAndHidePhuongThucDC(false);
                this.productGrip.gripAllowEdit = true;
                break;
            default:
                break;
        }
        if (isDC) {
            this.setContentProductName(_noiDungDC, 'text');
            this.productGrip.gripAllowEdit = false;
            this.productGrip.ShowAndHidePhuongThucDC(false);
        }
    };
    AdjustInvoiceComponent.prototype.setContentProductName = function (value, type) {
        var _this = this;
        setTimeout(function () {
            if (_this.productGrip.dataSource.items()[0]) {
                if (!_this.configs.system_parameter.is_add_product_code) {
                    _this.productGrip.dataSource.items()[0].product_name = value;
                }
            }
            if (type === 'text') {
                _this.productGrip.changeColumnProductNameToText();
            }
            else if (type === 'select') {
                _this.productGrip.changeColumnProductNameToSelect();
            }
        }, 100);
    };
    AdjustInvoiceComponent.prototype.setContentProductNameV2 = function (value, type) {
        var _this = this;
        setTimeout(function () {
            if (type === 'text') {
                _this.productGrip.changeColumnProductNameToText();
            }
            else if (type === 'select') {
                _this.productGrip.changeColumnProductNameToSelect();
            }
        }, 100);
    };
    /** Kết thúc */
    AdjustInvoiceComponent.prototype.roundNumber = function (number, n) {
        if (number == null) {
            return number;
        }
        else {
            var p = Math.pow(10, n);
            return Math.round(number * p) / p;
        }
    };
    AdjustInvoiceComponent.prototype.formatDecimalColumn = function (number) {
        if (number === 0) {
            return '0,###';
        }
        else {
            return '0,###.' + '0'.repeat(number);
        }
    };
    // Các hàm chức năng chính
    AdjustInvoiceComponent.prototype.getDataPreview = function () {
        var _this = this;
        var formatter = {};
        formatter = this.configs.system_parameter.decpoint_is_dot ? { decimal: '.', thousands: ',' } : { decimal: ',', thousands: '.' };
        var data = JSON.parse(JSON.stringify(this.frmData));
        var decimal_quatity = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.so_luong);
        var decimal_price = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.don_gia);
        var decimal_amount = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.thanh_tien);
        var decimal_amount_vat = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tien_thue);
        var decimal_amount_after_vat = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien);
        // let decimal_amount =  VChanggeMoneyService.getFormatterToNumber(this.formatter.thanh_tien);
        var total_amount_product_with_vatx = null, total_amount_product_with_vat0 = null, total_amount_product_with_vat5 = null, total_amount_product_with_vat10 = null, amount_vat0 = null;
        data.invoice_products.forEach(function (item) {
            if (item.vat === -1) {
                total_amount_product_with_vatx += item.amount_after_vat;
            }
            if (item.vat === 0) {
                total_amount_product_with_vat0 += item.amount_after_vat;
            }
            if (item.vat === 0) {
                amount_vat0 += item.amount_vat;
            }
            if (item.vat === 5) {
                total_amount_product_with_vat5 += item.amount_after_vat;
            }
            if (item.vat === 10) {
                total_amount_product_with_vat10 += item.amount_after_vat;
            }
            item['unit_name'] = '';
            _this.select.unit_codes.forEach(function (unit) {
                item.discount = '';
                item.total_discount = '';
                if (unit.code === item.unit_code) {
                    item['unit_name'] = unit.name;
                }
            });
            item.amount = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(item.amount, decimal_amount, formatter);
            item.price = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(item.price, decimal_price, formatter);
            item.quantity = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(item.quantity, decimal_quatity, formatter);
            item.amount_vat = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(item.amount_vat, 0, formatter);
            item.amount_after_vat = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(item.amount_after_vat, decimal_amount_after_vat, formatter);
        });
        data.total_amount_product_with_vatx = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(total_amount_product_with_vatx, decimal_amount_after_vat, formatter);
        data.total_amount_product_with_vat0 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(total_amount_product_with_vat0, decimal_amount_after_vat, formatter);
        data.total_amount_product_with_vat5 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(total_amount_product_with_vat5, decimal_amount_after_vat, formatter);
        data.total_amount_product_with_vat10 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(total_amount_product_with_vat10, decimal_amount_after_vat, formatter);
        data.amount_vat0 = amount_vat0;
        data.total_amount_product_vatx = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.total_amount_product_vatx, decimal_amount, formatter);
        data.total_amount_product_vat0 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.total_amount_product_vat0, decimal_amount, formatter);
        data.total_amount_product_vat5 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.total_amount_product_vat5, decimal_amount, formatter);
        data.total_amount_product_vat10 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.total_amount_product_vat10, decimal_amount, formatter);
        data.amount_vat5 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.amount_vat5, decimal_amount_vat, formatter);
        data.amount_vat10 = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.amount_vat10, decimal_amount_vat, formatter);
        data.amount = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.amount, decimal_amount, formatter);
        data.total_amount_vat = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.total_amount_vat, decimal_amount_vat, formatter);
        data.total_payment = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].formatMoney(data.total_payment, decimal_amount_after_vat, formatter);
        return data;
    };
    AdjustInvoiceComponent.prototype.preview = function () {
        var _this = this;
        setTimeout(function () {
            _this.handleFormData();
            if (!_this._validForm(true)) {
                return;
            }
            var data = _this.vatService.taodulieuXemTruocMau(_this.frmData);
            data['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].cauhinhxemmau.hoadon;
            _this.vPreviewInvService.xemMau(data);
        }, 300);
    };
    AdjustInvoiceComponent.prototype.view = function () {
        var ids = [];
        ids.push(this.frmData.id);
        var data = this.vatService.taodulieuXemMau(ids);
        data['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].cauhinhxemmau.hoadon;
        this.vPreviewInvService.xemMau(data);
    };
    AdjustInvoiceComponent.prototype.inChuyenDoi = function () {
        var ids = [];
        ids.push(this.frmData.id);
        var data = this.vatService.taodulieuInChuyenDoi(ids);
        data['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].cauhinhxemmau.hoadon;
        this.vPreviewInvService.xemMau(data);
    };
    AdjustInvoiceComponent.prototype.ghiTam = function (data) {
        var _this = this;
        this.isDisable = true;
        if (this.frmData.id) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_7 = this.vatService.edit(this.frmData.id, data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        }
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_7.unsubscribe();
                });
            }
            else {
                var sub_8 = this.vatService.editTT78(this.frmData.id, data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        }
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_8.unsubscribe();
                });
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_9 = this.vatService.ghiTam(data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_9.unsubscribe();
                });
            }
            else {
                var sub_10 = this.vatService.ghiTamTT78(data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _this.frmData.id = rs.data.id;
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_19__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_10.unsubscribe();
                });
            }
        }
    };
    AdjustInvoiceComponent.prototype.xuatChoKy = function (data) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        if (!this.isTT78) {
            var sub_11 = this.vatService.xuatChoKy(data).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.isShowButtonWaiteSign = false;
                    _this.frmData.id = rs.data.id;
                    _this.frmData.invoice_number = rs.data.invoice_number;
                    _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_wait_sign_success, 'success');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_11.unsubscribe();
            });
        }
        else {
            var sub_12 = this.vatService.xuatChoKyTT78(data).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.isShowButtonWaiteSign = false;
                    _this.frmData.id = rs.data.id;
                    _this.frmData.invoice_number = rs.data.invoice_number;
                    _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_wait_sign_success, 'success');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_12.unsubscribe();
            });
        }
    };
    AdjustInvoiceComponent.prototype.xuatHoaDon = function (data) {
        var _this = this;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.xuLiApiKhiXuat();
        }
        else {
            if (this.frmData.invoice_files.length) {
                this.frmData.invoice_files.forEach(function (item) {
                    _this.socketService.kiFile(function () { return _this.connectWebsocket(); }, item.file_content, item.file_name, item.file_name.split('.').pop(), true, _this.frmData.invoice_date);
                });
            }
            else {
                if (this.isTT78) {
                    var ListSerialNumber = "DSCKS";
                    if (this.infoDangKy && this.infoDangKy.registration_signature) {
                        var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                        if (signatures && signatures.length > 0)
                            ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                    }
                    var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
                }
                else
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
            }
        }
    };
    AdjustInvoiceComponent.prototype._validForm = function (isOnlyCheckAm) {
        var _isValid = true;
        var invoice_products_exchange_rate;
        var invoice_products;
        var indexErr;
        this.invoice_products.load().then(function (dataSource) {
            invoice_products = dataSource.filter(function (item) { return item.product_name !== ''; });
            invoice_products_exchange_rate = invoice_products.filter(function (item) { return item.product_exchange_rate; });
            indexErr = invoice_products.findIndex(function (item) { return !item.product_exchange_rate; });
        });
        if (this.frmData.adjustment_object == "TANG_GIAM" && this.isTT78) {
        }
        else {
            if ((this.frmData.amount_vat5 < 0 || this.frmData.amount_vat10 < 0 || this.frmData.total_payment < 0)
                && !this.configs.system_parameter.allow_export_with_negative) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.discount_same_vat, 'error');
                return false;
            }
        }
        if (isOnlyCheckAm) {
            return true;
        }
        if (this.frmData.currency_code && this.frmData.currency_code != "VND") {
            if (invoice_products_exchange_rate && invoice_products_exchange_rate.length > 0) {
                if (invoice_products_exchange_rate.length !== invoice_products.length) {
                    this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(indexErr, 'product_exchange_rate'));
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.currency_rate + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
            }
            else {
                if (!this.frmData.currency_rate) {
                    this.formInvoice.form.instance.getEditor('currency_rate').focus();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.currency_rate + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
            }
        }
        if (this.frmData.customer_object_code === 'DOANH_NGHIEP' && this.frmData.template_code != '6') {
            if (!this.frmData.customer_name) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.customer_name + ' ' + this._translate.VALIDATION.required, 'error');
                if (this.formInvoice.form.instance.getEditor('customer_name')) {
                    this.formInvoice.form.instance.getEditor('customer_name').focus();
                }
                return false;
            }
            if (!this.frmData.buyer_address) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.address + ' ' + this._translate.VALIDATION.required, 'error');
                if (this.formInvoice.form.instance.getEditor('customer_name')) {
                    this.formInvoice.form.instance.getEditor('customer_name').focus();
                }
                return false;
            }
            if (this.invoiceTemplateTT78.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe) {
                if (!this.frmData.nationality) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.nationality + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('nationality').focus();
                    return false;
                }
                if (!this.frmData.passport) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport').focus();
                    return false;
                }
                if (!this.frmData.passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_date').focus();
                    return false;
                }
                if (!this.frmData.passport_expiration_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
                var passport_expiration_date = new Date(this.frmData.passport_expiration_date);
                var passport_date = new Date(this.frmData.passport_date);
                if (passport_expiration_date <= passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + 'nhỏ hơn ' + this._translate.CONTROLL.LABEL.passport_date, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
            }
        }
        if (this.frmData.customer_object_code === 'CA_NHAN' && this.frmData.template_code != '6') {
            if (!this.frmData.buyer_name) {
                if (this.formInvoice.form.instance.getEditor('buyer_name')) {
                    this.formInvoice.form.instance.getEditor('buyer_name').focus();
                }
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.buyer_name + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (!this.frmData.buyer_address) {
                if (this.formInvoice.form.instance.getEditor('buyer_address')) {
                    this.formInvoice.form.instance.getEditor('buyer_address').focus();
                }
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.address + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (this.invoiceTemplateTT78.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe) {
                if (!this.frmData.nationality) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.nationality + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('nationality').focus();
                    return false;
                }
                if (!this.frmData.passport) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport').focus();
                    return false;
                }
                if (!this.frmData.passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_date').focus();
                    return false;
                }
                if (!this.frmData.passport_expiration_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
                var passport_expiration_date = new Date(this.frmData.passport_expiration_date);
                var passport_date = new Date(this.frmData.passport_date);
                if (passport_expiration_date <= passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + 'nhỏ hơn ' + this._translate.CONTROLL.LABEL.passport_date, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
            }
        }
        if (this.frmData.customer_object_code === 'KHACH_LE' && this.frmData.template_code != '6') {
            if (!this.frmData.buyer_name) {
                if (this.formInvoice.form.instance.getEditor('buyer_name')) {
                    this.formInvoice.form.instance.getEditor('buyer_name').focus();
                }
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.buyer_name + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (this.invoiceTemplateTT78.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe) {
                if (!this.frmData.nationality) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.nationality + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('nationality').focus();
                    return false;
                }
                if (!this.frmData.passport) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport').focus();
                    return false;
                }
                if (!this.frmData.passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_date').focus();
                    return false;
                }
                if (!this.frmData.passport_expiration_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
                var passport_expiration_date = new Date(this.frmData.passport_expiration_date);
                var passport_date = new Date(this.frmData.passport_date);
                if (passport_expiration_date <= passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + 'nhỏ hơn ' + this._translate.CONTROLL.LABEL.passport_date, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
            }
        }
        if (this.isTT78) {
            if (this.frmData.destroy_reason === null || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.destroy_reason) == "") {
                this.formInvoice.form.instance.getEditor('destroy_reason').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Lý do điều chỉnh" + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (this.frmData.list_date && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.list_number) == "") {
                this.formInvoice.form.instance.getEditor('list_number').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Số bảng kê" + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (!this.frmData.list_date && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.list_number) != "") {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ngày bảng kê" + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
        }
        /* Hóa đơn bán hàng NQ43 */
        if (this.frmData.is_resolution_43) {
            if (!this.frmData.sales_percentage) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tỷ lệ % trên doanh thu không được để trống", 'error');
                return false;
            }
            else if (this.frmData.sales_percentage != 1 && this.frmData.sales_percentage != 2
                && this.frmData.sales_percentage != 3 && this.frmData.sales_percentage != 5) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tỷ lệ % trên doanh thu chỉ bao gồm các giá trị: 1, 2, 3, 5", 'error');
                return false;
            }
        }
        return _isValid;
    };
    AdjustInvoiceComponent.prototype.eSubmit = function (type) {
        var _this = this;
        var checkValid = this.formInvoice.form.instance.validate();
        this.total_payment = "";
        if (!checkValid.isValid) {
            return;
        }
        if (type != 'GHI_TAM') {
            if (!this._validForm(false)) {
                return;
            }
            if (!_core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_13__["InvoicesService"].checkTimeExportInv(this.configs.system_parameter)) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(typescript_string_operations__WEBPACK_IMPORTED_MODULE_14__["String"].Format(this._translate.NOTIFY.time_export_inv, moment__WEBPACK_IMPORTED_MODULE_2__(this.configs.system_parameter.time_start).format('HH:mm'), moment__WEBPACK_IMPORTED_MODULE_2__(this.configs.system_parameter.time_end).format('HH:mm')), 'error');
                return;
            }
        }
        if (this.windowPreviewBeforeSubmit) {
            this.windowPreviewBeforeSubmit.focus();
            return;
        }
        setTimeout(function () {
            _this.handleFormData();
            if (_this.frmData.invoice_options) {
                _this.frmData.invoice_options.forEach(function (item) {
                    delete item['is_show'];
                    delete item['type'];
                    delete item['width'];
                    delete item['statusData'];
                    delete item['id'];
                    delete item['invoice_id'];
                });
            }
            if (_this.frmData.adjustment_form === 'GIAM') {
                if (_this.frmData.adjustment_object === 'HH_DV') {
                    var isValidProduct = true;
                    var indexProduct_1 = 0;
                    _this.frmData.invoice_products.forEach(function (p) {
                        if (_this.invoice_products_old) {
                            if (_this.configs.system_parameter.is_add_product_code) {
                                var product = _this.invoice_products_old.filter(function (w) { return w.product_code === p.product_code; })[0];
                                if (product) {
                                    if (p.quantity > product.quantity || p.price > product.price || p.amount_vat > product.amount_vat || p.amount_after_vat > product.amount_after_vat) {
                                        _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(indexProduct_1, 'product_code'));
                                        return;
                                    }
                                    else
                                        ++indexProduct_1;
                                }
                                else
                                    ++indexProduct_1;
                            }
                            else {
                                var product = _this.invoice_products_old.filter(function (w) { return w.product_name === p.product_name; })[0];
                                if (product) {
                                    if (p.quantity > product.quantity || p.price > product.price || p.amount_vat > product.amount_vat || p.amount_after_vat > product.amount_after_vat) {
                                        _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(indexProduct_1, 'product_name'));
                                        return;
                                    }
                                    else
                                        ++indexProduct_1;
                                }
                                else
                                    ++indexProduct_1;
                            }
                        }
                    });
                    // if (!isValidProduct) {
                    //   Library.notify('Giá trị của hóa đơn điều chỉnh giảm không được lớn hơn hóa đơn gốc.', 'error');
                    //   return false;
                    // }
                }
                // if (this.frmData.adjustment_object === 'KHAC_GIAM' && this.invoice_old) {
                //   if (this.frmData.amount > this.invoice_old.amount || this.frmData.total_amount_vat > this.invoice_old.total_amount_vat || this.frmData.total_payment > this.invoice_old.total_payment) {
                //     Library.notify('Giá trị của hóa đơn điều chỉnh giảm không được lớn hơn hóa đơn gốc.', 'error');
                //     return false;
                //   }
                // }
                // /* Áp dụng thuế giảm trừ theo Nghị định số 92/2021 */
                // let _objND92 = this.frmData.invoice_products.filter(p => (p.vat == "7" || p.vat == "3.5"))[0];
                // if (_objND92 || this.frmData.is_exemption_decree) {
                //   let dateFrom = moment("01/11/2021", 'DD/MM/YYYY').format('YYYY-MM-DD');
                //   let dateTo = moment("31/12/2021", 'DD/MM/YYYY').format('YYYY-MM-DD');
                //   let invoiceDate = moment(this.oldForm.invoice_date).format('YYYY-MM-DD')
                //   if (invoiceDate < dateFrom || invoiceDate > dateTo) {
                //     Library.notify("Chỉ áp dụng giảm thuế GTGT theo Nghị định số 92/2021 cho hóa đơn bị điều chỉnh có ngày từ 01/11/2021 đến 31/12/2021", 'error');
                //     return false;
                //   }
                // }
                /* Áp dụng thuế giảm trừ theo Nghị quyết số 43/2022/QH15 */
                // let _objNQ43 = this.frmData.invoice_products.filter(p => (p.vat == "8"))[0];
                // if (_objNQ43 || this.frmData.is_resolution_43) {
                //   let dateFromNQ43 = moment("01/02/2022", 'DD/MM/YYYY').format('YYYY-MM-DD');
                //   let dateToNQ43 = moment("31/12/2022", 'DD/MM/YYYY').format('YYYY-MM-DD');
                //   let invoiceDateNQ43 = moment(this.oldForm.invoice_date).format('YYYY-MM-DD')
                //   if (!this.isPassNQ43 && (invoiceDateNQ43 < dateFromNQ43 || invoiceDateNQ43 > dateToNQ43)) {
                //     Library.notify("Chỉ áp dụng giảm thuế GTGT theo Nghị quyết số 43/2022/QH15 cho hóa đơn bị điều chỉnh có ngày từ 01/02/2022 đến 31/12/2022", 'error');
                //     return false;
                //   }
                // }
            }
            if (_this.frmData.adjustment_object == "TANG_GIAM" && !_this.isTT78) {
                var _oProduct = _this.frmData.invoice_products.filter(function (w) { return _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(w.adjustment_form) == ""; })[0];
                if (_oProduct) {
                    var index = _this.frmData.invoice_products.indexOf(_oProduct);
                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'adjustment_form'));
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Phương thức điều chỉnh không được để trống.', 'error');
                    return false;
                }
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_this.frmData.bank_name) != "" && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_this.frmData.bank_name).length > 400) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.bank_name_less_than_400_character, 'error');
                return false;
            }
            if (_this.frmData.total_payment > 20000000 && (_this.frmData.payment_method_name === 'TM')) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Vui lòng chọn HTTT chuyển khoản cho hóa đơn có giá trị lớn hơn 20 triệu đồng', 'error');
                return false;
            }
            if (!_this.isAccessExportInv && type === 'XUAT' && _this.formInvoice.getHtXuatValue() !== _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].hinhThucXuat.XuatChoKy) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.you_not_permissions, 'error');
                return false;
            }
            if (type === 'XUAT' || (type === 'TRINH_KY' && _this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].hinhThucXuat.XuatChoKy)) {
                if (!_this.frmData.invoice_date && !_this.confirmCheckPreview && !_this.isTT78) {
                    var setInvoiceDate = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(_this._translate.NOTIFY.warning_invoice_date, _this._translate.NOTIFY.notify);
                    setInvoiceDate.then(function (dialog) {
                        if (!dialog) {
                            _this.formInvoice.form.instance.getEditor('invoice_date').focus();
                        }
                        else {
                            _this.processXuatHoaDon(type);
                        }
                    });
                }
                else
                    _this.processXuatHoaDon(type);
            }
            else {
                _this.processGhiTam(type);
            }
        }, 300);
    };
    /* Xử lý xuất hóa đơn */
    AdjustInvoiceComponent.prototype.processXuatHoaDon = function (type) {
        var _this = this;
        if (type === 'TRINH_KY' && this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].hinhThucXuat.XuatChoKy) {
            this.confirmCheckPreview = true;
        }
        if (this.confirmCheckPreview) {
            if (this.formInvoice.getHtXuatValue() !== _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].hinhThucXuat.XuatChoKy) {
                this.xuatHoaDon(this.frmData);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].confirmXuatChoKy(function () {
                    if (!_this.isAccessExportInv) {
                        if (type === 'TRINH_KY') {
                            _this.frmData.refuse_reason = '';
                            _this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet;
                        }
                        else {
                            if (_this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.TuChoi) {
                                _this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChuaTrinhKy;
                            }
                        }
                    }
                    _this.xuatChoKy(_this.frmData);
                });
            }
            this.confirmCheckPreview = false;
        }
        else {
            this.previewBeforeExport(type);
        }
    };
    AdjustInvoiceComponent.prototype.previewBeforeExport = function (type) {
        var _this = this;
        this.handleFormData();
        var trang_thai = '';
        if (this.formInvoice.getHtXuatValue() !== _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].hinhThucXuat.XuatChoKy) {
            trang_thai = this._translate.THONG_TIN.xuat_va_ky;
        }
        else {
            trang_thai = this._translate.THONG_TIN.xuat_cho_ky;
        }
        var du_lieu = this.vatService.taodulieuXemTruocMau(this.frmData);
        du_lieu['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].cauhinhxemmau.hoadon;
        var content_invoice = {
            du_lieu: du_lieu,
            ngay_hoa_don: "",
            trang_thai: trang_thai,
            tong_tien: "",
            title_invoice_type: this._translate.THONG_TIN.ban_du_thao_hoa_don.toUpperCase(),
            note_warn: this._translate.THONG_TIN.luu_y_truoc_khi_xuat,
            is_display_img_note: true,
            text_ngay_hoa_don: this._translate.THONG_TIN.ngay_hoa_don,
            text_tong_tien: this._translate.THONG_TIN.tong_tien,
            question_again: this._translate.THONG_TIN.ban_co_chac_chan_xuat_hoa_don_khong
        };
        var initialState = {
            content_invoice: content_invoice,
        };
        this.bsModalRef = this.customeModalService.show(_shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_22__["PreviewInvoiceComponent"], {
            backdrop: 'static',
            keyboard: false,
            class: 'modal-xl prv-s-invoice v-s-invoice',
            initialState: initialState
        });
        var subModal = this.customeModalService.onHide.subscribe(function () {
            if (_this.bsModalRef.content.successSaveItem == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].actionHander.DongY) {
                _this.confirmCheckPreview = true;
                _this.eSubmit(type);
            }
            subModal.unsubscribe();
        });
    };
    /* Xử lý ghi tạm hóa đơn */
    AdjustInvoiceComponent.prototype.processGhiTam = function (type) {
        if (!this.isAccessExportInv) {
            if (type === 'TRINH_KY') {
                this.frmData.refuse_reason = '';
                this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet;
            }
            else {
                if (this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.TuChoi) {
                    this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChuaTrinhKy;
                }
            }
        }
        this.ghiTam(this.frmData);
    };
    AdjustInvoiceComponent.prototype.handleFormData = function () {
        var _this = this;
        this.tempKiFile = 0;
        var invoice_products = [];
        this.invoice_products.load().then(function (dataSource) {
            dataSource.forEach(function (item, index) {
                delete item.error;
                if (item.product_code || item.product_name || (!item.product_name && item.is_promotion)) {
                    if ((_this.frmData.adjustment_form === 'TANG' && _this.frmData.adjustment_object === 'HH_DV') || (_this.frmData.adjustment_form == 'GIAM' && _this.frmData.adjustment_object === 'HH_DV'))
                        item.row_content = _this.rowContentInInvoiceProduct(item, _this.frmData.adjustment_form);
                    else
                        item.row_content = item.product_name;
                    invoice_products.push(item);
                    if (item.is_transport_number) {
                        _this.frmData.transport_number = item.product_name;
                    }
                }
            });
        });
        if ((this.frmData.adjustment_form === 'THONG_TIN' && this.frmData.adjustment_object === 'MST') || (this.frmData.adjustment_form == 'THONG_TIN' && this.frmData.adjustment_object === 'KH_DC')) {
            this.frmData.total_payment_in_word = '';
        }
        if (this.frmData.list_date) {
            this.frmData.list_date = moment__WEBPACK_IMPORTED_MODULE_2__(this.frmData.list_date).format('YYYY-MM-DD');
        }
        this.frmData.invoice_files = JSON.parse(JSON.stringify(this.fileData));
        var hoadon = "Hóa đơn";
        if (this.isPXKNB || this.isPXKDaiLy)
            hoadon = "Phiếu xuất kho";
        this.frmData.note_view_on_invoice = hoadon + " " + "n\u00E0y \u0111i\u1EC1u ch\u1EC9nh cho " + hoadon.toLowerCase() + " " + ("s\u1ED1 " + this.oldForm.invoice_number + ", m\u1EABu s\u1ED1 " + this.oldForm.template_code + ", k\u00FD hi\u1EC7u " + this.oldForm.invoice_series + " ng\u00E0y " + moment__WEBPACK_IMPORTED_MODULE_2__(this.oldForm.invoice_date).format('DD/MM/YYYY'));
        this.frmData.invoice_products = invoice_products;
        this.frmData.decimal_places_json = JSON.stringify(_core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getObjFormatterToColumn(this.formatter));
    };
    AdjustInvoiceComponent.prototype.handleFormDataSub = function () {
        var _this = this;
        var wait = function (delay) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            return new Promise(function (resolve) { return setTimeout.apply(void 0, [resolve, delay].concat(args)); });
        };
        return wait(200).then(function () {
            _this.tempKiFile = 0;
            var invoice_products = [];
            _this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    delete item.error;
                    if (item.product_code || item.product_name || (!item.product_name && item.is_promotion)) {
                        if ((_this.frmData.adjustment_form === 'TANG' && _this.frmData.adjustment_object === 'HH_DV') || (_this.frmData.adjustment_form == 'GIAM' && _this.frmData.adjustment_object === 'HH_DV'))
                            item.row_content = _this.rowContentInInvoiceProduct(item, _this.frmData.adjustment_form);
                        else
                            item.row_content = item.product_name;
                        invoice_products.push(item);
                        if (item.is_transport_number) {
                            _this.frmData.transport_number = item.product_name;
                        }
                    }
                });
            });
            if ((_this.frmData.adjustment_form === 'THONG_TIN' && _this.frmData.adjustment_object === 'MST') || (_this.frmData.adjustment_form == 'THONG_TIN' && _this.frmData.adjustment_object === 'KH_DC')) {
                _this.frmData.total_payment_in_word = '';
            }
            _this.frmData.invoice_files = JSON.parse(JSON.stringify(_this.fileData));
            var hoadon = "Hóa đơn";
            if (_this.isPXKNB || _this.isPXKDaiLy)
                hoadon = "Phiếu xuất kho";
            _this.frmData.note_view_on_invoice = hoadon + " " + "n\u00E0y \u0111i\u1EC1u ch\u1EC9nh cho " + hoadon.toLowerCase() + " " + ("s\u1ED1 " + _this.oldForm.invoice_number + ", m\u1EABu s\u1ED1 " + _this.oldForm.template_code + ", k\u00FD hi\u1EC7u " + _this.oldForm.invoice_series + " ng\u00E0y " + moment__WEBPACK_IMPORTED_MODULE_2__(_this.oldForm.invoice_date).format('DD/MM/YYYY'));
            _this.frmData.invoice_products = invoice_products;
            _this.frmData.decimal_places_json = JSON.stringify(_core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getObjFormatterToColumn(_this.formatter));
            return true;
        });
    };
    AdjustInvoiceComponent.prototype.rowContentInInvoiceProduct = function (row, status) {
        if (this.oldForm.template_code.indexOf('02GTTT') >= 0 || this.oldForm.template_code == "2" || this.oldForm.template_code.indexOf('07KPTQ') >= 0) {
            var status_view = (status === 'TANG') ? 'tăng' : 'giảm';
            var str = void 0, temp_1, quantity = void 0, price = void 0;
            this.oldForm.invoice_products.some(function (item) {
                if (item.product_name === row.product_name) {
                    temp_1 = item;
                    return true;
                }
            });
            if (!temp_1)
                temp_1 = new Object;
            if (temp_1.quantity !== row.quantity) {
                quantity = true;
            }
            if (temp_1.price !== row.price) {
                price = true;
            }
            if (quantity === true || price === true) {
                str = "\u0110i\u1EC1u ch\u1EC9nh " + status_view + " " + (quantity ? 'Số lượng, ' : '') + (price ? 'Đơn giá, ' : '') + "th\u00E0nh ti\u1EC1n c\u1EE7a m\u1EB7t h\u00E0ng";
            }
            else {
                str = "\u0110i\u1EC1u ch\u1EC9nh " + status_view + " S\u1ED1 l\u01B0\u1EE3ng, \u0110\u01A1n gi\u00E1, th\u00E0nh ti\u1EC1n c\u1EE7a m\u1EB7t h\u00E0ng";
            }
            return str + (" " + row.product_name);
        }
        else if (this.oldForm.template_code.indexOf('01GTKT') >= 0 || this.oldForm.template_code.indexOf('1') >= 0) {
            var status_view = (status === 'TANG') ? 'tăng' : 'giảm';
            var str = void 0, temp_2, quantity = void 0, price = void 0, vat = void 0;
            this.oldForm.invoice_products.some(function (item) {
                if (item.product_name === row.product_name) {
                    temp_2 = item;
                    return true;
                }
            });
            if (!temp_2)
                temp_2 = new Object;
            if (temp_2.quantity !== row.quantity) {
                quantity = true;
            }
            if (temp_2.price !== row.price) {
                price = true;
            }
            if (temp_2.vat !== row.vat) {
                vat = true;
            }
            var vat_view = ((temp_2.vat === -1 || temp_2.vat === 0 || !temp_2.vat) && vat !== true) ? '' : ', tiền thuế';
            if (vat) {
                str = "\u0110i\u1EC1u ch\u1EC9nh " + status_view + " thu\u1EBF su\u1EA5t v\u00E0 ti\u1EC1n thu\u1EBF GTGT c\u1EE7a m\u1EB7t h\u00E0ng";
            }
            else if (quantity === true || price === true) {
                str = "\u0110i\u1EC1u ch\u1EC9nh " + status_view + " " + (quantity ? 'Số lượng, ' : '') + (price ? 'Đơn giá, ' : '') + "th\u00E0nh ti\u1EC1n" + vat_view + " c\u1EE7a m\u1EB7t h\u00E0ng";
            }
            else {
                str = "\u0110i\u1EC1u ch\u1EC9nh " + status_view + " S\u1ED1 l\u01B0\u1EE3ng, \u0110\u01A1n gi\u00E1, th\u00E0nh ti\u1EC1n, thu\u1EBF su\u1EA5t" + vat_view + " c\u1EE7a m\u1EB7t h\u00E0ng";
            }
            return str + (" " + row.product_name);
        }
    };
    AdjustInvoiceComponent.prototype.ngOnDestroy = function () {
        this.ioSignature.unsubscribe();
        this.routeSub.unsubscribe();
        // this.socketService.close();
    };
    AdjustInvoiceComponent.prototype.xemlydotuchoi = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var sub = this.vatService.showToSendInvoice(this.frmData.id).subscribe(function (rs) {
            if (rs.status === 'success') {
                var initialState = {
                    invoice: rs.data.invoice,
                    listDM: _this.listDM
                };
                _this.bsModalRef = _this.modalService.show(_modules_handle_invoice_components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_15__["SendInvoicesComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveItem) {
                    }
                });
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    AdjustInvoiceComponent.prototype.onSubmit = function () {
    };
    AdjustInvoiceComponent.prototype.keyDown = function (e) {
        // setTimeout(() => {
        if (e.event.key === 'Delete') {
            e.event.srcElement.value = null;
        }
        // }, 100);
    };
    AdjustInvoiceComponent.prototype.onTemplateTypeChange = function (e) {
        this.invoicereleaseTempt = e;
    };
    AdjustInvoiceComponent.prototype.onTemplateTT78TypeChange = function (e) {
        this.invoiceTemplateTT78 = e;
    };
    AdjustInvoiceComponent.prototype.onNumberChange = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._calTotalMoney(this.frmData, this.formatter, !this.frmData.auto_value);
    };
    AdjustInvoiceComponent.prototype.onNumberTicketChange = function () {
        if (!this.isTT78) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyItem(this.dataSource, this.invoice_products, this.frmData, this.formatter, !this.frmData.auto_value, this.frmData.auto_value_price, null, this._objTemplateSelect, this.configs.system_parameter);
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonVeMayBay
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonXangDau) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyTicket(this.frmData, this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type));
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyItem(this.dataSource, this.invoice_products, this.frmData, this.formatter, !this.frmData.auto_value, this.frmData.auto_value_price, null, this._oTemplateTT78, this.configs.system_parameter);
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonVeMayBay
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].templatetype.HoaDonXangDau) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyTicket(this.frmData, this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type));
            }
        }
    };
    AdjustInvoiceComponent.prototype.onVatChange = function () {
        var decimal_amount = this.getFormatterToNumber(this.formatter.thanh_tien);
        var decimal_amount_vat = this.getFormatterToNumber(this.formatter.tien_thue);
        var decimal_vat = this.getFormatterToNumber(this.formatter.vat);
        if (this.frmData.vat_service_ticket != null && this.frmData.vat_service_ticket != '-1') {
            this.frmData.total_vat_service_ticket = this.roundNumber((Number.parseInt(this.frmData.vat_service_ticket) * this.frmData.money_service_ticket) / 100, decimal_amount_vat);
        }
        else {
            this.frmData.total_vat_service_ticket = null;
        }
        this.frmData.total_service_ticket_with_vat = this.roundNumber(this.frmData.money_service_ticket + this.frmData.total_vat_service_ticket, decimal_amount);
    };
    AdjustInvoiceComponent.prototype.getFormatterToNumber = function (formatter) {
        var s1 = formatter.replace('0,###', '');
        if (s1 === '') {
            return 0;
        }
        else {
            var s2 = s1.replace('.', '');
            return s2.split('').length;
        }
    };
    AdjustInvoiceComponent.prototype.setDataSessionStorage = function (value) {
        this.valueChange = JSON.stringify(value);
    };
    AdjustInvoiceComponent.prototype.checkDataFormChange = function (dataChange, dataForm) {
        var dataBefore = JSON.parse(dataChange);
        var dataAfter = JSON.parse(JSON.stringify(dataForm));
        return lodash__WEBPACK_IMPORTED_MODULE_17__["isEqual"](dataBefore, dataAfter);
    };
    AdjustInvoiceComponent.prototype.subData = function (type, value) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var checkValid;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        checkValid = this.formInvoice.form.instance.validate();
                        if (!checkValid.isValid) {
                            return [2 /*return*/, false];
                        }
                        if (this.windowPreviewBeforeSubmit) {
                            this.windowPreviewBeforeSubmit.focus();
                            return [2 /*return*/, false];
                        }
                        return [4 /*yield*/, this.handleFormDataSub()];
                    case 1:
                        _a.sent();
                        if (this.frmData.invoice_options) {
                            this.frmData.invoice_options.forEach(function (item) {
                                delete item['is_show'];
                                delete item['type'];
                                delete item['width'];
                                delete item['statusData'];
                            });
                        }
                        if (this.frmData.total_payment > 20000000 && (this.frmData.payment_method_name === 'TM')) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.payment_method_more_than_20_million, 'error');
                            return [2 /*return*/, false];
                        }
                        if (!this.isAccessExportInv) {
                            if (type === 'TRINH_KY') {
                                this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChoDuyet;
                                this.frmData.refuse_reason = '';
                            }
                            else {
                                if (this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.TuChoi) {
                                    this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_12__["sEnum"].statusApprove.ChuaTrinhKy;
                                }
                            }
                        }
                        if (!value.id) return [3 /*break*/, 6];
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                        if (!!this.isTT78) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.vatService.edit(this.frmData.id, value).toPromise().then(function (res) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                                if (res.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                    return true;
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                    return false;
                                }
                            })];
                    case 2: return [2 /*return*/, _a.sent()];
                    case 3: return [4 /*yield*/, this.vatService.editTT78(this.frmData.id, value).toPromise().then(function (res) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                            if (res.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                return true;
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                return false;
                            }
                        })];
                    case 4: return [2 /*return*/, _a.sent()];
                    case 5: return [3 /*break*/, 10];
                    case 6:
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                        if (!!this.isTT78) return [3 /*break*/, 8];
                        return [4 /*yield*/, this.vatService.ghiTam(value).toPromise().then(function (res) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                                if (res.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                    return true;
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                    return false;
                                }
                            })];
                    case 7: return [2 /*return*/, _a.sent()];
                    case 8: return [4 /*yield*/, this.vatService.ghiTamTT78(value).toPromise().then(function (res) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                            if (res.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                return true;
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                return false;
                            }
                        })];
                    case 9: return [2 /*return*/, _a.sent()];
                    case 10: return [2 /*return*/];
                }
            });
        });
    };
    AdjustInvoiceComponent.prototype.canDeactivate = function () {
        var _this = this;
        if (!this.checkDataFormChange(this.valueChange, this.frmData)) {
            return new rxjs__WEBPACK_IMPORTED_MODULE_16__["Observable"](function (observer) {
                _this.confirmService.confirm().subscribe(function (value) {
                    switch (value) {
                        case 'yes':
                            _this.subData('GHI_TAM', _this.frmData).then(function (value1) {
                                observer.next(value1);
                                observer.complete();
                            });
                            break;
                        case 'no':
                            observer.next(true);
                            observer.complete();
                            break;
                        case 'cancel':
                            observer.next(false);
                            observer.complete();
                            break;
                        default:
                            observer.next(true);
                            observer.complete();
                            break;
                    }
                });
            });
        }
        return true;
    };
    AdjustInvoiceComponent.prototype.onChangeSalePercen = function (e) {
        var _this = this;
        this.configs.system_parameter.value_rate_percent = e.value;
        var data = {
            config: {
                value: JSON.stringify(this.configs.system_parameter)
            }
        };
        this.configsService.update(this.configs.id.system_parameter, data).subscribe(function (response) {
            if (response.status == "success") {
                _this.configsService.getAll().subscribe(function (res) {
                    if (res.data && res.data.configs)
                        _this.authService.setConfigs(res.data.configs);
                    _this.configs = _this.authService.getConfigs();
                });
            }
            else {
            }
        }, function (err) { }, function () {
        });
        this.onNumberTicketChange();
    };
    AdjustInvoiceComponent.prototype.guideSales = function () {
        this.isDisplayGuideSale = !this.isDisplayGuideSale;
    };
    AdjustInvoiceComponent.prototype.doctienbangchu = function (total_payment, currency_code) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.adjustment_object) == "TANG_GIAM" && this.isTT78) {
            var number_money = Math.abs(total_payment);
            var c_money = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].tienBangChu(number_money, _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            this.frmData.total_payment_in_word = c_money;
            if (total_payment < 0) {
                this.frmData.total_payment_in_word = "Giảm " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                }
            }
            else if (total_payment > 0) {
                this.frmData.total_payment_in_word = "Tăng " + c_money;
                if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                    this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                }
            }
        }
        else {
            this.frmData.total_payment_in_word = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].tienBangChu(total_payment, _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), currency_code, this.configs.system_parameter.display_read_money_english);
            if (this.isTT78) {
                if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.total_payment_in_word) != "" && this.frmData.total_payment_in_word != "Không đồng chẵn.") {
                    if (this.frmData.adjustment_form === 'TANG') {
                        this.frmData.total_payment_in_word = "Tăng " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to increase by ");
                        }
                    }
                    if (this.frmData.adjustment_form == 'GIAM') {
                        this.frmData.total_payment_in_word = "Giảm " + this.frmData.total_payment_in_word;
                        if (this.configs.system_parameter.display_read_money_english && (currency_code == 'USD' || currency_code == 'EURO' || currency_code == 'EUR' || currency_code == 'MYR' || currency_code == 'CNY' || currency_code == 'SGD' || currency_code == 'JPY')) {
                            this.frmData.total_payment_in_word = this.frmData.total_payment_in_word.replace("(", "(Adjusted to reduce by ");
                        }
                    }
                }
            }
        }
    };
    AdjustInvoiceComponent.prototype.startProcess_TBSaiSot = function () {
        var _this = this;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.getXml_TBSaiSot();
        }
        else {
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var ListSerialNumber = "DSCKS";
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
            }
            else
                this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
        }
    };
    AdjustInvoiceComponent.prototype.getXml_TBSaiSot = function () {
        var _this = this;
        var invoices = [];
        var object = new Object;
        object["tax_authority_code"] = this.oldForm.tax_authority_code;
        object["template_code"] = this.oldForm.template_code;
        object["invoice_series"] = this.oldForm.invoice_series;
        object["invoice_date"] = this.oldForm.invoice_date;
        object["invoice_number"] = this.oldForm.invoice_number;
        object["reason"] = this.frmData.destroy_reason;
        object["notification_nature"] = "2";
        object["type_apply_invoice"] = 1;
        object["is_invoice_with_code"] = this.oldForm.is_invoice_with_code;
        object["invoice_id"] = this.oldForm.id;
        invoices.push(object);
        var data = {
            notification_type: 1,
            invoices: invoices
        };
        var xmlInvoice = "";
        var sub = this.handleInvoiceService.getXmlInvoiceWrong(data).subscribe(function (rs) {
            if (rs.status == 'success') {
                xmlInvoice = rs.data.xml_file;
                _this.invoices = rs.data.invoices;
                var sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.sign_date).format('YYYY-MM-DD HH:mm:ss');
                if (xmlInvoice != "") {
                    if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                        || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing))
                        _this.sendData_TBSaiSot(xmlInvoice);
                    else
                        _this.signXml_TBSaiSot(xmlInvoice, sign_date);
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            sub.unsubscribe();
        });
    };
    AdjustInvoiceComponent.prototype.sendData_TBSaiSot = function (xml_string) {
        var _this = this;
        var subXuatHoaDon = this.handleInvoiceService.sendXmlInvoiceWrong({
            xml_file: xml_string,
            invoices: this.invoices
        }).subscribe(function (rs) {
            if (rs.status == 'success') {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            subXuatHoaDon.unsubscribe();
        });
    };
    AdjustInvoiceComponent.prototype.signXml_TBSaiSot = function (xmlInvoice, signDate) {
        var _this = this;
        var nodeSign = "//TBao/DSCKS/NNT";
        var ListSerialNumber = "DSCKS";
        if (this.infoDangKy && this.infoDangKy.registration_signature) {
            var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
            if (signatures && signatures.length > 0)
                ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
        }
        this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', nodeSign, signDate, 'NotificationData', ListSerialNumber, true);
    };
    AdjustInvoiceComponent.prototype.inChuyenDoiText = function () {
        if (this.frmData.time_print_conversion > 0) {
            return this._translate.CONTROLL.BUTTON.view_conversion;
        }
        else {
            return this._translate.CONTROLL.BUTTON.print_conversion;
        }
    };
    AdjustInvoiceComponent.prototype.thukhoxuatky = function () {
        var _this = this;
        var ids = [];
        ids.push(this.frmData.id);
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var sub = this.vatService.thukhoxuatky(ids).subscribe(function (rs) {
            if (rs.status === 'success') {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_success, 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    AdjustInvoiceComponent.prototype.handleAddNew = function () {
        var _this = this;
        if (this.isExportInvoice) {
            this.addNew();
        }
        else {
            if (!this.checkDataFormChange(this.valueChange, this.frmData)) {
                this.confirmService.confirm()
                    .subscribe(function (value) {
                    switch (value) {
                        case 'yes':
                            _this.subData('GHI_TAM', _this.frmData).then(function (res) {
                                if (res) {
                                    _this.addNew();
                                }
                                else {
                                    return;
                                }
                            });
                            break;
                        case 'no':
                            _this.addNew();
                            break;
                        case 'cancel':
                            _this.addNew();
                            break;
                        default:
                            break;
                    }
                });
            }
            else {
                this.addNew();
            }
        }
    };
    AdjustInvoiceComponent.prototype.addNew = function () {
        var inv = Object.assign({}, this.frmData);
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["InvoiceModel"](1);
        this.frmData.invoice_date = null;
        this.frmData.template_id = inv.template_id;
        this.frmData.invoice_release_id = inv.invoice_release_id;
        this.frmData.payment_method_name = inv.payment_method_name;
        this.frmData.payment_method_view_name = inv.payment_method_view_name;
        this.frmData.currency_code = inv.currency_code;
        this.frmData.template_code = inv.template_code;
        this.frmData.invoice_series = inv.invoice_series;
        this.frmData.invoice_options = inv.invoice_options;
        this.formInvoice.resetTMR();
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: "id",
            data: this.frmData.invoice_products_data()
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        this.productGrip.ttDaXuatHoaDon = false;
        this.productGrip.createUpdateEvent();
        this.formInvoice.removeReadonlyAllForm();
        this.formInvoice.emails = [];
        this.ttDaXuatHoaDon = false;
        this.getDataToCompare();
    };
    AdjustInvoiceComponent.prototype.huylenhdieudong = function () {
        var _this = this;
        var setInvoiceDate = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(this._translate.NOTIFY.warning_the_dispatch_success, this._translate.NOTIFY.notify);
        setInvoiceDate.then(function (dialog) {
            if (!dialog) {
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                var ids = [];
                ids.push(_this.frmData.id);
                var sub_13 = _this.vatService.huylenhdieudong(ids).subscribe(function (rs) {
                    if (rs.status == 'success') {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.cancel_the_dispatch_success, 'success');
                        _this.isShowHuyLenhDD = false;
                        _this.enableScreen();
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) { }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_13.unsubscribe();
                });
            }
        });
    };
    AdjustInvoiceComponent.prototype.enableScreen = function () {
        this.formInvoice.allowEditAllForm();
        this.productGrip.ttDaXuatHoaDon = false;
    };
    AdjustInvoiceComponent.prototype.submitlenhdieudong = function () {
        var _this = this;
        var checkValid = this.formInvoice.form.instance.validate();
        if (!checkValid.isValid) {
            return;
        }
        if (this.windowPreviewBeforeSubmit) {
            this.windowPreviewBeforeSubmit.focus();
            return;
        }
        if (!this.isCheckLenhDieuDong)
            this.resultCompareData = this.checkDataFormChange(this.valueChange, this.frmData);
        setTimeout(function () {
            _this.handleFormData();
            if (!_this._validForm(false))
                return;
            if (_this.isCheckLenhDieuDong) {
                _this.kylenhdieudong();
                _this.isCheckLenhDieuDong = false;
            }
            else {
                _this.Reviewlenhdieudong();
            }
        }, 300);
    };
    AdjustInvoiceComponent.prototype.kylenhdieudong = function () {
        var _this = this;
        if (this.frmData.id) {
            var ids_1 = [];
            ids_1.push(this.frmData.id);
            if (!this.resultCompareData) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                if (!this.isTT78) {
                    var sub_14 = this.vatService.edit(this.frmData.id, this.frmData).subscribe(function (rs) {
                        if (rs.status == 'success') {
                            _this.frmData.id = rs.data.id;
                            _this.getDataToCompare();
                            var sub_15 = _this.vatService.kylenhdieudong(ids_1).subscribe(function (rs) {
                                if (rs.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                    _this.isShowHuyLenhDD = true;
                                    _this.disablleScreen();
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                                }
                            });
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                        }
                    }, function (err) { }, function () {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                        sub_14.unsubscribe();
                    });
                }
                else {
                    var sub_16 = this.vatService.editTT78(this.frmData.id, this.frmData).subscribe(function (rs) {
                        if (rs.status == 'success') {
                            _this.frmData.id = rs.data.id;
                            _this.getDataToCompare();
                            var sub_17 = _this.vatService.kylenhdieudong(ids_1).subscribe(function (rs) {
                                if (rs.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                    _this.isShowHuyLenhDD = true;
                                    _this.disablleScreen();
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                                }
                            });
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                        }
                    }, function (err) { }, function () {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                        sub_16.unsubscribe();
                    });
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                var sub_18 = this.vatService.kylenhdieudong(ids_1).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                        _this.isShowHuyLenhDD = true;
                        _this.disablleScreen();
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_18.unsubscribe();
                });
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_19 = this.vatService.ghiTam(this.frmData).subscribe(function (rs) {
                    if (rs.status == 'success') {
                        _this.frmData.id = rs.data.id;
                        var ids = [];
                        ids.push(_this.frmData.id);
                        var sub_20 = _this.vatService.kylenhdieudong(ids).subscribe(function (rs) {
                            if (rs.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                _this.isShowHuyLenhDD = true;
                                _this.disablleScreen();
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                            }
                        });
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) { }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_19.unsubscribe();
                });
            }
            else {
                var sub_21 = this.vatService.ghiTamTT78(this.frmData).subscribe(function (rs) {
                    if (rs.status == 'success') {
                        _this.frmData.id = rs.data.id;
                        var ids = [];
                        ids.push(_this.frmData.id);
                        var sub_22 = _this.vatService.kylenhdieudong(ids).subscribe(function (rs) {
                            if (rs.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                _this.isShowHuyLenhDD = true;
                                _this.disablleScreen();
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                            }
                        });
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) { }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_21.unsubscribe();
                });
            }
        }
    };
    AdjustInvoiceComponent.prototype.traLai = function () {
        var _this = this;
        if (this.frmTraLai.reason == undefined || this.frmTraLai.reason == "") {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.reason_return + " " + this._translate.VALIDATION.required, 'error');
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            var sub_23 = this.vatService.traLaiHoaDon({
                id: this.frmData.id,
                reason: this.frmTraLai.reason
            }).subscribe(function (rs) {
                if (rs.status == 'success') {
                    _this.router.navigate(['/system/invoice-sync']);
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.return_success, 'success');
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_23.unsubscribe();
            });
        }
    };
    AdjustInvoiceComponent.prototype.Reviewlenhdieudong = function () {
        var _this = this;
        this.handleFormData();
        this.windowPreviewBeforeSubmit = window.open("", "", "width=" + screen.availWidth + ", height=" + screen.availHeight);
        this.windowPreviewBeforeSubmit.document.body.innerHTML = this._translate.NOTIFY.loading;
        this.windowPreviewBeforeSubmit.blur();
        var timer = setInterval(function () {
            if (_this.windowPreviewBeforeSubmit.closed) {
                clearInterval(timer);
                var isCheck = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].getCookie('CK_LDD');
                _this.windowPreviewBeforeSubmit = undefined;
                if (isCheck == "CHECKED") {
                    document.cookie = "CK_LDD=; path=/";
                    _this.isCheckLenhDieuDong = true;
                    _this.submitlenhdieudong();
                }
            }
        }, 500);
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        if (!this.frmData.id || !this.isShowHuyLenhDD) {
            var sub_24 = this.vatService.xemtruoclenhdieudong(this.frmData).subscribe(function (rs) {
                if (rs.status == 'success') {
                    var pdf_file = rs.data.file_content;
                    var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_3__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                    _this.windowPreviewBeforeSubmit.document.write("\n          \n          <!DOCTYPE html>\n          <html lang=\"en\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Document</title>\n            <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\" />\n            <style type=\"text/css\" scoped>\n            .nhap-nhay {\n              background: red;\n              padding: 0.5px 9px;\n              margin-right: 5px;\n              border-radius: 57%;\n              -webkit-animation: flicker 1s infinite;\n            }\n            .ht-xuat{\n              width: 20%;\n              height: 100%;\n              background: #ffffff;\n              box-shadow: 0px 0px 8px 0px #888888;\n              \n            }\n            .ht-xuat > .right-nav{\n              display:flex;\n              justify-content: space-between;\n              align-items: center;\n              border-bottom: 1px solid #d5d5d5;\n              padding:20px;\n            }\n            @-webkit-keyframes flicker\n            {\n            0% {opacity:0;}\n            9% {opacity:0;}\n            10% {opacity:.5;}\n            13% {opacity:0;}\n            20% {opacity:.5;}\n            25% {opacity:1;}\n            }\n\n            .example {\n              padding: 20px;\n            }\n            \n            input[type=button] {\n              padding: 5px 10px;\n              margin: 10px 5px;\n              border-radius: 5px;\n              cursor: pointer;\n              background: #ddd;\n              border: 1px solid #ccc;\n            }\n            input[type=button]:hover {\n              background: #ccc;\n            }\n\n            .confirm {\n              display: none;\n            }\n            .confirm > div:first-of-type {\n              position: fixed;\n              width: 100%;\n              height: 100%;\n              background: rgba(0, 0, 0, 0.5);\n              top: 0px;\n              left: 0px;\n            }\n            .confirm > div:last-of-type {\n              padding: 10px 20px;\n              background: white;\n              position: absolute;\n              width: auto;\n              height: auto;\n              left: 50%;\n              top: 50%;\n              transform: translate(-50%, -50%);\n              border-radius: 5px;\n              border: 1px solid #333;\n            }\n            .confirm > div:last-of-type div:first-of-type {\n              min-width: 150px;\n              padding: 10px;\n            }\n            .confirm > div:last-of-type div:last-of-type {\n              text-align: right;\n            }\n          </style>\n          </head>\n          <body>\n          <div style=\"margin-left: 50px;\">\n          <h3 style=\"color: red; text-align: center;\">B\u1EA2N D\u1EF0 TH\u1EA2O H\u00D3A \u0110\u01A0N \u0110I\u1EC6N T\u1EEC</h3>\n          <p style=\"font-weight: 600;\"><span class=\"nhap-nhay\"></span><span style=\"font-size: 17px;\">L\u01B0u \u00FD: \n          </span>\u0110\u1EC1 ngh\u1ECB \u0111\u01A1n v\u1ECB ki\u1EC3m tra th\u1EADt k\u1EF9 c\u00E1c n\u1ED9i dung h\u00F3a \u0111\u01A1n \u0111\u00E3 nh\u1EADp tr\u01B0\u1EDBc khi xu\u1EA5t nh\u01B0: Ng\u00E0y h\u00F3a \u0111\u01A1n, B\u00EAn mua h\u00E0ng, T\u00EAn h\u00E0ng h\u00F3a d\u1ECBch v\u1EE5, T\u1ED5ng ti\u1EC1n,\u2026\u0111\u1EC3 tr\u00E1nh xu\u1EA5t sai.</>\n        </div>\n\n        <div style=\"display: flex; height:84vh; justify-content: center;\">\n          <iframe style=\"\" width=\"70%\" height=\"100%\" src=\"" + objectUrl + "\"></iframe>\n          <div class=\"ht-xuat\">\n            <div class=\"right-nav\">\n             <button style =\" background:#007BFF;color:#ffffff; padding: 10px 50px; border: none ; outline:none; border-radius: 30px\"> <a href=\"javascript:void(0)\" style=\"text-decoration: none; color:#ffffff; font-weight: bold; padding-right:10px\" onclick=\"setConfirmInvoice()\">\u0110\u1ED3ng \u00FD </a> <i class=\"fa fa-angle-right\"></i></button>\n              <a href=\"javascript:void(0)\" style=\"text-decoration: none; color: gray\" onclick=\"closeWin()\"><i class=\"fa fa-times\" style=\"font-size:25px\"></i></a>\n            </div>\n            <div style=\"display: flex; flex-direction: column; padding:10px;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding:10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\" font-weight: 600;\">Ng\u00E0y h\u00F3a \u0111\u01A1n : </p>\n                <p style=\"color: orange;font-weight: 600;\">" + moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice.invoice_date).format('DD/MM/YYYY') + "</p>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding: 10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\"font-weight: 600;\">Tr\u1EA1ng th\u00E1i : </p>\n                <p style=\"color: orange;font-weight: 600;\">Xu\u1EA5t  " + _this._translate.CONFIRM.confirm_sign_delivery + "</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"confirm\">\n            <div></div>\n            <div>\n              <div id=\"confirmMessage\">Confirm text</div>\n              <div>\n                <input id=\"confirmYes\" type=\"button\" value=\"\u0110\u1ED3ng \u00FD\" />\n                <input id=\"confirmNo\" type=\"button\" value=\"Quay l\u1EA1i\" />\n              </div>\n            </div>\n        </div>\n\n        <script type=\"text/javascript\">\n        const ui = {\n          confirm: async (message) => createConfirm(message)\n        }\n        \n        const createConfirm = (message) => {\n          return new Promise((complete, failed)=>{\n            $('#confirmMessage').text(message)\n        \n            $('#confirmYes').off('click');\n            $('#confirmNo').off('click');\n            \n            $('#confirmYes').on('click', ()=> { $('.confirm').hide(); complete(true); });\n            $('#confirmNo').on('click', ()=> { $('.confirm').hide(); complete(false); });\n            \n            $('.confirm').show();\n          });\n        }\n                             \n        const setConfirmInvoice = async () => {\n          const confirm = await ui.confirm(\" " + _this._translate.CONFIRM.confirm_sign_delivery + " \");\n          if(confirm){\n            document.cookie = \"CK_CFM_I=CHECKED; path=/\";\n            window.close();\n          } else{\n          }\n        } \n\n          function closeWin(){\n            window.close();\n          }\n        </script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n          </body>\n          </html>\n        ");
                    _this.windowPreviewBeforeSubmit.focus();
                }
                else {
                    _this.windowPreviewBeforeSubmit.close();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_24.unsubscribe();
            });
        }
        else {
            var ids = [];
            ids.push(this.frmData.id);
            var sub_25 = this.vatService.xemlenhdieudong(ids).subscribe(function (rs) {
                if (rs.status == 'success') {
                    var pdf_file = rs.data.file_content;
                    var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_3__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                    _this.windowPreviewBeforeSubmit.document.write("\n          <!DOCTYPE html>\n          <html lang=\"en\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Document</title>\n            <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\" />\n            <style type=\"text/css\" scoped>\n            .nhap-nhay {\n              background: red;\n              padding: 0.5px 9px;\n              margin-right: 5px;\n              border-radius: 57%;\n              -webkit-animation: flicker 1s infinite;\n            }\n            .ht-xuat{\n              width: 20%;\n              height: 100%;\n              background: #ffffff;\n              box-shadow: 0px 0px 8px 0px #888888;\n              \n            }\n            .ht-xuat > .right-nav{\n              display:flex;\n              justify-content: space-between;\n              align-items: center;\n              border-bottom: 1px solid #d5d5d5;\n              padding:20px;\n            }\n            @-webkit-keyframes flicker\n            {\n            0% {opacity:0;}\n            9% {opacity:0;}\n            10% {opacity:.5;}\n            13% {opacity:0;}\n            20% {opacity:.5;}\n            25% {opacity:1;}\n            }\n\n            .example {\n              padding: 20px;\n            }\n            \n            input[type=button] {\n              padding: 5px 10px;\n              margin: 10px 5px;\n              border-radius: 5px;\n              cursor: pointer;\n              background: #ddd;\n              border: 1px solid #ccc;\n            }\n            input[type=button]:hover {\n              background: #ccc;\n            }\n\n            .confirm {\n              display: none;\n            }\n            .confirm > div:first-of-type {\n              position: fixed;\n              width: 100%;\n              height: 100%;\n              background: rgba(0, 0, 0, 0.5);\n              top: 0px;\n              left: 0px;\n            }\n            .confirm > div:last-of-type {\n              padding: 10px 20px;\n              background: white;\n              position: absolute;\n              width: auto;\n              height: auto;\n              left: 50%;\n              top: 50%;\n              transform: translate(-50%, -50%);\n              border-radius: 5px;\n              border: 1px solid #333;\n            }\n            .confirm > div:last-of-type div:first-of-type {\n              min-width: 150px;\n              padding: 10px;\n            }\n            .confirm > div:last-of-type div:last-of-type {\n              text-align: right;\n            }\n          </style>\n          </head>\n          <body>\n          <div style=\"margin-left: 50px;\">\n          <h3 style=\"color: red; text-align: center;\">B\u1EA2N D\u1EF0 TH\u1EA2O H\u00D3A \u0110\u01A0N \u0110I\u1EC6N T\u1EEC</h3>\n          <p style=\"font-weight: 600;\"><span class=\"nhap-nhay\"></span><span style=\"font-size: 17px;\">L\u01B0u \u00FD: \n          </span>\u0110\u1EC1 ngh\u1ECB \u0111\u01A1n v\u1ECB ki\u1EC3m tra th\u1EADt k\u1EF9 c\u00E1c n\u1ED9i dung h\u00F3a \u0111\u01A1n \u0111\u00E3 nh\u1EADp tr\u01B0\u1EDBc khi xu\u1EA5t nh\u01B0: Ng\u00E0y h\u00F3a \u0111\u01A1n, B\u00EAn mua h\u00E0ng, T\u00EAn h\u00E0ng h\u00F3a d\u1ECBch v\u1EE5, T\u1ED5ng ti\u1EC1n,\u2026\u0111\u1EC3 tr\u00E1nh xu\u1EA5t sai.</>\n        </div>\n\n        <div style=\"display: flex; height:84vh; justify-content: center;\">\n          <iframe style=\"\" width=\"70%\" height=\"100%\" src=\"" + objectUrl + "\"></iframe>\n          <div class=\"ht-xuat\">\n            <div class=\"right-nav\">\n             <button style =\" background:#007BFF;color:#ffffff; padding: 10px 50px; border: none ; outline:none; border-radius: 30px\"> <a href=\"javascript:void(0)\" style=\"text-decoration: none; color:#ffffff; font-weight: bold; padding-right:10px\" onclick=\"setConfirmInvoice()\">\u0110\u1ED3ng \u00FD </a> <i class=\"fa fa-angle-right\"></i></button>\n              <a href=\"javascript:void(0)\" style=\"text-decoration: none; color: gray\" onclick=\"closeWin()\"><i class=\"fa fa-times\" style=\"font-size:25px\"></i></a>\n            </div>\n            <div style=\"display: flex; flex-direction: column; padding:10px;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding:10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\" font-weight: 600;\">Ng\u00E0y h\u00F3a \u0111\u01A1n : </p>\n                <p style=\"color: orange;font-weight: 600;\">" + moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice.invoice_date).format('DD/MM/YYYY') + "</p>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding: 10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\"font-weight: 600;\">Tr\u1EA1ng th\u00E1i : </p>\n                <p style=\"color: orange;font-weight: 600;\">Xu\u1EA5t  " + _this._translate.CONFIRM.confirm_sign_delivery + "</p>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding:10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\"font-weight: 600;\">T\u1ED5ng ti\u1EC1n : </p>\n                <p style=\"color: orange;font-weight: 600;\">" + rs.data.invoice.total_payment + "</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"confirm\">\n            <div></div>\n            <div>\n              <div id=\"confirmMessage\">Confirm text</div>\n              <div>\n                <input id=\"confirmYes\" type=\"button\" value=\"\u0110\u1ED3ng \u00FD\" />\n                <input id=\"confirmNo\" type=\"button\" value=\"Quay l\u1EA1i\" />\n              </div>\n            </div>\n        </div>\n\n        <script type=\"text/javascript\">\n        const ui = {\n          confirm: async (message) => createConfirm(message)\n        }\n        \n        const createConfirm = (message) => {\n          return new Promise((complete, failed)=>{\n            $('#confirmMessage').text(message)\n        \n            $('#confirmYes').off('click');\n            $('#confirmNo').off('click');\n            \n            $('#confirmYes').on('click', ()=> { $('.confirm').hide(); complete(true); });\n            $('#confirmNo').on('click', ()=> { $('.confirm').hide(); complete(false); });\n            \n            $('.confirm').show();\n          });\n        }\n                             \n        const setConfirmInvoice = async () => {\n          const confirm = await ui.confirm(\" " + _this._translate.CONFIRM.confirm_sign_delivery + " \");\n          if(confirm){\n            document.cookie = \"CK_CFM_I=CHECKED; path=/\";\n            window.close();\n          } else{\n          }\n        } \n\n          function closeWin(){\n            window.close();\n          }\n        </script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n          </body>\n          </html>\n        ");
                    _this.windowPreviewBeforeSubmit.focus();
                }
                else {
                    _this.windowPreviewBeforeSubmit.close();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_25.unsubscribe();
            });
        }
    };
    AdjustInvoiceComponent.prototype.getDataToCompare = function () {
        var _this = this;
        this.handleFormData();
        this.valueChange = JSON.stringify(this.frmData);
        this.invoice_products.load().then(function (dataSource) {
            _this.jsonProductFirst = JSON.stringify(dataSource);
        });
    };
    AdjustInvoiceComponent.prototype.onRefreshForm = function () {
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: 'id',
            data: this.frmData.invoice_products_data()
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        this.productGrip.createUpdateEvent();
        this.onNumberTicketChange();
        this.frmData.total_payment = null;
        this.frmData.amount_after_vat = null;
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_adjust_product_grip_adjust_product_grip_component__WEBPACK_IMPORTED_MODULE_4__["AdjustProductGripComponent"]),
        __metadata("design:type", _adjust_product_grip_adjust_product_grip_component__WEBPACK_IMPORTED_MODULE_4__["AdjustProductGripComponent"])
    ], AdjustInvoiceComponent.prototype, "productGrip", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_adjust_form_invoice_adjust_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__["AdjustFormInvoiceComponent"]),
        __metadata("design:type", _adjust_form_invoice_adjust_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__["AdjustFormInvoiceComponent"])
    ], AdjustInvoiceComponent.prototype, "formInvoice", void 0);
    AdjustInvoiceComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-adjust-invoice',
            template: __webpack_require__(/*! ./adjust-invoice.component.html */ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.html"),
            styles: [__webpack_require__(/*! ./adjust-invoice.component.scss */ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.scss")]
        }),
        __metadata("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_8__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["VatService"],
            _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_7__["HandleInvoiceService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["SocketService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["AuthService"],
            _angular_core__WEBPACK_IMPORTED_MODULE_0__["ChangeDetectorRef"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__["TranslateService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_18__["ConfirmService"],
            ngx_spinner__WEBPACK_IMPORTED_MODULE_20__["NgxSpinnerService"],
            _modules_configs_shared__WEBPACK_IMPORTED_MODULE_21__["ConfigsService"],
            _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_23__["MyBsModalService"],
            _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_24__["ViewInvoiceService"]])
    ], AdjustInvoiceComponent);
    return AdjustInvoiceComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.html":
/*!*****************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.html ***!
  \*****************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<!-- Phần không tự tính giá trị, nhập mẫu bảng kê -->\r\n<div class=\"row support-invoice\">\r\n  <div class=\"col-md-12\">\r\n    <div class=\"pull-left\">\r\n      <div style=\"float: left;width:  30%; padding-top: 4px\">{{ _translate.CONTROLL.BUTTON.add_row }}</div>\r\n      <div style=\"float: left; width: 30%\">\r\n        <dx-number-box #numberBox [max]=\"100\" [min]=\"1\" [showSpinButtons]=\"true\" [(value)]=\"rowData\"></dx-number-box>\r\n      </div>\r\n      <div>\r\n        <dx-button style=\"height: 27px\" icon=\"fa fa-plus-circle\" type=\"default\" text=\"\" (onClick)=\"addRow()\">\r\n        </dx-button>\r\n      </div>\r\n    </div>\r\n    <div class=\"pull-right\" *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n      <!-- Hóa đơn bán hàng NĐ 92 -->\r\n      <dx-check-box *ngIf=\"!isHdGTGT\" [(value)]=\"frmData.is_exemption_decree\" text=\"Giảm thuế theo NĐ số 92/2021\"\r\n        (onValueChanged)=\"_changeND92($event)\"></dx-check-box>\r\n      <div *ngIf=\"!isHdGTGT\" class=\"toggle normal\"\r\n        style=\"display: inline-block; align-items: center;margin-right: 42px;margin-left: 7px;\">\r\n        <img id=\"link3\" style=\"cursor: pointer\" src=\"assets\\img\\icons\\Icon_Information.png\"\r\n          (click)=\"onClickGuidReduce()\" alt=\"efy.vn\" alt=\"Efy.vn\">\r\n      </div>\r\n      <!-- Nghị định 43 -->\r\n      <dx-check-box *ngIf=\"!isHdGTGT\" style=\"margin-right:20px\" [(value)]=\"frmData.is_resolution_43\"\r\n        text=\"{{ _translate.THONG_TIN.giam_thue_theo_nq43 }}\" (onValueChanged)=\"_changeNQ43($event)\">\r\n      </dx-check-box>\r\n      <dx-check-box *ngIf=\"configs.system_parameter.view_sale_by_phone\" id=\"auto-input\"\r\n        text=\"{{ _translate.CONTROLL.LABEL.sale_by_phone }}\" [(value)]=\"frmData.sale_by_phone\"></dx-check-box>\r\n      <!-- Tổng tiền từ âm chuyển thành dương -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.BUTTON.total_money_from_negative_to_positive }}\"\r\n        [(value)]=\"frmData.is_total_amount_negative_to_positive\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- Không tự tính -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.no_calculation }}\" [(value)]=\"frmData.auto_value\"\r\n        (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- Tính thành tiền, tiền thuế theo số lượng và tổng tiền -->\r\n      <dx-check-box *ngIf=\"isHdGTGT\" id=\"auto-input\" text=\"{{_translate.CONTROLL.LABEL.auto_value_price }}\"\r\n        [(value)]=\"frmData.auto_value_price\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <dx-button text=\"Lấy hàng hóa HĐ gốc\" type=\"default\" (click)=\"thayTheToanBo()\" [disabled]=\"!isHangHoaDichVu\">\r\n      </dx-button>\r\n      <input type=\"file\" id=\"file-bang-ke\" accept=\".xlsx\" (change)=\"onFileBangKeChange($event)\" multiple=\"false\"\r\n        style=\"display: none;\" />\r\n    </div>\r\n    <div class=\"pull-right\" *ngIf=\"isPXKDaiLy || isPXKNB\">\r\n      <!-- Không tự tính -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.no_calculation }}\" [(value)]=\"frmData.auto_value\"\r\n        (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <dx-button text=\"Lấy hàng hóa HĐ gốc\" type=\"default\" [disabled]=\"!isHangHoaDichVu\" (click)=\"thayTheToanBo()\">\r\n      </dx-button>\r\n      <input type=\"file\" id=\"file-bang-ke\" accept=\".xlsx\" (change)=\"onFileBangKeChange($event)\" multiple=\"false\"\r\n        style=\"display: none;\" />\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- <button type=\"button\" (click)=\"aa()\">aaa</button> -->\r\n<!-- popup -->\r\n<dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"{{ _translate.NOTIFY.notify }}\"\r\n  [dragEnabled]=\"false\" [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">{{ _translate.CONFIRM.import_type }}</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"thayTheToanBo()\" text=\"{{ _translate.CONTROLL.BUTTON.replace_all }}\" type=\"default\">\r\n      </dx-button>\r\n      <dx-button (click)=\"themTiep()\" text=\"{{ _translate.CONTROLL.BUTTON.add_more }}\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"huy()\" text=\"{{ _translate.CONTROLL.BUTTON.cancel }}\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup>\r\n<!-- phần table hiển thị -->\r\n<div class=\"row invoice-table\">\r\n  <div class=\"col-md-12\">\r\n    <dx-data-grid id=\"gridInvoice\" [dataSource]=\"dataSource\" [showBorders]=\"true\" [showRowLines]=\"true\"\r\n      [allowColumnResizing]=\"true\" [columnResizingMode]=\"true\" [wordWrapEnabled]=\"true\"\r\n      (onKeyDown)=\"onGripKeyDown($event)\" (onContextMenuPreparing)=\"onContextMenuPreparing($event)\"\r\n      (onEditorPrepared)=\"onEditorPrepared($event)\" (onEditorPreparing)=\"onEditorPreparing($event)\"\r\n      (onRowPrepared)=\"onRowPrepared($event)\" *ngIf=\"!isPXKDaiLy && !isPXKNB\" (onContentReady)=\"onContentReady($event)\">\r\n      <!-- [wordWrapEnabled]=\"true\" -->\r\n      <dxo-editing mode=\"cell\" [allowUpdating]=\"gripAllowEdit\"></dxo-editing>\r\n      <!-- <dxo-selection showCheckBoxesMode=\"none\" mode=\"single\"></dxo-selection> -->\r\n      <dxo-sorting mode=\"false\"></dxo-sorting>\r\n      <dxi-column cellTemplate=\"deleteColumn\" [fixed]=\"true\" fixedPosition=\"left\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.delete }}\" [allowEditing]=\"false\"\r\n        width=\"{{ _translate.GRID_WIDTH.delete_column }}\" minWidth=\"{{ _translate.GRID_WIDTH.delete_column }}\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column dataField=\"view_order\" [fixed]=\"true\" fixedPosition=\"left\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.view_order }}\" width=\"{{ _translate.GRID_WIDTH.stt }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.stt }}\" alignment=\"center\"></dxi-column>\r\n      <!-- Phương thức điều chỉnh -->\r\n      <dxi-column *ngIf=\"isPhuongThucDC\" dataField=\"adjustment_form\" minWidth=\"{{ _translate.GRID_WIDTH.unit_code }}\"\r\n        width=\"{{ _translate.GRID_WIDTH.unit_code }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.modes_of_adjustment }}\" alignment=\"center\" [fixed]=\"true\"\r\n        fixedPosition=\"left\" [editorOptions]=\"{showClearButton: true}\">\r\n        <dxo-lookup [dataSource]=\"select.adjustment_methods\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"(extentionGrid && extentionGrid.don_hang_hop_dong) || (configs && configs.system_parameter && configs.system_parameter.display_contract_order)\"\r\n        dataField=\"contract_order\" minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.po_no_contract_no }}\" alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"extentionGrid && extentionGrid.ma_quan_ly\" dataField=\"management_code\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.management_code }}\" alignment=\"left\"></dxi-column>\r\n      <!-- mã hàng hóa -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_add_product_code\" dataField=\"product_code\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_code }}\" minWidth=\"{{ _translate.GRID_WIDTH.ma_hang }}\"\r\n        alignment=\"center\" [editorOptions]=\"editorOptionsForCode\">\r\n        <dxo-lookup [dataSource]=\"select.productsView\" displayExpr=\"mhvth\" valueExpr=\"product_code\" *ngIf=\"!isAll\">\r\n        </dxo-lookup>\r\n        <dxo-lookup [dataSource]=\"select.productsViewFull\" displayExpr=\"mhvth\" valueExpr=\"code\" *ngIf=\"isAll\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"( !configs.system_parameter.is_add_product_code && isTextProductName )\"\r\n        [editorOptions]=\"{showClearButton: true}\" dataField=\"product_name\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_name }}\" alignment=\"left\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\">\r\n        <dxo-lookup [dataSource]=\"select.productsView\" displayExpr=\"product_name\" valueExpr=\"product_name\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"(!isTextProductName) || (configs.system_parameter.is_add_product_code  && isTextProductName)\"\r\n        dataField=\"product_name\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_name }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.incurred_refund_ticket\" cellTemplate=\"PhiHoanVe\"\r\n        caption=\"{{ _translate.CONTROLL.LABEL.refund_fee }}\" minWidth=\"{{ _translate.GRID_WIDTH.cktm }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\" [fixed]=\"true\" fixedPosition=\"left\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect.template_type=='HOA_DON_KINH_DOANH_XE') || (_oTemplateTT78.template_type=='HOA_DON_KINH_DOANH_XE'))\"\r\n        dataField=\"engine_number\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.engine_number }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.so_may }}\" alignment=\"center\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect.template_type=='HOA_DON_KINH_DOANH_XE') || (_oTemplateTT78.template_type=='HOA_DON_KINH_DOANH_XE'))\"\r\n        dataField=\"chassis_number\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.chassis_number }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.so_khung }}\" alignment=\"center\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && (_objTemplateSelect.template_type=='HOA_DON_NHA_HANG_KHACH_SAN' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_CHUNG')) || (_oTemplateTT78 && (_oTemplateTT78.template_type=='HOA_DON_NHA_HANG_KHACH_SAN' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_CHUNG')))\"\r\n        cellTemplate=\"phi_dich_vu\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.money_service }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\" [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_promotion\" cellTemplate=\"dien_giai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.explain }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.promotional_goods_on_the_invoice\" cellTemplate=\"khuyen_mai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.promotion }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_lot\" dataField=\"lot\" minWidth=\"{{ _translate.GRID_WIDTH.lot }}\"\r\n        width=\"{{ _translate.GRID_WIDTH.lot }}\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.lot }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_expiration_date\" dataField=\"expiration_date\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.expiration_date }}\" alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_country\" [editorOptions]=\"{showClearButton: true}\"\r\n        dataField=\"country_code\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.country }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.country }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.countrys\" displayExpr=\"name\" valueExpr=\"code\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.commercial_discount\" cellTemplate=\"cktm\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.commercial_discount }}\" width=\"{{ _translate.GRID_WIDTH.cktm }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.cktm }}\" [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_provisions_on_accounts\" dataField=\"provisions_on_accounts\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.provisions_on_accounts }}\"\r\n        width=\"{{ _translate.GRID_WIDTH.dinh_khoan }}\" minWidth=\"{{ _translate.GRID_WIDTH.dinh_khoan }}\"\r\n        alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.select_provisions_on_accounts\" displayExpr=\"name\" valueExpr=\"code\"\r\n          onValueChanged=\"b($event)\"></dxo-lookup>\r\n      </dxi-column>\r\n      <!-- Nàu sắc, chất liệu -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.color_material\" dataField=\"color_material\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.mau_sac }}\" caption=\"{{ _translate.CONFIGS.color_material }}\"\r\n        alignment=\"left\"></dxi-column>\r\n      <!-- Số tham chiếu -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.items_number\" dataField=\"items_number\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"{{ _translate.CONTROLL.LABEL.reference_number }}\"\r\n        alignment=\"left\"></dxi-column>\r\n      <!-- Ngày -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.complete_order_date\" dataField=\"complete_order_date\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"{{ _translate.CONFIGS.day }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <!-- mpq -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.mpq\" dataField=\"mpq\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"MPQ\" alignment=\"left\"></dxi-column>\r\n      <!-- Đơn vị tính -->\r\n      <dxi-column dataField=\"unit_code\" [editorOptions]=\"lookupColumnOptions\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.unit_code }}\" width=\"{{ _translate.GRID_WIDTH.unit_code }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.unit_code }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.unit_codes\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n      </dxi-column>\r\n      <!-- Ngày -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.product_date\" dataField=\"product_date\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"{{ _translate.CONFIGS.day }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <!-- Tỷ giá -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.product_exchange_rate\" dataField=\"product_exchange_rate\"\r\n        headerCellTemplate=\"exchangeRateHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        [editorOptions]=\"{ format: formatter.ty_gia,step: '0' }\" [format]=\"formatter.ty_gia\" dataType=\"number\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column dataField=\"quantity\" headerCellTemplate=\"quantityHeader\" width=\"{{ _translate.GRID_WIDTH.so_luong }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.so_luong }}\" [editorOptions]=\"{ format: formatter.so_luong }\"\r\n        [format]=\"formatter.so_luong\" dataType=\"number\" alignment=\"center\"></dxi-column>\r\n      <!-- Đơn giá sau thuế -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.price_after_vat\" dataField=\"price_after_vat\"\r\n        headerCellTemplate=\"priceaftervatHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        [editorOptions]=\"{ format: formatter.don_gia_sau_thue,step: '0' }\" [format]=\"formatter.don_gia_sau_thue\"\r\n        dataType=\"number\" alignment=\"right\"></dxi-column>\r\n\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_price_nte\" dataField=\"price_nte\"\r\n        headerCellTemplate=\"price_nteHeader\" width=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\" [editorOptions]=\"{ format: formatter.don_gia_nte }\"\r\n        [format]=\"formatter.don_gia_nte\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column dataField=\"price\" headerCellTemplate=\"priceHeader\" width=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\" [editorOptions]=\"{ format: formatter.don_gia }\"\r\n        [format]=\"formatter.don_gia\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && _objTemplateSelect.template_type!='HOA_DON_BAN_GIAO_XE' && _objTemplateSelect.template_type!='HOA_DON_BAO_DUONG_XE')\r\n      || (_oTemplateTT78 && _oTemplateTT78.is_discount && _oTemplateTT78.template_type!='HOA_DON_BAN_GIAO_XE' && _oTemplateTT78.template_type!='HOA_DON_BAO_DUONG_XE'))\"\r\n        dataField=\"amount_without_discount\" headerCellTemplate=\"amountNoDiscountHeader\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.thanh_tien }}\" [editorOptions]=\"{ format: formatter.thanh_tien_chua_ck }\"\r\n        [format]=\"formatter.thanh_tien_chua_ck\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && _objTemplateSelect.template_type!='HOA_DON_BAN_GIAO_XE' && _objTemplateSelect.template_type!='HOA_DON_BAO_DUONG_XE')\r\n      || (_oTemplateTT78 && _oTemplateTT78.is_discount && _oTemplateTT78.template_type!='HOA_DON_BAN_GIAO_XE' && _oTemplateTT78.template_type!='HOA_DON_BAO_DUONG_XE'))\"\r\n        dataField=\"discount\" headerCellTemplate=\"discountHeader\" width=\"{{ _translate.GRID_WIDTH.chiet_khau }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.chiet_khau }}\" [editorOptions]=\"{ format: formatter.ty_le_chiet_khau }\"\r\n        [format]=\"formatter.ty_le_chiet_khau\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount) || (_oTemplateTT78 && _oTemplateTT78.is_discount))\"\r\n        dataField=\"amount_discount\" headerCellTemplate=\"amount_discountHeader\"\r\n        width=\"{{ _translate.GRID_WIDTH.tien_chiet_khau }}\" minWidth=\"{{ _translate.GRID_WIDTH.tien_chiet_khau }}\"\r\n        [editorOptions]=\"{ format: formatter.tien_chiet_khau }\" [format]=\"formatter.tien_chiet_khau\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.discount_on_price\" dataField=\"discount_on_price\"\r\n        headerCellTemplate=\"discount_on_priceHeader\" minWidth=\"{{ _translate.GRID_WIDTH.tien_chiet_khau }}\"\r\n        [editorOptions]=\"{ format: formatter.ck_theo_don_gia }\" [format]=\"formatter.ck_theo_don_gia\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && (_objTemplateSelect.template_type=='HOA_DON_BAN_GIAO_XE' || _objTemplateSelect.template_type=='HOA_DON_BAO_DUONG_XE'))\r\n  || (_oTemplateTT78 && _oTemplateTT78.is_discount && (_oTemplateTT78.template_type=='HOA_DON_BAN_GIAO_XE' || _oTemplateTT78.template_type=='HOA_DON_BAO_DUONG_XE'))) || configs.system_parameter.discount_on_price\"\r\n        dataField=\"price_after_discount\" headerCellTemplate=\"priceHeaderAfterDiscount\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\" [editorOptions]=\"{ format: formatter.don_gia,step: '0' }\"\r\n        [format]=\"formatter.don_gia\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"amount\" headerCellTemplate=\"amountHeader\" width=\"{{ _translate.GRID_WIDTH.thanh_tien }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.thanh_tien }}\" [editorOptions]=\"{ format: formatter.thanh_tien }\"\r\n        [format]=\"formatter.thanh_tien\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column cssClass=\"vat-invoices\" *ngIf=\"isHdGTGT\" dataField=\"vat\" [editorOptions]=\"{showClearButton: true}\"\r\n        headerCellTemplate=\"vatHeader\" width=\"{{ _translate.GRID_WIDTH.vat }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.vat }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.vats\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && (_objTemplateSelect.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')) || (_oTemplateTT78 && (_oTemplateTT78.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n        dataField=\"other_tax\" caption=\"{{ _translate.CONTROLL.LABEL.othertax  }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\" [editorOptions]=\"{ format: formatter.thanh_tien, step: '0' }\"\r\n        [format]=\"formatter.thanh_tien\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && (_objTemplateSelect.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')) || (_oTemplateTT78 && (_oTemplateTT78.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n        dataField=\"other_charge\" caption=\"{{ _translate.CONTROLL.LABEL.money_other  }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\" [editorOptions]=\"{ format: formatter.thanh_tien, step: '0' }\"\r\n        [format]=\"formatter.thanh_tien\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column *ngIf=\"isHdGTGT\" dataField=\"amount_vat\" headerCellTemplate=\"amountVatHeader\"\r\n        width=\"{{ _translate.GRID_WIDTH.tien_thue }}\" minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\"\r\n        [editorOptions]=\"{ format: formatter.tien_thue }\" [format]=\"formatter.tien_thue\" dataType=\"number\"\r\n        alignment=\"right\"></dxi-column>\r\n      <dxi-column dataField=\"amount_after_vat\" headerCellTemplate=\"amountAfterVatHeader\"\r\n        width=\"{{ _translate.GRID_WIDTH.tong_tien_sau_thue }}\" minWidth=\"{{ _translate.GRID_WIDTH.tong_tien_sau_thue }}\"\r\n        [editorOptions]=\"{ format: formatter.tong_tien }\" [format]=\"formatter.tong_tien\" dataType=\"number\"\r\n        alignment=\"right\"></dxi-column>\r\n      <!-- config column header -->\r\n      <div *dxTemplate=\"let d of 'exchangeRateHeader'\">\r\n        <p (click)=\"configDecimal('ty_gia')\" style=\"cursor: pointer;\">\r\n          {{ _translate.CONTROLL.LABEL.currency_rate }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'quantityHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.quantity }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeader'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.price }} <img\r\n            src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceaftervatHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_sau_thue')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.price_after_vat }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeaderAfterDiscount'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.price_after_discount }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'price_nteHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_nte')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.price_nte\r\n          }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.amount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'discount_on_priceHeader'\">\r\n        <p (click)=\"configDecimal('ck_theo_don_gia')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.discount_on_price }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountNoDiscountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien_chua_ck')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.amount_without_discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'discountHeader'\">\r\n        <p (click)=\"configDecimal('ty_le_chiet_khau')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amount_discountHeader'\">\r\n        <p (click)=\"configDecimal('tien_chiet_khau')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.amount_discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'vatHeader'\">\r\n        <p>VAT</p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountVatHeader'\">\r\n        <p (click)=\"configDecimal('tien_thue')\" style=\"cursor: pointer;\"> {{ _translate.GRID.INVOICE_DETAILS.amount_vat\r\n          }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountAfterVatHeader'\">\r\n        <p (click)=\"configDecimal('tong_tien')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.total_money\r\n          }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'dien_giai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion\" [disabled]=\"d.data.is_promotion_new\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'khuyen_mai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion_new\" [disabled]=\"d.data.is_promotion\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'phi_dich_vu'\">\r\n        <dx-check-box [(value)]=\"d.data.is_money_service\" (onValueChanged)=\"changePhiDV(d.data)\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'cktm'\">\r\n        <dx-check-box [(value)]=\"d.data.commercial_discount\" (onValueChanged)=\"cktmChange(d.data)\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'PhiHoanVe'\">\r\n        <dx-check-box [(value)]=\"d.data.is_refund_ticket\" (onValueChanged)=\"changePhiHoanVe(d.data)\"></dx-check-box>\r\n      </div>\r\n      <!-- config column -->\r\n      <div id=\"context-table\" *dxTemplate=\"let d of 'deleteColumn'\">\r\n        <a class=\"delete-row\" href=\"javascript:void(0)\" (click)=\"deleteRow(d.data)\"><i class=\"fa fa-times\"></i></a>\r\n      </div>\r\n      <dxo-paging [enabled]=\"false\"></dxo-paging>\r\n      <dxo-remote-operations [sorting]=\"false\" [filtering]=\"false\"></dxo-remote-operations>\r\n    </dx-data-grid>\r\n    <dx-data-grid id=\"gridInvoice\" [dataSource]=\"dataSource\" [showBorders]=\"true\" [showRowLines]=\"true\"\r\n      [allowColumnResizing]=\"true\" [columnResizingMode]=\"true\" [wordWrapEnabled]=\"true\"\r\n      (onKeyDown)=\"onGripKeyDown($event)\" (onContextMenuPreparing)=\"onContextMenuPreparing($event)\"\r\n      (onEditorPrepared)=\"onEditorPrepared($event)\" (onEditorPreparing)=\"onEditorPreparing($event)\"\r\n      (onRowPrepared)=\"onRowPrepared($event)\" *ngIf=\"isPXKDaiLy || isPXKNB\" (onContentReady)=\"onContentReady($event)\">\r\n      <!-- [wordWrapEnabled]=\"true\" (onEditorPrepared)=\"onEditorPrepared($event)\" -->\r\n      <dxo-editing mode=\"cell\" [allowUpdating]=\"gripAllowEdit\"></dxo-editing>\r\n      <dxo-sorting mode=\"false\"></dxo-sorting>\r\n      <dxi-column cellTemplate=\"deleteColumn\" caption=\"{{_translate.GRID.INVOICE_DETAILS.delete }}\" width=\"40\"\r\n        [allowEditing]=\"false\" alignment=\"center\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"view_order\" caption=\"{{_translate.GRID.INVOICE_DETAILS.view_order }}\" width=\"40\"\r\n        alignment=\"center\"></dxi-column>\r\n      <!-- mã hàng hóa -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_add_product_code\" dataField=\"product_code\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_code }}\" minWidth=\"{{ _translate.GRID_WIDTH.ma_hang }}\"\r\n        alignment=\"center\" [editorOptions]=\"editorOptionsForCode\">\r\n        <dxo-lookup [dataSource]=\"select.productsView\" displayExpr=\"mhvth\" valueExpr=\"product_code\" *ngIf=\"!isAll\">\r\n        </dxo-lookup>\r\n        <dxo-lookup [dataSource]=\"select.productsViewFull\" displayExpr=\"mhvth\" valueExpr=\"code\" *ngIf=\"isAll\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"( !configs.system_parameter.is_add_product_code && isTextProductName )\"\r\n        [editorOptions]=\"{showClearButton: true}\" dataField=\"product_name\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_name }}\" alignment=\"left\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\">\r\n        <dxo-lookup [dataSource]=\"select.productsView\" displayExpr=\"product_name\" valueExpr=\"product_name\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"(!isTextProductName) || (configs.system_parameter.is_add_product_code  && isTextProductName)\"\r\n        dataField=\"product_name\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_name }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <!-- Đơn hàng/ Hợp đồng -->\r\n      <dxi-column\r\n        *ngIf=\"(extentionGrid && extentionGrid.don_hang_hop_dong) || (configs && configs.system_parameter && configs.system_parameter.display_contract_order)\"\r\n        dataField=\"contract_order\" minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.po_no_contract_no }}\" alignment=\"left\"></dxi-column>\r\n      <!-- <dxi-column dataField=\"number_code\" caption=\"{{_translate.GRID.INVOICE_DETAILS.code }}\"\r\n        alignment=\"left\"></dxi-column> -->\r\n      <!-- Diễn giải -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_promotion\" cellTemplate=\"dien_giai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.explain }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <!-- Khuyến mại -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.promotional_goods_on_the_invoice\" cellTemplate=\"khuyen_mai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.promotion }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column dataField=\"unit_code\" caption=\"{{_translate.GRID.INVOICE_DETAILS.unit_code }}\" [width]=\"100\"\r\n        alignment=\"center\" [editorOptions]=\"lookupColumnOptions\">\r\n        <dxo-lookup [dataSource]=\"select.unit_codes\" displayExpr=\"name\" valueExpr=\"code\" onValueChanged=\"b($event)\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"isPXKDaiLy\" dataField=\"quantity\" headerCellTemplate=\"quantityHeader\" [width]=\"100\"\r\n        [editorOptions]=\"{ format: formatter.so_luong }\" [format]=\"formatter.so_luong\" dataType=\"number\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"!isPXKDaiLy\" dataField=\"number_real_export\" headerCellTemplate=\"quantity_exportHeader\"\r\n        [width]=\"100\" [editorOptions]=\"{ format: formatter.so_luong }\" [format]=\"formatter.so_luong\" dataType=\"number\"\r\n        alignment=\"center\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"!isPXKDaiLy\" dataField=\"number_real_import\" headerCellTemplate=\"quantity_importHeader\"\r\n        [width]=\"100\" [editorOptions]=\"{ format: formatter.so_luong\t }\" [format]=\"formatter.so_luong\" dataType=\"number\"\r\n        alignment=\"center\">\r\n      </dxi-column>\r\n\r\n      <dxi-column dataField=\"price\" headerCellTemplate=\"priceHeader\" [width]=\"90\"\r\n        [editorOptions]=\"{ format: formatter.don_gia }\" [format]=\"formatter.don_gia\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"amount\" headerCellTemplate=\"amountHeader\" [width]=\"109\"\r\n        [editorOptions]=\"{ format: formatter.thanh_tien }\" [format]=\"formatter.thanh_tien\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n\r\n      <dxi-column dataField=\"amount_after_vat\" headerCellTemplate=\"amountAfterVatHeader\" [width]=\"150\"\r\n        [editorOptions]=\"{ format: formatter.tong_tien }\" [format]=\"formatter.tong_tien\" dataType=\"number\"\r\n        alignment=\"right\"></dxi-column>\r\n      <!-- config column header -->\r\n      <div *dxTemplate=\"let d of 'quantityHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.quantity }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeader'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{_translate.GRID.INVOICE_DETAILS.price }}<img\r\n            src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'quantity_exportHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.quantity_export }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'quantity_importHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.quantity_import }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'price_nteHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_nte')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.price_nte }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien')\" style=\"cursor: pointer;\">{{_translate.GRID.INVOICE_DETAILS.amount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'vatHeader'\">\r\n        <p>VAT</p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'dien_giai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion\" [disabled]=\"d.data.is_promotion_new\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'khuyen_mai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion_new\" [disabled]=\"d.data.is_promotion\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountVatHeader'\">\r\n        <p (click)=\"configDecimal('tien_thue')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.amount_vat }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountAfterVatHeader'\">\r\n        <p (click)=\"configDecimal('tong_tien')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.amount_after_vat }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <!-- config column -->\r\n      <div id=\"context-table\" *dxTemplate=\"let d of 'deleteColumn'\">\r\n        <a class=\"delete-row\" href=\"javascript:void(0)\" (click)=\"deleteRow(d.data)\"><i class=\"fa fa-times\"></i></a>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'cktm'\">\r\n        <dx-check-box [(value)]=\"d.data.commercial_discount\" (onValueChanged)=\"cktmChange()\"></dx-check-box>\r\n      </div>\r\n      <dxo-paging [enabled]=\"false\"></dxo-paging>\r\n      <dxo-remote-operations [sorting]=\"false\" [filtering]=\"false\"></dxo-remote-operations>\r\n\r\n    </dx-data-grid>\r\n  </div>\r\n</div>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.scss":
/*!*****************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.scss ***!
  \*****************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".delete-row i{color:#0E77BB;font-size:18px}.support-invoice{margin-bottom:10px;margin-top:20px}.support-invoice .support-link{padding:6px 15px;border:1px solid #007bff;text-decoration:none}.support-invoice .support-link.mgr-15{margin-right:15px}.support-invoice .support-link img{margin-right:15px;margin-top:-2px}.support-invoice #auto-input{margin-right:20px !important}::ng-deep .vat-invoices .dx-texteditor-buttons-container{display:-ms-inline-grid;display:inline-grid}.button-dropdown-extend{display:inline-flex}::ng-deep .wrap-column-autoC{padding:0px !important}::ng-deep .wrap-column-autoC .wrap-code-template dx-autocomplete{border:none !important}::ng-deep .wrap-column-autoC .wrap-code-template dx-autocomplete input{text-align:center}::ng-deep .wrap-column-autoC .wrap-name-template dx-autocomplete{border:none !important}::ng-deep .wrap-column-autoC .wrap-name-template dx-autocomplete input{text-align:left}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.ts":
/*!***************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.ts ***!
  \***************************************************************************************************************/
/*! exports provided: AdjustProductGripComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustProductGripComponent", function() { return AdjustProductGripComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! devextreme/data/custom_store */ "./node_modules/devextreme/data/custom_store.js");
/* harmony import */ var devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @core/library/public/v-select-box.service */ "./src/app/core/library/public/v-select-box.service.ts");
/* harmony import */ var _modules_products_shared__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @modules/products/shared */ "./src/app/modules/products/shared/index.ts");
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! xlsx */ "./node_modules/xlsx/xlsx.js");
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(xlsx__WEBPACK_IMPORTED_MODULE_12__);
/* harmony import */ var _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @shared/service/invoice.service */ "./src/app/shared/service/invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};














var AdjustProductGripComponent = /** @class */ (function () {
    function AdjustProductGripComponent(authService, route, router, modalService, vatService, translate, productsService, invoiceService) {
        var _this = this;
        this.authService = authService;
        this.route = route;
        this.router = router;
        this.modalService = modalService;
        this.vatService = vatService;
        this.translate = translate;
        this.productsService = productsService;
        this.invoiceService = invoiceService;
        this.contextMenu = [{ text: 'Thêm' }, { text: 'Xóa' }];
        this.select = {};
        this.showPopup = false; //Popup
        this.dataExcelFile = null;
        this.ttDaXuatHoaDon = false;
        this.isTextProductName = false;
        this.isPhuongThucDC = false;
        this.visibleProductName = true;
        this.gripAllowEdit = false;
        this.reloadSelectProduct = true;
        this.isAll = false;
        this.isHdGTGT = true;
        this.rowData = 1;
        this.isPXKDaiLy = false;
        this.isPXKNB = false;
        this.extras = [];
        this.dataExcelFileInfo = null;
        this.isHangHoaDichVu = false;
        this.gripChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.autoChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.lookupColumnOptions = {
            acceptCustomValue: true,
            showClearButton: true,
            onCustomItemCreating: function (args) {
                var _this = this;
                //
                //
                var newItem = {};
                newItem.code = _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._convertToViKdau(args.text);
                newItem.name = args.text;
                this.select.unit_codes.unshift(newItem);
                setTimeout(function () {
                    _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                        dataSource: _this.select.unit_codes,
                        displayExpr: 'name',
                        valueExpr: 'code'
                    });
                });
                return newItem;
            }.bind(this)
        };
        this.onContentReady = function (e) {
            var arrFooter = [
                { name: _this._translate.GRID.INVOICE_DETAILS.amount_after_vat, class: 'table-footer-1' },
                { name: _this._translate.GRID.INVOICE_DETAILS.total_money, class: 'table-footer-1' },
                { name: _this._translate.GRID.INVOICE_DETAILS.amount_vat, class: 'table-footer-2' },
                { name: _this._translate.GRID.INVOICE_DETAILS.amount, class: 'table-footer-3' },
                { name: _this._translate.GRID.INVOICE_DETAILS.amount_without_discount, class: 'table-footer-4' },
            ];
            _this.invoiceService.formatSumColumnGrid(arrFooter);
        };
        this.editorOptionsForCode = {
            acceptCustomValue: true,
            showClearButton: true,
            onCustomItemCreating: function (args) {
                if (_this.isAll)
                    return _this.invoiceService.addProductInSelecBox(args, _this.select.productsViewFull, _this.dataGrid);
                else
                    return _this.invoiceService.addProductInSelecBox(args, _this.select.productsView, _this.dataGrid, { valueExpr: 'product_code' });
            }
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
        this.extras = [{
                id: '1',
                name: this._translate.CONTROLL.BUTTON.import_from_excel,
                items: [
                    {
                        id: 'LAY_MAU_BANG_KE',
                        name: this._translate.CONTROLL.BUTTON.get_the_sample_file,
                        icon: this._translate.ICONS.download
                    },
                    {
                        id: 'NAP_DU_LIEU_BANG_KE',
                        name: this._translate.CONTROLL.BUTTON.import_data,
                        icon: this._translate.ICONS.excel
                    }
                ]
            }];
    }
    AdjustProductGripComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.loaiHoaDon = this.route.snapshot.data.type;
        if (this.loaiHoaDon == '03XKNB')
            this.isPXKNB = true;
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.HGDL04)
            this.isPXKDaiLy = true;
        if (this.oldForm.template_code.indexOf('02GTTT') >= 0 || this.oldForm.template_code.indexOf('07KPTQ') >= 0 || this.oldForm.template_code == "2") {
            this.isHdGTGT = false;
        }
        this.configs = this.authService.getConfigs();
        this.routeSub = this.route.data.subscribe(function (data) {
            //put data DM for select
            _this.select.unit_codes = data.init[1].DM_DON_VI_TINH;
            _this.select.vats = data.init[1].DM_TY_LE_VAT;
            _this.select.countrys = data.init[1].DM_QUOC_GIA;
            _this.select.select_provisions_on_accounts = data.init[1].DM_DINH_KHOAN;
            _this.select.adjustment_methods = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_10__["VSelectBoxService"]._adjustmentMethods(_this._translate);
            //Hàng hóa dịch vụ
            _this.select.products = [];
            _this.productsFull = data.init[5];
            _this.productsFull.forEach(function (item) {
                if (item.code) {
                    item.mhvth = item.code + ': ' + item.name;
                }
                else {
                    item.mhvth = "(Chưa có mã hàng) " + ': ' + item.name;
                }
            });
            var len_data = data.init.length;
            _this.oldForm.invoice_products.forEach(function (item) {
                _this.select.products.push(item);
            });
            _this.select.products.forEach(function (item) {
                if (item.product_code) {
                    item.mhvth = item.product_code + ': ' + item.product_name;
                }
                else {
                    item.mhvth = "(Chưa có mã hàng) " + ': ' + item.product_name;
                }
            });
            _this.select.productsViewFull = {
                store: new devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default.a({
                    key: 'code',
                    loadMode: 'raw',
                    load: function (loadOptions) {
                        return _this.productsFull;
                    },
                    byKey: function (key) {
                        var _data = data.init[0].filter(function (p) { return p.code === key.toString(); });
                        return _data;
                    }
                }),
                paginate: true,
                sort: 'name'
            };
            if (_this.configs.system_parameter.is_add_product_code) {
                _this.isTextProductName = false;
                _this.select.productsView = {
                    store: new devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default.a({
                        key: 'product_code',
                        loadMode: 'raw',
                        load: function (loadOptions) {
                            return _this.select.products;
                        },
                        byKey: function (key) {
                            var _data = data.init[0].filter(function (p) { return p.code === key.toString(); });
                            return _data;
                        }
                    }),
                    paginate: true,
                    sort: 'product_name'
                };
            }
            else {
                _this.select.productsView = {
                    store: new devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_4___default.a({
                        key: 'product_name',
                        loadMode: 'raw',
                        load: function (loadOptions) {
                            return _this.select.products;
                        },
                        byKey: function (key) {
                            // console.log(encodeURIComponent(key) + " abc");
                            return [];
                            // let _data = data.init[2].filter(p => p.code == key.toString());
                            // return _data;
                        }
                    }),
                    paginate: true,
                    sort: 'product_name'
                };
            }
            if (data.init[3]) {
                if (data.init[3].invoice_products) {
                    data.init[3].invoice_products.forEach(function (item) {
                        if (item.product_name && item.unit_code) {
                            var obj1 = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                            if (!obj1) {
                                _this.select.unit_codes.push({
                                    id: _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].makeid(),
                                    code: item.unit_code,
                                    name: item.unit_name ? item.unit_name : item.unit_code
                                });
                            }
                        }
                    });
                }
            }
            _this.invoiceService.addProductInListP(_this.select.products, _this.invoice_products._array, 'product_code', 'mhvth');
            _this.invoiceService.addProductInListP(_this.productsFull, _this.invoice_products._array, 'code', 'mhvth');
        });
        //Event
        this.createUpdateEvent();
    };
    AdjustProductGripComponent.prototype.changeColumnProductNameToSelect = function () {
        var _this = this;
        this.isAll = false;
        this.isTextProductName = true;
        setTimeout(function () {
            _this.dataGrid.instance.refresh();
        }, 100);
    };
    AdjustProductGripComponent.prototype.changeColumnProductNameToText = function () {
        var _this = this;
        if (this.isPXKDaiLy || this.isPXKNB) {
            this.isAll = true;
        }
        else {
            if (this.configs.system_parameter.is_add_product_code) {
                this.isAll = true;
            }
            else {
                this.isTextProductName = false;
            }
            setTimeout(function () {
                _this.dataGrid.instance.refresh();
            }, 100);
        }
    };
    AdjustProductGripComponent.prototype.ShowAndHidePhuongThucDC = function (value, phuongThucDieuChinh) {
        var _this = this;
        if (phuongThucDieuChinh == 'GIAM_HH_DV' || phuongThucDieuChinh == 'TANG_HH_DV') {
            this.isHangHoaDichVu = true;
        }
        else {
            this.isHangHoaDichVu = false;
        }
        this.isPhuongThucDC = value;
        this.isAll = value;
        setTimeout(function () {
            _this.dataGrid.instance.refresh();
        }, 100);
    };
    //khởi tạo sự kiện khi update
    AdjustProductGripComponent.prototype.createUpdateEvent = function () {
        var _this = this;
        setTimeout(function () {
            _this.invoice_products.on('updated', function (key, value) {
                var column = Object.keys(value)[0];
                _this.invoice_products.byKey(key).then(function (row) {
                    switch (column) {
                        case 'view_order':
                            _this.view_orderChange();
                            break;
                        case 'product_name':
                            _this.product_nameChange(row);
                            break;
                        case 'product_code':
                            if (_this.isAll) {
                                _this.product_codeChangeFull(row);
                            }
                            else {
                                _this.product_codeChange(row);
                            }
                            break;
                        case 'unit_code':
                            _this.unit_codeChange(row);
                            break;
                        case 'quantity':
                        case 'number_real_export':
                        case 'price':
                        case 'price_nte':
                        case 'amount':
                        case 'amount_vat':
                        case 'amount_after_vat':
                        case 'amount_discount':
                        case 'discount':
                        case 'amount_without_discount':
                        case 'other_tax':
                        case 'other_charge':
                            _this._tinhGiaTri();
                            break;
                        case 'price_after_vat':
                            if ((row.vat == 5 || row.vat == 10) && row.price_after_vat)
                                row.price = (row.price_after_vat / (1 + row.vat / 100));
                            else
                                row.price = row.price_after_vat;
                            _this._tinhGiaTri();
                            break;
                        case 'vat':
                            if (_this.configs.system_parameter.price_after_vat) {
                                if ((row.vat == 5 || row.vat == 10) && row.price_after_vat)
                                    row.price = (row.price_after_vat / (1 + row.vat / 100));
                                else
                                    row.price = row.price_after_vat;
                            }
                            _this._tinhGiaTri();
                            break;
                        case 'adjustment_form':
                            if (row.adjustment_form == "TANG") {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(row.product_name) == "" || row.product_name === "Điều chỉnh giảm") {
                                    row.product_name = 'Điều chỉnh tăng';
                                    _this.invoice_products.update(row.id, row);
                                }
                            }
                            else if (row.adjustment_form == "GIAM") {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(row.product_name) == "" || row.product_name === "Điều chỉnh tăng") {
                                    row.product_name = 'Điều chỉnh giảm';
                                    _this.invoice_products.update(row.id, row);
                                }
                            }
                            else if (row.adjustment_form == "THONG_TIN") {
                                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(row.product_name) == "" || row.product_name === "Điều chỉnh tăng" || row.product_name === "Điều chỉnh giảm")
                                    row.product_name = "";
                                row.contract_order = null;
                                row.management_code = null;
                                row.chassis_number = null;
                                row.color_material = null;
                                row.product_exchange_rate = null;
                                row.product_date = null;
                                row.lot = null;
                                row.expiration_date = null;
                                row.country_code = null;
                                row.provisions_on_accounts = null;
                                row.unit_code = null;
                                row.quantity = null;
                                row.price_nte = null;
                                row.price = null;
                                row.price_after_vat = null;
                                row.amount_without_discount = null;
                                row.discount = null;
                                row.amount_discount = null;
                                row.discount_on_price = null;
                                row.price_after_discount = null;
                                row.amount = null;
                                row.vat = null;
                                row.other_tax = null;
                                row.other_charge = null;
                                row.items_number = null;
                                row.complete_order_date = null;
                                row.mpq = null;
                                row.amount_vat = null;
                                row.amount_after_vat = null;
                                _this.invoice_products.update(row.id, row);
                            }
                            _this._tinhGiaTri();
                            break;
                        default:
                            break;
                    }
                }, function (error) {
                    alert(error);
                });
            });
        }, 100);
    };
    AdjustProductGripComponent.prototype.onGripKeyDown = function (e) {
        if (e.event.code == 'Delete') {
            e.event.srcElement.value = null;
        }
    };
    AdjustProductGripComponent.prototype.onRowPrepared = function (e) {
        if (e.rowType == 'data') {
            e.rowElement.style.whiteSpace = 'pre-wrap';
        }
    };
    AdjustProductGripComponent.prototype.onEditorPreparing = function (e) {
        if (e.dataField === 'product_name' && e.parentType === 'dataRow' && e.editorName !== 'dxSelectBox') {
            e.editorName = 'dxTextArea';
        }
        if (e.dataField !== 'product_name' && e.dataField !== 'adjustment_form' && e.dataField !== 'unit_code') {
            if (e.row.data.adjustment_form == 'THONG_TIN')
                e.editorOptions.disabled = true;
        }
        // if (e.parentType === 'dataRow') {
        //   e.editorOptions.onFocusOut = (args) => {
        //     if (e.dataField === 'unit_code') {
        //       const _obj = this.select.unit_codes.filter(p => p.code === e.row.data.unit_code)[0];
        //       if (_obj) {
        //         e.row.data.unit_name = _obj.name;
        //       } else {
        //         e.row.data.unit_name = '';
        //       }
        //     }
        //     if (e.dataField === 'country_code') {
        //       const _obj = this.select.countrys.filter(p => p.code === e.row.data.country_code)[0];
        //       if (_obj) {
        //         e.row.data.country_name = _obj.name;
        //       } else {
        //         e.row.data.country_name = '';
        //       }
        //     }
        //     this.invoice_products.update(e.row.data.id, e.row.data);
        //   };
        // }
    };
    AdjustProductGripComponent.prototype.onEditorPrepared = function (e) {
        if ((e.dataField === 'amount_without_discount' || e.dataField === 'discount' || e.dataField === 'amount_discount' || e.dataField == 'quantity' || e.dataField == 'price' || e.dataField == 'amount' || e.dataField == 'amount_vat' || e.dataField == 'amount_after_vat') && e.parentType == 'dataRow') {
            e.editorElement.childNodes[1].firstChild.onwheel = function (evt) {
                e.component.cancelEditData();
            };
            e.editorElement.childNodes[1].firstChild.addEventListener('select', function () {
                this.selectionStart = this.selectionEnd;
            }, false);
        }
    };
    AdjustProductGripComponent.prototype.onContextMenuPreparing = function (e) {
        var _this = this;
        if (e.row && e.row.rowType === 'data') {
            e.items = [{
                    text: 'Thêm hàng',
                    onItemClick: function () {
                        _this.addRow(e.row.rowIndex);
                    }
                },
                {
                    text: 'Xóa hàng',
                    onItemClick: function () {
                        _this.deleteRow(e.row.data);
                    }
                }];
        }
    };
    AdjustProductGripComponent.prototype.addRow = function (rowIndexFocus) {
        if (rowIndexFocus >= 0) {
            var rowIndex = rowIndexFocus + 1;
            var data = this.frmData.add_invoice_products_data(rowIndex, rowIndex);
            if (data) {
                this.invoice_products._array.splice(rowIndex, 0, data);
                var order_1 = 0;
                this.invoice_products._array.forEach(function (item) {
                    item.order = ++order_1;
                    item.view_order = item.order;
                });
            }
        }
        else {
            var len_1, order = void 0, orderLast_1;
            this.invoice_products.load().then(function (dataSource) {
                len_1 = dataSource.length;
                orderLast_1 = dataSource[len_1 - 1].order;
            });
            for (var i = 0; i < this.rowData; i++) {
                if (len_1 >= 1) {
                    order = ++orderLast_1;
                }
                else {
                    order = 1;
                }
                var data = this.frmData.add_invoice_products_data(order, order);
                this.invoice_products.insert(data);
            }
        }
        this.dataSource.reload();
    };
    AdjustProductGripComponent.prototype.view_orderChange = function () {
        var _this = this;
        if (!this.isTT78) {
            var _index_1 = 0;
            this.dataSource.items().forEach(function (item) {
                if (item.view_order && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) != _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    item.view_order = ++_index_1;
                }
                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    if (!item.is_money_service) {
                        item.view_order = ++_index_1;
                    }
                    else {
                        item.view_order = null;
                    }
                }
            });
        }
        else {
            var _index_2 = 0;
            this.dataSource.items().forEach(function (item) {
                if (item.view_order && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) != _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    item.view_order = ++_index_2;
                }
                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    if (!item.is_money_service) {
                        item.view_order = ++_index_2;
                    }
                    else {
                        item.view_order = null;
                    }
                }
            });
        }
    };
    //Thay đổi cột mã hàng
    AdjustProductGripComponent.prototype.product_nameChange = function (row) {
        var _this = this;
        setTimeout(function () {
            _this.select.products.some(function (item) {
                if (item.product_name == row.product_name) {
                    //row.product_name = item.name;
                    row.unit_code = _this.checkUnitCode(item.unit_code);
                    row.unit_name = item.unit_name;
                    row.quantity = item.quantity ? parseFloat(item.quantity) : item.quantity;
                    row.price_after_vat = item.price_after_vat ? parseFloat(item.price_after_vat) : item.price_after_vat;
                    row.price = item.price ? parseFloat(item.price) : item.price;
                    row.price_nte = item.price_nte ? parseFloat(item.price_nte) : item.price_nte;
                    row.amount = item.price ? parseFloat(item.price) : 0;
                    row.engine_number = item.engine_number;
                    row.discount_on_price = item.discount_on_price;
                    row.price_after_discount = item.price_after_discount;
                    row.amount_discount = item.amount_discount;
                    row.chassis_number = item.chassis_number;
                    row.color_material = item.color_material;
                    row.product_date = item.product_date;
                    row.product_exchange_rate = item.product_exchange_rate;
                    row.other_tax = item.other_tax;
                    row.other_charge = item.other_charge;
                    row.items_number = item.items_number;
                    row.number_real_export = item.number_real_export ? parseFloat(item.number_real_export) : null;
                    row.number_real_import = item.number_real_import ? parseFloat(item.number_real_import) : null;
                    row.mpq = item.mpq;
                    row.complete_order_date = item.complete_order_date;
                    row.contract_order = item.contract_order;
                    row.management_code = item.management_code;
                    row.is_refund_ticket = item.is_refund_ticket;
                    row.is_promotion = item.is_promotion;
                    row.is_promotion_new = item.is_promotion_new;
                    row.lot = item.lot;
                    row.expiration_date = item.expiration_date;
                    row.country_code = item.country_code;
                    if (_this.isHdGTGT) {
                        row.vat = item.vat != null ? item.vat.toString() : null;
                        row.amount_vat = (row.vat >= 0) ? _this.caculatorAmountVat(row.amount, row.vat) : null;
                        row.amount_after_vat = row.amount + row.amount_vat;
                    }
                    else {
                        row.amount_after_vat = row.amount;
                    }
                    _this.invoice_products.update(row.order, row);
                    return true;
                }
            });
            _this._tinhGiaTri();
        }, 200);
    };
    AdjustProductGripComponent.prototype.product_codeChange = function (row) {
        var _this = this;
        setTimeout(function () {
            _this.select.products.some(function (item) {
                if (item.product_code == row.product_code && !item.notCallApi) {
                    row.product_name = item.product_name;
                    row.unit_code = _this.checkUnitCode(item.unit_code);
                    row.unit_name = item.unit_name;
                    row.quantity = item.quantity ? parseFloat(item.quantity) : item.quantity;
                    row.price_after_vat = item.price_after_vat ? parseFloat(item.price_after_vat) : item.price_after_vat;
                    row.price = item.price ? parseFloat(item.price) : item.price;
                    row.number_real_export = item.number_real_export ? parseFloat(item.number_real_export) : null;
                    row.number_real_import = item.number_real_import ? parseFloat(item.number_real_import) : null;
                    row.price_nte = item.price_nte ? parseFloat(item.price_nte) : item.price_nte;
                    if (item.quantity == null || item.quantity == 0 || item.price === 0) {
                        row.amount = item.amount ? parseFloat(item.amount) : 0;
                    }
                    else {
                        row.amount = item.price ? parseFloat(item.price) : 0;
                    }
                    row.engine_number = item.engine_number;
                    row.discount_on_price = item.discount_on_price;
                    row.price_after_discount = item.price_after_discount;
                    row.amount_discount = item.amount_discount;
                    row.chassis_number = item.chassis_number;
                    row.color_material = item.color_material;
                    row.product_date = item.product_date;
                    row.product_exchange_rate = item.product_exchange_rate;
                    row.other_tax = item.other_tax;
                    row.other_charge = item.other_charge;
                    row.items_number = item.items_number;
                    row.mpq = item.mpq;
                    row.complete_order_date = item.complete_order_date;
                    row.contract_order = item.contract_order;
                    row.management_code = item.management_code;
                    row.is_refund_ticket = item.is_refund_ticket;
                    row.is_promotion = item.is_promotion;
                    row.is_promotion_new = item.is_promotion_new;
                    row.lot = item.lot;
                    row.expiration_date = item.expiration_date;
                    row.country_code = item.country_code;
                    if (_this.isHdGTGT) {
                        row.vat = item.vat != null ? item.vat.toString() : null;
                        row.amount_vat = (row.vat >= 0) ? _this.caculatorAmountVat(row.amount, row.vat) : null;
                        row.amount_after_vat = row.amount + row.amount_vat;
                    }
                    else {
                        row.amount_after_vat = row.amount;
                    }
                    _this.invoice_products.update(row.order, row);
                    return true;
                }
            });
            _this._tinhGiaTri();
        }, 200);
    };
    AdjustProductGripComponent.prototype.product_codeChangeFull = function (row) {
        var _this = this;
        setTimeout(function () {
            _this.productsFull.some(function (item) {
                if (item.code === row.product_code) {
                    if (!item.notCallApi) {
                        _this.productsService.getProduct(item.id).subscribe(function (rs) {
                            if (rs.status == "success") {
                                var product = rs.data.product;
                                if (product) {
                                    row.product_name = product.name;
                                    row.unit_code = _this.checkUnitCode(product.unit_code);
                                    row.quantity = null;
                                    if (_this.isHdGTGT) {
                                        row.vat = product.vat != null ? product.vat.toString() : null;
                                    }
                                    else {
                                        row.vat = null;
                                    }
                                    if (_this.configs.system_parameter.price_after_vat) {
                                        row.price_after_vat = product.price ? parseFloat(product.price) : product.price;
                                        if ((row.vat == 5 || row.vat == 10) && row.price_after_vat)
                                            row.price = (row.price_after_vat / (1 + row.vat / 100));
                                        else
                                            row.price = row.price_after_vat;
                                    }
                                    else
                                        row.price = product.price ? parseFloat(product.price) : product.price;
                                    row.amount = product.price ? parseFloat(product.price) : 0;
                                    if (_this.isHdGTGT) {
                                        row.amount_vat = (row.vat >= 0 || row.vat == -3) ? _this.caculatorAmountVat(row.amount, row.vat) : null;
                                    }
                                    else {
                                        row.amount_vat = null;
                                    }
                                    row.amount_after_vat = row.amount + (row.amount_vat != null ? row.amount_vat : 0);
                                    var test = _this.invoice_products;
                                    _this.invoice_products.update(row.id, row);
                                    _this._tinhGiaTri();
                                    return true;
                                }
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                            }
                        });
                    }
                }
            });
        }, 200);
    };
    AdjustProductGripComponent.prototype.unit_codeChange = function (row) {
        var _obj = this.select.unit_codes.filter(function (p) { return p.code == row.unit_code; })[0];
        if (_obj) {
            row.unit_name = _obj.name;
            this.invoice_products.update(row.id, row);
        }
        else {
            row.unit_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    AdjustProductGripComponent.prototype.checkUnitCode = function (unitCode) {
        var items = this.select.unit_codes;
        for (var i = 0; i < items.length; i++) {
            if (items[i].code == unitCode) {
                return unitCode;
            }
        }
        return null;
    };
    AdjustProductGripComponent.prototype._tinhGiaTri = function () {
        var _this = this;
        if (!this.isTT78) {
            setTimeout(function () {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._objTemplateSelect, _this.configs.system_parameter);
                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBay
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayChung
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayHoanVe
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonXangDau) {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type));
                }
                if (_this.isPhuongThucDC)
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["VChanggeMoneyService"].convertToMoneyPositive(_this.frmData);
            }, 100);
        }
        else {
            setTimeout(function () {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._oTemplateTT78, _this.configs.system_parameter);
                if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBay
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayChung
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayHoanVe
                    || _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonXangDau) {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type));
                }
                if (_this.isPhuongThucDC)
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["VChanggeMoneyService"].convertToMoneyPositive(_this.frmData);
            }, 100);
        }
    };
    AdjustProductGripComponent.prototype.caculatorAmountVat = function (amount, vat) {
        var temp = amount / 100 * vat;
        return this.roundNumber(temp, 5);
    };
    AdjustProductGripComponent.prototype.roundNumber = function (number, n) {
        var p = Math.pow(10, n);
        return Math.round(number * p) / p;
    };
    //Bật modal thay đổi số thập phân
    AdjustProductGripComponent.prototype.configDecimal = function (n) {
        var _this = this;
        var initialState = {
            column: n,
            formatter: this.formatter,
            showDonGiaNte: this.configs.system_parameter.view_price_nte
        };
        this.bsModalRef = this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_6__["ConfigDecimalComponent"], {
            class: 'modal-lg', initialState: initialState, backdrop: 'static',
            keyboard: false
        });
        this.modalService.onHide.subscribe(function () {
            var data = _this.bsModalRef.content.successSaveItem;
            if (data) {
                _this.formatter[data.column] = data.character;
                _this._tinhGiaTri();
            }
        });
    };
    //Xóa hàng
    AdjustProductGripComponent.prototype.deleteRow = function (item) {
        var _this = this;
        // setTimeout(() => {
        var check = confirm('Bạn có đồng ý xóa không?');
        if (check && !this.ttDaXuatHoaDon) {
            setTimeout(function () {
                _this.invoice_products.remove(item.id);
                // this.dataSource.store().remove(item.id);
                _this.dataSource.reload();
                _this._tinhGiaTri();
            });
        }
        // }, 200);
    };
    AdjustProductGripComponent.prototype.autoInputChange = function () {
        this.autoChange.emit(this.not_auto);
    };
    AdjustProductGripComponent.prototype.ngOnDestroy = function () {
        this.routeSub.unsubscribe();
    };
    AdjustProductGripComponent.prototype.changePhiDV = function (row) {
        this.view_orderChange();
        if (row.is_money_service) {
            row.commercial_discount = false;
        }
        if (row.is_money_service && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(row.product_name) == '') {
            row.product_name = 'Phí dịch vụ';
            this.invoice_products.update(row.id, row);
        }
        else if (!row.is_money_service && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(row.product_name) === 'Phí dịch vụ') {
            row.product_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    AdjustProductGripComponent.prototype.cktmChange = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    AdjustProductGripComponent.prototype.changePhiHoanVe = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    AdjustProductGripComponent.prototype.onClickGuidReduce = function () {
        this.router.navigate([]).then(function (result) { window.open('https://ihoadon.vn/hddt/danh-muc-hang-hoa-dich-vu-duoc-giam-thue-gtgt-theo-nghi-quyet-so-406-nq-ubtvqh15.html', '_blank'); });
    };
    AdjustProductGripComponent.prototype._changeND92 = function (e) {
        if (e.value)
            this.frmData.is_resolution_43 = !e.value;
        this._tinhGiaTri();
    };
    AdjustProductGripComponent.prototype._changeNQ43 = function (e) {
        if (e.value) {
            this.frmData.is_exemption_decree = !e.value;
            if (this.frmData.sales_percentage == null && parseInt(this.configs.system_parameter.value_rate_percent) > 0) {
                this.frmData.sales_percentage = parseInt(this.configs.system_parameter.value_rate_percent);
            }
        }
        else {
            this.frmData.sales_percentage = null;
        }
        this._tinhGiaTri();
    };
    AdjustProductGripComponent.prototype.itemExtrasClick = function (e) {
        if (e.itemData.id === 'LAY_MAU_BANG_KE') {
            this.layMauBangKe();
        }
        else if (e.itemData.id === 'NAP_DU_LIEU_BANG_KE') {
            this.napDuLieuTuBangKe();
        }
    };
    AdjustProductGripComponent.prototype.onFileBangKeChange = function (evt) {
        var _this = this;
        var target = (evt.target);
        if (target.files.length !== 1) {
            throw new Error('Không thể chọn nhiều file');
        }
        var reader = new FileReader();
        reader.onload = function (e) {
            /* read workbook */
            var bstr = e.target.result;
            var wb = xlsx__WEBPACK_IMPORTED_MODULE_12__["read"](bstr, { type: 'binary' });
            /* grab first sheet */
            var wsname = wb.SheetNames[0];
            var ws = wb.Sheets[wsname];
            /* save data */
            var data = (xlsx__WEBPACK_IMPORTED_MODULE_12__["utils"].sheet_to_json(ws, { header: 'A', range: 9 }));
            var account = (xlsx__WEBPACK_IMPORTED_MODULE_12__["utils"].sheet_to_json(ws, { header: 'A', range: 0 }));
            var fileBangKe = document.getElementById('file-bang-ke');
            fileBangKe.value = '';
            var _arrData = [];
            if (data && data[0]) {
                var columnsName = data.map(function (e) { return e.A; });
                var _index = columnsName.indexOf("view_order");
                if (_index == -1) {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify("File mẫu không đúng định dạng. Vui lòng nhấn vào Tại đây để lấy lại file mẫu", "error");
                    return false;
                }
                else {
                    if (_index > 0) {
                        data.splice(0, _index);
                    }
                    for (var i = 1; i < data.length; i++) {
                        var _row = {};
                        for (var key in data[i]) {
                            if (data[i].hasOwnProperty(key)) {
                                var column = data[0][key];
                                var value = data[i][key];
                                _row[column] = value;
                            }
                        }
                        _arrData.push(_row);
                    }
                }
            }
            _this.dataExcelFile = _arrData;
            _this.dataExcelFileInfo = account.slice(0, 4);
            _this.showPopup = true;
        };
        reader.readAsBinaryString(target.files[0]);
    };
    AdjustProductGripComponent.prototype.layMauBangKe = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        var ts = this._objTemplateSelect;
        var fields = [];
        if (!this.isTT78) {
            if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayChung
                && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayHoanVe) {
                fields.push("other_tax");
                fields.push("other_charge");
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonKinhDoanhXe) {
                fields.push("engine_number");
                fields.push("chassis_number");
            }
        }
        else {
            if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayChung
                && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayHoanVe) {
                fields.push("other_tax");
                fields.push("other_charge");
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonKinhDoanhXe) {
                fields.push("engine_number");
                fields.push("chassis_number");
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonNhaHangKhachSan
                && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].templatetype.HoaDonVeMayBayChung) {
                fields.push("is_money_service");
            }
            if (!this.configs.system_parameter.incurred_refund_ticket)
                fields.push("is_refund_ticket");
            if (!this.configs.system_parameter.view_expiration_date)
                fields.push("expiration_date");
            if (!this.configs.system_parameter.view_lot)
                fields.push("lot");
            if (!this.configs.system_parameter.promotional_goods_on_the_invoice)
                fields.push("is_promotion_new");
            if (!this.configs.system_parameter.is_promotion)
                fields.push("is_promotion");
        }
        if (!this.configs.system_parameter.product_exchange_rate)
            fields.push("product_exchange_rate");
        if (!this.configs.system_parameter.product_date)
            fields.push("product_date");
        // if (this.configs && this.configs.system_parameter && this.configs.system_parameter.display_contract_order)
        //   fields.push("contract_order");
        if (!this.extentionGrid || (this.extentionGrid && !this.extentionGrid.ma_quan_ly)) {
            fields.push("management_code");
        }
        var invoiceType = "";
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03 || this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.HGDL04) {
            if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03) {
                invoiceType = _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03;
            }
            else {
                invoiceType = _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.HGDL04;
            }
        }
        else {
            invoiceType = "";
        }
        this.vatService.layFileMau({
            customer_name: this.oldForm.customer_name,
            buyer_tax_code: this.oldForm.buyer_tax_code,
            buyer_address: this.oldForm.buyer_address,
            buyer_name: this.oldForm.buyer_name,
            invoice_type_name: invoiceType,
            hiddens: fields
        }).subscribe(function (rs) {
            if (rs.status === 'success') {
                var file = rs.data.invoice;
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
        });
    };
    AdjustProductGripComponent.prototype.napDuLieuTuBangKe = function () {
        document.getElementById('file-bang-ke').click();
    };
    AdjustProductGripComponent.prototype.thayTheToanBo = function () {
        var _this = this;
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
            if (_this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03 || _this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.HGDL04) {
                if (_this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03) {
                    _this.fillDataPXK(_this.oldForm.invoice_products, _this.dataExcelFileInfo, 'thaythe');
                }
                else {
                    _this.fillDataPXKDaiLy(_this.oldForm.invoice_products, _this.dataExcelFileInfo, 'thaythe');
                }
            }
            else {
                _this.fillData(_this.oldForm.invoice_products, _this.dataExcelFileInfo, 'thaythe');
            }
            _this.showPopup = false;
            _this.dataExcelFile = null;
        }, 300);
    };
    AdjustProductGripComponent.prototype.themTiep = function () {
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03 || this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.HGDL04) {
            if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_9__["sEnum"].loaihoadon.XKNB03) {
                this.fillDataPXK(this.dataExcelFile, this.dataExcelFileInfo, 'themtiep');
            }
            else {
                this.fillDataPXKDaiLy(this.dataExcelFile, this.dataExcelFileInfo, 'themtiep');
            }
        }
        else {
            this.fillData(this.dataExcelFile, this.dataExcelFileInfo, 'themtiep');
        }
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    AdjustProductGripComponent.prototype.huy = function () {
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    AdjustProductGripComponent.prototype.fillData = function (fileData, info, status) {
        var _this = this;
        if (status === 'thaythe') {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    _this.invoice_products.remove(item.id);
                });
            });
        }
        else {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (!item.product_code && !item.product_name && !item.quantity && !item.price && !item.amount && !item.amount_vat && !item.amount_after_vat) {
                        _this.invoice_products.remove(item.id);
                    }
                });
            });
        }
        fileData.forEach(function (element) {
            if (element.product_name) {
                var invoice_1 = new Object;
                invoice_1["id"] = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].makeid();
                invoice_1["view_order"] = element.view_order ? parseInt(element.view_order) : null;
                invoice_1["product_code"] = element.product_code ? element.product_code : "";
                invoice_1["product_name"] = element.product_name ? element.product_name : "";
                invoice_1["unit_code"] = element.unit_name ? _this.getUnitCodeByUnitName(element.unit_name) : "";
                invoice_1["unit_name"] = element.unit_name ? element.unit_name : "";
                invoice_1["quantity"] = element.quantity ? element.quantity : null;
                invoice_1["vat"] = (element.vat && _this.isHdGTGT) ? element.vat : null;
                invoice_1["contract_order"] = element.contract_order ? element.contract_order : "";
                if (element.price) {
                    if (_this.configs.system_parameter.price_after_vat) {
                        invoice_1["price_after_vat"] = element.price ? element.price : null;
                        if ((invoice_1["vat"] == 5 || invoice_1["vat"] == 10 || invoice_1["vat"] == 7 || invoice_1["vat"] == 3.5) && invoice_1["price_after_vat"] !== null)
                            invoice_1["price"] = (invoice_1["price_after_vat"] / (1 + invoice_1["vat"] / 100));
                        else
                            invoice_1["price"] = invoice_1["price_after_vat"];
                    }
                    else
                        invoice_1["price"] = element.price ? element.price : null;
                }
                invoice_1["amount"] = element.amount ? element.amount : null;
                invoice_1["amount_vat"] = element.amount_vat ? element.amount_vat : null;
                // invoice["note"] = element.note ? element.note : null;
                invoice_1["other_tax"] = element.other_tax ? element.other_tax : null;
                invoice_1["other_charge"] = element.other_charge ? element.other_charge : null;
                invoice_1["product_exchange_rate"] = element.product_exchange_rate ? element.product_exchange_rate : null;
                invoice_1["product_date"] = element.product_date ? element.product_date : null;
                invoice_1["engine_number"] = element.engine_number ? element.engine_number : null;
                invoice_1["chassis_number"] = element.chassis_number ? element.chassis_number : null;
                invoice_1["management_code"] = element.management_code ? element.management_code : null;
                invoice_1["is_money_service"] = element.is_money_service;
                invoice_1["is_refund_ticket"] = element.is_refund_ticket;
                invoice_1["is_promotion"] = element.is_promotion;
                invoice_1["is_promotion_new"] = element.is_promotion_new;
                invoice_1["discount"] = element.discount ? element.discount : null;
                invoice_1["amount_discount"] = element.amount_discount ? element.amount_discount : null;
                invoice_1["lot"] = element.lot ? element.lot : null;
                invoice_1["expiration_date"] = element.expiration_date ? element.expiration_date : null;
                if (invoice_1["amount_vat"] !== null && invoice_1["amount"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_vat"] + invoice_1["amount"];
                else if (invoice_1["amount"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount"];
                else if (invoice_1["amount_vat"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_vat"];
                else
                    invoice_1["amount_after_vat"] = null;
                if (invoice_1["other_tax"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_after_vat"] + invoice_1["other_tax"];
                if (invoice_1["other_charge"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_after_vat"] + invoice_1["other_charge"];
                var _obj = _this.select.products.filter(function (p) { return p.product_code === invoice_1["product_code"]; })[0];
                if (!_obj && invoice_1["product_code"] !== '') {
                    var _objPush = {
                        code: invoice_1["product_code"],
                        name: invoice_1["product_name"],
                        mhvth: invoice_1["product_code"] + ': ' + invoice_1["product_name"],
                    };
                    _this.select.products.push(_objPush);
                }
                invoice_1["commercial_discount"] = element.commercial_discount;
                _this.invoice_products.insert(invoice_1);
            }
        });
        setTimeout(function () {
            _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                dataSource: _this.select.unit_codes,
                displayExpr: 'name',
                valueExpr: 'code'
            });
        });
        this.dataGrid.instance.refresh();
        this._tinhGiaTri();
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
    };
    AdjustProductGripComponent.prototype.getUnitCodeByUnitName = function (unitName) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(unitName) !== '') {
            if (this.select.unit_codes && this.select.unit_codes.length > 0) {
                var _obj = this.select.unit_codes.filter(function (p) { return p.name === unitName; })[0];
                if (_obj) {
                    return _obj.code;
                }
                else {
                    var code = _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._convertToViKdau(unitName);
                    this.select.unit_codes.push({ code: code, name: unitName });
                    return code;
                }
            }
            else {
                this.select.unit_codes = [];
            }
        }
        return null;
    };
    AdjustProductGripComponent.prototype.fillDataPXKDaiLy = function (fileData, info, status) {
        var _this = this;
        if (status === 'thaythe') {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    _this.invoice_products.remove(item.id);
                });
            });
        }
        else {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (!item.product_code && !item.product_name && !item.quantity && !item.price && !item.amount && !item.amount_vat && !item.amount_after_vat) {
                        _this.invoice_products.remove(item.id);
                    }
                });
            });
        }
        fileData.forEach(function (element) {
            if (element.product_name) {
                var invoice_2 = new Object;
                invoice_2["id"] = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].makeid();
                invoice_2["view_order"] = element.view_order ? parseInt(element.view_order) : null;
                invoice_2["product_code"] = element.product_code ? element.product_code : "";
                invoice_2["product_name"] = element.product_name ? element.product_name : "";
                invoice_2["unit_code"] = element.unit_name ? _this.getUnitCodeByUnitName(element.unit_name) : "";
                invoice_2["unit_name"] = element.unit_name ? element.unit_name : "";
                invoice_2["quantity"] = element.quantity ? element.quantity : null;
                invoice_2["vat"] = (element.vat && _this.isHdGTGT) ? element.vat : null;
                invoice_2["contract_order"] = element.contract_order ? element.contract_order : "";
                if (element.price) {
                    if (_this.configs.system_parameter.price_after_vat) {
                        invoice_2["price_after_vat"] = element.price ? element.price : null;
                        if ((invoice_2["vat"] == 5 || invoice_2["vat"] == 10 || invoice_2["vat"] == 7 || invoice_2["vat"] == 3.5) && invoice_2["price_after_vat"] !== null)
                            invoice_2["price"] = (invoice_2["price_after_vat"] / (1 + invoice_2["vat"] / 100));
                        else
                            invoice_2["price"] = invoice_2["price_after_vat"];
                    }
                    else
                        invoice_2["price"] = element.price ? element.price : null;
                }
                invoice_2["amount"] = element.amount ? element.amount : null;
                invoice_2["amount_vat"] = element.amount_vat ? element.amount_vat : null;
                // invoice["note"] = element.note ? element.note : null;
                invoice_2["other_tax"] = element.other_tax ? element.other_tax : null;
                invoice_2["other_charge"] = element.other_charge ? element.other_charge : null;
                invoice_2["product_exchange_rate"] = element.product_exchange_rate ? element.product_exchange_rate : null;
                invoice_2["product_date"] = element.product_date ? element.product_date : null;
                invoice_2["engine_number"] = element.engine_number ? element.engine_number : null;
                invoice_2["chassis_number"] = element.chassis_number ? element.chassis_number : null;
                invoice_2["management_code"] = element.management_code ? element.management_code : null;
                invoice_2["is_money_service"] = element.is_money_service;
                invoice_2["is_refund_ticket"] = element.is_refund_ticket;
                invoice_2["is_promotion"] = element.is_promotion;
                invoice_2["is_promotion_new"] = element.is_promotion_new;
                invoice_2["lot"] = element.lot ? element.lot : null;
                invoice_2["expiration_date"] = element.expiration_date ? element.expiration_date : null;
                if (invoice_2["amount_vat"] !== null && invoice_2["amount"] !== null)
                    invoice_2["amount_after_vat"] = invoice_2["amount_vat"] + invoice_2["amount"];
                else if (invoice_2["amount"] !== null)
                    invoice_2["amount_after_vat"] = invoice_2["amount"];
                else if (invoice_2["amount_vat"] !== null)
                    invoice_2["amount_after_vat"] = invoice_2["amount_vat"];
                else
                    invoice_2["amount_after_vat"] = null;
                if (invoice_2["other_tax"] !== null)
                    invoice_2["amount_after_vat"] = invoice_2["amount_after_vat"] + invoice_2["other_tax"];
                if (invoice_2["other_charge"] !== null)
                    invoice_2["amount_after_vat"] = invoice_2["amount_after_vat"] + invoice_2["other_charge"];
                var _obj = _this.select.products.filter(function (p) { return p.product_code === invoice_2["product_code"]; })[0];
                if (!_obj && invoice_2["product_code"] !== '') {
                    var _objPush = {
                        code: invoice_2["product_code"],
                        name: invoice_2["product_name"],
                        mhvth: invoice_2["product_code"] + ': ' + invoice_2["product_name"],
                    };
                    _this.select.products.push(_objPush);
                }
                invoice_2["commercial_discount"] = element.commercial_discount;
                _this.invoice_products.insert(invoice_2);
            }
        });
        setTimeout(function () {
            _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                dataSource: _this.select.unit_codes,
                displayExpr: 'name',
                valueExpr: 'code'
            });
        });
        this.dataGrid.instance.refresh();
        this._tinhGiaTri();
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
    };
    AdjustProductGripComponent.prototype.fillDataPXK = function (fileData, info, status) {
        var _this = this;
        if (status === 'thaythe') {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    _this.invoice_products.remove(item.id);
                });
            });
        }
        else {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (!item.product_code && !item.product_name && !item.quantity && !item.price && !item.amount && !item.amount_vat && !item.amount_after_vat) {
                        _this.invoice_products.remove(item.id);
                    }
                });
            });
        }
        fileData.forEach(function (element) {
            if (element.product_name) {
                var invoice_3 = new Object;
                invoice_3["id"] = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].makeid();
                invoice_3["view_order"] = element.view_order ? parseInt(element.view_order) : null;
                invoice_3["product_code"] = element.product_code ? element.product_code : "";
                invoice_3["product_name"] = element.product_name ? element.product_name : "";
                invoice_3["unit_code"] = element.unit_name ? _this.getUnitCodeByUnitName(element.unit_name) : "";
                invoice_3["unit_name"] = element.unit_name ? element.unit_name : "";
                invoice_3["quantity"] = element.quantity ? _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].toNumber(element.quantity) : null;
                invoice_3["vat"] = (element.vat && _this.isHdGTGT) ? element.vat : null;
                invoice_3["contract_order"] = element.contract_order ? element.contract_order : "";
                if (element.price) {
                    if (_this.configs.system_parameter.price_after_vat) {
                        invoice_3["price_after_vat"] = element.price ? element.price : null;
                        if ((invoice_3["vat"] == 5 || invoice_3["vat"] == 10 || invoice_3["vat"] == 7 || invoice_3["vat"] == 3.5) && invoice_3["price_after_vat"] !== null)
                            invoice_3["price"] = (invoice_3["price_after_vat"] / (1 + invoice_3["vat"] / 100));
                        else
                            invoice_3["price"] = invoice_3["price_after_vat"];
                    }
                    else
                        invoice_3["price"] = element.price ? element.price : null;
                }
                invoice_3["amount"] = element.amount ? element.amount : null;
                invoice_3["amount_vat"] = element.amount_vat ? element.amount_vat : null;
                // invoice["note"] = element.note ? element.note : null;
                invoice_3["other_tax"] = element.other_tax ? element.other_tax : null;
                invoice_3["other_charge"] = element.other_charge ? element.other_charge : null;
                invoice_3["product_exchange_rate"] = element.product_exchange_rate ? element.product_exchange_rate : null;
                invoice_3["product_date"] = element.product_date ? element.product_date : null;
                invoice_3["engine_number"] = element.engine_number ? element.engine_number : null;
                invoice_3["chassis_number"] = element.chassis_number ? element.chassis_number : null;
                invoice_3["management_code"] = element.management_code ? element.management_code : null;
                invoice_3["is_money_service"] = element.is_money_service;
                invoice_3["is_refund_ticket"] = element.is_refund_ticket;
                invoice_3["is_promotion"] = element.is_promotion;
                invoice_3["is_promotion_new"] = element.is_promotion_new;
                invoice_3["lot"] = element.lot ? element.lot : null;
                invoice_3["expiration_date"] = element.expiration_date ? element.expiration_date : null;
                invoice_3["number_real_export"] = element.number_real_export ? _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].toNumber(element.number_real_export) : null;
                invoice_3["number_real_import"] = element.number_real_import ? _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].toNumber(element.number_real_import) : null;
                if (invoice_3["amount_vat"] !== null && invoice_3["amount"] !== null)
                    invoice_3["amount_after_vat"] = invoice_3["amount_vat"] + invoice_3["amount"];
                else if (invoice_3["amount"] !== null)
                    invoice_3["amount_after_vat"] = invoice_3["amount"];
                else if (invoice_3["amount_vat"] !== null)
                    invoice_3["amount_after_vat"] = invoice_3["amount_vat"];
                else
                    invoice_3["amount_after_vat"] = null;
                if (invoice_3["other_tax"] !== null)
                    invoice_3["amount_after_vat"] = invoice_3["amount_after_vat"] + invoice_3["other_tax"];
                if (invoice_3["other_charge"] !== null)
                    invoice_3["amount_after_vat"] = invoice_3["amount_after_vat"] + invoice_3["other_charge"];
                var _obj = _this.select.products.filter(function (p) { return p.product_code === invoice_3["product_code"]; })[0];
                if (!_obj && invoice_3["product_code"] !== '') {
                    var _objPush = {
                        code: invoice_3["product_code"],
                        name: invoice_3["product_name"],
                        mhvth: invoice_3["product_code"] + ': ' + invoice_3["product_name"],
                    };
                    _this.select.products.push(_objPush);
                }
                invoice_3["commercial_discount"] = element.commercial_discount;
                _this.invoice_products.insert(invoice_3);
            }
        });
        setTimeout(function () {
            _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                dataSource: _this.select.unit_codes,
                displayExpr: 'name',
                valueExpr: 'code'
            });
        });
        this.dataGrid.instance.refresh();
        this._tinhGiaTri();
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxDataGridComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxDataGridComponent"])
    ], AdjustProductGripComponent.prototype, "dataGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChildren"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "listDxForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "dataSource", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "invoice_products", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "formatter", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "not_auto", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "oldForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "_objTemplateSelect", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "extentionGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], AdjustProductGripComponent.prototype, "isTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "_oTemplateTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "frmData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('gripChange'),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "gripChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('autoChange'),
        __metadata("design:type", Object)
    ], AdjustProductGripComponent.prototype, "autoChange", void 0);
    AdjustProductGripComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'adjust-vat-product-grip',
            template: __webpack_require__(/*! ./adjust-product-grip.component.html */ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.html"),
            styles: [__webpack_require__(/*! ./adjust-product-grip.component.scss */ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_5__["AuthService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_2__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__["VatService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_8__["TranslateService"],
            _modules_products_shared__WEBPACK_IMPORTED_MODULE_11__["ProductsService"],
            _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_13__["InvoiceService"]])
    ], AdjustProductGripComponent);
    return AdjustProductGripComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.html":
/*!******************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.html ***!
  \******************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"modal-header\">\r\n  <h4 class=\"modal-title pull-left\">DANH SÁCH HÓA ĐƠN CHỜ KÝ</h4>\r\n  <button type=\"button\" class=\"close pull-right\" aria-label=\"Close\" (click)=\"bsModalRef.hide()\">\r\n    <span aria-hidden=\"true\">&times;</span>\r\n  </button>\r\n</div>\r\n<div class=\"modal-body\">\r\n  <dx-data-grid \r\n    id=\"gridContainer\"\r\n    [dataSource]=\"invoiceList\"\r\n    [showRowLines]=\"true\"\r\n    [allowColumnResizing]=\"true\"\r\n    [(selectedRowKeys)]=\"selectedRows\"\r\n    [columnMinWidth]=\"50\"\r\n    [columnResizingMode]=\"true\"\r\n    [columnAutoWidth]=\"true\"\r\n    [wordWrapEnabled]=\"true\">\r\n\r\n    <dxo-selection selectAllMode=\"page\" mode=\"single\"></dxo-selection>\r\n\r\n    <dxo-load-panel [enabled]=\"true\"></dxo-load-panel>\r\n    <dxi-column dataField=\"invoice_number\" caption=\"Số hóa đơn\" [width]=\"110\" alignment=\"center\"></dxi-column>\r\n    <dxi-column dataField=\"invoice_date\" caption=\"Ngày HĐ\" [width]=\"110\" dataType=\"date\" format=\"dd/MM/yyyy\" dateSerializationFormat=\"yyyy-MM-dd\" alignment=\"center\"></dxi-column>\r\n    <dxi-column dataField=\"buyer_tax_code\" caption=\"Mã số thuế\" [width]=\"140\" alignment=\"left\"></dxi-column>\r\n    <dxi-column cellTemplate=\"customerName\" caption=\"Tên đơn vị\" alignment=\"left\"></dxi-column>\r\n\r\n    <div *dxTemplate=\"let d of 'customerName'\">\r\n      <p>{{ d.data.customer_name || d.data.buyer_name || 'Hóa đơn chờ ký' }}</p>\r\n    </div>\r\n    \r\n    <dxo-remote-operations [sorting]=\"false\" [filtering]=\"false\"></dxo-remote-operations>\r\n    <!-- <dxo-paging [enabled]=\"false\"></dxo-paging> -->\r\n  </dx-data-grid>\r\n</div>\r\n<div class=\"modal-footer\">\r\n  <dx-button text=\"Chọn\" icon=\"assets\\img\\icons\\Ghi.png\" type=\"default\" (click)=\"choose()\" [disabled]=\"!(selectedRows.length == 1)\">\r\n  </dx-button>\r\n  <dx-button text=\"Quay lại\" icon=\"assets\\img\\icons\\QuayLai.png\" type=\"default\" (click)=\"bsModalRef.hide()\">\r\n  </dx-button>\r\n</div>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.scss":
/*!******************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.scss ***!
  \******************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ""

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts":
/*!****************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts ***!
  \****************************************************************************************/
/*! exports provided: ChooseHdckComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ChooseHdckComponent", function() { return ChooseHdckComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @modules/handle-invoice/shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};




var ChooseHdckComponent = /** @class */ (function () {
    function ChooseHdckComponent(bsModalRef, handleInvoiceService) {
        this.bsModalRef = bsModalRef;
        this.handleInvoiceService = handleInvoiceService;
        this.selectedRows = [];
    }
    ChooseHdckComponent.prototype.ngOnInit = function () {
        var _this = this;
        // console.log(this.invoiceNumberOrigin);
        // console.log(this.templateCode);
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        this.handleInvoiceService.layCacHoaDonChoKy(this.invoiceDateOrigin, this.invoiceReleaseId).subscribe(function (rs) {
            _this.invoiceList = rs.data.invoices;
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
        });
    };
    ChooseHdckComponent.prototype.choose = function () {
        this.onSave(this.selectedRows[0]);
        this.bsModalRef.hide();
    };
    ChooseHdckComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-choose-hdck',
            template: __webpack_require__(/*! ./choose-hdck.component.html */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.html"),
            styles: [__webpack_require__(/*! ./choose-hdck.component.scss */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.scss")]
        }),
        __metadata("design:paramtypes", [ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_1__["BsModalRef"],
            _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_2__["HandleInvoiceService"]])
    ], ChooseHdckComponent);
    return ChooseHdckComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/index/index.component.html":
/*!******************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/index/index.component.html ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"row search-section\">\r\n  <div class=\"col-md-7\">\r\n    <app-search-advanced (searchContentChange)=\"getSearch($event)\" [isFormHandInvoice]=\"isFormHandInvoice\">\r\n    </app-search-advanced>\r\n  </div>\r\n  <div class=\"col-md-5 list-header\" style=\"max-height: 70px;\">\r\n    <div class=\"pull-right button-panel\">\r\n      <dx-button *ngIf=\"isDaDKTT78\" (click)=\"BaoCaoCQT()\" icon=\"assets\\img\\icons\\DieuChinh.png\" text=\"Báo CQT HĐ sai\"\r\n        type=\"default\"></dx-button>\r\n      <dx-button (click)=\"dieuChinh()\" icon=\"assets\\img\\icons\\DieuChinh.png\" [disabled]=\"isDisableAdjust\"\r\n        text=\"{{ 'CONTROLL.BUTTON.adjusted' | translate }}\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"thayThe()\" icon=\"assets\\img\\icons\\ThayThe.png\"\r\n        text=\"{{ 'CONTROLL.BUTTON.replaced' | translate }}\" type=\"default\" [disabled]=\"isDisableReplace\">\r\n      </dx-button>\r\n      <dx-button (click)=\"routerCancelInvoice()\" [(icon)]=\"_translate.ICONS.delete\" text=\"Hủy HĐ\" type=\"default\"\r\n        [disabled]=\"selectedRows.length == 0\"></dx-button>\r\n    </div>\r\n  </div>\r\n</div>\r\n<dx-data-grid id=\"gridContainerInvoice\" (onSelectionChanged)=\"selectionChanged($event)\" [dataSource]=\"dataSource\"\r\n  [showRowLines]=\"true\" [(selectedRowKeys)]=\"selectedRows\" [allowColumnResizing]=\"true\" [columnMinWidth]=\"50\"\r\n  [showBorders]=\"true\" [columnResizingMode]=\"true\" [wordWrapEnabled]=\"true\" (onRowPrepared)=\"onRowPrepared($event)\"\r\n  (onContentReady)=\"onContentReady($event)\">\r\n  <dxo-selection selectAllMode=\"{{pageSelect}}\" mode=\"multiple\">\r\n  </dxo-selection>\r\n  <!-- <dxo-state-storing [enabled]=\"true\" type=\"sessionStorage\" storageKey=\"handleinvoice\"></dxo-state-storing> -->\r\n  <dxo-load-panel [enabled]=\"true\"></dxo-load-panel>\r\n  <dxo-sorting mode=\"single\"></dxo-sorting>\r\n  <dxo-selection mode=\"multiple\"></dxo-selection>\r\n  <dxo-filter-row [visible]=\"true\"></dxo-filter-row>\r\n  <dxi-column cellTemplate=\"invoiceNumber\" dataField=\"invoice_number\"\r\n    caption=\"{{ 'GRID.INVOICE.invoice_number' | translate }}\" [width]=\"_translate.GRID_WIDTH.so_hoa_don\"\r\n    alignment=\"center\" sortOrder=\"desc\" [sortIndex]=\"1\" headerCellTemplate=\"titleHeaderTemplate\"></dxi-column>\r\n  <dxi-column cellTemplate=\"templateCode\"\r\n    caption=\"{{ 'GRID.INVOICE.template_code' | translate }}, {{ 'GRID.INVOICE.invoice_series' | translate }}\"\r\n    [width]=\"_translate.GRID_WIDTH.mau_so_ky_hieu\" alignment=\"center\"></dxi-column>\r\n  <!-- <dxi-column dataField=\"template.invoice_series\" caption=\"{{ 'GRID.INVOICE.invoice_series' | translate }}\" [width]=\"110\" alignment=\"center\"\r\n      [allowSorting]=\"false\" [allowFiltering]=\"false\"></dxi-column> -->\r\n  <dxi-column dataField=\"invoice_date\" [editorOptions]=\"{useMaskBehavior:true}\"\r\n    caption=\"{{ 'GRID.INVOICE.invoice_date' | translate }}\" [width]=\"_translate.GRID_WIDTH.ngay_hoa_don\" dataType=\"date\"\r\n    format=\"dd/MM/yyyy\" dateSerializationFormat=\"yyyy-MM-dd\" alignment=\"center\" headerCellTemplate=\"titleHeaderTemplate\"\r\n    sortOrder=\"desc\" [sortIndex]=\"0\"></dxi-column>\r\n  <!-- Số phiếu -->\r\n  <dxi-column *ngIf=\"configs.system_parameter.display_recepts_no\" dataField=\"receipts_no\"\r\n    caption=\"{{ 'GRID.INVOICE.receipts_no' | translate }}\" width=\"{{_translate.GRID_WIDTH.so_phieu}}\" alignment=\"left\"\r\n    headerCellTemplate=\"titleHeaderTemplate\">\r\n  </dxi-column>\r\n  <dxi-column dataField=\"buyer_tax_code\" caption=\"{{ 'GRID.INVOICE.buyer_tax_code' | translate }}\"\r\n    [width]=\"_translate.GRID_WIDTH.ma_so_thue\" alignment=\"left\">\r\n  </dxi-column>\r\n  <!-- Tên khách hàng -->\r\n  <dxi-column cellTemplate=\"customerName\" caption=\"{{ 'GRID.INVOICE.customer_name' | translate }}\" alignment=\"left\">\r\n  </dxi-column>\r\n  <dxi-column *ngIf=\"configs.system_parameter.display_transport_number_from_product\" dataField=\"transport_number\"\r\n    caption=\"{{ 'GRID.INVOICE_DETAILS.transport_number' | translate }}\"\r\n    width=\"{{_translate.GRID_WIDTH.transport_number}}\" alignment=\"left\" headerCellTemplate=\"titleHeaderTemplate\">\r\n  </dxi-column>\r\n  <dxi-column dataField=\"total_payment_string\" caption=\"{{ 'GRID.INVOICE.total_payment' | translate }}\"\r\n    alignment=\"right\" headerCellTemplate=\"titleHeaderTemplate\" [width]=\"_translate.GRID_WIDTH.tong_tien\"></dxi-column>\r\n\r\n  <dxi-column cellTemplate=\"statusInvoice\" caption=\"{{ 'CONTROLL.LABEL.processing_status' | translate }}\"\r\n    [width]=\"_translate.GRID_WIDTH.trang_thai_gui_mail\" alignment=\"center\"></dxi-column>\r\n  <!-- <dxi-column dataField=\"note_view_on_invoice\" caption=\"{{ 'GRID.GENERAL.note' | translate }}\"\r\n              headerCellTemplate=\"titleHeaderTemplate\"></dxi-column> -->\r\n  <!-- Trạng thái gửi CQT -->\r\n  <dxi-column *ngIf=\"isDaDKTT78\" cellTemplate=\"statusSendTax\" caption=\"TT gửi HĐ sai sót\" [width]=\"106\"\r\n    alignment=\"center\">\r\n  </dxi-column>\r\n  <!-- Biên bản xử lý -->\r\n  <dxi-column caption=\"{{ 'GRID.GENERAL.handle-report' | translate }}\">\r\n    <dxi-column cellTemplate=\"invoice_reports\" caption=\"{{ 'GRID.GENERAL.electric_report' | translate }}\"\r\n      [width]=\"_translate.GRID_WIDTH.electric_report\" alignment=\"center\"></dxi-column>\r\n    <dxi-column cellTemplate=\"file_content\" caption=\"{{ 'GRID.GENERAL.paper_report' | translate }}\"\r\n      [width]=\"_translate.GRID_WIDTH.electric_report\" alignment=\"center\"></dxi-column>\r\n  </dxi-column>\r\n\r\n  <dxi-column cellTemplate=\"actionIcon\" minWidth=\"{{_translate.GRID_WIDTH.hanh_dong_2}}\"\r\n    width=\"{{_translate.GRID_WIDTH.hanh_dong_2}}\" alignment=\"center\"></dxi-column>\r\n\r\n  <div *dxTemplate=\"let d of 'templateCode'\">\r\n    <p (click)=\"editNotSelect(d.data)\" style=\"text-decoration: underline;cursor: pointer;\">\r\n      {{ d.data.template_code }}</p>\r\n    <p (click)=\"editNotSelect(d.data)\" style=\"text-decoration: underline;cursor: pointer;\">\r\n      {{ d.data.invoice_series }}</p>\r\n  </div>\r\n  <div *dxTemplate=\"let d of 'statusSendTax'\">\r\n    <a *ngIf=\"getStatusSendTax(d.data) != ''\" href=\"javascript:void(0)\"\r\n      (click)=\"ThongDiepGuiNhan(d.data)\">{{ getStatusSendTax(d.data) }}</a>\r\n  </div>\r\n  <div *dxTemplate=\"let d of 'invoiceNumber'\">\r\n    <a *ngIf=\"d.data.status === 'DA_XUAT'\" class=\"gach-chan\" (click)=\"viewNotSelect(d.data)\"\r\n      href=\"javascript:void(0)\">{{ d.data.invoice_number }}<span *ngIf=\"d.data.time_print_conversion\">-CĐ\r\n        ({{ d.data.time_print_conversion }})</span></a>\r\n    <p *ngIf=\"d.data.status !== 'DA_XUAT'\">{{ d.data.invoice_number }}<span *ngIf=\"d.data.time_print_conversion\">-CĐ\r\n        ({{ d.data.time_print_conversion }})</span></p>\r\n  </div>\r\n  <div *dxTemplate=\"let d of 'customerName'\">\r\n    <p class=\"gach-chan\" (click)=\"editNotSelect(d.data)\" *ngIf=\"d.data.status !='GIU_SO' && d.data.status !='DA_XUAT'\">\r\n      {{ d.data.customer_name || d.data.buyer_name }}\r\n    </p>\r\n    <p class=\"gach-chan\" (click)=\"editNotSelect(d.data)\"\r\n      *ngIf=\"d.data.status =='GIU_SO' && d.data.template_code != '6'\">\r\n      {{ d.data.customer_name || d.data.buyer_name || _translate.GRID.INVOICE.invoice_wait_for_sign }}</p>\r\n    <p *ngIf=\"d.data.status =='DA_XUAT'\">{{ d.data.customer_name || d.data.buyer_name }}</p>\r\n  </div>\r\n\r\n  <div *dxTemplate=\"let d of 'actionEmail'\">\r\n    <a *ngIf=\"d.data.send_email_status == 'CHUA_GUI' && d.data.status !='GIU_SO'\" class=\"chua-gui-khach-hang gach-chan\"\r\n      (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">{{ 'GRID.INVOICE.un_sent' | translate }}\r\n    </a>\r\n    <a *ngIf=\"d.data.send_email_status == 'CHUA_GUI' && d.data.status =='GIU_SO'\" class=\"cho-ky\"\r\n      (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">{{ 'GRID.INVOICE.wait_for_sign' | translate }}</a>\r\n    <a *ngIf=\"d.data.send_email_status == 'DA_GUI'\" class=\"gach-chan\" (click)=\"sendInvoice(d.data.id)\"\r\n      href=\"javascript:void(0)\">{{ 'GRID.INVOICE.wait_for_it' | translate }}</a>\r\n    <a *ngIf=\"d.data.send_email_status == 'DA_NHAN'\" class=\"gach-chan\" (click)=\"sendInvoice(d.data.id)\"\r\n      href=\"javascript:void(0)\">{{ 'GRID.INVOICE.received' | translate }}</a>\r\n    <p *ngIf=\"!d.data.send_email_status\" href=\"javascript:void(0)\">{{ trangthaihoadon(d.data) }} <a\r\n        *ngIf=\"trangthaihoadon(d.data) == 'Lỗi ký HD' || trangthaihoadon(d.data) == 'Signed error'\" class=\"gach-chan\"\r\n        (click)=\"editNotSelect(d.data)\" href=\"javascript:void(0)\">({{ 'GRID.INVOICE.re_sign' | translate }})</a></p>\r\n  </div>\r\n\r\n  <div *dxTemplate=\"let d of 'statusInvoice'\">\r\n    <ng-container [ngSwitch]=\"d.data.adjustment_type\">\r\n      <p *ngSwitchCase=\"1\">{{ 'GRID.GENERAL.original_invoice' | translate }}</p>\r\n      <p *ngSwitchCase=\"2\">{{ 'GRID.GENERAL.invoice_replaced' | translate }}</p>\r\n      <p *ngSwitchCase=\"3\">{{ 'GRID.GENERAL.invoice_replacement' | translate }}</p>\r\n      <p *ngSwitchCase=\"4\">{{ 'GRID.GENERAL.invoice_adjusted' | translate }}</p>\r\n      <p *ngSwitchCase=\"5\">{{ 'GRID.GENERAL.adjustment_invoice' | translate }}</p>\r\n      <p *ngSwitchCase=\"6\">{{ 'GRID.GENERAL.invoice_deleted' | translate }}</p>\r\n      <p *ngSwitchCase=\"7\">{{ 'GRID.GENERAL.invoice_removed' | translate }}</p>\r\n    </ng-container>\r\n  </div>\r\n  <!-- Biên bản điện tử -->\r\n  <div *dxTemplate=\"let d of 'invoice_reports'\">\r\n    <ng-container\r\n      *ngIf=\"filterReport(d.data.invoice_reports,'0').length >0 || filterReport(d.data.invoice_reports,'1').length ==0\">\r\n      <ng-container *ngFor=\"let data of d.data.invoice_reports; let i=index\">\r\n\r\n        <ng-container *ngIf=\"data.status === 'HOAT_DONG'\">\r\n          <div *ngIf=\"data.signature_status === 'CHUA_KY' && data.suggest_adjustment_content === null\">\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"viewReport(d.data.id,data)\" href=\"javascript:void(0)\">Chưa gửi</a>\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"data.signature_status === 'NGUOI_BAN_KY' && data.suggest_adjustment_content === null\">\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"viewReport(d.data.id,data)\" href=\"javascript:void(0)\">Chờ KH ký</a>\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n              </span>\r\n            </div>\r\n            <a title=\"file {{_translate.GRID.GENERAL.attach}}\" class=\"attachIcon actionIcon text-decoration\"\r\n              (click)=\"downloadFile(d.data,'0')\" href=\"javascript:void(0)\">\r\n            </a>\r\n          </div>\r\n\r\n          <div *ngIf=\"data.signature_status === 'NGUOI_MUA_KY' && data.suggest_adjustment_content === null\">\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"viewReport(d.data.id,data)\" href=\"javascript:void(0)\">KH đã ký</a>\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n              </span>\r\n            </div>\r\n            <a title=\"file {{_translate.GRID.GENERAL.attach}}\" class=\"attachIcon actionIcon text-decoration\"\r\n              (click)=\"downloadFile(d.data,'0')\" href=\"javascript:void(0)\">\r\n            </a>\r\n          </div>\r\n\r\n          <div *ngIf=\"data.signature_status === 'CHUA_KY' && data.suggest_adjustment_content !== null\">\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"viewReport(d.data.id,data)\" href=\"javascript:void(0)\">\r\n                  KH đề nghị điều chỉnh\r\n                </a>\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"data.signature_status === 'NGUOI_BAN_KY' && data.suggest_adjustment_content !== null\">\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"viewReport(d.data.id,data)\" href=\"javascript:void(0)\">\r\n                  KH đề nghị điều chỉnh\r\n                </a>\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n              </span>\r\n            </div>\r\n            <a title=\"file {{_translate.GRID.GENERAL.attach}}\" class=\"attachIcon actionIcon text-decoration\"\r\n              (click)=\"downloadFile(d.data,'0')\" href=\"javascript:void(0)\">\r\n            </a>\r\n          </div>\r\n\r\n          <div *ngIf=\"data.signature_status === 'NGUOI_MUA_KY' && data.suggest_adjustment_content !== null\">\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"viewReport(d.data.id,data)\" href=\"javascript:void(0)\">\r\n                  KH đề nghị điều chỉnh\r\n                </a>\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n              </span>\r\n            </div>\r\n            <a title=\"file {{_translate.GRID.GENERAL.attach}}\" class=\"attachIcon actionIcon text-decoration\"\r\n              (click)=\"downloadFile(d.data,'0')\" href=\"javascript:void(0)\">\r\n            </a>\r\n          </div>\r\n\r\n        </ng-container>\r\n      </ng-container>\r\n      <!-- <ng-container *ngIf=\"filterReport(d.data.invoice_reports,'0').length > 0\">\r\n            <a title=\"file đính kèm\"\r\n               class=\"attachIcon actionIcon text-decoration\" (click)=\"downloadFile(data.invoice_id,'0')\" href=\"javascript:void(0)\">\r\n            </a>\r\n      </ng-container> -->\r\n      <!-- <div *ngIf=\"d.data.invoice_reports.length == 0\">\r\n        <div class=\"dropdown\" style=\"float:none;\">\r\n          <a title=\"{{_translate.CONTROLL.BUTTON.extend}}\" style=\"font-size: 27px\"\r\n             (click)=\"myFunction1(d.data.id + d.data.invoice_number)\"\r\n             href=\"javascript:void(0)\"><i class=\"dx-icon fa fa-plus-circle\"></i></a>\r\n          <div [id]=\"d.data.id + d.data.invoice_number\" class=\"dropdown-content\" style=\"min-width: 180px!important;\">\r\n            <a href=\"javascript:void(0)\"\r\n               (click)=\"cancelReport(d.data)\">{{ 'CONTROLL.BUTTON.cancel_report' | translate }}\r\n            </a>\r\n            <a href=\"javascript:void(0)\"\r\n               (click)=\"dieuChinhBtn(d.data)\">{{ 'CONTROLL.BUTTON.create_adjustment_report' | translate }}\r\n            </a>\r\n            <a href=\"javascript:void(0)\" (click)=\"thayTheBtn(d.data)\">{{ 'CONTROLL.BUTTON.create_replace_report' | translate }}\r\n            </a>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n        </div>\r\n      </div> -->\r\n    </ng-container>\r\n\r\n    <div *ngIf=\"d.data.invoice_reports.length == 0\">\r\n      <!-- <div class=\"dropdown\" style=\"float:none;\">\r\n        <a title=\"{{_translate.CONTROLL.BUTTON.extend}}\" style=\"font-size: 27px\"\r\n           (click)=\"myFunction1(d.data.id + d.data.invoice_number)\"\r\n           href=\"javascript:void(0)\"><i class=\"dx-icon fa fa-plus-circle\"></i></a>\r\n        <div [id]=\"d.data.id + d.data.invoice_number\" class=\"dropdown-content\" style=\"min-width: 180px!important;\">\r\n          <a href=\"javascript:void(0)\"\r\n             (click)=\"cancelReport(d.data)\">{{ 'CONTROLL.BUTTON.cancel_report' | translate }}\r\n          </a>\r\n          <a href=\"javascript:void(0)\"\r\n             (click)=\"dieuChinhBtn(d.data)\">{{ 'CONTROLL.BUTTON.create_adjustment_report' | translate }}\r\n          </a>\r\n          <a href=\"javascript:void(0)\" (click)=\"thayTheBtn(d.data)\">{{ 'CONTROLL.BUTTON.create_replace_report' | translate }}\r\n          </a>\r\n        </div>\r\n      </div> -->\r\n      <div>\r\n        <a class=\"text-decoration\" (click)=\"sendInvoice(d.data.id)\" href=\"javascript:void(0)\">...</a>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n\r\n  <div *dxTemplate=\"let d of 'file_content'\">\r\n    <div *ngIf=\"filterReport(d.data.invoice_reports,'0').length == 0\">\r\n      <div *ngIf=\"filterReport(d.data.invoice_reports,'1').length == 0 && d.data.status !='GHI_TAM'\"\r\n        style=\"float:none;\">\r\n        <a class=\"{{_translate.ICONS.upload}}\" (click)=\"dinhKemFile($event)\" title=\"{{_translate.GRID.GENERAL.attach}}\"\r\n          style=\"color: #007BFF;font-size:18px;cursor: pointer;line-height: 26px\">\r\n          <input type=\"file\" id=\"file-dinh-kem\" [attr.data-rowindex]=\"d.data.id\"\r\n            accept=\".xlsx, .docx, .doc, .pdf, .xls, .xml\" (change)=\"onDinhKemFile($event)\" multiple=\"false\"\r\n            style=\"display: none;\" />\r\n          <!-- Chọn file -->\r\n          <!-- <i class=\"{{_translate.ICONS.upload}}\"></i> -->\r\n        </a>\r\n        <div class=\"dropdown\">\r\n          <a title=\"{{_translate.CONTROLL.BUTTON.get_template_report}}\" style=\"float: right;\"\r\n            class=\"{{_translate.ICONS.download}}\"\r\n            style=\"color: #007BFF;font-size:18px;cursor: pointer;line-height: 26px\"\r\n            (click)=\"myFunction1(d.data.id + d.data.invoice_number)\" href=\"javascript:void(0)\"></a>\r\n          <div [id]=\"d.data.id + d.data.invoice_number\" class=\"dropdown-content\" style=\"min-width: 227px!important;\"\r\n            [ngClass]=\"{'last-drodown':( pageSize - 1 == d.rowIndex || pageSize - 2 == d.rowIndex || pageSize - 3 == d.rowIndex) && pageSize > 4, 'small-grid': pageSize < 5}\">\r\n            <!-- <a  (click)=\"kyHangLoat(d.data)\" href=\"javascript:void(0)\">{{ 'CONTROLL.BUTTON.sign' | translate }} <i [(class)]=\"_translate.ICONS.pencil\"></i></a> -->\r\n            <a (click)=\"downloadFileDocx(d.data, 'HUY')\" href=\"javascript:void(0)\">{{\r\n              'CONTROLL.BUTTON.get_file_content_cancel' | translate }}\r\n              <i [class]=\"_translate.ICONS.print\"></i></a>\r\n            <a (click)=\"downloadFileDocx(d.data, 'DIEU_CHINH')\" href=\"javascript:void(0)\">{{\r\n              'CONTROLL.BUTTON.get_file_content_adjust' | translate }}\r\n              <i [class]=\"_translate.ICONS.print\"></i></a>\r\n            <!-- <a  (click)=\"viewAttachFile(d.data)\" href=\"javascript:void(0)\">{{ 'CONTROLL.BUTTON.view_attach_file' | translate }} <i [(class)]=\"_translate.ICONS.view_attach_file\"></i></a> -->\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div *ngIf=\"filterReport(d.data.invoice_reports,'1').length > 0\" class=\"dropdown\" style=\"float:none;\">\r\n        <a title=\"file {{_translate.GRID.GENERAL.attach}}\" class=\"attachIcon actionIcon text-decoration\"\r\n          (click)=\"downloadFile(d.data,'1')\" href=\"javascript:void(0)\">\r\n        </a>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n\r\n  <div *dxTemplate=\"let d of 'actionIcon'\">\r\n    <div class=\"dropdown\">\r\n      <a title=\"{{_translate.CONTROLL.BUTTON.extend}}\" style=\"float: right;\" class=\"morongIcon actionIcon\"\r\n        (click)=\"myFunction(d.data.id)\" href=\"javascript:void(0)\"></a>\r\n      <div [id]=\"d.data.id\" class=\"dropdown-content\" style=\"margin-top: 26px!important;\"\r\n        [ngClass]=\"{'last-drodown':( pageSize - 1 == d.rowIndex || pageSize - 2 == d.rowIndex || pageSize - 3 == d.rowIndex) && pageSize > 4, 'small-grid': pageSize < 5}\">\r\n        <!-- <a  (click)=\"kyHangLoat(d.data)\" href=\"javascript:void(0)\">{{ 'CONTROLL.BUTTON.sign' | translate }} <i [(class)]=\"_translate.ICONS.pencil\"></i></a> -->\r\n        <a (click)=\"inChuyenDoi(d.data)\" href=\"javascript:void(0)\">{{ 'CONTROLL.BUTTON.print_conversion' | translate }}\r\n          <i [class]=\"_translate.ICONS.print\"></i></a>\r\n        <!-- <a  (click)=\"viewAttachFile(d.data)\" href=\"javascript:void(0)\">{{ 'CONTROLL.BUTTON.view_attach_file' | translate }} <i [(class)]=\"_translate.ICONS.view_attach_file\"></i></a> -->\r\n      </div>\r\n    </div>\r\n\r\n    <a *ngIf=\"d.data.invoice_files &&d.data.invoice_files.length>0\" style=\"float: right;\"\r\n      title=\"{{_translate.CONTROLL.BUTTON.view_attach_file}}\" class=\"attachIcon actionIcon\"\r\n      (click)=\"viewAttachFile(d.data)\" href=\"javascript:void(0)\">\r\n    </a>\r\n    <a *ngIf=\"d.data.status =='GHI_TAM'\" style=\"float: right;\" title=\"{{_translate.CONTROLL.BUTTON.delete}}\"\r\n      class=\"xoaIcon actionIcon\" (click)=\"deleteItem(d.data)\" href=\"javascript:void(0)\">\r\n    </a>\r\n    <a *ngIf=\"d.data.status =='DA_XUAT'\" style=\"float: right;\" title=\"{{_translate.CONTROLL.BUTTON.tai_hd_xml}}\"\r\n      class=\"taiXmlIcon actionIcon\" (click)=\"taiHDXml(d.data)\" href=\"javascript:void(0)\">\r\n    </a>\r\n    <a *ngIf=\"d.data.status =='GHI_TAM'\" style=\"float: right;\" title=\"{{_translate.CONTROLL.BUTTON.edit}}\"\r\n      class=\"suaIcon actionIcon\" (click)=\"editNotSelect(d.data)\" href=\"javascript:void(0)\">\r\n    </a>\r\n    <a title=\"{{_translate.CONTROLL.BUTTON.view_invoice}}\" style=\"float: right;\" class=\"xemIcon actionIcon\"\r\n      (click)=\"view(d.data)\" href=\"javascript:void(0)\">\r\n    </a>\r\n\r\n\r\n  </div>\r\n  <div *dxTemplate=\"let info of 'titleHeaderTemplate'\">\r\n    <p><i class=\"fa fa-sort icon-dx-sort\"></i> {{info.column.caption}} </p>\r\n  </div>\r\n\r\n  <dxo-summary>\r\n    <dxi-total-item summaryType=\"custom\" cssClass=\"dxi-total-payment-total_payment_string\" [customizeText]=\"customizeText\" showInColumn=\"total_payment_string\">\r\n    </dxi-total-item>\r\n  </dxo-summary>\r\n\r\n  <dxo-remote-operations [sorting]=\"true\" [paging]=\"true\" [filtering]=\"true\" [summary]=\"true\">\r\n  </dxo-remote-operations>\r\n  <dxo-paging [pageSize]=\"configs.system_parameter.number_row_per_page\"></dxo-paging>\r\n  <dxo-pager [showPageSizeSelector]=\"true\" [allowedPageSizes]=\"[15, 35, 50, 100]\" [showNavigationButtons]=\"true\"\r\n    [showInfo]=\"true\">\r\n  </dxo-pager>\r\n</dx-data-grid>\r\n\r\n\r\n<!-- <dx-popover\r\n  [(target)]=\"popoverTarget\"\r\n  [width]=\"200\"\r\n>\r\n<div *dxTemplate=\"let data of 'content'\">\r\n        <span>{{popOverText}}</span>\r\n</div>\r\n</dx-popover>   -->\r\n<ngx-spinner bdColor=\"rgba(51,51,51,0.8)\" size=\"medium\" color=\"#fff\" type=\"timer\">\r\n  <p style=\"font-size: 20px; color: white\">Loading...</p>\r\n</ngx-spinner>\r\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/index/index.component.scss":
/*!******************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/index/index.component.scss ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".chua-gui-khach-hang{color:red}.cho-ky{color:#008b8b}.gach-chan{text-decoration:underline;cursor:pointer}.search-section{padding-bottom:15px}.last-drodown{bottom:30px}.small-grid{position:fixed  !important;right:39px !important}.button-panel{margin-top:30px;margin-right:16px}::ng-deep #gridContainerInvoice .dx-cell-focus-disabled{overflow:visible !important}::ng-deep #gridContainerInvoice .dx-datagrid-rowsview{overflow:visible}.text-decoration{text-decoration:none}::ng-deep .truyen-nhan{max-width:80% !important;margin:auto}::ng-deep .view-invoice{max-width:100%;margin:0px;height:100%}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/index/index.component.ts":
/*!****************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/index/index.component.ts ***!
  \****************************************************************************/
/*! exports provided: IndexComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "IndexComponent", function() { return IndexComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @modules/handle-invoice/shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var _remove_remove_component__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../remove/remove.component */ "./src/app/modules/handle-invoice/components/remove/remove.component.ts");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../send-invoices/send-invoices.component */ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _shared_modules_vat_shared_components_view_attach_file_view_attach_file_component__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @shared/modules/vat-shared/components/view-attach-file/view-attach-file.component */ "./src/app/shared/modules/vat-shared/components/view-attach-file/view-attach-file.component.ts");
/* harmony import */ var _modules_handle_report_hanlde_report_service__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @modules/handle-report/hanlde-report.service */ "./src/app/modules/handle-report/hanlde-report.service.ts");
/* harmony import */ var _core_helper_Helper__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @core/helper/Helper */ "./src/app/core/helper/Helper.ts");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _angular_forms__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @angular/forms */ "./node_modules/@angular/forms/fesm5/forms.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_14__);
/* harmony import */ var _modules_template_shared__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @modules/template/shared */ "./src/app/modules/template/shared/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var _report_tax_invoice_error_report_tax_invoice_error_component__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../report-tax-invoice-error/report-tax-invoice-error.component */ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.ts");
/* harmony import */ var ngx_spinner__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ngx-spinner */ "./node_modules/ngx-spinner/fesm5/ngx-spinner.js");
/* harmony import */ var _modules_search_shared__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @modules/search/shared */ "./src/app/modules/search/shared/index.ts");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
/* harmony import */ var _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @shared/service/invoice.service */ "./src/app/shared/service/invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};























var IndexComponent = /** @class */ (function () {
    function IndexComponent(authService, handleInvoiceService, vatService, modalService, router, translate, handleReportService, fb, templateService, spinner, socketService, searchService, vPreviewInvService, invoiceService) {
        var _this = this;
        this.authService = authService;
        this.handleInvoiceService = handleInvoiceService;
        this.vatService = vatService;
        this.modalService = modalService;
        this.router = router;
        this.translate = translate;
        this.handleReportService = handleReportService;
        this.fb = fb;
        this.templateService = templateService;
        this.spinner = spinner;
        this.socketService = socketService;
        this.searchService = searchService;
        this.vPreviewInvService = vPreviewInvService;
        this.invoiceService = invoiceService;
        this.selectedRows = [];
        this.selectedItems = [];
        this.clickCurent = undefined;
        this.idRow = undefined;
        this.configs = {};
        this.isDisableAdjust = true;
        this.isDaDKTT78 = false;
        this.isExistFormRelease = false;
        this.isFormHandInvoice = false;
        this.isDisableReplace = true;
        this.objStatusBtn = {};
        this.customizeText = function (url) {
            _this.invoiceService.handleTotalGrid(url.value, _this.objStatusBtn, _this.dataGrid);
            return '';
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
    }
    IndexComponent.prototype.ngOnInit = function () {
        this.formFileContent = this.fb.group(this.handleReportService.generatedFormControlAll);
        this.currentUser = this.authService.getCurrentUser();
        this.configs = this.authService.getConfigs();
        if (this.configs.system_parameter.select_invoice_current_page)
            this.pageSelect = "page";
        else
            this.pageSelect = "allPages";
        if (this.currentUser.is_convert_TT78) {
            this.infoDangKy = this.authService.getInfoRegister();
            if (this.infoDangKy && this.infoDangKy.id) {
                if (this.infoDangKy.status == "CHAP_NHAN") {
                    this.isDaDKTT78 = true;
                    this.isFormHandInvoice = true;
                    var infoFormRelease = this.authService.getInfoFormRelease();
                    if (infoFormRelease && infoFormRelease.invoice_releases && infoFormRelease.invoice_releases.length > 0) {
                        var invoicesReleases = infoFormRelease.invoice_releases.filter(function (p) { return (parseInt(p.amount) - parseInt(p.used_amount)) > 0; });
                        if (invoicesReleases && invoicesReleases.length > 0)
                            this.isExistFormRelease = true;
                    }
                }
            }
        }
        /* Hiện nút điều chỉnh/thay thế */
        if (this.configs.system_parameter.incurred_adjustment_invoice || this.configs.system_parameter.process_not_in_software) {
            this.isDisableAdjust = false;
            if (this.configs.system_parameter.process_not_in_software)
                this.isDisableReplace = false;
        }
    };
    IndexComponent.prototype.loadList = function (params) {
        this.dataSource = {};
        this.dataSource.store = this.handleInvoiceService.getAll(params);
        // if (params) {
        //   this.dataSource.store = this.handleInvoiceService.getAll(params);
        // } else {
        //   this.dataSource.store = this.handleInvoiceService.getAll();
        // }
    };
    IndexComponent.prototype.filterReport = function (data, _condition) {
        if (data && data.length > 0) {
            return data.filter(function (p) { return p.is_paper_report == _condition && p.status == 'HOAT_DONG'; });
        }
        else {
            return [];
        }
    };
    IndexComponent.prototype.onRowPrepared = function (e) {
        if (e.rowType == 'data') {
            switch (e.data.status) {
                case 'DA_XUAT':
                    break;
                case 'GHI_TAM':
                    if (e.data.invoice_number) {
                        if (e.data.send_department_status == "DA_GUI_CQT")
                            e.rowElement.style.color = '#008B8B';
                        else if (e.data.send_department_status == "DA_CAP")
                            e.rowElement.style.color = 'black';
                        else if (e.data.send_department_status == "DA_TIEP_NHAN")
                            e.rowElement.style.color = 'black';
                        else
                            e.rowElement.style.color = 'red';
                    }
                    else {
                        e.rowElement.style.color = '#DEA960';
                    }
                    break;
                case 'GIU_SO':
                    e.rowElement.style.color = '#008B8B';
                    break;
                default:
                    break;
            }
            if (e.data.adjustment_type === '2' || e.data.adjustment_type === '7' || e.data.adjustment_type === '6') {
                var eles = e.rowElement.getElementsByTagName('td');
                for (var i = 0; i < eles.length; i++) {
                    if (i !== 9 && i !== 1) {
                        eles[i].style.textDecoration = 'line-through';
                    }
                }
            }
        }
    };
    IndexComponent.prototype.trangthaihoadon = function (data) {
        switch (data.status) {
            case 'DA_XUAT':
                break;
            case 'GHI_TAM':
                if (data.invoice_number) {
                    return this._translate.GRID.INVOICE.signed_error;
                }
                else {
                    return this._translate.CONTROLL.BUTTON.save_temporary;
                }
            case 'GIU_SO':
                return this._translate.GRID.INVOICE.wait_for_sign;
            default:
                break;
        }
    };
    IndexComponent.prototype.getSearch = function (e) {
        this.paramSearch = e;
        this.loadList(e);
    };
    IndexComponent.prototype.checkDisableButton = function () {
        if (this.selectedItems.length) {
            if (this.selectedItems[0].status == 'DA_XUAT') {
                return true;
            }
            return false;
        }
        return false;
    };
    IndexComponent.prototype.myFunction = function (e) {
        if (this.idRow && document.getElementById(this.idRow)) {
            document.getElementById(this.idRow).classList.remove('show');
        }
        if (this.clickCurent !== undefined && this.clickCurent !== e && document.getElementById(this.clickCurent)) {
            document.getElementById(this.clickCurent).classList.remove('show');
        }
        document.getElementById(e).classList.toggle('show');
        this.clickCurent = e;
    };
    IndexComponent.prototype.myFunction1 = function (e) {
        if (this.clickCurent && document.getElementById(this.clickCurent)) {
            document.getElementById(this.clickCurent).classList.remove('show');
        }
        if (this.idRow !== '' && this.idRow !== e && document.getElementById(this.idRow)) {
            document.getElementById(this.idRow).classList.remove('show');
        }
        document.getElementById(e).classList.toggle('show');
        this.idRow = e;
    };
    // Chọn đối tượng trong màn hình danh sách
    IndexComponent.prototype.selectionChanged = function (data) {
        this.hidenDropdownList();
        this.selectedItems = data.selectedRowsData;
        if (this.selectedRows.length == 1 || this.configs.system_parameter.incurred_adjustment_invoice || this.configs.system_parameter.process_not_in_software) {
            if (this.selectedRows.length == 1 || this.configs.system_parameter.process_not_in_software) {
                this.isDisableAdjust = false;
                this.isDisableReplace = false;
            }
            else {
                this.isDisableAdjust = false;
                this.isDisableReplace = true;
            }
        }
        else {
            this.isDisableAdjust = true;
            this.isDisableReplace = true;
        }
    };
    IndexComponent.prototype.setUrlNavigate = function () {
        var url = window.location.pathname;
        if (sessionStorage.hasOwnProperty('urlIndex')) {
            if (sessionStorage.getItem('urlIndex') !== null) {
                sessionStorage.setItem('urlIndex', url);
            }
            else {
                sessionStorage.setItem('urlIndex', url);
            }
        }
        else {
            sessionStorage.setItem('urlIndex', url);
        }
    };
    IndexComponent.prototype.routerCancelInvoice = function () {
        var _this = this;
        if (this.selectedItems && this.selectedItems.length > 0) {
            var lstGhiTam = this.selectedItems.filter(function (p) { return p.status == 'GHI_TAM'; });
            if (lstGhiTam && lstGhiTam.length == this.selectedItems.length) {
                var ids_1 = this.selectedRows.join(',');
                var result = _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].confirm(this._translate.CONFIRM.delete, this._translate.NOTIFY.notify);
                result.then(function (dialogResult) {
                    if (dialogResult) {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                        _this.handleInvoiceService.delete(ids_1).subscribe(function (rs) {
                            if (rs.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(_this._translate.NOTIFY.delete_success, 'success');
                                _this.loadList(_this.paramSearch);
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                            }
                        }, function (err) {
                        }, function () {
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                        });
                    }
                });
            }
            else {
                var lstInvoice = this.selectedItems.filter(function (p) { return p.status == 'DA_XUAT' && p.adjustment_type == '1'; });
                if (lstInvoice && lstInvoice.length > 0) {
                    if (lstInvoice.length == 1) {
                        var row = lstInvoice[0];
                        this.setUrlNavigate();
                        this.router.navigate(['/system/handle-report/', row.id, 'HUY']);
                    }
                    else {
                        var _lstCancel = lstInvoice.filter(function (p) { return p.adjustment_type == '7' || p.adjustment_type == '2'; });
                        if (_lstCancel && _lstCancel.length > 0) {
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.choose_cancel_invoice, 'error');
                        }
                        else {
                            this.delete(lstInvoice);
                        }
                    }
                }
                else
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể hủy hóa đơn này', 'error');
            }
        }
    };
    IndexComponent.prototype.dieuChinh = function () {
        var _this = this;
        if (this.isExistFormRelease) {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify("Vui lòng hủy dải hóa đơn theo TT32 chưa sử dụng trước khi lập hóa đơn theo TT78", "error", 5000);
            return;
        }
        if (this.selectedItems && this.selectedItems.length == 0) {
            if (this.configs.system_parameter.process_not_in_software) {
                this.router.navigate(['/system/handle-invoice/adjust-without-software']);
            }
            else if (this.configs.system_parameter.incurred_adjustment_invoice)
                this.router.navigate(['/system/handle-invoice/multiple-adjust']);
        }
        else {
            if (this.selectedItems && this.selectedItems.length == 1) {
                var row_1 = this.selectedItems[0];
                if (row_1.status === 'DA_XUAT' && row_1.adjustment_type !== '7' && row_1.adjustment_type !== '2' && row_1.template_code != '5') {
                    if (row_1.xml_type == 4) {
                        this.router.navigate(['/system/handle-invoice/adjust-without-software'], {
                            queryParams: {
                                loaiHoaDonGoc: 3, mauHoaDonGoc: row_1.template_code, kyHieuHoaDonGoc: row_1.invoice_series, soHoaDonGoc: row_1.invoice_number,
                                ngayHoaDonGoc: row_1.invoice_date, idHoaDonGoc: row_1.id, htHoaDonGoc: row_1.xml_type, dcHoaDonGoc: row_1.adjustment_type
                            }
                        });
                    }
                    else {
                        var template_code_1 = row_1.template_code.split('/');
                        var template_1 = row_1.invoice_type;
                        if (this.isDaDKTT78) {
                            if (row_1.adjustment_type == '1') {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                                this.handleInvoiceService.checkStatusInvoice(row_1.id, true).subscribe(function (rs) {
                                    if (rs.status == "success") {
                                        if (template_code_1[0].indexOf('01GTKT') >= 0 || template_code_1[0].indexOf('02GTTT') >= 0 || template_code_1[0].indexOf('07KPTQ') >= 0
                                            || template_code_1[0] == "2" || template_code_1[0] == "1") {
                                            _this.setUrlNavigate();
                                            _this.router.navigate(['/system/handle-report/', row_1.id, 'DIEU_CHINH']);
                                        }
                                        else if (template_code_1[0] == "6") {
                                            if (template_1 == "03XKNB") {
                                                _this.router.navigate(['/system/handle-invoice/adjust-warehouse', row_1.id]);
                                            }
                                            else {
                                                _this.router.navigate(['/system/handle-invoice/adjust-agent', row_1.id]);
                                            }
                                        }
                                    }
                                    else {
                                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error', 5000);
                                    }
                                }, function (err) {
                                }, function () {
                                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                                });
                            }
                            else if (row_1.adjustment_type == '4' && template_code_1[0] == "6") {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                                this.handleInvoiceService.checkStatusInvoice(row_1.id, false).subscribe(function (rs) {
                                    if (rs.status == "success") {
                                        if (template_1 == "03XKNB") {
                                            _this.router.navigate(['/system/handle-invoice/adjust-warehouse', row_1.id]);
                                        }
                                        else {
                                            _this.router.navigate(['/system/handle-invoice/adjust-agent', row_1.id]);
                                        }
                                    }
                                    else {
                                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error', 5000);
                                    }
                                }, function (err) {
                                }, function () {
                                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                                });
                            }
                            else {
                                if (template_code_1[0].indexOf('01GTKT') >= 0 || template_code_1[0].indexOf('02GTTT') >= 0 || template_code_1[0].indexOf('07KPTQ') >= 0
                                    || template_code_1[0] == "2" || template_code_1[0] == "1") {
                                    this.setUrlNavigate();
                                    this.router.navigate(['/system/handle-report/', row_1.id, 'DIEU_CHINH']);
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể điều chỉnh hóa đơn này', 'error');
                                }
                            }
                        }
                        else {
                            if (template_code_1[0].indexOf('01GTKT') >= 0 || template_code_1[0].indexOf('02GTTT') >= 0 || template_code_1[0].indexOf('07KPTQ') >= 0
                                || template_code_1[0] == "2" || template_code_1[0] == "1") {
                                this.setUrlNavigate();
                                this.router.navigate(['/system/handle-report/', row_1.id, 'DIEU_CHINH']);
                            }
                        }
                    }
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể điều chỉnh hóa đơn này', 'error');
                }
            }
        }
    };
    IndexComponent.prototype.thayThe = function () {
        var _this = this;
        if (this.isExistFormRelease) {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify("Vui lòng hủy dải hóa đơn theo TT32 chưa sử dụng trước khi lập hóa đơn theo TT78", "error", 5000);
            return;
        }
        if (this.selectedItems && this.selectedItems.length == 0 && this.configs.system_parameter.process_not_in_software) {
            this.router.navigate(['/system/handle-invoice/replace-without-software']);
        }
        else if (this.selectedItems && this.selectedItems.length == 1) {
            var row_2 = this.selectedItems[0];
            if (row_2.status === 'DA_XUAT' && row_2.adjustment_type !== '4' && row_2.template_code != '5') {
                if (row_2.xml_type == 4) {
                    this.router.navigate(['/system/handle-invoice/replace-without-software'], {
                        queryParams: {
                            loaiHoaDonGoc: 3, mauHoaDonGoc: row_2.template_code, kyHieuHoaDonGoc: row_2.invoice_series, soHoaDonGoc: row_2.invoice_number,
                            ngayHoaDonGoc: row_2.invoice_date, idHoaDonGoc: row_2.id, htHoaDonGoc: row_2.xml_type, dcHoaDonGoc: row_2.adjustment_type
                        }
                    });
                }
                else {
                    var template_code_2 = row_2.template_code.split('/');
                    var template_2 = row_2.invoice_type;
                    if (this.isDaDKTT78) {
                        if (row_2.adjustment_type == '1') {
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                            this.handleInvoiceService.checkStatusInvoice(row_2.id, false).subscribe(function (rs) {
                                if (rs.status == "success") {
                                    if (template_code_2[0].indexOf('01GTKT') >= 0 || template_code_2[0].indexOf('02GTTT') >= 0 || template_code_2[0].indexOf('07KPTQ') >= 0
                                        || template_code_2[0] == "2" || template_code_2[0] == "1") {
                                        _this.setUrlNavigate();
                                        _this.router.navigate(['/system/handle-report/', row_2.id, 'THAY_THE']);
                                    }
                                    else if (template_code_2[0] == "6") {
                                        if (template_2 == "03XKNB") {
                                            _this.router.navigate(['/system/handle-invoice/replace-warehouse', row_2.id]);
                                        }
                                        else {
                                            _this.router.navigate(['/system/handle-invoice/replace-agent', row_2.id]);
                                        }
                                    }
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error', 5000);
                                }
                            }, function (err) {
                            }, function () {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                            });
                        }
                        else if (row_2.adjustment_type == '3' && template_code_2[0] == "6") {
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                            this.handleInvoiceService.checkStatusInvoice(row_2.id, false).subscribe(function (rs) {
                                if (rs.status == "success") {
                                    if (template_2 == "03XKNB") {
                                        _this.router.navigate(['/system/handle-invoice/replace-warehouse', row_2.id]);
                                    }
                                    else {
                                        _this.router.navigate(['/system/handle-invoice/replace-agent', row_2.id]);
                                    }
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error', 5000);
                                }
                            }, function (err) {
                            }, function () {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                            });
                        }
                        else {
                            if (template_code_2[0].indexOf('01GTKT') >= 0 || template_code_2[0].indexOf('02GTTT') >= 0 || template_code_2[0].indexOf('07KPTQ') >= 0
                                || template_code_2[0] == "2" || template_code_2[0] == "1") {
                                this.setUrlNavigate();
                                this.router.navigate(['/system/handle-report/', row_2.id, 'THAY_THE']);
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể thay thế hóa đơn này', 'error');
                            }
                        }
                    }
                    else {
                        if (template_code_2[0].indexOf('01GTKT') >= 0 || template_code_2[0].indexOf('02GTTT') >= 0 || template_code_2[0].indexOf('07KPTQ') >= 0
                            || template_code_2[0] == "2" || template_code_2[0] == "1" || template_code_2[0].indexOf('03XKNB') >= 0) {
                            this.setUrlNavigate();
                            this.router.navigate(['/system/handle-report/', row_2.id, 'THAY_THE']);
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể thay thế hóa đơn này!', 'error');
                        }
                    }
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể thay thế hóa đơn này', 'error');
            }
        }
    };
    IndexComponent.prototype.editNotSelect = function (row) {
        if (this.isExistFormRelease) {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify("Vui lòng hủy dải hóa đơn theo TT32 chưa sử dụng trước khi lập hóa đơn theo TT78", "error", 5000);
            return;
        }
        this.hidenDropdownList();
        if (row.status === 'DA_XUAT') {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể sửa hóa đơn đã xuất', 'error');
        }
        else {
            if (row.adjustment_type === '5') {
                if (row.is_adjustment_invoices || row.is_outside_process) {
                    if (row.is_adjustment_invoices)
                        this.router.navigate(["/system/handle-invoice/multiple-adjust/" + row.id]);
                    else
                        this.router.navigate(["/system/handle-invoice/adjust-without-software/" + row.id]);
                }
                else {
                    switch (row.invoice_type) {
                        case '01GTKT':
                            this.router.navigate(["/system/handle-invoice/edit-adjust/" + row.id]);
                            break;
                        case '02GTTT':
                            this.router.navigate(["/system/handle-invoice/edit-sale-adjust/" + row.id]);
                            break;
                        case '07KPTQ':
                            this.router.navigate(["/system/handle-invoice/edit-non-tariff-adjust/" + row.id]);
                            break;
                        case '04HGDL':
                            this.router.navigate(["/system/handle-invoice/edit-adjust-agent/" + row.id]);
                            break;
                        case '03XKNB':
                            this.router.navigate(["/system/handle-invoice/edit-adjust-warehouse/" + row.id]);
                            break;
                        default:
                            break;
                    }
                }
            }
            else if (row.adjustment_type === '3') {
                if (row.is_outside_process) {
                    this.router.navigate(["/system/handle-invoice/replace-without-software/" + row.id]);
                }
                else {
                    switch (row.invoice_type) {
                        case '01GTKT':
                            this.router.navigate(["/system/handle-invoice/edit-replace/" + row.id]);
                            break;
                        case '02GTTT':
                            this.router.navigate(["/system/handle-invoice/edit-sale-replace/" + row.id]);
                            break;
                        case '07KPTQ':
                            this.router.navigate(["/system/handle-invoice/edit-non-tariff-replace/" + row.id]);
                            break;
                        case '04HGDL':
                            this.router.navigate(["/system/handle-invoice/edit-replace-agent/" + row.id]);
                            break;
                        case '03XKNB':
                            this.router.navigate(["/system/handle-invoice/edit-replace-warehouse/" + row.id]);
                            break;
                        default:
                            break;
                    }
                }
            }
        }
    };
    IndexComponent.prototype.viewNotSelect = function (row) {
        var _this = this;
        this.hidenDropdownList();
        if (row.status == 'DA_XUAT') {
            if (row.xml_type == 4 && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(row.link_pdf_file) != "") {
                var oData = {
                    url: row.link_pdf_file,
                    type: 'pdf'
                };
                var popup_1 = window.open('about:blank', 'name', "width=200, height=100");
                popup_1.document.body.innerHTML = this._translate.NOTIFY.loading;
                popup_1.blur();
                this.spinner.show();
                var sub_1 = this.searchService.getFilePdf(oData).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        var w = 1920, h = 900;
                        w = window.screen.availWidth * 100 / 100;
                        h = window.screen.availHeight * 93 / 100;
                        var pdf_file = rs.data.file_content;
                        var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_5__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                        var win = window.open(objectUrl, 'name', 'width=' + w + ', height=' + h);
                        win.resizeTo(screen.availWidth, screen.availHeight);
                        win.focus();
                        _this.spinner.hide();
                    }
                    else {
                        popup_1.close();
                        _this.spinner.hide();
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                    _this.spinner.hide();
                }, function () {
                    sub_1.unsubscribe();
                });
            }
            else {
                var ids = [];
                ids.push(row.id);
                if (this.configs.system_parameter.view_multi_invoice) {
                    var data = this.vatService.taodulieuXemMau(ids);
                    data['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].cauhinhxemmau.hoadon;
                    this.vPreviewInvService.xemMau(data);
                }
                else {
                    var initialState = {
                        items: ids,
                        isXuatHD: false,
                        hinhthucxuat: '',
                        typeAction: _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].typeCode.xem_hoa_don
                    };
                    this.vPreviewInvService.xemMauPhanTrang(initialState);
                }
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Hóa đơn bị ký lỗi, bạn vui lòng ký lại hóa đơn', 'error');
        }
    };
    IndexComponent.prototype.view = function (data) {
        var _this = this;
        if (data) {
            if (data) {
                if (data.xml_type == 4 && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(data.link_pdf_file) != "") {
                    var oData = {
                        url: data.link_pdf_file,
                        type: 'pdf'
                    };
                    var popup_2 = window.open('about:blank', 'name', "width=200, height=100");
                    setTimeout(function () {
                        popup_2.document.body.innerHTML = _this._translate.NOTIFY.loading;
                        popup_2.blur();
                    }, 30);
                    this.spinner.show();
                    var sub_2 = this.searchService.getFilePdf(oData).subscribe(function (rs) {
                        if (rs.status === 'success') {
                            var w = 1920, h = 900;
                            w = window.screen.availWidth * 100 / 100;
                            h = window.screen.availHeight * 93 / 100;
                            var pdf_file = rs.data.file_content;
                            var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_5__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                            var win = window.open(objectUrl, 'name', 'width=' + w + ', height=' + h);
                            win.resizeTo(screen.availWidth, screen.availHeight);
                            win.focus();
                            _this.spinner.hide();
                        }
                        else {
                            popup_2.close();
                            _this.spinner.hide();
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                        }
                    }, function (err) {
                        _this.spinner.hide();
                    }, function () {
                        sub_2.unsubscribe();
                    });
                }
                else {
                    this.dataInfor = data;
                    var ids = [];
                    ids.push(data.id);
                    if (this.configs.system_parameter.view_multi_invoice) {
                        var data_1 = this.vatService.taodulieuXemMau(ids);
                        data_1['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].cauhinhxemmau.hoadon;
                        this.vPreviewInvService.xemMau(data_1);
                    }
                    else {
                        var initialState = {
                            items: ids,
                            isXuatHD: false,
                            hinhthucxuat: '',
                            typeAction: _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].typeCode.xem_hoa_don
                        };
                        this.vPreviewInvService.xemMauPhanTrang(initialState);
                    }
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.no_record_selected, 'error');
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.no_record_selected, 'error');
        }
    };
    IndexComponent.prototype.viewDetailInvoice = function (row) {
        this.router.navigate(["/system/vat-invoice/" + row.id]);
    };
    IndexComponent.prototype.viewReport = function (idInv, data) {
        var url = window.location.pathname;
        var type;
        if (data.type === 'HUY') {
            type = 'THAY_THE';
        }
        else {
            type = data.type;
        }
        if (sessionStorage.hasOwnProperty('urlCreate')) {
            if (sessionStorage.getItem('urlCreate') !== null) {
                sessionStorage.setItem('urlCreate', url);
            }
            else {
                sessionStorage.setItem('urlCreate', url);
            }
        }
        else {
            sessionStorage.setItem('urlCreate', url);
        }
        this.handleReportService.createReport(idInv, type);
    };
    IndexComponent.prototype.sendInvoice = function (id) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        var sub = this.vatService.showToSendInvoice(id).subscribe(function (rs) {
            if (rs.status == 'success') {
                var initialState = {
                    invoice: rs.data.invoice,
                };
                _this.bsModalRef = _this.modalService.show(_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_7__["SendInvoicesComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveItem) {
                        _this.loadList(_this.paramSearch);
                    }
                });
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    IndexComponent.prototype.delete = function (lstInvoice) {
        var _this = this;
        this.hidenDropdownList();
        var ids = [];
        lstInvoice = lstInvoice.sort(function (invA, invB) {
            return new Date(invB.invoice_date) - new Date(invA.invoice_date) || invB.invoice_number.localeCompare(invA.invoice_number);
        });
        ids = lstInvoice.map(function (e) { return e.id; });
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        var isView = false;
        var sub = this.handleInvoiceService.showHDXoaBo(ids, isView).subscribe(function (rs) {
            // let countReport = 0;
            // if (rs[1].data.invoice_reports)
            //   countReport = rs[1].data.invoice_reports.length;
            var lstInvoice = rs[0].data.invoices.filter(function (p) { return p.adjustment_type == '7'; });
            if (lstInvoice && lstInvoice.length > 0)
                isView = true;
            var lstInv = [];
            ids.forEach(function (id) {
                var inv = rs[0].data.invoices.filter(function (p) { return p.id == id; })[0];
                lstInv.push(inv);
            });
            var initialState = {
                isView: isView,
                data: lstInv,
                configs: _this.configs,
                infoDangKy: _this.infoDangKy
                //  countReport: countReport,
            };
            _this.bsModalRef = _this.modalService.show(_remove_remove_component__WEBPACK_IMPORTED_MODULE_3__["RemoveComponent"], {
                class: 'modal-lg full-width', initialState: initialState, backdrop: 'static',
                keyboard: false
            });
            _this.modalService.onHide.subscribe(function () {
                if (_this.bsModalRef.content.successSaveItem) {
                    _this.loadList(_this.paramSearch);
                    _this.selectedRows = [];
                }
            });
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    IndexComponent.prototype.deleteItem = function (data) {
        var _this = this;
        var ids = data.id;
        var result = _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].confirm(this._translate.CONFIRM.delete, this._translate.NOTIFY.notify);
        result.then(function (dialogResult) {
            if (dialogResult) {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                _this.handleInvoiceService.delete(ids).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(_this._translate.NOTIFY.delete_success, 'success');
                        _this.loadList(_this.paramSearch);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                });
            }
        });
    };
    IndexComponent.prototype.viewAttachFile = function (data) {
        var _this = this;
        this.hidenDropdownList();
        if (data) {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
            this.vatService.showAttachFile(data.id).subscribe(function (rs) {
                if (rs.status == 'success') {
                    if (rs.data && rs.data.invoice && rs.data.invoice.invoice_files.length > 0) {
                        var initialState = {
                            fileData: rs.data.invoice.invoice_files,
                            view_attach_file: true,
                        };
                        _this.bsModalRef = _this.modalService.show(_shared_modules_vat_shared_components_view_attach_file_view_attach_file_component__WEBPACK_IMPORTED_MODULE_9__["ViewAttachFileComponent"], {
                            backdrop: 'static',
                            keyboard: false,
                            class: 'modal-lg',
                            initialState: initialState
                        });
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(_this._translate.NOTIFY.not_file_attach, 'error');
                    }
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(_this._translate.NOTIFY.an_error_occurred, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
            });
        }
    };
    IndexComponent.prototype.inChuyenDoi = function (data) {
        var _this = this;
        if (this.selectedItems.length || data) {
            var _lst = this.selectedItems.filter(function (p) { return p.status == 'DA_XUAT'; });
            if (_lst.length > 0 || data) {
                var ids = [];
                if (data) {
                    if (data.status == 'DA_XUAT') {
                        ids.push(data.id);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.not_print_convert, 'error');
                        return;
                    }
                }
                else {
                    ids = _lst.map(function (e) { return e.id; });
                }
                if (data.xml_type == 4 && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(data.link_pdf_file) != "") {
                    var oData = {
                        url: data.link_pdf_file,
                        type: 'pdf'
                    };
                    var popup_3 = window.open('about:blank', 'name', "width=200, height=100");
                    popup_3.document.body.innerHTML = this._translate.NOTIFY.loading;
                    popup_3.blur();
                    this.spinner.show();
                    var sub_3 = this.searchService.getFilePdf(oData).subscribe(function (rs) {
                        if (rs.status === 'success') {
                            var w = 1920, h = 900;
                            w = window.screen.availWidth * 100 / 100;
                            h = window.screen.availHeight * 93 / 100;
                            var pdf_file = rs.data.file_content;
                            var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_5__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                            var win = window.open(objectUrl, 'name', 'width=' + w + ', height=' + h);
                            win.resizeTo(screen.availWidth, screen.availHeight);
                            win.focus();
                            _this.spinner.hide();
                        }
                        else {
                            popup_3.close();
                            _this.spinner.hide();
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                        }
                    }, function (err) {
                        popup_3.close();
                        _this.spinner.hide();
                    }, function () {
                        sub_3.unsubscribe();
                    });
                }
                else {
                    if (this.configs.system_parameter.view_multi_invoice) {
                        var data_2 = this.vatService.taodulieuInMau(ids, false);
                        data_2['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].cauhinhxemmau.hoadon;
                        this.vPreviewInvService.xemMau(data_2);
                    }
                    else {
                        var initialState = {
                            items: ids,
                            isXuatHD: false,
                            hinhthucxuat: '',
                            typeAction: _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].typeCode.in_chuyen_doi_hd
                        };
                        this.vPreviewInvService.xemMauPhanTrang(initialState);
                    }
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.no_record_selected, 'error');
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.no_record_selected, 'error');
        }
    };
    IndexComponent.prototype.downloadFile = function (data, isBBGiay) {
        var _this = this;
        this.hidenDropdownList();
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        this.handleReportService.getAllFileContentOfReport(data.id, isBBGiay)
            .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_12__["map"])(function (value) {
            if (value.status === 'success') {
                return value.data.invoice_reports;
            }
        }), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_12__["finalize"])(function () { return _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading(); }))
            .subscribe(function (value) {
            _this.arrayFileContent = [];
            for (var i = 0; i < value.length; i++) {
                if (value[i].file_content !== null) {
                    if (value[i].type === 'DIEU_CHINH') {
                        _this.arrayFileContent.push({ id: value[i].id, file_content: value[i].file_content, file_name: value[i].file_name });
                    }
                    else {
                        _this.arrayFileContent.push({ id: value[i].id, file_content: value[i].file_content, file_name: value[i].file_name });
                    }
                }
            }
            var initialState = {
                fileData: _this.arrayFileContent,
                view_attach_file: true,
                view_paper_report: (isBBGiay == '1' ? true : false),
                _objInv: data
            };
            _this.bsModalRef = _this.modalService.show(_shared_modules_vat_shared_components_view_attach_file_view_attach_file_component__WEBPACK_IMPORTED_MODULE_9__["ViewAttachFileComponent"], {
                backdrop: 'static',
                keyboard: false,
                class: 'modal-lg',
                initialState: initialState
            });
        }, function (error) {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(error, 'error');
        });
    };
    IndexComponent.prototype.taiHDXml = function (data) {
        if (data) {
            var ids = [];
            if (data.status != _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusInv.DaXuat) {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.invoice_export_status, 'error');
                return;
            }
            if (data.xml_type == 4 && _core_index__WEBPACK_IMPORTED_MODULE_5__["VStringService"]._getValueToString(data.link_xml_file) != "") {
                var oData = {
                    url: data.link_xml_file,
                    type: 'xml'
                };
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                var sub_4 = this.searchService.getFilePdf(oData).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _core_helper_Helper__WEBPACK_IMPORTED_MODULE_11__["Helper"].dowloadFile(rs.data.file_name, 'zip', rs.data.file_content);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    sub_4.unsubscribe();
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                });
            }
            else {
                ids.push(data.id);
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
                var sub_5 = this.vatService.xuatHDXml(ids).subscribe(function (rs) {
                    if (rs.status == "success") {
                        _core_helper_Helper__WEBPACK_IMPORTED_MODULE_11__["Helper"].dowloadFile(rs.data.file_name, 'zip', rs.data.file_content);
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, "error");
                    }
                }, function (err) { }, function () {
                    sub_5.unsubscribe();
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                });
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(this._translate.NOTIFY.invoice_export_status, 'error');
            return;
        }
    };
    IndexComponent.prototype.dieuChinhBtn = function (data) {
        var row = data;
        if (row.status === 'DA_XUAT' && row.adjustment_type !== '7' && row.adjustment_type !== '2') {
            var template_code = row.template_code.split('/');
            switch (template_code[0]) {
                case '01GTKT0':
                case '1':
                    this.router.navigate(['/system/handle-report/', row.id, 'DIEU_CHINH']);
                    break;
                case '02GTTT0':
                case '2':
                    this.router.navigate(["/system/handle-invoice/sale-adjust/" + row.id]);
                    break;
                case '07KPTQ0':
                case '2':
                    this.router.navigate(["/system/handle-invoice/non-tariff-adjust/" + row.id]);
                    break;
                default:
                    break;
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể điều chỉnh hóa đơn này', 'error');
        }
    };
    IndexComponent.prototype.thayTheBtn = function (data) {
        var row = data;
        if (row.status === 'DA_XUAT' && row.adjustment_type !== 7 && row.adjustment_type !== 2 && row.adjustment_type !== 4 && row.adjustment_type !== 5) {
            this.router.navigate(["/system/handle-invoice/replace/" + row.id]);
            var template_code = row.template_code.split('/');
            switch (template_code[0]) {
                case '01GTKT0':
                case '1':
                    this.router.navigate(['/system/handle-report/', row.id, 'THAY_THE']);
                    break;
                case '02GTTT0':
                case '2':
                    this.router.navigate(["/system/handle-invoice/sale-replace/" + row.id]);
                    break;
                case '07KPTQ0':
                case '2':
                    this.router.navigate(["/system/handle-invoice/non-tariff-replace/" + row.id]);
                    break;
                default:
                    break;
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Bạn không thể thay thế hóa đơn này', 'error');
        }
    };
    IndexComponent.prototype.cancelReport = function (data) {
        var row = data;
        if (row.status === 'DA_XUAT' && row.adjustment_type !== '7') {
            this.router.navigate(['/system/handle-report/', row.id, 'HUY']);
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Hóa đơn đã bị hủy', 'error');
        }
    };
    IndexComponent.prototype.dinhKemFile = function (evt) {
        evt.srcElement.firstChild.click();
        // document.getElementById("file-dinh-kem").click();
        // console.log(e)
    };
    IndexComponent.prototype.onDinhKemFile = function (e) {
        var _this = this;
        var rowIndex = e.target.dataset.rowindex;
        var fileAttachData = [];
        var fileReader = new FileReader();
        var file = e.target.files[0];
        if (file.size <= 2000000) {
            var pattFile = /(\.xlsx|\.docx|\.doc|\.pdf|\.xls|\.xml)$/i;
            if (pattFile.test(file.name)) {
                fileReader.readAsDataURL(file);
                fileReader.onload = function (e) {
                    var base64result = fileReader.result.toString().split(',')[1];
                    fileAttachData.unshift({
                        type: 'DK',
                        file_name: file.name,
                        file_content: base64result,
                    });
                    var data = {
                        invoice_report: {
                            invoice_id: rowIndex,
                            type: 'HUY',
                            status: 'HOAT_DONG',
                            signature_status: 'NGUOI_BAN_KY',
                            file_content: base64result,
                            is_paper_report: '1',
                            file_name: file.name
                        }
                    };
                    _this.handleReportService.apiCreateReport(data).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_12__["finalize"])(function () { return _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading(); }))
                        .subscribe(function (value) {
                        if (value.status === 'success') {
                            _this.loadList(_this.paramSearch);
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(_this._translate.NOTIFY.attach_paper_report, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(value.message, 'error');
                        }
                    }, function (error) {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(error, 'error');
                    });
                };
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('File bạn chọn không đúng định dạng xls, xlsx, doc, docx, pdf, xml', 'error');
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify('Yêu cầu file nhỏ hơn 2MB', 'error');
        }
    };
    IndexComponent.prototype.downloadFileDocx = function (data, type) {
        var dataSeller = JSON.parse(window.localStorage.getItem('currentUser'));
        var a = {
            invoice_report: {
                invoice_id: data.id,
                file_extension: 'docx',
                doc_relate_date: moment__WEBPACK_IMPORTED_MODULE_14__(new Date()).format('YYYY-MM-DD'),
                type: type,
                json_data: {
                    seller_name: dataSeller.account.name,
                    seller_address: dataSeller.account.business_address,
                    seller_tax_code: dataSeller.account.tax_code,
                    seller_mobile: dataSeller.account.contact_mobile,
                    seller_surrogate_name: dataSeller.account.surrogate_name,
                    seller_surrogate_position: dataSeller.account.surrogate_position,
                    buyer_name: data.hasOwnProperty('customer_name') && data.customer_name !== null ? data.customer_name : data.buyer_name,
                    buyer_address: data.hasOwnProperty('buyer_address') ? data.buyer_address : null,
                    buyer_tax_code: data.hasOwnProperty('buyer_tax_code') ? data.buyer_tax_code : null,
                    buyer_mobile: data.hasOwnProperty('buyer_mobile') ? data.buyer_mobile : null,
                    buyer_surrogate_name: data.hasOwnProperty('buyer_surrogate_name') ? data.buyer_surrogate_name : null,
                    buyer_surrogate_position: data.hasOwnProperty('buyer_surrogate_position') ? data.buyer_surrogate_position : null,
                    template_code: data.hasOwnProperty('template_code') ? data.template_code : null,
                    invoice_series: data.hasOwnProperty('invoice_series') ? data.invoice_series : null,
                    invoice_date: data.hasOwnProperty('invoice_date') ? data.invoice_date : null,
                    invoice_number: data.hasOwnProperty('invoice_number') ? data.invoice_number : null,
                },
                is_paper_report: 1
            }
        };
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        this.handleReportService.apiGetFileContent(a).subscribe(function (value) {
            if (value.status === 'success') {
                _core_helper_Helper__WEBPACK_IMPORTED_MODULE_11__["Helper"].dowloadFile(value.data.invoice.file_name, 'docx', value.data.invoice.file_content);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(value.message, 'error');
            }
        }, function (error) {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(error.message, 'error');
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
        });
    };
    IndexComponent.prototype.hidenDropdownList = function () {
        if (this.clickCurent) {
            document.getElementById(this.clickCurent).classList.remove('show');
        }
        if (this.idRow) {
            document.getElementById(this.idRow).classList.remove('show');
        }
    };
    IndexComponent.prototype.BaoCaoCQT = function () {
        var _this = this;
        this.hidenDropdownList();
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        var sub = this.templateService.getAll1().subscribe(function (rs) {
            if (rs.status == 'success') {
                var listTemplate = rs.data.templates;
                var lstInvoice = _this.selectedItems;
                lstInvoice = lstInvoice.sort(function (invA, invB) {
                    return new Date(invB.invoice_date) - new Date(invA.invoice_date) || invB.invoice_number.localeCompare(invA.invoice_number);
                });
                var initialState = {
                    data: lstInvoice,
                    configs: _this.configs,
                    listTemplate: listTemplate,
                    infoDangKy: _this.infoDangKy
                };
                _this.bsModalRef = _this.modalService.show(_report_tax_invoice_error_report_tax_invoice_error_component__WEBPACK_IMPORTED_MODULE_18__["ReportTaxInvoiceErrorComponent"], {
                    class: 'modal-lg full-width', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveItem) {
                        _this.loadList(_this.paramSearch);
                    }
                });
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    IndexComponent.prototype.ThongDiepGuiNhan = function (data) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        if (data.invoice_wrongs && data.invoice_wrongs.length > 0) {
            var lstErr = data.invoice_wrongs;
            var initialState = {
                lstErr: lstErr,
                notifyType: "THONG_DIEP_TRUYEN_NHAN_MTT",
                send_wrong_status: data.send_wrong_status,
            };
            this.bsModalSignRef = this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_16__["SendDataForTaxComponent"], {
                backdrop: 'static',
                keyboard: true,
                class: 'modal-lg truyen-nhan',
                initialState: initialState
            });
            var subModal_1 = this.modalService.onHide.subscribe(function () {
                subModal_1.unsubscribe();
            });
            _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
        }
        else {
            var message = {
                message_code: data.message_wrong_code
            };
            var sub_6 = this.handleInvoiceService.getInforSendRecieve(message).subscribe(function (rs) {
                if (rs.status == "success") {
                    var lstErr = rs.data;
                    var initialState = {
                        lstErr: lstErr,
                        notifyType: "THONG_DIEP_TRUYEN_NHAN",
                        send_wrong_status: data.send_wrong_status,
                        noi_dung_loi: data.error_content
                    };
                    _this.bsModalSignRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_16__["SendDataForTaxComponent"], {
                        backdrop: 'static',
                        keyboard: true,
                        class: 'modal-lg modal-margin-width truyen-nhan',
                        initialState: initialState
                    });
                    var subModal_2 = _this.modalService.onHide.subscribe(function () {
                        subModal_2.unsubscribe();
                    });
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs.message, "error");
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                sub_6.unsubscribe();
            });
        }
    };
    IndexComponent.prototype.ngOnDestroy = function () {
    };
    IndexComponent.prototype.onContentReady = function (e) {
        if (e) {
            var dataSource = this.dataGrid.instance.getDataSource();
            this.pageSize = dataSource ? dataSource.items().length : 0;
        }
    };
    IndexComponent.prototype.getStatusSendTax = function (data) {
        var status = "";
        if (data.invoice_wrongs && data.invoice_wrongs.length > 0) {
            switch (data.invoice_wrongs[0].status) {
                case "DA_GUI":
                case "DA_GUI_CQT":
                    status = "Đã gửi TB";
                    break;
                case "KHONG_TIEP_NHAN":
                    status = "CQT không tiếp nhận";
                    break;
                case "TIEP_NHAN":
                    status = "CQT tiếp nhận";
                    break;
                case "CHAP_NHAN":
                    status = "CQT chấp nhận";
                    break;
                case "KHONG_CHAP_NHAN":
                    status = "CQT không chấp nhận";
                    break;
            }
        }
        else {
            switch (data.send_wrong_status) {
                case "DA_GUI":
                case "DA_GUI_CQT":
                    status = "Đã gửi TB";
                    break;
                case "KHONG_TIEP_NHAN":
                    status = "CQT không tiếp nhận";
                    break;
                case "TIEP_NHAN":
                    status = "CQT tiếp nhận";
                    break;
                case "CHAP_NHAN":
                    status = "CQT chấp nhận";
                    break;
                case "KHONG_CHAP_NHAN":
                    status = "CQT không chấp nhận";
                    break;
            }
        }
        return status;
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_17__["DxDataGridComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_17__["DxDataGridComponent"])
    ], IndexComponent.prototype, "dataGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_17__["DxPopoverComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_17__["DxPopoverComponent"])
    ], IndexComponent.prototype, "popOver", void 0);
    IndexComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-index',
            template: __webpack_require__(/*! ./index.component.html */ "./src/app/modules/handle-invoice/components/index/index.component.html"),
            styles: [__webpack_require__(/*! ./index.component.scss */ "./src/app/modules/handle-invoice/components/index/index.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_5__["AuthService"],
            _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_2__["HandleInvoiceService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["VatService"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__["BsModalService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_8__["TranslateService"],
            _modules_handle_report_hanlde_report_service__WEBPACK_IMPORTED_MODULE_10__["HanldeReportService"],
            _angular_forms__WEBPACK_IMPORTED_MODULE_13__["FormBuilder"],
            _modules_template_shared__WEBPACK_IMPORTED_MODULE_15__["TemplateService"],
            ngx_spinner__WEBPACK_IMPORTED_MODULE_19__["NgxSpinnerService"],
            _core_index__WEBPACK_IMPORTED_MODULE_5__["SocketService"],
            _modules_search_shared__WEBPACK_IMPORTED_MODULE_20__["SearchService"],
            _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_21__["ViewInvoiceService"],
            _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_22__["InvoiceService"]])
    ], IndexComponent);
    return IndexComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/remove/remove.component.html":
/*!********************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/remove/remove.component.html ***!
  \********************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"modal-header\">\r\n  <h4 class=\"modal-title pull-left\">{{_translate.CONTROLL.LABEL.cancel_invoice}}</h4>\r\n  <button type=\"button\" class=\"close pull-right\" aria-label=\"Close\" (click)=\"bsModalRef.hide()\">\r\n    <span aria-hidden=\"true\">&times;</span>\r\n  </button>\r\n</div>\r\n<div class=\"modal-body\">\r\n  <dx-data-grid\r\n    id=\"invoiceHistoryGrid\"\r\n    [dataSource]=\"dataSource\"\r\n    [showBorders]=\"true\"\r\n    [wordWrapEnabled]=\"true\"\r\n    (onEditorPreparing)=\"onEditorPreparing($event)\"\r\n    (onCellPrepared)=\"onCellPrepared($event)\"\r\n    [showRowLines]=\"true\">\r\n    <dxo-editing mode=\"cell\" [allowUpdating]=\"true\"></dxo-editing>\r\n    <!-- Số hóa đơn -->\r\n    <dxi-column cellTemplate=\"invoiceNumber\" dataField=\"invoice_number\"\r\n              caption=\"{{ 'GRID.INVOICE.invoice_number' | translate }}\" minWidth=\"{{_translate.GRID_WIDTH.so_hoa_don}}\"\r\n              alignment=\"center\" [allowEditing]=\"false\">\r\n    </dxi-column>\r\n    <!-- Mẫu số, ký hiệu -->\r\n    <dxi-column cellTemplate=\"templateCode\"\r\n              caption=\"{{ 'GRID.INVOICE.template_code' | translate }}, {{ 'GRID.INVOICE.invoice_series' | translate }}\"\r\n              minWidth=\"{{_translate.GRID_WIDTH.mau_so_ky_hieu}}\" alignment=\"center\" [allowEditing]=\"false\">\r\n    </dxi-column>\r\n    <!-- Ngày hóa đơn -->\r\n    <dxi-column dataField=\"invoice_date\" caption=\"{{ 'GRID.INVOICE.invoice_date' | translate }}\"\r\n              minWidth=\"{{_translate.GRID_WIDTH.ngay_hoa_don}}\" [editorOptions]=\"{useMaskBehavior:true}\" dataType=\"date\"\r\n              format=\"dd/MM/yyyy\" dateSerializationFormat=\"yyyy-MM-dd\" alignment=\"center\" [allowEditing]=\"false\">\r\n    </dxi-column>\r\n    <!-- Mã số thuế -->\r\n     <dxi-column dataField=\"buyer_tax_code\" caption=\"{{ 'GRID.INVOICE.buyer_tax_code' | translate }}\"\r\n              minWidth=\"{{_translate.GRID_WIDTH.ma_so_thue}}\" alignment=\"left\" [allowEditing]=\"false\">\r\n    </dxi-column>\r\n    <!-- Tên khách hàng -->\r\n    <dxi-column cellTemplate=\"customerName\" caption=\"{{ 'GRID.INVOICE.customer_name' | translate }}\"\r\n              alignment=\"left\" minWidth=\"200\" [allowEditing]=\"false\">\r\n    </dxi-column>\r\n    <!-- Địa chỉ bên mua -->\r\n    <dxi-column dataField=\"buyer_address\" caption=\"{{_translate.CONTROLL.LABEL.address}}\" minWidth=\"200\" \r\n                [allowEditing]=\"false\" alignment=\"left\" [allowEditing]=\"false\">\r\n    </dxi-column>\r\n    <!-- Tổng tiền -->\r\n    <dxi-column dataField=\"total_payment\" caption=\"{{ 'GRID.INVOICE.total_payment' | translate }}\" alignment=\"right\"\r\n              minWidth=\"{{_translate.GRID_WIDTH.tong_tien}}\" [allowEditing]=\"false\" dataType=\"number\" format=\"0,###.##\">\r\n    </dxi-column>\r\n    <!-- Số văn bản -->\r\n    <!-- <dxi-column dataField=\"doc_relate_symbol\" [allowEditing]=\"!isView\"\r\n                caption=\"{{_translate.CONTROLL.LABEL.doc_relate_symbol}}\" minWidth=\"150\" alignment=\"left\">\r\n    </dxi-column> -->\r\n    <!-- Ngày văn bản -->\r\n    <!-- <dxi-column dataField=\"doc_relate_date\" [allowEditing]=\"!isView\" \r\n                caption=\"{{_translate.CONTROLL.LABEL.doc_relate_date}}\" dataType=\"date\" format=\"dd/MM/yyyy\" dateSerializationFormat=\"yyyy-MM-dd\" alignment=\"left\" minWidth=\"{{_translate.GRID_WIDTH.ngay_hoa_don}}\">\r\n    </dxi-column> -->\r\n    <!-- Ngày hủy -->\r\n    <dxi-column dataField=\"destroy_date\"\r\n                caption=\"{{ 'GRID.INVOICE.date_cancel' | translate }}\" [editorOptions]=\"{ placeholder: 'dd/MM/yyyy',useMaskBehavior:true }\" dataType=\"date\" format=\"dd/MM/yyyy\" dateSerializationFormat=\"yyyy-MM-dd\" alignment=\"left\" minWidth=\"{{_translate.GRID_WIDTH.ngay_hoa_don}}\">\r\n    </dxi-column>\r\n    <!-- Lý do hủy -->\r\n    <dxi-column dataField=\"destroy_reason\"\r\n                caption=\"{{_translate.CONTROLL.LABEL.destroy_reason}}\" alignment=\"left\" minWidth=\"150\">\r\n    </dxi-column>\r\n    <!-- Email -->\r\n    <!-- <dxi-column dataField=\"buyer_email\" [allowEditing]=\"!isView\" \r\n                caption=\"Email\" alignment=\"left\" minWidth=\"150\">\r\n    </dxi-column> -->\r\n    <!-- <dxi-column cellTemplate=\"DinhKemFile\" caption=\"{{_translate.CONTROLL.LABEL.attach_file}}\" [width]=\"150\" alignment=\"left\"></dxi-column> -->\r\n    <!-- <dxi-column *ngIf=\"!isView\" cellTemplate=\"downloadBB\" caption=\"{{_translate.CONTROLL.LABEL.doc_relate}}\" [width]=\"90\" alignment=\"center\"></dxi-column> -->\r\n\r\n    <div *dxTemplate=\"let d of 'templateCode'\">\r\n      <p>{{ d.data.template_code }}</p>\r\n      <p>{{ d.data.invoice_series }}</p>\r\n    </div>\r\n    <div *dxTemplate=\"let d of 'invoiceNumber'\">\r\n      <a class=\"gach-chan\" (click)=\"viewDetailInvoice(d.data)\" href=\"javascript:void(0)\">{{ d.data.invoice_number }}<span\r\n        *ngIf=\"d.data.time_print_conversion\">-CĐ ({{ d.data.time_print_conversion }})</span></a>\r\n    </div>\r\n    <div *dxTemplate=\"let d of 'customerName'\">\r\n      <p *ngIf=\"d.data.status !='GIU_SO'\">{{ d.data.customer_name }}</p>\r\n      <p *ngIf=\"d.data.status =='GIU_SO'\">{{ d.data.customer_name || _translate.GRID.INVOICE.invoice_wait_for_sign }}</p>\r\n    </div>\r\n      <div *dxTemplate=\"let data of 'DinhKemFile'\">\r\n          <a href=\"javascript:void(0)\" (click)=\"dinhKemFile($event)\">\r\n            <input type=\"file\" id=\"file-dinh-kem\" [attr.data-rowindex]=\"data.rowIndex\" accept=\".xlsx, .docx, .doc, .pdf, .xls, .xml\" (change)=\"onDinhKemFile($event)\" multiple=\"false\" style=\"display: none;\"/>\r\n             <p *ngIf=\"!isView || adjustment_type == '7'\">Chọn file</p>\r\n            <p *ngIf=\"data.data.invoice_files&&data.data.invoice_files.length\" (click)=\"downloadFile(data.data.invoice_files[0])\">{{data.data.invoice_files[0].file_name}}</p>\r\n          </a>\r\n        </div>\r\n      <!-- <div *dxTemplate=\"let d of 'downloadBB'\">\r\n          <a href=\"javascript:void(0)\" (click)=\"xuatMauBienBan(d.data)\"><img src=\"assets\\img\\icons\\TaiMauBangKe.png\"></a>\r\n        </div> -->\r\n  </dx-data-grid>\r\n</div>\r\n<div class=\"modal-footer\">\r\n  <dx-button disableDoubleClick *ngIf=\"!isView\" text=\"{{_translate.CONTROLL.BUTTON.save }}\" (click)=\"xoaBo()\" icon=\"{{_translate.ICONS.save }}\" type=\"default\" validationGroup=\"formData\">\r\n  </dx-button>\r\n  <dx-button text=\"{{_translate.CONTROLL.BUTTON.come_back }}\" icon=\"{{_translate.ICONS.come_back }}\" type=\"default\" (click)=\"dong()\">\r\n  </dx-button>\r\n</div>\r\n\r\n\r\n<!-- popup -->\r\n<dx-popup\r\n  class=\"popup\"\r\n  [width]=\"400\"\r\n  [height]=\"120\"\r\n  [showTitle]=\"true\"\r\n  title=\"{{_translate.NOTIFY.processing}}\"\r\n  [dragEnabled]=\"false\"\r\n  (onShowing)=\"onImportShowing($event)\"\r\n  (onHiding)=\"onImportHiding($event)\"\r\n  [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <div style=\"height: 30px;\">\r\n      <dx-progress-bar \r\n        [min]=\"0\" \r\n        [max]=\"100\" \r\n        [value]=\"valueProgress\"\r\n        [statusFormat]=\"format\">\r\n      </dx-progress-bar>\r\n    </div>\r\n    <!-- <p style=\"height: 25px;\">\r\n        <span>{{thongbao}}</span>\r\n    </p> -->\r\n  </div>\r\n</dx-popup>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/remove/remove.component.scss":
/*!********************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/remove/remove.component.scss ***!
  \********************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".gach-chan{text-decoration:underline}.img-upload-second{text-align:center}.img-upload-second i{margin-top:10px;width:40px;height:auto;cursor:pointer}.img-upload-second p{margin-top:10px}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/remove/remove.component.ts":
/*!******************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/remove/remove.component.ts ***!
  \******************************************************************************/
/*! exports provided: RemoveComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RemoveComponent", function() { return RemoveComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @core/library/invoice/invoices.service */ "./src/app/core/library/invoice/invoices.service.ts");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! typescript-string-operations */ "./node_modules/typescript-string-operations/dist/index.min.js");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(typescript_string_operations__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! devextreme/data/array_store */ "./node_modules/devextreme/data/array_store.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11__);
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};















var RemoveComponent = /** @class */ (function () {
    function RemoveComponent(bsModalRef, socketService, handleInvoiceService, authService, vatService, translate, router, vPreviewInvService) {
        var _this = this;
        this.bsModalRef = bsModalRef;
        this.socketService = socketService;
        this.handleInvoiceService = handleInvoiceService;
        this.authService = authService;
        this.vatService = vatService;
        this.translate = translate;
        this.router = router;
        this.vPreviewInvService = vPreviewInvService;
        this.valueProgress = 0;
        this.errorImport = false;
        this.showPopup = false;
        this.invoiceIndex = 0;
        this.tempKiFile = 0;
        this.emailPattern = _config_index__WEBPACK_IMPORTED_MODULE_12__["pattern"].email;
        this.isTT78 = false;
        this.format = function (value) {
            var percent = Math.round(value * 100);
            return _this._translate.NOTIFY.finish + ": " + percent + '%';
        };
        this._language = this.authService.getLanguage();
        this._translate = this.authService.getTranslate();
        translate.use(this._language);
    }
    RemoveComponent.prototype.ngOnInit = function () {
        this.invoicesStore = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10___default.a({
            key: 'id',
            data: this.data
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11___default.a({
            store: this.invoicesStore
        });
        if (this.infoDangKy && this.infoDangKy.id) {
            if (this.infoDangKy.status == "CHAP_NHAN")
                this.isTT78 = true;
        }
        // this.invoicesStore.load().then((dataSource) => {
        //   dataSource.forEach((item, index) => {
        //     item.doc_relate_symbol = this.createDocRelateNumber();
        //   });
        // });
        this.connectWebsocket();
    };
    RemoveComponent.prototype.createDocRelateNumber = function () {
        var number_report = "";
        if (this.countReport < 10)
            number_report = '0' + this.countReport + '/' + new Date().getFullYear() + '/BB-HBHĐ';
        else
            number_report = this.countReport + '/' + new Date().getFullYear() + '/BB-HBHĐ';
        this.countReport++;
        return number_report;
    };
    RemoveComponent.prototype.connectWebsocket = function () {
        var _this = this;
        this.ioSignature = this.socketService.lapHoaDonImport().subscribe(function (message) {
            var data = message;
            if (data.Status == 'success') {
                if (data.SvcName == "efy_Sign") {
                    var i = _this.invoiceIndex;
                    if (data.Data.Name == 'hoadon.xml') {
                        _this.goiApiXuatHoaDon(data.Data.Content, _this.invoices[i]);
                    }
                    else if (data.Data.Name == 'ten_filek_the_trung-dc-nhi.xml') {
                        _this.invoices[i].issuer_name = data.Data.IssuerName;
                        _this.xuLiApiKhiXuat(_this.invoices[i]);
                    }
                    else {
                        _this.invoices[i].invoice_files.forEach(function (item) {
                            if (item.file_name == data.Data.Name) {
                                item.file_content = data.Data.Content;
                            }
                        });
                        _this.tempKiFile++;
                        if (_this.tempKiFile == _this.invoices[i].invoice_files.length) {
                            _this.xuLiApiKhiXuat(_this.invoices[i]);
                        }
                    }
                }
            }
            else {
                _this.showPopup = false;
                _this.errorImport = true;
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(data.Description, 'error');
            }
        });
    };
    RemoveComponent.prototype._validGrid = function () {
        var _this = this;
        var invalid = true;
        this.invoicesStore.load().then(function (dataSource) {
            dataSource.forEach(function (item, index) {
                item.doc_relate_date = item.doc_relate_date ? moment__WEBPACK_IMPORTED_MODULE_1__(item.doc_relate_date).format('YYYY-MM-DD') : item.doc_relate_date;
                item.destroy_date = item.destroy_date ? moment__WEBPACK_IMPORTED_MODULE_1__(item.destroy_date).format('YYYY-MM-DD') : item.destroy_date;
                if (!item.destroy_date && invalid) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.CONTROLL.LABEL.cancel_date + " " + _this._translate.VALIDATION.required, 'error');
                    _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'destroy_date'));
                    invalid = false;
                    return false;
                }
                else {
                    var currentDate = moment__WEBPACK_IMPORTED_MODULE_1__(new Date()).format('YYYY-MM-DD');
                    if (moment__WEBPACK_IMPORTED_MODULE_1__(item.destroy_date) > moment__WEBPACK_IMPORTED_MODULE_1__(currentDate) && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.date_cancel_invoice_not_greater_date_current, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'destroy_date'));
                        invalid = false;
                        return false;
                    }
                    var invoice_date = moment__WEBPACK_IMPORTED_MODULE_1__(item.invoice_date).format('YYYY-MM-DD');
                    if (moment__WEBPACK_IMPORTED_MODULE_1__(item.destroy_date) < moment__WEBPACK_IMPORTED_MODULE_1__(invoice_date) && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.date_cancel_invoice_greater_or_equal_date_invoice, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'destroy_date'));
                        invalid = false;
                        return false;
                    }
                }
                if (!item.destroy_reason && invalid) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.CONTROLL.LABEL.reason_cancels + " " + _this._translate.VALIDATION.required, 'error');
                    _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'destroy_reason'));
                    invalid = false;
                    return false;
                }
                if (item.buyer_email && !_this.emailPattern.test(item.buyer_email) && invalid) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Email ' + _this._translate.VALIDATION.not_pattern, 'error');
                    _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'buyer_email'));
                    invalid = false;
                    return false;
                }
            });
        });
        return invalid;
    };
    RemoveComponent.prototype.xoaBo = function () {
        var _this = this;
        if (!_core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_7__["InvoicesService"].checkTimeExportInv(this.configs.system_parameter)) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(typescript_string_operations__WEBPACK_IMPORTED_MODULE_8__["String"].Format(this._translate.NOTIFY.time_export_inv, moment__WEBPACK_IMPORTED_MODULE_1__(this.configs.system_parameter.time_start).format('HH:mm'), moment__WEBPACK_IMPORTED_MODULE_1__(this.configs.system_parameter.time_end).format('HH:mm')), 'error');
            return;
        }
        setTimeout(function () {
            if (_this._validGrid()) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirmVA(_this._translate.CONFIRM.acction_function, _this._translate.NOTIFY.notify, function () {
                    _this.showPopup = true;
                    _this.invoicesStore.load().then(function (dataSource) {
                        if (dataSource.length > 0) {
                            _this.invoices = dataSource.filter(function (p) { return p.adjustment_type != '7'; });
                            _this.totalInvoice = _this.invoices.length;
                            _this.invoiceIndex = 0;
                            _this.tempKiFile = 0;
                            _this.xuatHoaDon();
                        }
                    });
                });
            }
        }, 300);
    };
    RemoveComponent.prototype.xuatHoaDon = function () {
        var _this = this;
        var i = this.invoiceIndex;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.xuLiApiKhiXuat(this.invoices[i]);
        }
        else {
            if (this.invoices[i].invoice_files.length) {
                this.invoices[i].invoice_files.forEach(function (item) {
                    _this.socketService.kiFile(function () { return _this.connectWebsocket(); }, item.file_content, item.file_name, item.file_name.split('.').pop(), true, _this.invoices[i].invoice_date);
                });
            }
            else {
                if (this.isTT78) {
                    var ListSerialNumber = "DSCKS";
                    if (this.infoDangKy && this.infoDangKy.registration_signature) {
                        var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                        if (signatures && signatures.length > 0)
                            ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                    }
                    var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_1__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
                }
                else
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
            }
        }
    };
    RemoveComponent.prototype.xuLiApiKhiXuat = function (invoice) {
        var _this = this;
        var tempTemplate = invoice.template;
        delete invoice.template;
        var xmlInvoice = "";
        var isNewXml = 0;
        var data = {
            id: invoice.id,
            adjustment_type: "7",
            destroy_reason: invoice.destroy_reason,
            email: invoice.buyer_email,
            date: invoice.destroy_date
        };
        var sub = this.handleInvoiceService.getXmlString(data).subscribe(function (rs) {
            invoice.template = tempTemplate;
            if (rs.status == 'success') {
                xmlInvoice = rs.data.invoice.xml_string;
                var isNewXml_1 = rs.data.invoice.is_new_xml;
                var sign_date = moment__WEBPACK_IMPORTED_MODULE_1__(rs.data.invoice.sign_date).format('YYYY-MM-DD HH:mm:ss');
                if (isNewXml_1)
                    _this.nodeSign = "//HDon/DSCKS/NBan";
                else
                    _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                if (xmlInvoice != "") {
                    if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                        || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing))
                        _this.goiApiXuatHoaDon(xmlInvoice, invoice);
                    else {
                        if (_this.isTT78)
                            _this.xuLyKiFile(xmlInvoice, sign_date);
                        else
                            _this.xuLyKiFile(xmlInvoice, invoice.invoice_date);
                    }
                }
            }
            else {
                _this.showPopup = false;
                _this.errorImport = true;
                //this.onImportHiding();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            sub.unsubscribe();
        });
    };
    RemoveComponent.prototype.xuLyKiFile = function (xmlInvoice, signDate) {
        var _this = this;
        if (this.isTT78) {
            var ListSerialNumber = "DSCKS";
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
            }
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate, 'InvoiceData', ListSerialNumber, true);
        }
        else
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate);
    };
    RemoveComponent.prototype.goiApiXuatHoaDon = function (xml_string, invoice) {
        var _this = this;
        var percentComplete = 100 / this.totalInvoice;
        // Helper.dowloadFile('hoadon.xml', 'xml', xml_string);
        this.subXuatHoaDon = this.handleInvoiceService.cancelInvoice({
            invoice: {
                id: invoice.id,
                // doc_relate_symbol: invoice.doc_relate_symbol,
                // doc_relate_date: invoice.doc_relate_date,
                destroy_reason: invoice.destroy_reason,
                destroy_date: invoice.destroy_date,
                //email: invoice.buyer_email,
                xml_string: xml_string
            },
            invoice_files: invoice.invoice_files,
        }).subscribe(function (rs) {
            if (rs.status == 'success') {
                _this.valueProgress += percentComplete;
                _this.tempKiFile = 0;
                invoice.adjustment_type = '7';
                if (_this.invoiceIndex < _this.totalInvoice - 1) {
                    _this.invoiceIndex++;
                    _this.bsModalRef.content.successSaveItem = 'success';
                    _this.xuatHoaDon();
                }
                else if (_this.invoiceIndex == _this.totalInvoice - 1) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.cancel_invoice_done, 'success');
                    _this.isView = true;
                    setTimeout(function () {
                        _this.showPopup = false;
                    }, 300);
                }
            }
            else {
                _this.showPopup = false;
                _this.errorImport = true;
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            // Library.hideloading();
            _this.subXuatHoaDon.unsubscribe();
        });
    };
    RemoveComponent.prototype.dinhKemFile = function (evt) {
        evt.srcElement.firstChild.click();
        // document.getElementById("file-dinh-kem").click();
        // console.log(e)
    };
    RemoveComponent.prototype.choseFile = function (evt) {
        //evt.srcElement.firstChild.click();
        document.getElementById("file-input").click();
    };
    RemoveComponent.prototype.fileChanged = function (e) {
        var _this = this;
        setTimeout(function () {
            //let rowIndex = e.target.dataset.rowindex;
            var fileAttachData = [];
            var fileReader = new FileReader();
            var file = e.target.files[0];
            var pattFile = /(\.xlsx|\.docx|\.doc|\.pdf|\.xls|\.xml)$/i;
            // console.log(file)
            if (pattFile.test(file.name)) {
                fileReader.readAsDataURL(file);
                fileReader.onload = function (e) {
                    var base64result = fileReader.result.toString().split(',')[1];
                    fileAttachData.unshift({
                        type: "DK",
                        file_name: file.name,
                        file_content: base64result,
                    });
                    // if (document.getElementById('list-file')) {
                    //   document.getElementById('list-file').scrollTop = 0;
                    // }
                    var _lstAttach = [];
                    _lstAttach = _this.dataSource[0]["invoice_files"];
                    if (_lstAttach == null) {
                        _lstAttach = [];
                    }
                    else {
                        _lstAttach.push(fileAttachData[0]);
                    }
                    _this.dataSource[0]["invoice_files"] = _lstAttach;
                    // this.dataSource[rowIndex]["report_cancel_invoice_file_name"] = file.name;
                    //this.dataSource.reload();
                };
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("File bạn chọn không đúng định dạng xls, xlsx, doc, docx, pdf, xml", "error");
            }
        }, 200);
    };
    RemoveComponent.prototype.onDinhKemFile = function (e) {
        var _this = this;
        var rowIndex = e.target.dataset.rowindex;
        var fileAttachData = [];
        var fileReader = new FileReader();
        var file = e.target.files[0];
        var pattFile = /(\.xlsx|\.docx|\.doc|\.pdf|\.xls|\.xml)$/i;
        // console.log(file)
        if (pattFile.test(file.name)) {
            fileReader.readAsDataURL(file);
            fileReader.onload = function (e) {
                var test = fileReader.result;
                var base64result = fileReader.result.toString().split(',')[1];
                fileAttachData.unshift({
                    type: "DK",
                    file_name: file.name,
                    file_content: base64result,
                });
                if (document.getElementById('list-file')) {
                    document.getElementById('list-file').scrollTop = 0;
                }
                _this.invoicesStore.load().then(function (dataSource) {
                    dataSource.forEach(function (item, index) {
                        if (index == rowIndex)
                            item.invoice_files = fileAttachData;
                    });
                });
                // this.dataSource[rowIndex]["invoice_files"] = fileAttachData;
                // this.dataSource[rowIndex]["report_cancel_invoice_file_content"] = base64result;
                // this.dataSource[rowIndex]["report_cancel_invoice_file_name"] = file.name;
            };
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("File bạn chọn không đúng định dạng xls, xlsx, doc, docx, pdf, xml", "error");
        }
    };
    RemoveComponent.prototype.removeFile = function (i) {
        var _lstAttach = [];
        _lstAttach = this.dataSource[0]["invoice_files"];
        _lstAttach.splice(i, 1);
    };
    RemoveComponent.prototype.downloadFile = function (data) {
        var re = /(?:\.([^.]+))?$/;
        var fileType = re.exec(data.file_name)[1];
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].dowloadFile(data.file_name, fileType, data.file_content);
    };
    RemoveComponent.prototype.xuatMauBienBan = function (data) {
        if (this._validGrid()) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            var inv = Object.assign({}, data);
            inv.adjustment_type = "1";
            inv.auto_value_price = inv.auto_value_price == null ? false : inv.auto_value_price;
            inv.invoice_files = [];
            inv.doc_relate_date = moment__WEBPACK_IMPORTED_MODULE_1__(data.doc_relate_date).format('YYYY-MM-DD');
            this.vatService.xuatMauBienBan(inv).subscribe(function (rs) {
                if (rs.status == 'success') {
                    var file = rs.data.invoice;
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            });
        }
    };
    RemoveComponent.prototype.viewDetailInvoice = function (data) {
        if (data) {
            var ids = [];
            if (data) {
                ids.push(data.id);
            }
            var dulieu = this.vatService.taodulieuXemMau(ids);
            dulieu['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].cauhinhxemmau.hoadon;
            this.vPreviewInvService.xemMau(dulieu);
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.no_record_selected, 'error');
        }
    };
    RemoveComponent.prototype.onImportShowing = function (e) {
        this.valueProgress = 0;
    };
    RemoveComponent.prototype.onImportHiding = function (e) {
        var r = true;
        if (this.valueProgress < 100 && this.errorImport == false) {
            r = confirm(this._translate.CONFIRM.sign_stop);
        }
        if (r) {
            if (this.subXuatHoaDon) {
                this.subXuatHoaDon.unsubscribe();
            }
            this.valueProgress = 0;
        }
        else {
            e.cancel = true;
        }
    };
    RemoveComponent.prototype.dong = function () {
        this.bsModalRef.hide();
        // this.router.navigate(['/system/handle-invoice/']);
    };
    RemoveComponent.prototype.onEditorPreparing = function (e) {
        if (e.parentType === 'dataRow') {
            if (e.dataField === 'destroy_date' || e.dataField === 'destroy_reason') {
                if (this.isView || e.row.data.adjustment_type == "7")
                    e.editorOptions.disabled = true;
            }
        }
    };
    RemoveComponent.prototype.onCellPrepared = function (e) {
        if (e.rowType == "data") {
            /* Bôi đỏ các trường bắt buộc */
            if (e.column.dataField == "destroy_date") {
                if (!e.data.destroy_date) {
                    e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                    e.cellElement.title = this._translate.CONTROLL.LABEL.cancel_date + " " + this._translate.VALIDATION.required;
                }
                else {
                    var currentDate = moment__WEBPACK_IMPORTED_MODULE_1__(new Date()).format('YYYY-MM-DD');
                    var invoice_date = moment__WEBPACK_IMPORTED_MODULE_1__(e.data.invoice_date).format('YYYY-MM-DD');
                    var destroy_date = moment__WEBPACK_IMPORTED_MODULE_1__(e.data.destroy_date).format('YYYY-MM-DD');
                    if (moment__WEBPACK_IMPORTED_MODULE_1__(destroy_date) > moment__WEBPACK_IMPORTED_MODULE_1__(currentDate)) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = this._translate.NOTIFY.date_cancel_invoice_not_greater_date_current;
                    }
                    if (moment__WEBPACK_IMPORTED_MODULE_1__(destroy_date) < moment__WEBPACK_IMPORTED_MODULE_1__(invoice_date)) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = this._translate.NOTIFY.date_cancel_invoice_greater_or_equal_date_invoice;
                    }
                }
            }
            if (e.column.dataField == "destroy_reason") {
                if (!e.data.destroy_reason) {
                    e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                    e.cellElement.title = this._translate.CONTROLL.LABEL.reason_cancels + " " + this._translate.VALIDATION.required;
                }
            }
            if (e.column.dataField == "buyer_email") {
                if (e.data.buyer_email && !this.emailPattern.test(e.data.buyer_email)) {
                    e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                    e.cellElement.title = 'Email ' + this._translate.VALIDATION.not_pattern;
                }
            }
        }
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_2__["DxDataGridComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_2__["DxDataGridComponent"])
    ], RemoveComponent.prototype, "dataGrid", void 0);
    RemoveComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-remove',
            template: __webpack_require__(/*! ./remove.component.html */ "./src/app/modules/handle-invoice/components/remove/remove.component.html"),
            styles: [__webpack_require__(/*! ./remove.component.scss */ "./src/app/modules/handle-invoice/components/remove/remove.component.scss")]
        }),
        __metadata("design:paramtypes", [ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_5__["BsModalRef"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["SocketService"],
            _shared__WEBPACK_IMPORTED_MODULE_4__["HandleInvoiceService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["AuthService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["VatService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__["TranslateService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_13__["Router"],
            _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_14__["ViewInvoiceService"]])
    ], RemoveComponent);
    return RemoveComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.html":
/*!********************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.html ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"row invoice-form\" *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n  <div class=\"col-md-6\">\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item *ngIf=\"!isTT78\" [label]=\"{text: _translate.CONTROLL.LABEL.invoice_form}\"\r\n          dataField=\"invoice_release_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.invoice_releases, onValueChanged: templateChange, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"_translate.CONTROLL.LABEL.invoice_form {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item *ngIf=\"isTT78\" dataField=\"template_id\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.templatesTT78, onValueChanged: onChangeTem, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{ _translate.CONTROLL.LABEL.invoice_form }} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item dataField=\"invoice_date\" [label]=\"{text: _translate.GRID.INVOICE.invoice_date }\"\r\n          editorType=\"dxDateBox\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss', disabled: disableInvoiceDate, onValueChanged: changeDateTime}\">\r\n        </dxi-item>\r\n        <dxi-item cssClass=\"vat invoice-number-create-invoice\" dataField=\"invoice_number\"\r\n          [label]=\"{text: _translate.GRID.INVOICE.invoice_number }\" editorType=\"dxNumberBox\"\r\n          [editorOptions]=\"{ disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.currency_code}\" dataField=\"currency_code\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.currency_codes, onValueChanged: currencyCodeChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n        </dxi-item>\r\n        <dxi-item dataField=\"currency_rate\" [label]=\"{text: _translate.CONTROLL.LABEL.currency_rate}\"\r\n          editorType=\"dxNumberBox\"\r\n          [editorOptions]=\"{disabled: frmData.currency_code == 'VND',onValueChanged: currencyRateChange, format: formatter.ty_gia}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.payment_method}\" dataField=\"payment_method_name\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.payment_method_names,onValueChanged: paymentMethodChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.payment_method}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <dxi-item name=\"ht-xuat\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.export_form }}\"></dxo-label>\r\n          <div *dxTemplate>\r\n            <dx-select-box [(value)]=\"frmData.status\" displayExpr=\"name\" valueExpr=\"code\" [items]=\"htXuatOptions\"\r\n              [disabled]=\"!configs.system_parameter.allow_keep_invoice_number\">\r\n            </dx-select-box>\r\n          </div>\r\n        </dxi-item>\r\n      </dxi-item>\r\n\r\n      <dxi-item *ngIf=\"configs.system_parameter.view_bank_account_seller\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"seller_bank_account_number\" editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.list_bank_account_seller, onValueChanged: bankAccountSellerChange, displayExpr: 'name_display', valueExpr: 'code',showClearButton: true}\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.seller_bank_account_name }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item name=\"origin-invoice-number\">\r\n            <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number_original}}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-text-box [(value)]=\"oldForm.invoice_number\" disabled=\"true\"></dx-text-box>\r\n            </div>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"origin_btn_options\" cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"soXacThucGoc\" [label]=\"{text: _translate.CONTROLL.LABEL.certificate_code}\"\r\n          [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Chứng từ tham chiếu -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.vouchers_reference\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.vouchers_reference}\" dataField=\"license_number\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Số S/O -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.invoice_the_order\">\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.so_so }\" dataField=\"the_order\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số phiếu xuất kho -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.receipts_no\" dataField=\"receipts_no\" [colCount]=\"1\">\r\n          <dxo-label text=\"{{ _translate.GRID.INVOICE.receipts_no }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Ngày giao hàng -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.from_warehouse_date\" dataField=\"from_warehouse_date\"\r\n          [template]=\"'deliverydata'\" [colCount]=\"1\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.delivery_date }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Xuất cho khách hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.ship_receiving_name\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_name\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.ship_receiving_name }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Địa chỉ nhận hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.ship_receiving_address\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_address\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.ship_receiving_address }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Thời hạn thanh toán -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"configs.system_parameter.payment_expire\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.payment_time }\" dataField=\"payment_expire\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hình thức bán hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.form_sales\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONFIGS.form_sales}\" dataField=\"sell_form\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_export_place\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.export_place}\" dataField=\"export_place\"\r\n          editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.export_places, onValueChanged: exportPlaceChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_transport_number\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"transport_number\">\r\n          <dxo-label text=\"{{ 'CONTROLL.LABEL.transport_number' | translate }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn pepsi -->\r\n      <!-- Tên khách hàng(TT giao hàng) -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_name\" [label]=\"{text: _translate.CONTROLL.LABEL.ship_receiving_name}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Địa chỉ giao hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"ship_receiving_address\" [label]=\"{text: _translate.CONTROLL.LABEL.shipping_address}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Đơn đặt hàng( Mã số đơn hàng) -->\r\n        <dxi-item dataField=\"the_order\" [label]=\"{text: _translate.CONTROLL.LABEL.the_order}\">\r\n        </dxi-item>\r\n        <!-- Số tham khảo -->\r\n        <dxi-item dataField=\"consult_number\" [label]=\"{text: _translate.CONTROLL.LABEL.consult_number}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bảo dưỡng xe -->\r\n      <!-- Địa chỉ giao hàng -->\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"place_of_delivery\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.address_delivery }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Thời hạn thanh toán -->\r\n        <dxi-item dataField=\"payment_expire\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.payment_time }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Số wip -->\r\n        <dxi-item dataField=\"wip_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.wip_number }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Biển số xe -->\r\n        <dxi-item dataField=\"license_plate\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.license_plate }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Số khung -->\r\n        <dxi-item dataField=\"invoice_chassis_number\">\r\n          <dxo-label text=\"{{ _translate.GRID.INVOICE_DETAILS.chassis_number }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bàn giao xe -->\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số hợp đồng -->\r\n        <dxi-item dataField=\"contract_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.vehicle_contract_number }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Số VSB -->\r\n        <dxi-item dataField=\"vsb_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.vehicle_vsb }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Màu xe -->\r\n        <dxi-item dataField=\"color\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.vehicle_color }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Số máy -->\r\n        <dxi-item dataField=\"invoice_engine_number\">\r\n          <dxo-label text=\"{{ _translate.GRID.INVOICE_DETAILS.engine_number }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn nhà thuốc -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số tham chiếu -->\r\n        <dxi-item dataField=\"license_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.reference_number }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Tuyến -->\r\n        <dxi-item dataField=\"route\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.route }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Đơn đặt hàng -->\r\n        <dxi-item dataField=\"the_order\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.the_order }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Số tham khảo -->\r\n        <dxi-item dataField=\"consult_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.consult_number }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Nhân viên thu tiền -->\r\n        <dxi-item dataField=\"cash_staff\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.cash_staff }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isTT78\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Lý do thay thế -->\r\n        <dxi-item dataField=\"destroy_reason\">\r\n          <dxo-label text=\"Lý do thay thế\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\" message=\"Lý do thay thế {{_translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isTT78\" itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item dataField=\"list_number\">\r\n          <dxo-label text=\"Số bảng kê\"></dxo-label>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"list_date\" [template]=\"'notifydate'\">\r\n          <dxo-label text=\"Ngày bảng kê\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <div *dxTemplate=\"let d of 'notifydate'\">\r\n        <dx-date-box [(value)]=\"frmData.list_date\" type=\"date\" [useMaskBehavior]=\"true\" [displayFormat]=\"'dd/MM/yyyy'\"\r\n          [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'deliverydata'\">\r\n        <dx-date-box [(value)]=\"frmData.from_warehouse_date\" type=\"date\" [useMaskBehavior]=\"true\"\r\n          [displayFormat]=\"'dd/MM/yyyy'\" [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n    </dx-form>\r\n  </div>\r\n  <div class=\"col-md-6\">\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.export_invoice_for}\" dataField=\"customer_object_code\"\r\n          editorType=\"dxSelectBox\" [cssClass]=\"'max_left'\"\r\n          [editorOptions]=\"{items: select.customer_object_codes, displayExpr: 'name', valueExpr: 'code', onValueChanged: customer_object_codeChange}\">\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.customer_group}\" dataField=\"customer_type\"\r\n          editorType=\"dxSelectBox\" [cssClass]=\"'max_right'\"\r\n          [editorOptions]=\"{items: select.customer_types, displayExpr: 'name', valueExpr: 'code'}\">\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n          <dxi-item name=\"search-mst\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.tax_code }}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-autocomplete valueExpr=\"tax_code\" [dataSource]=\"tax_codes\" [(value)]=\"frmData.buyer_tax_code\"\r\n                [readOnly]=\"readOnlyCacTruongConLai\" (onItemClick)=\"taxCodeChoose($event)\"\r\n                (onValueChanged)=\"changeTaxCode($event)\" (onFocusOut)=\"updateTaxcodeInfo($event)\">\r\n                <div *dxTemplate=\"let item of 'item'\">\r\n                  <span>{{item.tax_code}}: {{ item.name }}</span>\r\n                </div>\r\n              </dx-autocomplete>\r\n            </div>\r\n          </dxi-item>\r\n          <dxi-item cssClass='btn-small'>\r\n            <button (click)=\"searchTaxCode()\" type=\"button\" class=\"button-tax-code\">\r\n              <i class=\"{{_translate.ICONS.search}}\" style=\"font-size: 22px;\"></i>\r\n            </button>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button vat-handle'>\r\n          <dxi-item name=\"search-mkh\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.customer_code}}\"></dxo-label>\r\n            <div *dxTemplate>\r\n              <dx-autocomplete valueExpr=\"code\" [dataSource]=\"customer_codes\" [(value)]=\"frmData.customer_code\"\r\n                [readOnly]=\"readOnlyCacTruongConLai\" (onItemClick)=\"customerCodeChoose($event)\"\r\n                (onFocusOut)=\"updateCustomerInfo($event)\">\r\n                <div *dxTemplate=\"let item of 'item'\">\r\n                  <span>{{item.code}}: {{ item.name }}</span>\r\n                </div>\r\n              </dx-autocomplete>\r\n            </div>\r\n          </dxi-item>\r\n          <!--            <dxi-item itemType=\"button\" [buttonOptions]=\"mst_btn_options\" cssClass='btn-small'>-->\r\n          <!--            </dxi-item>-->\r\n          <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"mst_btn_options\" cssClass='btn-small'>\r\n          </dxi-item>\r\n        </dxi-item>\r\n        <!-- <dxi-item name=\"search-mkh\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.customer_code}}\"></dxo-label>\r\n          <div *dxTemplate>\r\n            <dx-autocomplete valueExpr=\"code\" [dataSource]=\"customer_codes\" [(value)]=\"frmData.customer_code\"\r\n              [readOnly]=\"readOnlyCacTruongConLai\" (onItemClick)=\"customerCodeChoose($event)\"\r\n              (onFocusOut)=\"updateCustomerInfo($event)\">\r\n              <div *dxTemplate=\"let item of 'item'\">\r\n                <span>{{item.code}}: {{ item.name }}</span>\r\n              </div>\r\n            </dx-autocomplete>\r\n          </div>\r\n        </dxi-item> -->\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.customer_name}\" dataField=\"customer_name\"\r\n          [editorOptions]=\"{disabled: tod.customer_name, isRequired: false,onValueChanged: customerChanged}\">\r\n          <!-- <dxi-validation-rule *ngIf=\"!tod.customer_name\" type=\"required\" message=\"Tên đơn vị {{ _translate.VALIDATION.required }}\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.buyer_name}\" dataField=\"buyer_name\"\r\n          [editorOptions]=\"{disabled: tod.buyer_name,onValueChanged: customerChanged}\">\r\n          <!-- <dxi-validation-rule *ngIf=\"frmData.customer_object_code != 'DOANH_NGHIEP'\" type=\"required\" message=\"Họ tên người mua {{ _translate.VALIDATION.required }}\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.phone}\" dataField=\"buyer_mobile\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n          <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.phone\"\r\n            message=\"{{_translate.CONTROLL.LABEL.phone}} không đúng định dạng\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isShowToKhai\">\r\n        <!-- Số hộ chiều -->\r\n        <dxi-item cssClass=\"in-hoa vat2 layout_input\" dataField=\"passport\"\r\n          [editorOptions]=\"{disabled: disableTemplateInput() }\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.passport}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.passport}} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Quốc tịch -->\r\n        <dxi-item cssClass=\"in-hoa vat3 layout_input\" dataField=\"nationality\"\r\n          [editorOptions]=\"{disabled: disableTemplateInput()}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.nationality}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.nationality}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isShowToKhai\">\r\n        <!-- Ngày cấp hộ chiếu -->\r\n        <dxi-item cssClass=\"vat2 layout_input\" editorType=\"dxDateBox\" dataField=\"passport_date\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.passport_date}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.passport_date}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n        <!-- Ngày hết hạn hộ chiếu -->\r\n        <dxi-item dataField=\"passport_expiration_date\" editorType=\"dxDateBox\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n          <dxo-label text=\"{{_translate.CONTROLL.LABEL.passport_expiration_date}}\"></dxo-label>\r\n          <dxi-validation-rule type=\"required\"\r\n            message=\"{{_translate.CONTROLL.LABEL.passport_expiration_date}} {{ _translate.VALIDATION.required }}\">\r\n          </dxi-validation-rule>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.address}\" dataField=\"buyer_address\"\r\n          [editorOptions]=\"{disabled: tod.buyer_address,onValueChanged: customerChanged}\">\r\n          <!-- <dxi-validation-rule *ngIf=\"!tod.buyer_address\" type=\"required\" message=\"Địa chỉ {{ _translate.VALIDATION.required }}\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n\r\n        <dxi-item [label]=\"{text: 'Email'}\">\r\n          <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n            <div\r\n              class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n              <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                </app-tag-input-email>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </dxi-item>\r\n        <!--        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.bank_account_number}\" dataField=\"bank_account_number\"-->\r\n        <!--                  [editorOptions]=\"{onValueChanged: customerChanged}\">-->\r\n        <!--        </dxi-item>-->\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.bank_name}\" dataField=\"bank_name\"\r\n          [editorOptions]=\"{onValueChanged: customerChanged}\">\r\n        </dxi-item>\r\n        <!--Thông tin other_id -->\r\n        <dxi-item *ngIf=\"configs.system_parameter.other_id\" dataField=\"other_id\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.other_id }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_export_place\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item [label]=\"{text: _translate.CONTROLL.LABEL.export_address}\" dataField=\"export_address\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_transport_number\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"train_name\">\r\n          <dxo-label text=\"{{ 'CONTROLL.LABEL.train_name' | translate }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn pepsi -->\r\n      <!-- Thời hạn thanh toán -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item *ngIf=\"configs.system_parameter.display_delivery_information\" dataField=\"payment_expire\"\r\n          [label]=\"{text: _translate.CONTROLL.LABEL.payment_time}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bảo dưỡng xe -->\r\n      <!-- Địa chỉ xuất hàng -->\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"shiping_point\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.address_shipping }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Ngày ra, vào xe -->\r\n        <dxi-item dataField=\"in_out_date\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.in_out_date }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Số hóa đơn nội bộ -->\r\n        <dxi-item dataField=\"invoice_internal_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.invoice_internal_number }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBaoDuongXe\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Số km -->\r\n        <dxi-item dataField=\"kilometer_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.kilometer_number }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn bàn giao xe -->\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số chứng từ -->\r\n        <dxi-item cssClass=\"vat layout_input\" dataField=\"license_number\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.vehicle_license_number }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Kiểu xe -->\r\n        <dxi-item dataField=\"model\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.vehicle_model }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"isShowBanGiaoXe\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Số khung -->\r\n        <dxi-item cssClass=\"vat layout_input\" dataField=\"invoice_chassis_number\">\r\n          <dxo-label text=\"{{ _translate.GRID.INVOICE_DETAILS.chassis_number }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Năm sản xuất -->\r\n        <dxi-item dataField=\"manufacture_year\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.year_manufacture }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Hóa đơn nhà thuốc -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"1\">\r\n        <!-- Địa chỉ giao hàng -->\r\n        <dxi-item dataField=\"place_of_delivery\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.address_delivery }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <dxi-item *ngIf=\"configs.system_parameter.display_infor_put_product\" itemType=\"group\" [colCount]=\"2\">\r\n        <!-- Kho -->\r\n        <dxi-item dataField=\"from_warehouse_name\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.warehouse }}\"></dxo-label>\r\n        </dxi-item>\r\n        <!-- Phiếu nhận hàng -->\r\n        <dxi-item dataField=\"receive_bill\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.receive_bill }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Điều khoản giao hàng -->\r\n      <dxi-item *ngIf=\"configs.system_parameter.delivery_terms\" itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"delivery_terms\">\r\n          <dxo-label text=\"{{ _translate.CONFIGS.delivery_terms }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Ghi chú -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <dxi-item dataField=\"note\">\r\n          <dxo-label text=\"{{ _translate.CONTROLL.LABEL.note }}\"></dxo-label>\r\n        </dxi-item>\r\n      </dxi-item>\r\n      <!-- Trường mở rộng -->\r\n      <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n        <app-form-extend [disableForm]=\"ttDaXuatHoaDon\" [formData]=\"frmData\" [customerTempt]=\"customerTempt\"\r\n          [formItems]=\"formItems\" [typeOptions]=\"'invoice_options'\"></app-form-extend>\r\n      </dxi-item>\r\n    </dx-form>\r\n  </div>\r\n\r\n\r\n  <div class=\"col-md-12\" style=\"margin-top:7px;margin-bottom:7px\">\r\n    <dx-form *ngIf=\"!isTT78\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <ng-container *ngIf=\"configs.system_parameter.allow_keep_invoice_number && isShowButtonWaiteSign\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item name=\"btn-chossen-hdck\">\r\n              <dx-button id=\"btn-chossen-hdck\" (click)=\"showModalHdck()\" icon=\"assets\\img\\icons\\GiuSo.png\"\r\n                text=\"{{_translate.CONTROLL.BUTTON.select_inv_wait_sign}}\" type=\"default\"></dx-button>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </ng-container>\r\n\r\n      </dxi-item>\r\n    </dx-form>\r\n  </div>\r\n</div>\r\n<div class=\"row invoice-form\" *ngIf=\"isPXKDaiLy || isPXKNB\">\r\n  <div class=\"col-md-12\">\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\" (onFieldDataChanged)=\"onFieldDataChanged()\">\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n          <!-- Mẫu hoá đơn -->\r\n          <dxi-item *ngIf=\"!isTT78\" dataField=\"invoice_release_id\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.invoice_releases, onValueChanged: templateChange, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n            <dxo-label text=\"{{_translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{_translate.CONTROLL.LABEL.invoice_form }} {{_translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item *ngIf=\"isTT78\" dataField=\"template_id\" editorType=\"dxSelectBox\"\r\n            [editorOptions]=\"{items: select.templatesTT78, onValueChanged: onChangeTem, displayExpr: 'name', valueExpr: 'value', disabled: disableTemplateInput()}\">\r\n            <dxo-label text=\"{{ _translate.CONTROLL.LABEL.invoice_form }}\"></dxo-label>\r\n            <dxi-validation-rule type=\"required\"\r\n              message=\"{{ _translate.CONTROLL.LABEL.invoice_form }} {{ _translate.VALIDATION.required }}\">\r\n            </dxi-validation-rule>\r\n          </dxi-item>\r\n          <!-- Ngày hóa đơn, số hóa đơn -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n            <dxi-item dataField=\"invoice_date\" editorType=\"dxDateBox\"\r\n              [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss', disabled: disableInvoiceDate , onValueChanged: changeDateTime}\"\r\n              [cssClass]=\"'max_left'\">\r\n              <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_date }}\"></dxo-label>\r\n            </dxi-item>\r\n            <dxi-item cssClass=\"vat invoice-number-create-invoice\" dataField=\"invoice_number\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{ disabled: true}\" [cssClass]=\"'max_right'\">\r\n              <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Loại tiền, tỷ giá -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n            <dxi-item dataField=\"currency_code\" editorType=\"dxSelectBox\"\r\n              [editorOptions]=\"{items: select.currency_codes, onValueChanged: currencyCodeChange, displayExpr: 'name', valueExpr: 'code'}\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.currency_code }}\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.currency_code }} {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item dataField=\"currency_rate\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{disabled: frmData.currency_code == 'VND',onValueChanged: currencyRateChange, format: '0,###.##'}\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.currency_rate }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n            <!-- Hình thức xuất -->\r\n            <dxi-item name=\"ht-xuat\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.export_form }}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-select-box [(value)]=\"frmData.status\" displayExpr=\"name\" valueExpr=\"code\" [items]=\"htXuatOptions\"\r\n                  [disabled]=\"!configs.system_parameter.allow_keep_invoice_number\"></dx-select-box>\r\n              </div>\r\n            </dxi-item>\r\n            <!-- Số hóa đơn gốc -->\r\n            <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button' *ngIf=\"isTT78 && isPXKDaiLy\">\r\n              <dxi-item name=\"origin-invoice-number\">\r\n                <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number_original}}\"></dxo-label>\r\n                <div *dxTemplate>\r\n                  <dx-text-box [(value)]=\"oldForm.invoice_number\" disabled=\"true\"></dx-text-box>\r\n                </div>\r\n              </dxi-item>\r\n              <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"origin_btn_options\" cssClass='btn-small'>\r\n              </dxi-item>\r\n            </dxi-item>\r\n            <!-- MST kho nhận -->\r\n            <dxi-item *ngIf=\"isTT78 && !isPXKDaiLy\" dataField=\"buyer_tax_code\">\r\n              <dxo-label text=\"MST kho nhận\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Mã số thuế -->\r\n          <dxi-item *ngIf=\"isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item dataField=\"buyer_tax_code\">\r\n              <dxo-label text=\"{{ _translate.CONTROLL.LABEL.tax_code }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Số hóa đơn gốc, hợp đồng -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isTT78 && !isPXKDaiLy\">\r\n            <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n              <dxi-item name=\"origin-invoice-number\">\r\n                <dxo-label text=\"{{_translate.GRID.INVOICE.invoice_number_original}}\"></dxo-label>\r\n                <div *dxTemplate>\r\n                  <dx-text-box [(value)]=\"oldForm.invoice_number\" disabled=\"true\"></dx-text-box>\r\n                </div>\r\n              </dxi-item>\r\n              <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"origin_btn_options\" cssClass='btn-small'>\r\n              </dxi-item>\r\n            </dxi-item>\r\n            <dxi-item dataField=\"transportation_contract\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.contract_number }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Lý do thay thế -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\" cssClass='group-input-button'>\r\n            <dxi-item dataField=\"destroy_reason\">\r\n              <dxo-label text=\"Lý do thay thế\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\" message=\"Lý do thay thế {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Xuất tại kho -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n            <dxi-item name=\"search-mst\" dataField=\"from_warehouse\" editorType=\"dxSelectBox\"\r\n              [editorOptions]=\"{items: wavehourses, onValueChanged: from_warehouseChange, displayExpr: 'name', valueExpr: 'id',searchEnabled:true}\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.from_warehouse }}\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.from_warehouse }} {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"from_warehouse_btn_options\"\r\n              cssClass='btn-small'>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Địa chỉ kho xuất -->\r\n          <dxi-item *ngIf=\"isTT78  && !isPXKDaiLy\" itemType=\"group\">\r\n            <dxi-item dataField=\"shiping_point\">\r\n              <dxo-label text=\"Địa chỉ kho xuất\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\" message=\"Địa chỉ kho xuất {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\"\r\n            *ngIf=\"configs.integrate_parameter.integrate_econtract && configs.integrate_parameter.integrate_econtract.is_delivery\">\r\n            <!-- Số điện thoại người vận chuyển -->\r\n            <dxi-item dataField=\"carrier_mobile\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.carrier_mobile }}\"></dxo-label>\r\n              <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.phone\"\r\n                message=\"{{_translate.CONTROLL.LABEL.carrier_mobile }} {{_translate.VALIDATION.not_pattern}}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n            <!-- Email người vận chuyển -->\r\n            <dxi-item dataField=\"carrier_email\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.carrier_email }}\"></dxo-label>\r\n              <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.email\"\r\n                message=\"{{_translate.CONTROLL.LABEL.carrier_email }} {{_translate.VALIDATION.not_pattern}}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <dxi-item *ngIf=\"isTT78\" itemType=\"group\" [colCount]=\"2\">\r\n            <!-- Số bảng kê -->\r\n            <dxi-item dataField=\"list_number\">\r\n              <dxo-label text=\"Số bảng kê\"></dxo-label>\r\n            </dxi-item>\r\n            <!-- Ngày bảng kê -->\r\n            <dxi-item dataField=\"list_date\" [template]=\"'notifydate'\">\r\n              <dxo-label text=\"Ngày bảng kê\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dxi-item>\r\n\r\n\r\n        <!-- Right -->\r\n        <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n          <!-- Hợp đồng kinh tế số, ngày -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n            <dxi-item dataField=\"delivery_order_number\" [cssClass]=\"'max_left'\">\r\n              <dxo-label text=\"{{strTextHDKT}}\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\" message=\"{{strTextHDKT}} {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item dataField=\"delivery_order_date\" editorType=\"dxDateBox\"\r\n              [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\"\r\n              [cssClass]=\"'max_right'\">\r\n              <dxo-label text=\"{{strtextHDKTNgay}}\"></dxo-label>\r\n              <dxi-validation-rule *ngIf=\"isPXKDaiLy\" type=\"required\"\r\n                message=\"{{ strtextHDKTNgay }} {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Của -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item dataField=\"delivery_order_by\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.of }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Với -->\r\n          <dxi-item *ngIf=\"isPXKDaiLy\" itemType=\"group\" [colCount]=\"2\" cssClass='vat-handle group-input-button'>\r\n            <dxi-item name=\"search-mkh\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.with }}\"></dxo-label>\r\n              <div *dxTemplate>\r\n                <dx-autocomplete valueExpr=\"code\"\r\n                  placeholder=\"{{ _translate.CONTROLL.PLACE_HOLDER.input_content_search }}\"\r\n                  [dataSource]=\"customer_codes\" [(value)]=\"frmData.customer_name\"\r\n                  (onItemClick)=\"customerCodeChoose($event)\" (onFocusOut)=\"updateCustomerInfo($event)\">\r\n                  <div *dxTemplate=\"let item of 'item'\">\r\n                    <span>{{item.code}}: {{ item.name }}</span>\r\n                  </div>\r\n                </dx-autocomplete>\r\n              </div>\r\n              <dxi-validation-rule type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.with }} {{_translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"add_customer\" cssClass='btn-small'>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Về việc -->\r\n          <dxi-item *ngIf=\"!isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item dataField=\"delivery_order_content\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.delivery_order_content }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Email -->\r\n          <dxi-item *ngIf=\"!isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item [label]=\"{text: 'Email'}\"\r\n              [ngClass]=\"configs.system_parameter.view_bank_account_seller? 'vat layout_input' : ''\">\r\n              <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n                <div\r\n                  class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n                  <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                    <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                    </app-tag-input-email>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Email -->\r\n          <dxi-item *ngIf=\"isPXKDaiLy\" itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item [label]=\"{text: 'Email'}\"\r\n              [ngClass]=\"configs.system_parameter.view_bank_account_seller? 'vat layout_input' : ''\">\r\n              <div class=\"dx-field-item-content dx-field-item-content-location-right\">\r\n                <div\r\n                  class=\"dx-textbox dx-texteditor dx-widget dx-texteditor-empty dx-validator dx-visibility-change-handler\">\r\n                  <div class=\"dx-texteditor-container\" style=\"background: #fff; border: 1px solid #ddd;\">\r\n                    <app-tag-input-email [variableName]=\"this.emails\" (numberGenerated)=\"renderDataEmail($event)\">\r\n                    </app-tag-input-email>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Người vận chuyển -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\" *ngIf=\"isTT78 && !isPXKDaiLy\">\r\n            <dxi-item dataField=\"delivery_by\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.delivery_by }}\"></dxo-label>\r\n              <dxi-validation-rule *ngIf=\"isPXKDaiLy\" type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.delivery_by }} {{ _translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Hợp đồng số, Người vận chuyển -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" *ngIf=\"isTT78 && isPXKDaiLy\">\r\n            <dxi-item dataField=\"delivery_by\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.delivery_by }}\"></dxo-label>\r\n              <dxi-validation-rule *ngIf=\"isPXKDaiLy\" type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.delivery_by }} {{ _translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item dataField=\"transportation_contract\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.contract_number }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Phương thức vận chuyển -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item dataField=\"transportation_method\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.transportation_method }}\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.transportation_method }} {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Nhập tại kho -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"2\" cssClass='group-input-button'>\r\n            <dxi-item dataField=\"to_warehouse\" editorType=\"dxSelectBox\"\r\n              [editorOptions]=\"{items: wavehourses, onValueChanged: to_warehouseChange, displayExpr: 'name', valueExpr: 'id',searchEnabled:true}\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.to_warehouse }}\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\"\r\n                message=\"{{_translate.CONTROLL.LABEL.to_warehouse }} {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item itemType=\"button\" alignment=\"left\" [buttonOptions]=\"to_warehouse_btn_options\"\r\n              cssClass='btn-small'>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Địa chỉ kho nhập -->\r\n          <dxi-item *ngIf=\"isTT78  && !isPXKDaiLy\" itemType=\"group\">\r\n            <dxi-item dataField=\"place_of_delivery\">\r\n              <dxo-label text=\"Địa chỉ kho nhập\"></dxo-label>\r\n              <dxi-validation-rule type=\"required\" message=\"Địa chỉ kho nhập {{_translate.VALIDATION.required }}\">\r\n              </dxi-validation-rule>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Ghi chú -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat invoice-note\" dataField=\"note\">\r\n              <dxo-label text=\"{{_translate.CONTROLL.LABEL.note }}\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n          <!-- Trường mở rộng -->\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <app-form-extend [disableForm]=\"ttDaXuatHoaDon\" [formData]=\"frmData\" [customerTempt]=\"customerTempt\"\r\n              [formItems]=\"formItems\" [typeOptions]=\"'invoice_options'\"></app-form-extend>\r\n          </dxi-item>\r\n        </dxi-item>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      </dxi-item>\r\n      <div *dxTemplate=\"let d of 'notifydate'\">\r\n        <dx-date-box [(value)]=\"frmData.list_date\" type=\"date\" [useMaskBehavior]=\"true\" [displayFormat]=\"'dd/MM/yyyy'\"\r\n          [dateSerializationFormat]=\"'yyyy-MM-dd HH:mm:ss'\">\r\n        </dx-date-box>\r\n      </div>\r\n    </dx-form>\r\n\r\n  </div>\r\n</div>\r\n<dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"Thông báo\" [dragEnabled]=\"false\"\r\n  [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">Bạn có muốn cập nhật lại dữ liệu vào danh mục khách hàng không?</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"capNhatDmKhachHang()\" text=\"Cập nhật\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"huy()\" text=\"Hủy\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.scss":
/*!********************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.scss ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "::ng-deep .vat.invoice-number-create-invoice input{color:red;font-weight:bold}.button-tax-code{background:#337ab7;color:#fff;border-color:transparent;border:none}.button-tax-code:focus{outline:none}.tmr{display:flex;flex-wrap:nowrap;padding:0 !important}::ng-deep .btn-small{flex:unset !important}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.ts":
/*!******************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.ts ***!
  \******************************************************************************************************************/
/*! exports provided: ReplaceFormInvoiceComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReplaceFormInvoiceComponent", function() { return ReplaceFormInvoiceComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @core/library/public/v-select-box.service */ "./src/app/core/library/public/v-select-box.service.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @modules/handle-invoice/components/choose-hdck/choose-hdck.component */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts");
/* harmony import */ var _modules_customers_shared__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @modules/customers/shared */ "./src/app/modules/customers/shared/index.ts");
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _modules_products_shared__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @modules/products/shared */ "./src/app/modules/products/shared/index.ts");
/* harmony import */ var _shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @shared/modules/some/components/add-wavehourse/add-wavehourse.component */ "./src/app/shared/modules/some/components/add-wavehourse/add-wavehourse.component.ts");
/* harmony import */ var _shared_components_form_extend_form_extend_component__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @shared/components/form-extend/form-extend.component */ "./src/app/shared/components/form-extend/form-extend.component.ts");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_17___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_17__);
/* harmony import */ var _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @shared/service/invoice.service */ "./src/app/shared/service/invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};



















var ReplaceFormInvoiceComponent = /** @class */ (function () {
    function ReplaceFormInvoiceComponent(route, modalService, vatService, authService, customersService, invoiceService) {
        var _this = this;
        this.route = route;
        this.modalService = modalService;
        this.vatService = vatService;
        this.authService = authService;
        this.customersService = customersService;
        this.invoiceService = invoiceService;
        this.ttDaXuatHoaDon = false;
        this.formEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.adjustmentObject = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateTypeChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTemplateTT78TypeChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.select = {};
        this.pattern = _config_index__WEBPACK_IMPORTED_MODULE_8__["pattern"];
        this.tax_codes = [];
        this.customer_codes = [];
        this.configs = {};
        this.emails = [];
        this.arrEmail = [];
        // thay đổi disable của 3 input customer_name, buyer_name, buyer_address
        this.formItems = [];
        this.customForms = [];
        this.customerTempt = {};
        this.tod = {};
        this.disableInvoiceDate = this.authService.isAllowEditInvoiceDate();
        this.htXuatOptions = [];
        this.showPopup = false;
        this.customerCurent = {};
        this.isPXKDaiLy = false;
        this.isPXKNB = false;
        this.isShowToKhai = false;
        this.origin_btn_options = {
            text: '', icon: 'assets/img/icons/Xem.png', type: 'default',
            onClick: function () {
                if (_this.oldForm.template_code.indexOf('02GTTT') >= 0 || _this.oldForm.template_code == "2" || _this.oldForm.template_code.indexOf('07KPTQ') >= 0) {
                    window.open("/system/sale-invoice/" + _this.oldForm.id, '_blank');
                }
                else {
                    if (_this.loaiHoaDon == "03XKNB" || _this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].loaihoadon.HGDL04) {
                        if (_this.loaiHoaDon == "03XKNB") {
                            window.open("/system/transport-invoice/" + _this.oldForm.id, '_blank');
                        }
                        else {
                            window.open("/system/agent-invoice/" + _this.oldForm.id, '_blank');
                        }
                    }
                    else {
                        window.open("/system/vat-invoice/" + _this.oldForm.id, '_blank');
                    }
                }
            }
        };
        this.add_customer = {
            text: "",
            icon: "assets/img/icons/Them.png",
            type: "default",
            onClick: function () {
                var initialState = {
                    isVisibleGhiVaThemMoi: false,
                };
                _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_10__["AddCustomerComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                var submodal = _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveData) {
                        var customer = _this.bsModalRef.content.successSaveData;
                        _this.frmData.customer_name = customer.name;
                        _this.frmData.buyer_tax_code = customer.tax_code;
                        _this.frmData.buyer_name = customer.contact_person_name;
                        _this.frmData.buyer_address = customer.business_address;
                        _this.frmData.customer_code = customer.code;
                        _this.frmData.buyer_mobile = customer.contact_mobile;
                        if (customer.email) {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                            var stringDataEmailGet = customer.email.split(';');
                            for (var i = 0; i < stringDataEmailGet.length; i++) {
                                _this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
                            }
                        }
                        else {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                        }
                        if (customer.bank_account_number) {
                            _this.frmData.bank_account_number = customer.bank_account_number;
                        }
                        if (customer.bank_name) {
                            _this.frmData.bank_name = customer.bank_name;
                        }
                    }
                    submodal.unsubscribe();
                });
            }
        };
        this.mst_btn_options = {
            text: '', icon: 'assets/img/icons/Them.png', type: 'default',
            onClick: function () {
                var initialState = {
                    isVisibleGhiVaThemMoi: false
                };
                _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_10__["AddCustomerComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                var submodal = _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveData) {
                        var customer = _this.bsModalRef.content.successSaveData;
                        _this.frmData.customer_name = customer.name;
                        _this.frmData.buyer_tax_code = customer.tax_code;
                        _this.frmData.buyer_name = customer.contact_person_name;
                        _this.frmData.buyer_address = customer.business_address;
                        _this.frmData.customer_code = customer.code;
                        _this.frmData.buyer_mobile = customer.contact_mobile;
                        if (customer.email) {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                            var stringDataEmailGet = customer.email.split(';');
                            for (var i = 0; i < stringDataEmailGet.length; i++) {
                                _this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
                            }
                        }
                        else {
                            _this.frmData.buyer_email = customer.email;
                            _this.emails = [];
                        }
                        if (customer.bank_account_number) {
                            _this.frmData.bank_account_number = customer.bank_account_number;
                        }
                        if (customer.bank_name) {
                            _this.frmData.bank_name = customer.bank_name;
                        }
                    }
                    submodal.unsubscribe();
                });
            }
        };
        this.from_warehouse_btn_options = {
            text: "",
            icon: "assets/img/icons/Them.png",
            type: "default",
            onClick: function () {
                _this.wavehourse = new _modules_products_shared__WEBPACK_IMPORTED_MODULE_14__["Wavehourse"]();
                _this.wavehourse.order = _this.wavehourses.length + 1;
                var initialState = {
                    wavehourse: _this.wavehourse,
                    onSave: function (wavehourse) {
                        _this.wavehourse = wavehourse;
                        _this.wavehourses.unshift(_this.wavehourse);
                        _this.frmData.from_warehouse = _this.wavehourse.id;
                        _this.frmData.from_warehouse_name = _this.wavehourse.name;
                    }
                };
                _this.bsModalRef = _this.modalService.show(_shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_15__["AddWavehourseComponent"], {
                    class: 'second child-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
            }
        };
        this.to_warehouse_btn_options = {
            text: "",
            icon: "assets/img/icons/Them.png",
            type: "default",
            onClick: function () {
                _this.wavehourse = new _modules_products_shared__WEBPACK_IMPORTED_MODULE_14__["Wavehourse"]();
                _this.wavehourse.order = _this.wavehourses.length + 1;
                var initialState = {
                    wavehourse: _this.wavehourse,
                    onSave: function (wavehourse) {
                        _this.wavehourse = wavehourse;
                        _this.wavehourses.unshift(_this.wavehourse);
                        _this.frmData.to_warehouse = _this.wavehourse.id;
                        _this.frmData.to_warehouse_name = _this.wavehourse.name;
                    }
                };
                _this.bsModalRef = _this.modalService.show(_shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_15__["AddWavehourseComponent"], {
                    class: 'second child-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
            }
        };
        // sự kiện
        this.taxCodeKeyUp = function (e) {
            var str = _this.frmData.buyer_tax_code;
            var len = str.length;
            if (len >= 3) {
                _this.vatService.searchMST(str).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        var arr_1 = [];
                        rs.data.customers.forEach(function (item) {
                            arr_1.push(item);
                        });
                        _this.tax_codes = arr_1;
                    }
                });
            }
        };
        this.customerChanged = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.name) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.customer_name)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.contact_person_name) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_name)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.contact_mobile) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_mobile)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.business_address) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_address)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.email) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_email)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.bank_name) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.bank_name)
                                || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.bank_account_number) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.bank_account_number)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.customer_object_codeChange = function (e) {
            _this.setDisabledByCustomer_object_code(e.value);
        };
        this.templateChange = function (e) {
            _this.select.invoice_releases.forEach(function (item) {
                if (e.value === item.value) {
                    _this.frmData.template_id = item.template_id;
                    _this._objTemplateSelect = item;
                    _this.onTemplateTypeChange.emit(item);
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    if (!_this._objTemplateSelect.is_discount) {
                        _this.dataSource.items().forEach(function (item) {
                            item.discount = null;
                            item.amount_discount = null;
                        });
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._objTemplateSelect, _this.configs.system_parameter);
                        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBay
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonXangDau)
                            _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type));
                    }
                }
                // Nếu là mẫu html
                _this.formDuLieuMoRong(item);
            });
        };
        this.onChangeTem = function (e) {
            _this.select.templatesTT78.forEach(function (item) {
                if (e.value == item.value) {
                    _this.frmData.template_id = item.value;
                    _this.frmData.invoice_series = item.invoice_series;
                    _this.frmData.template_code = item.template_code;
                    _this.onTemplateTT78TypeChange.emit(item);
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe)
                        _this.isShowToKhai = true;
                    else
                        _this.isShowToKhai = false;
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            var value = item[key];
                            _this._oTemplateTT78[key] = value;
                        }
                    }
                    if (!_this._oTemplateTT78.is_discount) {
                        _this.invoice_products.load().then(function (dataSource) {
                            dataSource.forEach(function (item, index) {
                                item.discount = null;
                                item.amount_discount = null;
                            });
                        });
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._oTemplateTT78, _this.configs.system_parameter);
                        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBay
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                            || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonXangDau) {
                            _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type));
                        }
                    }
                    // Nếu là mẫu html
                    _this.formDuLieuMoRong(item);
                }
            });
        };
        //
        this.currencyCodeChange = function (e) {
            if (_this.frmData.currency_code === 'VND') {
                _this.frmData.currency_rate = null;
            }
            var tien_chu = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].tienBangChu(Math.abs(_this.frmData.total_payment), _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"].getFormatterToNumber(_this.formatter.tong_tien), _this.frmData.currency_code, _this.configs.system_parameter.display_read_money_english);
            _this.frmData.total_payment_in_word = _this.invoiceService.docTienAm(_this.frmData.total_payment, tien_chu, _this.configs, _this.frmData.currency_code);
        };
        this.exportPlaceChange = function (e) {
            var _obj = _this.select.export_places.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.export_address = _obj.dia_chi;
                _this.frmData.export_place_name = _obj.name;
            }
        };
        this.bankAccountSellerChange = function (e) {
            var _obj = _this.select.list_bank_account_seller.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.seller_bank_account_name = _obj.name;
                // this.frmData.export_place_name = _obj.name;
            }
            else {
                _this.frmData.seller_bank_account_name = '';
            }
        };
        this.paymentMethodChange = function (e) {
            var _obj = _this.select.payment_method_names.filter(function (p) { return p.code === e.value; })[0];
            if (_obj) {
                _this.frmData.payment_method_view_name = _obj.name;
            }
        };
        this.currencyRateChange = function (e) {
            if (!_this.isTT78)
                _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._objTemplateSelect, _this.configs.system_parameter);
            else
                _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, null, _this._oTemplateTT78, _this.configs.system_parameter);
        };
        this.updateCustomerInfo = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.code) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.customer_code)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.updateTaxcodeInfo = function (e) {
            if (_this.frmData.customer_id) {
                _this.customersService.getCustomer(_this.frmData.customer_id).subscribe(function (response) {
                    if (response.data) {
                        _this.customerCurent = response.data.customer;
                        if (_this.customerCurent) {
                            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.customerCurent.tax_code) !== _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this.frmData.buyer_tax_code)) {
                                _this.showPopup = true;
                                return;
                            }
                        }
                    }
                });
            }
        };
        this.changeDateTime = function (e) {
            _this.changeTemplateInvoice(e.value);
        };
        this.from_warehouseChange = function (e) {
            var _obj = _this.wavehourses.filter(function (p) { return p.id == e.value; })[0];
            if (_obj) {
                _this.frmData.from_warehouse_name = _obj.name;
                _this.frmData.shiping_point = _obj.address;
            }
        };
        this.to_warehouseChange = function (e) {
            var _obj = _this.wavehourses.filter(function (p) { return p.id == e.value; })[0];
            if (_obj) {
                _this.frmData.to_warehouse_name = _obj.name;
                _this.frmData.place_of_delivery = _obj.address;
            }
        };
        this._translate = this.authService.getTranslate();
    }
    ReplaceFormInvoiceComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.loaiHoaDon = this.route.snapshot.data.type;
        if (this.loaiHoaDon == '03XKNB')
            this.isPXKNB = true;
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].loaihoadon.HGDL04)
            this.isPXKDaiLy = true;
        if (this.isPXKDaiLy) {
            this.strTextHDKT = this._translate.CONTROLL.LABEL.deconomic_contract_number;
            this.strtextHDKTNgay = "Hợp đồng kinh tế ngày";
        }
        else {
            this.strTextHDKT = this._translate.CONTROLL.LABEL.delivery_order_number;
            this.strtextHDKTNgay = this._translate.CONTROLL.LABEL.date;
        }
        this.minNgayVB = moment__WEBPACK_IMPORTED_MODULE_2__(this.oldForm.invoice_date).format('YYYY-MM-DD');
        this.maxNgayVB = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD');
        this.configs = this.authService.getConfigs();
        this.routeSub = this.route.data.subscribe(function (data) {
            // put data DM for select
            _this.select.unit_codes = data.init[1].DM_DON_VI_TINH;
            _this.select.payment_method_names = data.init[1].DM_HINH_THUC_THANH_TOAN;
            _this.select.currency_codes = data.init[1].DM_LOAI_TIEN;
            _this.select.customer_types = data.init[1].DM_NHOM_KHACH_HANG;
            _this.select.export_places = data.init[1].DM_NOI_XUAT_HOA_DON;
            _this.select.list_bank_account_seller = data.init[1].DM_TAI_KHOAN_NGAN_HANG;
            _this.select.list_bank_account_seller.forEach(function (item) {
                item.name_display = item.code + ': ' + item.name;
            });
            _this.htXuatOptions = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._htXuatOptions(_this._translate, _this.frmData.status);
            if (_this.configs.system_parameter.allow_keep_invoice_number === false) {
                _this.htXuatOptions = _this.htXuatOptions.filter(function (e) { return e.code !== _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].hinhThucXuat.XuatChoKy; });
            }
            if (_this.isTT78) {
                var temptTT78 = [];
                temptTT78 = data.init[0].filter(function (item) { return item.template_type !== 'HOA_DON_KHOI_TAO_TU_MAY_TINH_TIEN' && item.template_type !== 'PHIEU_THU_MAY_TINH_TIEN'; });
                if (temptTT78 && temptTT78.length > 0) {
                    _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.infoDangKy.is_invoice_with_code; });
                    if (Number.parseInt(_this.frmData.invoice_number) > 0) {
                        if (_this.frmData.is_invoice_with_code != _this.infoDangKy.is_invoice_with_code) {
                            _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.frmData.is_invoice_with_code; });
                        }
                    }
                }
                if (_this.frmData.id)
                    _this.changeTemplateInvoice(_this.frmData.invoice_date);
            }
            else {
                _this.select.invoice_releases = data.init[0];
            }
        });
        this.select.customer_object_codes = _core_library_public_v_select_box_service__WEBPACK_IMPORTED_MODULE_6__["VSelectBoxService"]._customerObject(this._translate);
        this.select.adjustment_objects = [];
        // Set disabled cho đơn vị tổ chức
        this.setDisabledByCustomer_object_code(this.frmData.customer_object_code);
        // tìm kiếm mã số thuế
        this.tax_codes = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default.a({
            load: function (loadOptions) {
                return _this.vatService.getDataSourceForm(loadOptions.searchValue, 'tax_code');
            }
        });
        // // tìm kiếm mã khách hàng
        this.customer_codes = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_5___default.a({
            load: function (loadOptions) {
                return _this.vatService.getDataSourceForm(loadOptions.searchValue, 'code');
            }
        });
        // Khởi tạo ban đầu
        this.extentionGrid.ma_hang = false;
        this.extentionGrid.so_lo = false;
        this.extentionGrid.han_dung = false;
        this.extentionGrid.nuoc_san_xuat = false;
        this.extentionGrid.don_hang_hop_dong = false;
        this.extentionGrid.ma_quan_ly = false;
        if (!this.isTT78) {
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id === _this.frmData.template_id) {
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    // Nếu là mẫu html
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe)
                        _this.isShowToKhai = true;
                    else
                        _this.isShowToKhai = false;
                    _this.template_temp = item;
                }
            });
        }
        else {
            this.select.templatesTT78.forEach(function (item) {
                if (item.value === _this.frmData.template_id) {
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBanGiaoXe)
                        _this.isShowBanGiaoXe = true;
                    else
                        _this.isShowBanGiaoXe = false;
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonBaoDuongXe)
                        _this.isShowBaoDuongXe = true;
                    else
                        _this.isShowBaoDuongXe = false;
                    // Nếu là mẫu html
                    if (item.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe)
                        _this.isShowToKhai = true;
                    else
                        _this.isShowToKhai = false;
                    _this.template_temp = item;
                }
            });
        }
        if (this.frmData.buyer_email) {
            this.emails = [];
            var emailToString = this.frmData.buyer_email;
            var a11 = emailToString.replace(/;/g, ',');
            this.emails = a11.split(',');
        }
    };
    ////// Tạo form mở rộng
    ReplaceFormInvoiceComponent.prototype.createCustomGroup = function () {
        return {
            itemType: 'group',
            colCount: '2',
            items: this.customForms
        };
    };
    /////// sự kiện thay đổi các trường mở rộng
    ReplaceFormInvoiceComponent.prototype.changeItem = function (_dulieumorong) {
        var _this = this;
        _dulieumorong.forEach(function (item) {
            for (var key in _this.customerTempt) {
                if (item.code === key) {
                    item.value = _this.customerTempt[key];
                }
            }
            _this.frmData.invoice_options = _dulieumorong;
        });
    };
    ReplaceFormInvoiceComponent.prototype.formDuLieuMoRong = function (item) {
        var _this = this;
        this.customForms = [];
        this.customerTempt = {};
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].resetObject(this.formItems);
        if (item.fields && item.fields.length > 0) {
            var _arrayGrid = item.fields.filter(function (x) { return x.type === '5'; });
            if (_arrayGrid && _arrayGrid.length > 0) {
                this.extentionGrid.ma_hang = false;
                this.extentionGrid.so_lo = false;
                this.extentionGrid.han_dung = false;
                this.extentionGrid.nuoc_san_xuat = false;
                this.extentionGrid.don_hang_hop_dong = false;
                this.extentionGrid.ma_quan_ly = false;
                for (var i = 0; i < _arrayGrid.length; i++) {
                    var column = _arrayGrid[i]['name'];
                    var value = _arrayGrid[i]['is_show'];
                    var _ma = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column);
                    this.extentionGrid[_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(column)] = value;
                }
            }
            var _dulieumorong = lodash__WEBPACK_IMPORTED_MODULE_17__["cloneDeep"](item.fields).filter(function (x) { return x.type === '4'; });
            var invoice_options_1 = this.frmData.invoice_options;
            if (invoice_options_1.length > 0) {
                _dulieumorong = _dulieumorong.map(function (dl) {
                    var option = invoice_options_1.find(function (x) { return x.code == dl.code; });
                    if (option) {
                        dl.value = option.value;
                    }
                    return dl;
                });
            }
            this.frmData.invoice_options = _dulieumorong;
            if (_dulieumorong.length > 0) {
                this.formExtend.createForm(this.customForms, _dulieumorong);
            }
            _dulieumorong.forEach(function (value) {
                _this.customerTempt[value.code] = value.value;
            });
        }
        else {
            this.frmData.invoice_options = [];
            this.extentionGrid.ma_hang = false;
            this.extentionGrid.so_lo = false;
            this.extentionGrid.han_dung = false;
            this.extentionGrid.nuoc_san_xuat = false;
            this.extentionGrid.don_hang_hop_dong = false;
            this.extentionGrid.ma_quan_ly = false;
        }
    };
    ReplaceFormInvoiceComponent.prototype.ngAfterViewInit = function () {
        // this.listDxForm._results[1].readOnly = true;
        this.formDuLieuMoRong(this.template_temp);
        var arrD = document.querySelectorAll('.btn-small');
        arrD.forEach(function (item) {
            item.parentElement.parentElement.style.flex = '0 0 0 ';
        });
        if (this.frmData.total_payment) {
            var tien_chu = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].tienBangChu(Math.abs(this.frmData.total_payment), _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"].getFormatterToNumber(this.formatter.tong_tien), this.frmData.currency_code, this.configs.system_parameter.display_read_money_english);
            this.frmData.total_payment_in_word = this.invoiceService.docTienAm(this.frmData.total_payment, tien_chu, this.configs, this.frmData.currency_code);
        }
    };
    // reset trường mở rộng
    ReplaceFormInvoiceComponent.prototype.resetTMR = function () {
        this.formExtend.resetForm();
        this.formExtend.resetOptions();
    };
    ReplaceFormInvoiceComponent.prototype.readonlyAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = true;
        });
        this.readOnlyCacTruongConLai = true;
    };
    ReplaceFormInvoiceComponent.prototype.removeReadonlyAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = false;
            // item.instance.resetValues();
        });
        this.readOnlyCacTruongConLai = false;
    };
    ReplaceFormInvoiceComponent.prototype.setDisabledByCustomer_object_code = function (value) {
        this.tod.customer_name = false;
        this.tod.buyer_name = false;
        this.tod.buyer_address = false;
        switch (value) {
            case 'DOANH_NGHIEP':
                break;
            case 'CA_NHAN':
                this.frmData.customer_name = '';
                this.tod.customer_name = true;
                break;
            case 'KHACH_LE':
                this.frmData.customer_name = '';
                this.frmData.buyer_address = '';
                this.tod.customer_name = true;
                this.tod.buyer_address = true;
                break;
            default:
                break;
        }
    };
    ReplaceFormInvoiceComponent.prototype.getHtXuatValue = function () {
        return this.frmData.status;
    };
    // gửi data lên parent component
    ReplaceFormInvoiceComponent.prototype.onFieldDataChanged = function () {
        this.formEvent.emit(this.frmData);
    };
    ReplaceFormInvoiceComponent.prototype.taxCodeChoose = function (e) {
        var customer = e.itemData;
        if (this.frmData.customer_object_code !== 'CA_NHAN' && this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.customer_name = customer.name;
        }
        this.frmData.buyer_name = customer.contact_person_name;
        if (this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.buyer_address = customer.business_address;
        }
        this.frmData.customer_code = customer.code;
        this.frmData.buyer_mobile = customer.contact_mobile;
        if (customer.email) {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
            var stringDataEmailGet = customer.email.split(';');
            for (var i = 0; i < stringDataEmailGet.length; i++) {
                this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
            }
        }
        else {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
        }
        this.frmData.customer_id = customer.id;
        this.onFieldDataChanged();
    };
    ReplaceFormInvoiceComponent.prototype.customerCodeChoose = function (e) {
        var customer = e.itemData;
        if (this.frmData.customer_object_code !== 'CA_NHAN' && this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.customer_name = customer.name;
        }
        this.frmData.buyer_name = customer.contact_person_name;
        if (this.frmData.customer_object_code !== 'KHACH_LE') {
            this.frmData.buyer_address = customer.business_address;
        }
        this.frmData.buyer_tax_code = customer.tax_code;
        this.frmData.customer_id = customer.id;
        this.frmData.buyer_mobile = customer.contact_mobile;
        if (customer.email) {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
            var stringDataEmailGet = customer.email.split(';');
            for (var i = 0; i < stringDataEmailGet.length; i++) {
                this.emails.push({ display: stringDataEmailGet[i], value: stringDataEmailGet[i] });
            }
        }
        else {
            this.frmData.buyer_email = customer.email;
            this.emails = [];
        }
        this.frmData.bank_account_number = customer.bank_account_number ? customer.bank_account_number : "";
        this.frmData.bank_name = customer.bank_name ? customer.bank_name : "";
        this.onFieldDataChanged();
    };
    ///////////////
    ReplaceFormInvoiceComponent.prototype.ngOnDestroy = function () {
        this.routeSub.unsubscribe();
    };
    ReplaceFormInvoiceComponent.prototype.onSubmit = function () {
    };
    //
    ReplaceFormInvoiceComponent.prototype.clone = function () {
        var cloneObj = new (this.constructor());
        for (var attribut in this) {
            if (typeof this[attribut] === 'object') {
                cloneObj[attribut] = this.clone();
            }
            else {
                cloneObj[attribut] = this[attribut];
            }
        }
        return cloneObj;
    };
    ReplaceFormInvoiceComponent.prototype.xuatMauBienBan = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].showloading();
        var inv = Object.assign({}, this.oldForm);
        inv.doc_relate_date = this.frmData.doc_relate_date;
        inv.doc_relate_symbol = this.frmData.doc_relate_symbol;
        inv.destroy_reason = this.frmData.destroy_reason;
        inv.adjustment_type = '1';
        inv.auto_value_price = inv.auto_value_price === null ? false : inv.auto_value_price;
        // inv.invoice_products =this.oldForm.invoice_products;
        // this.dataSource.items().forEach(item => {
        //   if (item.product_name)
        //     inv.invoice_products.push(item);
        // });
        inv.invoice_files = [];
        this.vatService.xuatMauBienBanThuHoi(inv).subscribe(function (rs) {
            if (rs.status === 'success') {
                var file = rs.data.invoice;
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
        });
        // if (!this.frmData.doc_relate_symbol) {
        //   Library.notify(this._translate.CONTROLL.LABEL.doc_relate_symbol +" "+this._translate.VALIDATION.required, 'error');
        // } else if (!this.frmData.doc_relate_date) {
        //   Library.notify(this._translate.CONTROLL.LABEL.doc_relate_date +" "+this._translate.VALIDATION.required, 'error');
        // } else if (!this.frmData.destroy_reason) {
        //   Library.notify(this._translate.CONTROLL.LABEL.destroy_reason +" "+this._translate.VALIDATION.required, 'error');
        // } else {
        //   const initialState = {
        //     oldForm: this.oldForm,
        //     frmData: this.frmData,
        //     _objTemplateSelect: this._objTemplateSelect,
        //     fileData: this.fileData,
        //     onSave: (data) => {
        //       console.log(data);
        //       this.frmData.id = data.id;
        //       this.frmData.invoice_date = data.invoice_date;
        //       this.frmData.invoice_number = data.invoice_number;
        //     }
        //   };
        //   this.bsModalRef = this.modalService.show(ReportCancelInvComponent, {
        //     backdrop: 'static',
        //     keyboard: false,
        //     class: 'modal-lg full-modal',
        //     initialState
        //   });
        // }
    };
    ReplaceFormInvoiceComponent.prototype.showModalHdck = function () {
        var _this = this;
        var initialState = {
            invoiceNumberOrigin: this.oldForm.invoice_number,
            invoiceDateOrigin: this.oldForm.invoice_date,
            invoiceReleaseId: this.frmData.invoice_release_id,
            onSave: function (data) {
                _this.frmData.status = _config_sEnum__WEBPACK_IMPORTED_MODULE_13__["sEnum"].statusInv.ChoKy;
                _this.frmData.id = data.id;
                _this.frmData.invoice_date = data.invoice_date;
                _this.frmData.invoice_number = data.invoice_number;
            }
        };
        this.bsModalRef = this.modalService.show(_modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_11__["ChooseHdckComponent"], {
            backdrop: 'static',
            keyboard: false,
            class: 'modal-lg full-modal',
            initialState: initialState
        });
    };
    ReplaceFormInvoiceComponent.prototype.capNhatDmKhachHang = function () {
        var _this = this;
        this.customerCurent.tax_code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_tax_code);
        this.customerCurent.name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.customer_name);
        this.customerCurent.code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.customer_code);
        this.customerCurent.contact_person_name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_name);
        this.customerCurent.contact_mobile = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_mobile);
        this.customerCurent.business_address = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_address);
        this.customerCurent.email = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.buyer_email);
        this.customerCurent.bank_name = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.bank_name);
        this.customerCurent.bank_account_number = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this.frmData.bank_account_number);
        var data = { customer: this.customerCurent };
        this.customersService.edit(data, this.customerCurent.id).subscribe(function (response) {
            if (response.status === 'success') {
                _this.showPopup = false;
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(response.message, 'error');
            }
        }, function (err) {
        }, function () {
        });
    };
    ReplaceFormInvoiceComponent.prototype.huy = function () {
        this.showPopup = false;
    };
    ReplaceFormInvoiceComponent.prototype.renderDataEmail = function ($event) {
        this.arrEmail = [];
        this.emails = $event;
        if (this.emails.length > 0) {
            for (var i = 0; i < this.emails.length; i++) {
                if (typeof this.emails[i] === 'object')
                    this.arrEmail.push(this.emails[i].value);
                else if (typeof this.emails[i] === 'string')
                    this.arrEmail.push(this.emails[i]);
            }
            var emailToString = this.arrEmail.toString();
            this.frmData.buyer_email = emailToString.replace(/,/g, ';');
        }
        else {
            this.frmData.buyer_email = null;
        }
        this.formEvent.emit(this.frmData);
    };
    ReplaceFormInvoiceComponent.prototype.changeTemplateInvoice = function (strDate) {
        var _this = this;
        if (this.isTT78) {
            var year_1 = "";
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(strDate) != "")
                year_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(strDate).substring(4, 2);
            else {
                var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                year_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(invoiceDate).substring(4, 2);
            }
            var templates = this.select.templatesTT78;
            this.select.templatesTT78 = [];
            if (templates && templates.length > 0) {
                templates.forEach(function (item) {
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(item.name) != "")
                        item.name = item.name.replace(item.name.substring(4, 2), year_1);
                    // for (const key in item) {
                    //   if (item.hasOwnProperty(key)) {
                    //     const value = item[key];
                    //     this._oTemplateTT78[key] = value;
                    //   }
                    // }
                    if (item.value === _this.frmData.template_id) {
                        _this.onTemplateTT78TypeChange.emit(item);
                        //  item.invoice_series = item.invoice_series.replace(item.invoice_series.substring(3, 1), year);
                        // this.frmData.invoice_series = item.invoice_series;
                        // this.frmData.template_code = item.template_code;
                    }
                    _this.select.templatesTT78.push(item);
                });
            }
        }
    };
    ReplaceFormInvoiceComponent.prototype.disableTemplateInput = function () {
        if (this.frmData.invoice_number) {
            return true;
        }
        return false;
    };
    ReplaceFormInvoiceComponent.prototype.changeTaxCode = function (e) {
        this.tax_code_search = e.value;
    };
    ReplaceFormInvoiceComponent.prototype.searchTaxCode = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].showloading();
        if (!this.tax_code_search) {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify("Vui lòng nhập mã số thuế!", "error");
        }
        else {
            this.vatService.getInfoCompany(this.tax_code_search).subscribe(function (res) {
                if (res.status == "success") {
                    _this.dataTaxCode = res.data.customer;
                    _this.frmData.customer_name = _this.dataTaxCode.name;
                    _this.frmData.buyer_address = _this.dataTaxCode.business_address;
                }
            });
        }
        this.onFieldDataChanged();
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
        }, 1000);
    };
    ReplaceFormInvoiceComponent.prototype.allowEditAllForm = function () {
        this.listDxForm._results.forEach(function (item) {
            item.readOnly = false;
        });
        this.readOnlyCacTruongConLai = false;
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_shared_components_form_extend_form_extend_component__WEBPACK_IMPORTED_MODULE_16__["FormExtendComponent"]),
        __metadata("design:type", _shared_components_form_extend_form_extend_component__WEBPACK_IMPORTED_MODULE_16__["FormExtendComponent"])
    ], ReplaceFormInvoiceComponent.prototype, "formExtend", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChildren"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "listDxForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxFormComponent"])
    ], ReplaceFormInvoiceComponent.prototype, "form", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "wavehourses", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], ReplaceFormInvoiceComponent.prototype, "ttDaXuatHoaDon", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "frmData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "dataSource", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "oldForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "type", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "invoice_products", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "formatter", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "_objTemplateSelect", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "fileData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "extentionGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], ReplaceFormInvoiceComponent.prototype, "isShowButtonWaiteSign", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onFormChange'),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "formEvent", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('adjustmentObjectChange'),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "adjustmentObject", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateTypeChange'),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "onTemplateTypeChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('onTemplateTT78TypeChange'),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "onTemplateTT78TypeChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "infoDangKy", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], ReplaceFormInvoiceComponent.prototype, "isTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceFormInvoiceComponent.prototype, "_oTemplateTT78", void 0);
    ReplaceFormInvoiceComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'replace-vat-form-invoice',
            template: __webpack_require__(/*! ./replace-form-invoice.component.html */ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.html"),
            styles: [__webpack_require__(/*! ./replace-form-invoice.component.scss */ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.scss")]
        }),
        __metadata("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_4__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__["VatService"],
            _core_index__WEBPACK_IMPORTED_MODULE_7__["AuthService"],
            _modules_customers_shared__WEBPACK_IMPORTED_MODULE_12__["CustomersService"],
            _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_18__["InvoiceService"]])
    ], ReplaceFormInvoiceComponent);
    return ReplaceFormInvoiceComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.html":
/*!**********************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.html ***!
  \**********************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<div class=\"container-fluid\" style=\"margin-bottom: 0!important; padding-left: 0!important;\"\r\n  *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n  <div class=\"row\">\r\n    <div class=\"pl-0 col-md-12\">\r\n      <div class=\"button-redirect\">\r\n        <ul class=\"nav nav-tabs\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link active\" href=\"javascript:void(0)\">{{_translate.CONTROLL.BUTTON.report_replace}}</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link \" (click)=\"routeReport()\" href=\"javascript:void(0)\">\r\n              {{this.textReport}}\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n<form (ngSubmit)=\"onSubmit()\">\r\n  <div class=\"invoice-container\">\r\n    <!-- phần form thông tin -->\r\n    <replace-vat-form-invoice [ttDaXuatHoaDon]=\"ttDaXuatHoaDon\" [type]=\"1\" [frmData]=\"frmData\" [oldForm]=\"oldForm\" [dataSource]=\"dataSource\"\r\n      [invoice_products]=\"invoice_products\" [formatter]=\"formatter\" [fileData]=\"fileData\"\r\n      (onTemplateTypeChange)=\"onTemplateTypeChange($event)\" [extentionGrid]=\"extentionGrid\"\r\n      [isShowButtonWaiteSign]=\"isShowButtonWaiteSign\" [_oTemplateTT78]=\"_oTemplateTT78\" [isTT78]=\"isTT78\"\r\n      [wavehourses]=\"wavehourses\" [infoDangKy]=\"infoDangKy\"\r\n      (onTemplateTT78TypeChange)=\"onTemplateTT78TypeChange($event)\" [_objTemplateSelect]=\"_objTemplateSelect\">\r\n    </replace-vat-form-invoice>\r\n\r\n    <!-- <dx-button id=\"btn-chossen-hdck\" (click)=\"showModalHdck()\" icon=\"assets\\img\\icons\\GiuSo.png\"\r\n      text=\"Chọn hóa đơn chờ ký\" type=\"default\"></dx-button> -->\r\n\r\n    <!-- table product -->\r\n    <replace-vat-product-grip #child [dataSource]=\"dataSource\" [invoice_products]=\"invoice_products\"\r\n      [formatter]=\"formatter\" [oldForm]=\"oldForm\" [frmData]=\"frmData\" [extentionGrid]=\"extentionGrid\" [isTT78]=\"isTT78\"\r\n      [_oTemplateTT78]=\"_oTemplateTT78\" [_objTemplateSelect]=\"_objTemplateSelect\">\r\n    </replace-vat-product-grip>\r\n\r\n    <div class=\" table-footer\">\r\n      <div class=\"table-footer-1\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-table-footer\" dataField=\"amount_after_vat\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tong_tien, disabled: true}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-2\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-vat-table-footer\" dataField=\"total_amount_vat\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tien_thue, disabled: true}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-3\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-after-vat-table-footer\" dataField=\"amount\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.thanh_tien, disabled: true}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n      <div class=\"table-footer-4\">\r\n        <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n            <dxi-item cssClass=\"vat amount-table-footer\" dataField=\"amount_without_discount\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.thanh_tien_chua_ck, disabled: true}\">\r\n              <dxo-label [visible]=\"false\"></dxo-label>\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- vùng chọn file -->\r\n    <div class=\"row after-table\">\r\n      <div class=\"col-md-5\">\r\n        <file-upload-multiple [fileData]=\"fileData\" (fileChange)=\"getFileData($event)\"></file-upload-multiple>\r\n      </div>\r\n      <div class=\"col-md-2\">\r\n      </div>\r\n      <div class=\"col-md-5\">\r\n        <!-- <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n             <dxi-item dataField=\"aaa\" [label]=\"{text: 'Tiền phí khác'}\" editorType=\"dxNumberBox\" [editorOptions]=\"{format: '0,###'}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"on_currency_amount\"\r\n              [label]=\"{text: _translate.CONTROLL.LABEL.on_currency_amount}\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: '0,###', disabled: true}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"amount\" [label]=\"{text: _translate.CONTROLL.LABEL.amount}\"\r\n              editorType=\"dxNumberBox\" [editorOptions]=\"{format: formatter.thanh_tien, disabled: true}\"></dxi-item>\r\n            <dxi-item *ngIf=\"isHdGTGT\" cssClass=\"vat money-pull-right\" dataField=\"amount_vat5\"\r\n              [label]=\"{text: _translate.CONTROLL.LABEL.amount_vat5}\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tien_thue, disabled: true}\"></dxi-item>\r\n            <dxi-item *ngIf=\"isHdGTGT\" cssClass=\"vat money-pull-right\" dataField=\"amount_vat10\"\r\n              [label]=\"{text: _translate.CONTROLL.LABEL.amount_vat10}\" editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tien_thue, disabled: true}\"></dxi-item>\r\n            <dxi-item cssClass=\"vat money-pull-right\" dataField=\"total_payment\" [label]=\"{text: _translate.CONTROLL.LABEL.amount_after_vat}\"\r\n              editorType=\"dxNumberBox\"\r\n              [editorOptions]=\"{format: formatter.tong_tien, onValueChanged: totalPaymentChange, disabled: true}\">\r\n            </dxi-item>\r\n          </dxi-item>\r\n        </dx-form> -->\r\n        <div\r\n          *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY' && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY_THU_TIEN' && invoicereleaseTempt.template_type!='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n        ||(invoiceTemplateTT78 && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY' && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY_THU_TIEN' && invoiceTemplateTT78.template_type!='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n          class=\"vat money-pull-right\">\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.on_currency_amount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.on_currency_amount\" tabIndex=\"-1\" format=\"0,###\"\r\n                [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount\" tabIndex=\"-1\" [format]=\"formatter.thanh_tien\"\r\n                [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_amount_discount}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_discount\" tabIndex=\"-1\" [format]=\"formatter.tien_chiet_khau\"\r\n                (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat5}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat5\" tabIndex=\"-1\" [format]=\"formatter.tien_thue\"\r\n                (onValueChanged)=\"onNumberChange()\" [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat8}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat8\" tabIndex=\"-1\" [format]=\"formatter.tien_thue\"\r\n                (onValueChanged)=\"onNumberChange()\" [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat10}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat10\" tabIndex=\"-1\" [format]=\"formatter.tien_thue\"\r\n                (onValueChanged)=\"onNumberChange()\" [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"isHdGTGT\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.amount_vat_other\" tabIndex=\"-1\" [format]=\"formatter.tien_thue\"\r\n                (onValueChanged)=\"onNumberChange()\" [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_DANG_KIEM')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_DANG_KIEM'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.fees}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.registry_fee\" tabIndex=\"-1\" step=\"0\" (onKeyDown)=\"keyDown($event)\"\r\n                [format]=\"formatter.tong_tien\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_XANG_DAU')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_XANG_DAU'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_fee\" tabIndex=\"-1\" step=\"0\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertax}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_tax\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\"\r\n                [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_TONG_HOP' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_CHUNG' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_charge\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\"\r\n                (onKeyDown)=\"keyDown($event)\" [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div\r\n          *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\r\n        || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')))\"\r\n          class=\"vat money-pull-right\">\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.surcharge}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_charge\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" (onValueChanged)=\"onNumberTicketChange()\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY'))\" class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [format]=\"formatter.tong_tien\" (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\"\r\n                [(value)]=\"frmData.total_other\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\" (onKeyDown)=\"keyDown($event)\"\r\n                [(value)]=\"frmData.other_fee\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY')))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.refund_fee}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.money_ticket_return\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" (onValueChanged)=\"onNumberTicketChange()\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_fare_after_tax}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_ticket_with_vat\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" [disabled]=\"checkDisabledTotalPaymentInWord()\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\r\n          || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')))\"\r\n            class=\"dx-field\">\r\n            <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n            || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n              class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertax}}</div>\r\n            <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n            || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\"\r\n              class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.othertaxair}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_tax\" [format]=\"formatter.tong_tien\" (onKeyDown)=\"keyDown($event)\"\r\n                tabIndex=\"-1\" step=\"0\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.money_other}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [format]=\"formatter.tong_tien\" (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\"\r\n                [(value)]=\"frmData.other_fee\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_fare}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_ticket\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n          <div *ngIf=\"((invoicereleaseTempt && invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN')\r\n          || (invoiceTemplateTT78 && invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_HOAN_TIEN'))\"\r\n            class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_other\" [format]=\"formatter.tong_tien\"\r\n                (onKeyDown)=\"keyDown($event)\" tabIndex=\"-1\" step=\"0\" [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n      <div\r\n        *ngIf=\"((invoicereleaseTempt && (invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY' || invoicereleaseTempt.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN'))\r\n      || (invoiceTemplateTT78 && (invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY' || invoiceTemplateTT78.template_type==='HOA_DON_VE_MAY_BAY_THU_TIEN')))\"\r\n        class=\"col-md-12\" style=\"margin:10px 0 !important;\">\r\n        <h3 class=\"font-weight-bold\">{{ _translate.CONTROLL.LABEL.ticketing_service_fee}}</h3>\r\n        <div class=\"row\">\r\n          <div class=\"col-md-3 pr-0 money-pull-right\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 52%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.ticketing_service_charge}}\r\n              </div>\r\n              <div style=\"width: 48%\" class=\"dx-field-value\">\r\n                <dx-number-box [(value)]=\"frmData.money_service_ticket\" format=\"#,###\" tabIndex=\"-1\"\r\n                  (onValueChanged)=\"onVatChange()\"></dx-number-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-3 pr-0 money-pull-right\" style=\"max-width: 23%\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 50%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.tax_GTGT}}</div>\r\n              <div style=\"width: 50%\" class=\"dx-field-value\">\r\n                <dx-select-box [(value)]=\"frmData.vat_service_ticket\" displayExpr=\"name\" valueExpr=\"code\"\r\n                  [items]=\"select.vats\" (onValueChanged)=\"onVatChange()\"></dx-select-box>\r\n\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-3 pr-0 money-pull-right\" style=\"max-width: 19%\">\r\n            <div class=\"dx-field\">\r\n              <div style=\"width: 50%\" class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_vat}}</div>\r\n              <div style=\"width: 50%\" class=\"dx-field-value\">\r\n                <dx-number-box [(value)]=\"frmData.total_vat_service_ticket\" format=\"#,###\" tabIndex=\"-1\"\r\n                  [disabled]=\"!frmData.auto_value\"></dx-number-box>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-md-4 \" style=\"max-width: 33%\">\r\n            <div class=\"prt-1 money-pull-right\">\r\n              <div class=\"dx-field\" style=\"width: 395px\">\r\n                <div style=\"width: 44.3%\" class=\"dx-field-label\">{{\r\n                  _translate.CONTROLL.LABEL.total_after_tax_service_charge}}</div>\r\n                <div style=\"width: 55.7%\" class=\"dx-field-value\">\r\n                  <dx-number-box [(value)]=\"frmData.total_service_ticket_with_vat\" format=\"#,###\" tabIndex=\"-1\"\r\n                    [disabled]=\"!frmData.auto_value\" (onValueChanged)=\"onNumberTicketChange()\"></dx-number-box>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- Hóa đơn bán hàng ND 92 -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_exemption_decree\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Đã giảm </p>\r\n          <dx-number-box [format]=\"formatter.tong_tien\" [(value)]=\"frmData.text_exemption_decree\"\r\n            [readOnly]=\"!frmData.auto_value\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> tương ứng 30% mức tỷ lệ để tính thuế giá trị gia tăng theo Nghị\r\n            quyết số 406/NQ-UBTVQH15</p>\r\n        </div>\r\n      </div>\r\n      <!-- Hóa đơn bán hàng NQ 43 -->\r\n      <!-- Tỷ lệ % doanh thu -->\r\n      <div class=\"col-md-8\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_resolution_43\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Tỷ lệ % trên doanh thu </p>\r\n\r\n          <div class=\"toggle normal\" style=\"display: flex; align-items: center; margin-top: -6px;\">\r\n            <img id=\"link14\" style=\"cursor: pointer;padding-left: 2px;padding-right: 7px\"\r\n              src=\"assets\\img\\icons\\Icon_Information.png\" (click)=\"guideSales()\" alt=\"efy.vn\" alt=\"Efy.vn\">\r\n          </div>\r\n          <dx-popover target=\"#link14\" position=\"top\" [width]=\"350\" [(visible)]=\"isDisplayGuideSale\">\r\n            <div *dxTemplate=\"let data of 'content'\">\r\n              <p>- 1% : Phân phối, cung cấp hàng hóa dịch vụ</p>\r\n              <p>- 5% : Dịch vụ xây dựng không bao thầu nguyên vật liệu</p>\r\n              <p>- 3% : Sản xuất, vận tải, dịch vụ có gắn với hàng hóa, xây dựng có bao thầu nguyên vật liệu</p>\r\n              <p>- 2% : Hoạt động kinh doanh khác</p>\r\n            </div>\r\n          </dx-popover>\r\n\r\n          <dx-number-box [width]=\"50\" [(value)]=\"frmData.sales_percentage\"\r\n            (onValueChanged)=\"onChangeSalePercen($event)\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> %</p>\r\n        </div>\r\n      </div>\r\n      <!-- Đã giảm 20% -->\r\n      <div class=\"col-md-7\" style=\"margin-top:5px\">\r\n        <div *ngIf=\"frmData.is_resolution_43\" style=\"display: inline-flex;margin-top:5px\">\r\n          <p style=\"margin-right: 5px;margin-top: 5px\">Đã giảm </p>\r\n          <dx-number-box [format]=\"formatter.tong_tien\" [(value)]=\"frmData.money_resolution_43\"\r\n            [readOnly]=\"!frmData.auto_value\"></dx-number-box>\r\n          <p style=\"margin-left: 5px;margin-top: 5px\"> {{ _translate.THONG_TIN.tinh_thue_nq101}}</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-md-5\" style=\"margin-top: 10px\">\r\n        <div class=\"vat money-pull-right\">\r\n          <!-- Tổng tiền giảm trừ không chịu thuế -->\r\n          <div class=\"dx-field\" *ngIf=\"isHdGTGT\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_deduction_not_taxable}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_deduction_not_taxable\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\"\r\n                step=\"0\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <!-- Tổng tiền giảm trừ khác -->\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.other_total_deduction}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.other_total_deduction\" [format]=\"formatter.tong_tien\" tabIndex=\"-1\" step=\"0\">\r\n              </dx-number-box>\r\n            </div>\r\n          </div>\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.amount_after_vat}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-number-box [(value)]=\"frmData.total_payment\" [format]=\"formatter.tong_tien\"\r\n                [disabled]=\"!frmData.auto_value\" (onKeyDown)=\"keyDown($event)\"\r\n                (onValueChanged)=\"totalPaymentChange($event)\"></dx-number-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-md-12\">\r\n        <div class=\"vat total-payment-in-word\">\r\n          <div class=\"dx-field\">\r\n            <div class=\"dx-field-label\">{{ _translate.CONTROLL.LABEL.total_payment_in_word}}</div>\r\n            <div class=\"dx-field-value\">\r\n              <dx-text-box [(value)]=\"frmData.total_payment_in_word\" [disabled]=\"!frmData.auto_value\"></dx-text-box>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"row button-action\">\r\n      <div class=\"col-md-12\" *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n        <div class=\"pull-left\">\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" (click)=\"preview()\" icon=\"{{_translate.ICONS.view}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.preview_invoice}}\" type=\"default\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"ttDaXuatHoaDon\" (click)=\"view()\" icon=\"{{_translate.ICONS.view}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.view_invoice}}\" type=\"default\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"ttDaXuatHoaDon\" (click)=\"inChuyenDoi()\" icon=\"{{_translate.ICONS.print}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.print_conversion}}\" type=\"default\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"isTuChoi\" (click)=\"xemlydotuchoi()\" [(icon)]=\"this._translate.ICONS.view\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.reason_reject}}\" type=\"default\"></dx-button>\r\n        </div>\r\n        <div class=\"pull-right\">\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon && !isAccessExportInv\" text=\"{{ _translate.CONTROLL.BUTTON.sign_approval}}\"\r\n            icon=\"assets\\img\\icons\\XuatFile.png\" (click)=\"eSubmit('TRINH_KY')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\"></dx-button>\r\n          <!-- <button type=\"button\" (click)=\"test()\">Test</button> -->\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" text=\"{{ _translate.CONTROLL.BUTTON.export_invoice}}\" appScrollToInvalid\r\n            icon=\"{{_translate.ICONS.export_inv}}\" (click)=\"eSubmit('XUAT', true)\" type=\"default\"\r\n            validationGroup=\"formData\" [useSubmitBehavior]=\"true\"></dx-button>\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" text=\"{{ _translate.CONTROLL.BUTTON.save_temporary}}\" appScrollToInvalid\r\n            icon=\"{{_translate.ICONS.save}}\" (click)=\"eSubmit('GHI_TAM')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\">\r\n          </dx-button>\r\n          <dx-button appBackButton type=\"default\" icon=\"{{_translate.ICONS.come_back}}\"\r\n            text=\"{{ _translate.CONTROLL.BUTTON.close}}\"></dx-button>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-md-12\" *ngIf=\"isPXKDaiLy || isPXKNB\">\r\n        <div class=\"pull-left\">\r\n          <!-- Xem trước PXK -->\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon\" (click)=\"preview()\" icon=\"assets\\img\\icons\\Xem.png\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.preview_internal_transport }}\" type=\"default\"></dx-button>\r\n          <!-- Xem PXK -->\r\n          <dx-button disableDoubleClick *ngIf=\"ttDaXuatHoaDon\" (click)=\"view()\" icon=\"assets\\img\\icons\\Xem.png\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.view_internal_transport }}\" type=\"default\"></dx-button>\r\n          <!-- In chuyển đổi PXK -->\r\n          <dx-button disableDoubleClick *ngIf=\"ttDaXuatHoaDon\" (click)=\"inChuyenDoi()\" [(icon)]=\"this._translate.ICONS.print\"\r\n            [text]=\"inChuyenDoiText()\" type=\"default\"></dx-button>\r\n        </div>\r\n        <div class=\"pull-right\">\r\n          <!-- Thủ kho xuất ký (đang chờ biến cấu hình để bắt ràng buộc nếu biến đó là true thì k hiện nút này)-->\r\n          <dx-button disableDoubleClick (click)=\"thukhoxuatky()\" *ngIf=\"isPXKNB && isShowThuKhoXuatKy\"\r\n            [(icon)]=\"this._translate.ICONS.pencil\" text=\"{{_translate.CONTROLL.BUTTON.warehouse_keeper_sign }}\"\r\n            type=\"default\"></dx-button>\r\n          <!-- Hủy lệnh điều động -->\r\n          <dx-button disableDoubleClick *ngIf=\"isShowKyLenhDieuDong && isShowHuyLenhDD && isPXKNB\" (click)=\"huylenhdieudong()\"\r\n            [(icon)]=\"this._translate.ICONS.delete\" text=\"{{_translate.CONTROLL.BUTTON.cancel_maneuver_command }}\"\r\n            type=\"default\"></dx-button>\r\n          <!-- Ký lệnh điều động -->\r\n          <dx-button disableDoubleClick *ngIf=\"isShowKyLenhDieuDong && isPXKNB\" (click)=\"submitlenhdieudong()\"\r\n            [(icon)]=\"this._translate.ICONS.pencil\" text=\"{{_translate.CONTROLL.BUTTON.sign_maneuver_command }}\"\r\n            type=\"default\"></dx-button>\r\n          <!-- Xuất phiếu xuất kho -->\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon && !showTraLai && !showKyDuyet && isAccessExportInv\" appScrollToInvalid\r\n            text=\"{{_translate.CONTROLL.BUTTON.export_internal_transport }}\" icon=\"assets\\img\\icons\\XuatHD.png\"\r\n            (click)=\"eSubmit('XUAT')\" type=\"default\" validationGroup=\"formData\" [useSubmitBehavior]=\"true\"></dx-button>\r\n          <!-- Ghi tạm -->\r\n          <dx-button disableDoubleClick *ngIf=\"!ttDaXuatHoaDon && !showTraLai && !showKyDuyet\" appScrollToInvalid\r\n            text=\"{{_translate.CONTROLL.BUTTON.save_temporary }}\" icon=\"assets\\img\\icons\\GhiTam.png\"\r\n            [disabled]=\"isDisable\" (click)=\"eSubmit('GHI_TAM')\" type=\"default\" validationGroup=\"formData\"\r\n            [useSubmitBehavior]=\"true\">\r\n          </dx-button>\r\n          <!-- Tạo mới -->\r\n          <dx-button *ngIf=\"!showTraLai && !showKyDuyet\" text=\"{{_translate.CONTROLL.BUTTON.create_new }}\"\r\n            icon=\"assets\\img\\icons\\LapHD.png\" (click)=\"handleAddNew()\" type=\"default\"></dx-button>\r\n          <!-- Trả lại -->\r\n          <!-- <dx-button *ngIf=\"showTraLai\" text=\"{{_translate.CONTROLL.BUTTON.return }}\"\r\n          icon=\"assets\\img\\icons\\XuatFile.png\" (click)=\"traLai()\" type=\"default\"></dx-button>\r\n        <dx-button *ngIf=\"!ttDaXuatHoaDon && showKyDuyet\" text=\"Ký duyệt\" icon=\"assets\\img\\icons\\XuatFile.png\"\r\n          (click)=\"eSubmit('XUAT')\" type=\"default\" validationGroup=\"formData\" [useSubmitBehavior]=\"true\"></dx-button> -->\r\n          <!-- Quay lại -->\r\n          <dx-button appBackButton type=\"default\" icon=\"assets\\img\\icons\\QuayLai.png\"\r\n            text=\"{{_translate.CONTROLL.BUTTON.close }}\"></dx-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n</form>\r\n<ngx-spinner bdColor=\"rgba(51,51,51,0.8)\" size=\"medium\" color=\"#fff\" type=\"timer\">\r\n  <p style=\"font-size: 20px; color: white\">Loading...</p>\r\n</ngx-spinner>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.scss":
/*!**********************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.scss ***!
  \**********************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".invoice-container{padding-top:15px}.after-table{margin-top:10px}::ng-deep .vat.total-payment-in-word{margin-top:15px}::ng-deep .vat.total-payment-in-word input{color:#000000;font-weight:bold;text-align:right}.vat.total-payment-in-word .dx-field-label{width:12%}.vat.total-payment-in-word .dx-field-value{width:88% !important}::ng-deep .vat.amount-table-footer input,::ng-deep .vat.amount-vat-table-footer input,::ng-deep .vat.amount-after-vat-table-footer input{font-weight:bold;text-align:right;color:#0034F5}::ng-deep .vat.money-pull-right input{text-align:right}::ng-deep .pr-0.money-pull-right input{text-align:right}::ng-deep .prt-1.money-pull-right input{text-align:right}.vat.money-pull-right .dx-field-label{width:45%}.vat.money-pull-right .dx-field-value{width:55% !important}.button-action{margin-top:18px}.table-footer{height:40px;background:#E3E3E3;padding-top:3px}.table-footer .table-footer-1{display:inline-block;width:109px;float:right}.table-footer .table-footer-2{display:inline-block;width:120px;margin-right:32px;float:right}.table-footer .table-footer-3{display:inline-block;width:150px;margin-right:90px;float:right}.table-footer .table-footer-4{display:inline-block;width:109px;margin-right:190px;float:right}#btn-chossen-hdck{margin-top:10px;margin-left:50%;margin-bottom:10px}.dx-field-value.dx-widget,.dx-field-value:not(.dx-widget)>.dx-widget{height:25px}::ng-deep .mauhoadon .modal-content{width:67%}::ng-deep .mauhoadon43 .modal-content{width:72%}::ng-deep .prv-s-invoice .modal-content{border:0px;border-radius:0px}::ng-deep .v-s-invoice{max-width:100%;margin:0px;height:100%}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.ts":
/*!********************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.ts ***!
  \********************************************************************************************************/
/*! exports provided: ReplaceInvoiceComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReplaceInvoiceComponent", function() { return ReplaceInvoiceComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _replace_product_grip_replace_product_grip_component__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../replace-product-grip/replace-product-grip.component */ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.ts");
/* harmony import */ var _replace_form_invoice_replace_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../replace-form-invoice/replace-form-invoice.component */ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.ts");
/* harmony import */ var _modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/handle-invoice/components/choose-hdck/choose-hdck.component */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! devextreme/data/array_store */ "./node_modules/devextreme/data/array_store.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @core/library/invoice/invoices.service */ "./src/app/core/library/invoice/invoices.service.ts");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! typescript-string-operations */ "./node_modules/typescript-string-operations/dist/index.min.js");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(typescript_string_operations__WEBPACK_IMPORTED_MODULE_13__);
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _modules_handle_invoice_components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @modules/handle-invoice/components/send-invoices/send-invoices.component */ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.ts");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_16___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_16__);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var _shared_router_router_library_service__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @shared/router/router-library.service */ "./src/app/shared/router/router-library.service.ts");
/* harmony import */ var _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @shared/service/confirm.service */ "./src/app/shared/service/confirm.service.ts");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var ngx_spinner__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ngx-spinner */ "./node_modules/ngx-spinner/fesm5/ngx-spinner.js");
/* harmony import */ var _modules_configs_shared__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @modules/configs/shared */ "./src/app/modules/configs/shared/index.ts");
/* harmony import */ var _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @modules/handle-invoice/shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var _shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @shared/components/preview-invoice/preview-invoice.component */ "./src/app/shared/components/preview-invoice/preview-invoice.component.ts");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
/* harmony import */ var _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @core/library/invoice/my-bsmodel.service */ "./src/app/core/library/invoice/my-bsmodel.service.ts");
/* harmony import */ var _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! @shared/service/invoice.service */ "./src/app/shared/service/invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};





























var ReplaceInvoiceComponent = /** @class */ (function () {
    function ReplaceInvoiceComponent(route, modalService, vatService, socketService, authService, cdRef, translate, router, routerLibrary, confirmService, spinner, configsService, handleInvoiceService, vPreviewInvService, customeModalService, invoiceService) {
        var _this = this;
        this.route = route;
        this.modalService = modalService;
        this.vatService = vatService;
        this.socketService = socketService;
        this.authService = authService;
        this.cdRef = cdRef;
        this.translate = translate;
        this.router = router;
        this.routerLibrary = routerLibrary;
        this.confirmService = confirmService;
        this.spinner = spinner;
        this.configsService = configsService;
        this.handleInvoiceService = handleInvoiceService;
        this.vPreviewInvService = vPreviewInvService;
        this.customeModalService = customeModalService;
        this.invoiceService = invoiceService;
        this.isShowHuyLenhDD = false;
        this.isCheckLenhDieuDong = false;
        this.isRoleThuKhoXuatKy = false;
        this.isDisable = false;
        // buttonBehavior = {
        //   xuat: false,
        //   ghiTam: false,
        // };
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__["InvoiceModel"](3);
        this.ttDaXuatHoaDon = false; // Trạng thái đã xuất hóa đơn hay chưa
        this.formatter = {};
        this.extentionGrid = {};
        this.select = {};
        this._objTemplateSelect = {};
        this.formatNumber = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].numberInvoiceFormatDev;
        this.tempKiFile = 0;
        this.confirmCheckPreview = false;
        this.isHdGTGT = true;
        // danh sách data trong file
        this.fileData = [];
        this.isTuChoi = false;
        this.isAccessExportInv = false;
        this.dataReport = [];
        this.productCodePattern = _config_index__WEBPACK_IMPORTED_MODULE_20__["pattern"].productCodePattern;
        this.isShowButtonWaiteSign = true;
        this._oTemplateTT78 = {};
        this.isTT78 = false;
        this.isPassNQ43 = false;
        this.isDisplayGuideSale = false;
        this.invoices = [];
        this.isPXKDaiLy = false;
        this.isPXKNB = false;
        this.showTraLai = false;
        this.showKyDuyet = false;
        // sự kiện form
        this.totalPaymentChange = function (e) {
            if (_this.frmData.auto_value)
                _this.frmData.amount_after_vat = _this.frmData.total_payment;
            var currency_code = _this.frmData.currency_code;
            if (_this.configs.system_parameter.view_price_nte) {
                currency_code = 'VND';
            }
            var tien_chu = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].tienBangChu(Math.abs(e.value), _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterToNumber(_this.formatter.tong_tien), currency_code, _this.configs.system_parameter.display_read_money_english);
            _this.frmData.total_payment_in_word = _this.invoiceService.docTienAm(e.value, tien_chu, _this.configs, _this.frmData.currency_code);
        };
        this._translate = this.authService.getTranslate();
        translate.use(this.authService.getLanguage());
    }
    ReplaceInvoiceComponent.prototype.ngAfterViewInit = function () {
        if (this.frmData.status === 'DA_XUAT') {
            this.disablleScreen();
            this.cdRef.detectChanges();
        }
        this.setDataSessionStorage(this.frmData);
    };
    ReplaceInvoiceComponent.prototype.disablleScreen = function () {
        this.formInvoice.readonlyAllForm();
        this.productGrip.ttDaXuatHoaDon = true;
        this.ttDaXuatHoaDon = true;
    };
    ReplaceInvoiceComponent.prototype.xuLiApiKhiXuat = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var status;
        if (!this.frmData.id && !this.frmData.invoice_number) {
            status = 'THEM_MOI';
        }
        if (this.frmData.id && !this.frmData.invoice_number) {
            status = 'GHI_TAM';
        }
        if (this.frmData.id && this.frmData.invoice_number) {
            status = 'GIU_SO';
        }
        var xmlInvoice = "";
        var isNewXml = 0;
        if (status === 'THEM_MOI') {
            if (!this.isTT78) {
                var sub_1 = this.vatService.ghiTam(this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        _this.frmData.id = rs.data.id;
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_1.unsubscribe();
                });
            }
            else {
                var sub_2 = this.vatService.ghiTamTT78(this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        _this.frmData.id = rs.data.id;
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_2.unsubscribe();
                });
            }
        }
        else if (status === 'GHI_TAM') {
            if (!this.isTT78) {
                var sub_3 = this.vatService.edit(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_3.unsubscribe();
                });
            }
            else {
                var sub_4 = this.vatService.editTT78(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_number = rs.data.invoice_number;
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_4.unsubscribe();
                });
            }
        }
        else if (status === 'GIU_SO') {
            if (!this.isTT78) {
                var sub_5 = this.vatService.edit(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, _this.frmData.invoice_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_5.unsubscribe();
                });
            }
            else {
                var sub_6 = this.vatService.editTT78(this.frmData.id, this.frmData, true).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                        var invoice_sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_sign_date).format('YYYY-MM-DD HH:mm:ss');
                        // demo kí số vào file
                        //  Lấy xml từ serer
                        isNewXml = rs.data.is_new_xml;
                        if (isNewXml)
                            _this.nodeSign = "//HDon/DSCKS/NBan";
                        else
                            _this.nodeSign = "//inv:transaction/inv:invoices/inv:invoice";
                        xmlInvoice = _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(rs.data.xml_string);
                        if (xmlInvoice != "") {
                            if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                                || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
                                _this.goiApiXuatHoaDon(xmlInvoice);
                            }
                            else {
                                _this.xuLyKiFile(xmlInvoice, invoice_sign_date);
                            }
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_6.unsubscribe();
                });
            }
        }
    };
    ReplaceInvoiceComponent.prototype.xuLyKiFile = function (xmlInvoice, signDate) {
        var _this = this;
        if (this.isTT78) {
            var ListSerialNumber = "DSCKS";
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
            }
            // nodeSign: thẻ đc kí vào(vùng chữ kí số)
            // InvoiceData: id của thẻ(vùng dữ liệu)
            // ListSerialNumber
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate, 'InvoiceData', ListSerialNumber, true);
        }
        else
            this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', this.nodeSign, signDate);
    };
    ReplaceInvoiceComponent.prototype.goiApiXuatHoaDon = function (xml_string) {
        var _this = this;
        setTimeout(function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        }, 20);
        var sub = this.vatService.xuatHoaDon({
            id: this.frmData.id,
            xml_string: xml_string,
            invoice_files: this.frmData.invoice_files
        }).subscribe(function (rs) {
            if (rs.status === 'success') {
                _this.disablleScreen();
                _this.isExportInvoice = true;
                _this.isShowButtonWaiteSign = false;
                _this.fileData = _this.frmData.invoice_files;
                _this.setDataSessionStorage(_this.frmData);
                if (_this.isRoleThuKhoXuatKy && !_this.frmData.warehouse_keeper_signed)
                    _this.isShowThuKhoXuatKy = true;
                if (_this.configs.system_parameter.enable_send_wrong_process && _this.isTT78) {
                    if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                        || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing))
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
                    else
                        _this.startProcess_TBSaiSot();
                }
                else
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    ReplaceInvoiceComponent.prototype.ngOnInit = function () {
        var _this = this;
        // kết nối websocket
        this.connectWebsocket();
        var currentUsers = this.authService.getCurrentUser();
        var listpermission = currentUsers.user.permissions.split(',');
        var oThuKhoXuat = listpermission.filter(function (p) { return p == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].permissions.ThuKhoXuatKy; });
        if (oThuKhoXuat.length > 0)
            this.isRoleThuKhoXuatKy = true;
        else
            this.isRoleThuKhoXuatKy = false;
        this.loaiHoaDon = this.route.snapshot.data.type;
        if (this.loaiHoaDon == '03XKNB')
            this.isPXKNB = true;
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].loaihoadon.HGDL04)
            this.isPXKDaiLy = true;
        this.configs = this.authService.getConfigs();
        this.infoDangKy = this.authService.getInfoRegister();
        this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(this.configs.decimal_places_json);
        this.formatter.display_int = this.configs.system_parameter.display_int;
        ///////
        var isViewTT32 = false;
        if (this.route.snapshot.queryParams['status'] === 'viewInvTT32') {
            isViewTT32 = true;
        }
        this.routeSub = this.route.data.subscribe(function (data) {
            if (data.init[5].length > 0) {
                _this.textReport = _this._translate.CONTROLL.BUTTON.view_report;
            }
            else {
                _this.textReport = _this._translate.CONTROLL.BUTTON.create_report;
            }
            // put data DM for select
            _this.select.unit_codes = data.init[1].DM_DON_VI_TINH;
            _this.select.select_provisions_on_accounts = data.init[1].DM_DINH_KHOAN;
            _this.select.payment_method_names = data.init[1].DM_HINH_THUC_THANH_TOAN;
            _this.select.vats = data.init[1].DM_TY_LE_VAT;
            if (_this.infoDangKy) {
                if (_this.infoDangKy.status == "CHAP_NHAN")
                    _this.isTT78 = true;
            }
            if (_this.isTT78 == true && isViewTT32)
                _this.isTT78 = false;
            if (_this.isTT78) {
                var temptTT78 = [];
                temptTT78 = data.init[0];
                if (temptTT78 && temptTT78.length > 0) {
                    _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == _this.infoDangKy.is_invoice_with_code; });
                    if (data.init[4] && Number.parseInt(data.init[4].invoice_number) > 0) {
                        if (data.init[4].is_invoice_with_code != _this.infoDangKy.is_invoice_with_code && data.init[4].xml_type != '1') {
                            _this.select.templatesTT78 = temptTT78.filter(function (p) { return p.is_invoice_with_code == data.init[4].is_invoice_with_code; });
                        }
                        // id mẫu tt78 k so sánh dk vs id mẫu tt32 nên mặc định mẫu là nhiều loại thuế suất để xuất dk cho mẫu 1 loại thuế suất
                        if (data.init[4].xml_type == '1')
                            _this.is_multi_vat = true;
                    }
                }
            }
            else {
                _this.select.invoice_releases = data.init[0];
            }
            if (data.status === 'thaythemoi') {
                _this.khoiTaoKhiThemMoi(data.init[4]);
                _this.oldForm = data.init[4];
                _this.wavehourses = data.init[6];
            }
            else {
                _this.khoiTaoKhiSua(data.init[4]);
                _this.oldForm = data.init[4].origin;
                _this.wavehourses = data.init[6];
            }
            if (data.init[5].length > 0 && _this.isTT78) {
                var oReport = data.init[5][data.init[5].length - 1];
                if (oReport)
                    _this.frmData.destroy_reason = oReport.destroy_reason;
            }
            ///test
            var ts = _this.oldForm.template_code;
            if (_this.oldForm.template_code.indexOf('02GTTT') >= 0 || _this.oldForm.template_code.indexOf('07KPTQ') >= 0 || _this.oldForm.template_code == "2") {
                _this.isHdGTGT = false;
            }
            // mẫu nhiều loại thuế suất ko
            if (!_this.isTT78) {
                _this.select.invoice_releases.some(function (item) {
                    if (item.value === _this.oldForm.invoice_release_id) {
                        _this.is_multi_vat = item.is_multi_vat;
                        _this._objTemplateSelect = item;
                        return true;
                    }
                });
            }
            else {
                _this.select.templatesTT78.forEach(function (item) {
                    if (item.value === _this.oldForm.template_id) {
                        _this.invoiceTemplateTT78 = item;
                    }
                });
                _this.select.templatesTT78.some(function (item) {
                    if (item.value === _this.oldForm.template_id) {
                        _this.is_multi_vat = item.is_multi_vat;
                        for (var key in item) {
                            if (item.hasOwnProperty(key)) {
                                _this._oTemplateTT78[key] = item[key];
                            }
                        }
                        return true;
                    }
                });
            }
            _this.dataInvoice = data.init[4];
        });
        var currentUser = this.authService.getCurrentUser();
        if (currentUser && currentUser.account && (currentUser.account.tax_code == "0102519041-999" || currentUser.account.tax_code == "8888888803" || currentUser.account.tax_code == "9999999671"))
            this.isPassNQ43 = true;
        var listpermissions = currentUser.user.permissions.split(',');
        var obj2 = listpermissions.filter(function (p) { return p === 'phe_duyet'; });
        if (obj2.length > 0) {
            this.isAccessExportInv = true;
        }
        else {
            this.isAccessExportInv = false;
        }
    };
    ReplaceInvoiceComponent.prototype.connectWebsocket = function () {
        var _this = this;
        this.ioSignature = this.socketService.lapHoaDon().subscribe(function (message) {
            var data = message;
            if (data.SvcName === 'efy_Sign') {
                // Helper.dowloadFile('test.xml', 'xml', data.Data.Content);
                if (data.Data.Name === 'hoadon.xml') {
                    if (_this.ttDaXuatHoaDon)
                        _this.sendData_TBSaiSot(data.Data.Content);
                    else
                        _this.goiApiXuatHoaDon(data.Data.Content);
                }
                else if (data.Data.Name === 'ten_filek_the_trung-dc-nhi.xml') {
                    if (_this.ttDaXuatHoaDon)
                        _this.getXml_TBSaiSot();
                    else {
                        _this.frmData.issuer_name = data.Data.IssuerName;
                        _this.xuLiApiKhiXuat();
                    }
                }
                else {
                    _this.frmData.invoice_files.forEach(function (item) {
                        if (item.file_name === data.Data.Name) {
                            item.file_content = data.Data.Content;
                        }
                    });
                    _this.tempKiFile++;
                    if (_this.tempKiFile === _this.frmData.invoice_files.length) {
                        _this.xuLiApiKhiXuat();
                    }
                }
            }
        });
    };
    ReplaceInvoiceComponent.prototype.khoiTaoKhiThemMoi = function (data) {
        var _this = this;
        // khởi tạo mới lưới
        var inv_products = this.frmData.setInvoice_products_data(data.invoice_products);
        inv_products.forEach(function (item) {
            item.vat = item.vat != null ? item.vat.toString() : null;
        });
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: 'id',
            data: inv_products
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        // tạo mới đối tượng file
        this.fileData = [];
        // khởi tạo dữ liệu form
        this.frmData.fillFormThayThe(data);
        if (this.frmData.vat_service_ticket != null) {
            this.frmData.vat_service_ticket = this.frmData.vat_service_ticket.toString();
        }
        if (!this.isTT78) {
            this.select.invoice_releases = this.select.invoice_releases.filter(function (p) { return p.number_survival > 0; });
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id === _this.frmData.template_id) {
                    _this.invoicereleaseTempt = item;
                }
            });
        }
        else {
            if (this.select.templatesTT78.length) {
                this.select.templatesTT78.forEach(function (item) {
                    if (item.value === _this.frmData.template_id) {
                        _this.invoiceTemplateTT78 = item;
                    }
                });
            }
        }
        this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(JSON.parse(data.decimal_places_json));
    };
    ReplaceInvoiceComponent.prototype.checkDisabledTotalPaymentInWord = function () {
        if (this.frmData.adjustment_form === 'THONG_TIN' && this.frmData.adjustment_object === 'TIEN_CHU') {
            return false;
        }
        return true;
    };
    ReplaceInvoiceComponent.prototype.khoiTaoKhiSua = function (data) {
        var _this = this;
        console.log(data);
        var inv_products = this.frmData.setInvoice_products_data(data.invoice_products);
        inv_products.forEach(function (item) {
            item.vat = item.vat != null ? item.vat.toString() : null;
        });
        // khởi tạo lưới từ dữ liệu sửa
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: 'id',
            data: inv_products
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        // khởi tạo dữ liệu form
        this.frmData.fillFormData(data);
        this.frmData.adjustment_type = 3;
        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.approve_status) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.TuChoi) {
            this.isTuChoi = true;
        }
        // lấy file
        this.fileData = data.invoice_files || [];
        if (this.frmData.vat_service_ticket != null) {
            this.frmData.vat_service_ticket = this.frmData.vat_service_ticket.toString();
        }
        if (!this.isTT78) {
            this.select.invoice_releases.forEach(function (item) {
                if (item.template_id === _this.frmData.template_id) {
                    _this.invoicereleaseTempt = item;
                }
            });
        }
        else {
            this.select.templatesTT78.forEach(function (item) {
                if (item.value === _this.frmData.template_id) {
                    _this.invoiceTemplateTT78 = item;
                }
            });
        }
        // cấu hình thập phân thêm mới
        this.formatter = _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getFormatterColumnInv(JSON.parse(data.decimal_places_json));
        if (this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusInv.DaXuat || this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusInv.ChoKy)
            this.isShowButtonWaiteSign = false;
    };
    ReplaceInvoiceComponent.prototype.updateSomeTotalInput = function (e) {
    };
    ReplaceInvoiceComponent.prototype.fillAutoInput = function (e) {
        // this.frmData.auto_value = e;
    };
    // Lấy data khi chọn file đính kèm bảng kê
    ReplaceInvoiceComponent.prototype.getFileData = function (fileData) {
        this.fileData = fileData;
    };
    ReplaceInvoiceComponent.prototype.formatDecimalColumn = function (number) {
        if (number === 0) {
            return '0,###';
        }
        else {
            return '0,###.' + '0'.repeat(number);
        }
    };
    // Các hàm chức năng chính
    ReplaceInvoiceComponent.prototype.preview = function () {
        var _this = this;
        setTimeout(function () {
            _this.handleFormData();
            if (!_this._validForm(true)) {
                return;
            }
            var data = _this.vatService.taodulieuXemTruocMau(_this.frmData);
            data['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].cauhinhxemmau.hoadon;
            _this.vPreviewInvService.xemMau(data);
        }, 300);
    };
    ReplaceInvoiceComponent.prototype.view = function () {
        var ids = [];
        ids.push(this.frmData.id);
        var data = this.vatService.taodulieuXemMau(ids);
        data['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].cauhinhxemmau.hoadon;
        this.vPreviewInvService.xemMau(data);
    };
    ReplaceInvoiceComponent.prototype.inChuyenDoi = function () {
        var ids = [];
        ids.push(this.frmData.id);
        var data = this.vatService.taodulieuInChuyenDoi(ids);
        data['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].cauhinhxemmau.hoadon;
        this.vPreviewInvService.xemMau(data);
    };
    ReplaceInvoiceComponent.prototype.ghiTam = function (data) {
        var _this = this;
        this.isDisable = true;
        if (this.frmData.id) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_7 = this.vatService.edit(this.frmData.id, data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.id = rs.data.id;
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        }
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_7.unsubscribe();
                });
            }
            else {
                var sub_8 = this.vatService.editTT78(this.frmData.id, data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.id = rs.data.id;
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                        }
                        _this.setDataSessionStorage(_this.frmData);
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_8.unsubscribe();
                });
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_9 = this.vatService.ghiTam(data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.id = rs.data.id;
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_9.unsubscribe();
                });
            }
            else {
                var sub_10 = this.vatService.ghiTamTT78(data).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _this.frmData.id = rs.data.id;
                        if (rs.data.status == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusInv.ChoKy)
                            _this.isShowButtonWaiteSign = false;
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.save_invoice_success, 'success');
                    }
                    else {
                        if (rs.message.includes('CHUA_CO_BIEN_GIAM_TRU')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon modal-lg',
                                initialState: initialState
                            });
                        }
                        else if (rs.message.includes('MAU_HOA_DON_NQ43')) {
                            var initialState = {
                                typeNotify: "MAU_HOA_DON_NQ43",
                            };
                            _this.bsModalRef = _this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_21__["NotifyReduceTaxComponent"], {
                                backdrop: 'static',
                                keyboard: false,
                                class: 'mauhoadon43 modal-lg',
                                initialState: initialState
                            });
                        }
                        else
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    _this.isDisable = false;
                    sub_10.unsubscribe();
                });
            }
        }
    };
    ReplaceInvoiceComponent.prototype.xuatChoKy = function (data) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        if (!this.isTT78) {
            var sub_11 = this.vatService.xuatChoKy(data).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.isShowButtonWaiteSign = false;
                    _this.frmData.id = rs.data.id;
                    _this.frmData.invoice_number = rs.data.invoice_number;
                    _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_wait_sign_success, 'success');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_11.unsubscribe();
            });
        }
        else {
            var sub_12 = this.vatService.xuatChoKyTT78(data).subscribe(function (rs) {
                if (rs.status === 'success') {
                    _this.isShowButtonWaiteSign = false;
                    _this.frmData.id = rs.data.id;
                    _this.frmData.invoice_number = rs.data.invoice_number;
                    _this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice_date).format('YYYY-MM-DD HH:mm:ss');
                    if (_this.frmData.approve_status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_board_success, 'success');
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_wait_sign_success, 'success');
                    }
                    _this.setDataSessionStorage(_this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) {
            }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_12.unsubscribe();
            });
        }
    };
    ReplaceInvoiceComponent.prototype.xuatHoaDon = function (data) {
        var _this = this;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.xuLiApiKhiXuat();
        }
        else {
            if (this.frmData.invoice_files.length) {
                this.frmData.invoice_files.forEach(function (item) {
                    _this.socketService.kiFile(function () { return _this.connectWebsocket(); }, item.file_content, item.file_name, item.file_name.split('.').pop(), true, _this.frmData.invoice_date);
                });
            }
            else {
                if (this.isTT78) {
                    var ListSerialNumber = "DSCKS";
                    if (this.infoDangKy && this.infoDangKy.registration_signature) {
                        var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                        if (signatures && signatures.length > 0)
                            ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                    }
                    var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
                }
                else
                    this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
            }
        }
    };
    ReplaceInvoiceComponent.prototype._validForm = function (isOnlyCheckAm) {
        var _this = this;
        var _isValid = true;
        var invoice_products = this.frmData.invoice_products.filter(function (item) { return item.product_name; });
        var invoice_products_exchange_rate = this.frmData.invoice_products.filter(function (item) { return item.product_exchange_rate; });
        var indexErr = this.frmData.invoice_products.findIndex(function (item) { return !item.product_exchange_rate; });
        if ((this.frmData.amount_vat5 < 0 || this.frmData.amount_vat10 < 0 || this.frmData.total_payment < 0)
            && !this.configs.system_parameter.allow_export_with_negative) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.discount_same_vat, 'error');
            return false;
        }
        if (isOnlyCheckAm) {
            if (this.checkProductCode())
                return true;
            else
                return false;
        }
        if (this.frmData.currency_code && this.frmData.currency_code != "VND") {
            if (invoice_products_exchange_rate && invoice_products_exchange_rate.length > 0) {
                if (invoice_products_exchange_rate.length !== invoice_products.length) {
                    this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(indexErr, 'product_exchange_rate'));
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.currency_rate + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
            }
            else {
                if (!this.frmData.currency_rate) {
                    this.formInvoice.form.instance.getEditor('currency_rate').focus();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.currency_rate + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
            }
        }
        if (this.frmData.customer_object_code === 'DOANH_NGHIEP' && this.frmData.template_code != '6') {
            if (!this.frmData.customer_name) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.customer_name + ' ' + this._translate.VALIDATION.required, 'error');
                if (this.formInvoice.form.instance.getEditor('customer_name')) {
                    this.formInvoice.form.instance.getEditor('customer_name').focus();
                }
                return false;
            }
            if (!this.frmData.buyer_address) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.address + ' ' + this._translate.VALIDATION.required, 'error');
                if (this.formInvoice.form.instance.getEditor('customer_name')) {
                    this.formInvoice.form.instance.getEditor('customer_name').focus();
                }
                return false;
            }
            if (this.invoiceTemplateTT78.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe) {
                if (!this.frmData.nationality) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.nationality + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('nationality').focus();
                    return false;
                }
                if (!this.frmData.passport) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport').focus();
                    return false;
                }
                if (!this.frmData.passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_date').focus();
                    return false;
                }
                if (!this.frmData.passport_expiration_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
                var passport_expiration_date = new Date(this.frmData.passport_expiration_date);
                var passport_date = new Date(this.frmData.passport_date);
                if (passport_expiration_date <= passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + 'nhỏ hơn ' + this._translate.CONTROLL.LABEL.passport_date, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
            }
        }
        if (this.frmData.customer_object_code === 'CA_NHAN' && this.frmData.template_code != '6') {
            if (!this.frmData.buyer_name) {
                if (this.formInvoice.form.instance.getEditor('buyer_name')) {
                    this.formInvoice.form.instance.getEditor('buyer_name').focus();
                }
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.buyer_name + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (!this.frmData.buyer_address) {
                if (this.formInvoice.form.instance.getEditor('buyer_address')) {
                    this.formInvoice.form.instance.getEditor('buyer_address').focus();
                }
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.address + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (this.invoiceTemplateTT78.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe) {
                if (!this.frmData.nationality) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.nationality + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('nationality').focus();
                    return false;
                }
                if (!this.frmData.passport) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport').focus();
                    return false;
                }
                if (!this.frmData.passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_date').focus();
                    return false;
                }
                if (!this.frmData.passport_expiration_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
                var passport_expiration_date = new Date(this.frmData.passport_expiration_date);
                var passport_date = new Date(this.frmData.passport_date);
                if (passport_expiration_date <= passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + 'nhỏ hơn ' + this._translate.CONTROLL.LABEL.passport_date, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
            }
        }
        if (this.frmData.customer_object_code === 'KHACH_LE' && this.frmData.template_code != '6') {
            if (!this.frmData.buyer_name) {
                if (this.formInvoice.form.instance.getEditor('buyer_name')) {
                    this.formInvoice.form.instance.getEditor('buyer_name').focus();
                }
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.buyer_name + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
            if (this.invoiceTemplateTT78.template_type == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonKiemToKhaiHoanVe) {
                if (!this.frmData.nationality) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.nationality + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('nationality').focus();
                    return false;
                }
                if (!this.frmData.passport) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport').focus();
                    return false;
                }
                if (!this.frmData.passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_date').focus();
                    return false;
                }
                if (!this.frmData.passport_expiration_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + this._translate.VALIDATION.required, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
                var passport_expiration_date = new Date(this.frmData.passport_expiration_date);
                var passport_date = new Date(this.frmData.passport_date);
                if (passport_expiration_date <= passport_date) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.CONTROLL.LABEL.passport_expiration_date + ' ' + 'nhỏ hơn ' + this._translate.CONTROLL.LABEL.passport_date, 'error');
                    this.formInvoice.form.instance.getEditor('passport_expiration_date').focus();
                    return false;
                }
            }
        }
        if (!this.frmData.total_payment && this.frmData.total_payment !== 0) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tổng tiền hóa đơn không được để trống", 'error');
            return false;
        }
        if (this.isTT78) {
            if (this.frmData.destroy_reason === null || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.destroy_reason) == "") {
                this.formInvoice.form.instance.getEditor('destroy_reason').focus();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Lý do thay thế" + ' ' + this._translate.VALIDATION.required, 'error');
                return false;
            }
        }
        var _lst = this.frmData.invoice_products.filter(function (p) { return p.product_name; });
        if (_lst.length === 0) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.no_product, 'error');
            this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'product_code'));
            return false;
        }
        else {
            if (!this.checkProductCode())
                return false;
            var _lstValidThanhTien = this.frmData.invoice_products.filter(function (p) { return !p.amount && p.amount !== 0; });
            if (_lstValidThanhTien.length == this.frmData.invoice_products.length) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Thành tiền không được để trống", 'error', 5000);
                this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'amount'));
                return false;
            }
            var _lstValidTongTien = this.frmData.invoice_products.filter(function (p) { return !p.amount_after_vat && p.amount_after_vat !== 0; });
            if (_lstValidTongTien.length == this.frmData.invoice_products.length) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tổng tiền hàng hóa không được để trống", 'error', 5000);
                this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'amount_after_vat'));
                return false;
            }
            if (!this.isTT78) {
                var numberRow = this.invoicereleaseTempt.numberRow;
                if (numberRow == 100) {
                    if (_lst.length > 1) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Chỉ được chọn 1 khoản thu để xuất hóa đơn", 'error', 5000);
                        this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'product_code'));
                        return false;
                    }
                }
            }
            else {
                var numberRow = this.invoiceTemplateTT78.numberRow;
                if (numberRow == 100) {
                    if (_lst.length > 1) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.only_seclected_1_product_to_export_invoice, 'error', 5000);
                        this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'product_code'));
                        return false;
                    }
                }
                if (this.frmData.list_date && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.list_number) == "") {
                    this.formInvoice.form.instance.getEditor('list_number').focus();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Số bảng kê" + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
                if (!this.frmData.list_date && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.list_number) != "") {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ngày bảng kê" + ' ' + this._translate.VALIDATION.required, 'error');
                    return false;
                }
                this.invoice_products.load().then(function (dataSource) {
                    dataSource.forEach(function (item, index) {
                        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.product_name) != "" && !item.is_promotion && !item.is_promotion_new && !item.commercial_discount && _isValid) {
                            // if (item.quantity == null && _isValid) {
                            //   Library.notify("Số lượng" + " " + this._translate.VALIDATION.required, 'error');
                            //   this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(index, 'quantity'));
                            //   _isValid = false;
                            //   return false;
                            // }
                            // if (item.price == null && _isValid) {
                            //   Library.notify("Đơn giá" + " " + this._translate.VALIDATION.required, 'error');
                            //   this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(index, 'price'));
                            //   _isValid = false;
                            //   return false;
                            // }
                        }
                        else if (item.is_promotion || item.is_promotion_new || item.commercial_discount) {
                            if ((item.product_name == null || item.product_name == '') && _isValid) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tên hàng hóa" + " " + _this._translate.VALIDATION.required, 'error');
                                _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'product_name'));
                                _isValid = false;
                                return false;
                            }
                        }
                        if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.product_name) != "" && !item.is_promotion) {
                            if (_this.isHdGTGT && _this.frmData.template_code != '6') {
                                if (item.vat == null && _isValid) {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Thuế suất" + " " + _this._translate.VALIDATION.required, 'error');
                                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'vat'));
                                    _isValid = false;
                                    return false;
                                }
                                if (item.vat != "-1" && item.vat != "-2" && item.amount_vat == null && _isValid) {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tiền thuế" + " " + _this._translate.VALIDATION.required, 'error');
                                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'amount_vat'));
                                    _isValid = false;
                                    return false;
                                }
                            }
                            if (item.amount == null && _isValid) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Thành tiền" + " " + _this._translate.VALIDATION.required, 'error');
                                _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(index, 'amount'));
                                _isValid = false;
                                return false;
                            }
                        }
                    });
                });
            }
            /* Hóa đơn giảm trừ theo Nghị định số 92/2021  */
            var _objND92 = this.frmData.invoice_products.filter(function (p) { return (p.vat == "7" || p.vat == "3.5"); })[0];
            if (_objND92) {
                var _objCommon = this.frmData.invoice_products.filter(function (p) { return (p.vat != null && p.vat != "7" && p.vat != "3.5"); })[0];
                var isCheckNoVat_1 = false;
                var _lstNoVat = this.frmData.invoice_products.filter(function (p) { return p.vat == null; });
                _lstNoVat.forEach(function (item) {
                    if (!item.commercial_discount) {
                        if (item.amount != null)
                            isCheckNoVat_1 = true;
                    }
                });
                if (_objCommon || isCheckNoVat_1) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Vui lòng lập hóa đơn riêng cho hàng hóa, dịch vụ được giảm thuế GTGT theo Nghị định số 92/2021", 'error', 5000);
                    this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'vat'));
                    return false;
                }
            }
            /* Hóa đơn giảm trừ theo Nghị quyết số 43/2022/QH15 */
            // let _objNQ43 = this.frmData.invoice_products.filter(p => (p.vat == "8"))[0];
            // if (_objNQ43) {
            //   let _objCommonNQ43 = this.frmData.invoice_products.filter(p => (p.vat != null && p.vat != "8"))[0];
            //   let isCheckNQ43 = false;
            //   let _lstNQ43 = this.frmData.invoice_products.filter(p => p.vat == null);
            //   _lstNQ43.forEach(item => {
            //     if (!item.commercial_discount) {
            //       if (item.amount != null)
            //         isCheckNQ43 = true;
            //     }
            //   });
            //   if (_objCommonNQ43 || isCheckNQ43) {
            //     Library.notify("Vui lòng lập hóa đơn riêng cho hàng hóa, dịch vụ được giảm thuế GTGT theo Nghị quyết số 43/2022/QH15", 'error', 5000);
            //     this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(0, 'vat'));
            //     return false;
            //   }
            // } 
            /* Hóa đơn bán hàng NQ43 */
            if (this.frmData.is_resolution_43) {
                if (!this.frmData.sales_percentage) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tỷ lệ % trên doanh thu không được để trống", 'error');
                    return false;
                }
                else if (this.frmData.sales_percentage != 1 && this.frmData.sales_percentage != 2
                    && this.frmData.sales_percentage != 3 && this.frmData.sales_percentage != 5) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tỷ lệ % trên doanh thu chỉ bao gồm các giá trị: 1, 2, 3, 5", 'error');
                    return false;
                }
            }
        }
        return _isValid;
    };
    /* Kiểm tra Mã hàng phải nhập không dấu, không chứa ký tự đặc biệt và tối đa 50 ký tự */
    ReplaceInvoiceComponent.prototype.checkProductCode = function () {
        var isValid = true;
        var _lst = this.frmData.invoice_products.filter(function (p) { return p.product_name; });
        if (_lst.length > 0) {
            for (var i = 0; i < _lst.length; i++) {
                if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_lst[i].product_code) != "" && !this.productCodePattern.test(_lst[i].product_code)) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.VALIDATION.required_productCode, 'error', 5000);
                    this.productGrip.dataGrid.instance.focus(this.productGrip.dataGrid.instance.getCellElement(i, 'product_code'));
                    return false;
                }
            }
        }
        return isValid;
    };
    ReplaceInvoiceComponent.prototype.eSubmit = function (type, isCheckNoVat) {
        var _this = this;
        var checkValid = this.formInvoice.form.instance.validate();
        if (!checkValid.isValid) {
            return;
        }
        this.total_payment = "";
        if (this.windowPreviewBeforeSubmit) {
            this.windowPreviewBeforeSubmit.focus();
            return;
        }
        setTimeout(function () {
            _this.handleFormData();
            if (type !== 'GHI_TAM') {
                if (!_this._validForm(false)) {
                    return;
                }
                if (!_core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_12__["InvoicesService"].checkTimeExportInv(_this.configs.system_parameter)) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(typescript_string_operations__WEBPACK_IMPORTED_MODULE_13__["String"].Format(_this._translate.NOTIFY.time_export_inv, moment__WEBPACK_IMPORTED_MODULE_2__(_this.configs.system_parameter.time_start).format('HH:mm'), moment__WEBPACK_IMPORTED_MODULE_2__(_this.configs.system_parameter.time_end).format('HH:mm')), 'error');
                    return;
                }
            }
            else {
                if (!_this.checkProductCode()) {
                    return;
                }
            }
            if (_this.frmData.invoice_options) {
                _this.frmData.invoice_options.forEach(function (item) {
                    delete item['is_show'];
                    delete item['type'];
                    delete item['width'];
                    delete item['statusData'];
                    delete item['id'];
                    delete item['invoice_id'];
                });
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_this.frmData.bank_name) != "" && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(_this.frmData.bank_name).length > 400) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.bank_name_less_than_400_character, 'error');
                return false;
            }
            if (_this.frmData.total_payment > 20000000 && (_this.frmData.payment_method_name === 'TM')) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Vui lòng chọn HTTT chuyển khoản cho hóa đơn có giá trị lớn hơn 20 triệu đồng', 'error');
                return false;
            }
            if (!_this.isAccessExportInv && type === 'XUAT' && _this.formInvoice.getHtXuatValue() !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.you_not_permissions, 'error');
                return false;
            }
            if (type === 'XUAT' || (type === 'TRINH_KY' && _this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy)) {
                if (!_this.frmData.invoice_date && !_this.confirmCheckPreview && !_this.isTT78) {
                    var setInvoiceDate = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(_this._translate.NOTIFY.warning_invoice_date, _this._translate.NOTIFY.notify);
                    setInvoiceDate.then(function (dialog) {
                        if (!dialog) {
                            _this.formInvoice.form.instance.getEditor('invoice_date').focus();
                        }
                        else {
                            _this.processXuatHoaDon(type, isCheckNoVat);
                        }
                    });
                }
                else
                    _this.processXuatHoaDon(type, isCheckNoVat);
            }
            else {
                _this.processGhiTam(type);
            }
        }, 300);
    };
    /* Xử lý xuất hóa đơn */
    ReplaceInvoiceComponent.prototype.processXuatHoaDon = function (type, isCheckNoVat) {
        var _this = this;
        var _index = 0;
        var _isValid = true;
        var _lstInv = [];
        this.invoice_products.load().then(function (dataSource) {
            _lstInv = dataSource.filter(function (p) { return p.product_name; });
        });
        for (var i = 0; i < _lstInv.length; i++) {
            if (_lstInv[i].amount > 0 && !_lstInv[i].vat && !_lstInv[i].is_refund_ticket) {
                _index = i;
                _isValid = false;
                break;
            }
        }
        if (!this.isHdGTGT)
            _isValid = true;
        if (!this.vatService.checkVatMauHoaDon(_lstInv, this.is_multi_vat)) {
            return false;
        }
        if (!_isValid && isCheckNoVat && !this.isPXKDaiLy && !this.isPXKNB) {
            var result = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(this._translate.CONFIRM.no_vat, this._translate.NOTIFY.notify);
            result.then(function (dialogResult) {
                if (dialogResult) {
                    _this.productGrip.dataGrid.instance.focus(_this.productGrip.dataGrid.instance.getCellElement(_index, 'vat'));
                    return false;
                }
                else {
                    if (type === 'TRINH_KY' && _this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy) {
                        _this.confirmCheckPreview = true;
                    }
                    if (_this.confirmCheckPreview) {
                        if (_this.formInvoice.getHtXuatValue() !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy) {
                            _this.xuatHoaDon(_this.frmData);
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].confirmXuatChoKy(function () {
                                if (!_this.isAccessExportInv) {
                                    if (type === 'TRINH_KY') {
                                        _this.frmData.refuse_reason = '';
                                        _this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet;
                                    }
                                    else {
                                        if (_this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.TuChoi) {
                                            _this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChuaTrinhKy;
                                        }
                                    }
                                }
                                _this.xuatChoKy(_this.frmData);
                            });
                        }
                        _this.confirmCheckPreview = false;
                    }
                    else {
                        _this.previewBeforeExport(type);
                    }
                }
            });
        }
        else {
            if (type === 'TRINH_KY' && this.frmData.status === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy) {
                this.confirmCheckPreview = true;
            }
            if (this.confirmCheckPreview) {
                if (this.formInvoice.getHtXuatValue() != _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy) {
                    this.xuatHoaDon(this.frmData);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].confirmXuatChoKy(function () {
                        if (!_this.isAccessExportInv) {
                            if (type === 'TRINH_KY') {
                                _this.frmData.refuse_reason = '';
                                _this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet;
                            }
                            else {
                                if (_this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.TuChoi) {
                                    _this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChuaTrinhKy;
                                }
                            }
                        }
                        _this.xuatChoKy(_this.frmData);
                    });
                }
            }
            else {
                this.previewBeforeExport(type);
            }
        }
    };
    ReplaceInvoiceComponent.prototype.previewBeforeExport = function (type) {
        var _this = this;
        this.handleFormData();
        var trang_thai = '';
        if (this.formInvoice.getHtXuatValue() !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].hinhThucXuat.XuatChoKy) {
            trang_thai = this._translate.THONG_TIN.xuat_va_ky;
        }
        else {
            trang_thai = this._translate.THONG_TIN.xuat_cho_ky;
        }
        var du_lieu = this.vatService.taodulieuXemTruocMau(this.frmData);
        du_lieu['configs'] = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].cauhinhxemmau.hoadon;
        var content_invoice = {
            du_lieu: du_lieu,
            ngay_hoa_don: "",
            trang_thai: trang_thai,
            tong_tien: "",
            title_invoice_type: this._translate.THONG_TIN.ban_du_thao_hoa_don.toUpperCase(),
            note_warn: this._translate.THONG_TIN.luu_y_truoc_khi_xuat,
            is_display_img_note: true,
            text_ngay_hoa_don: this._translate.THONG_TIN.ngay_hoa_don,
            text_tong_tien: this._translate.THONG_TIN.tong_tien,
            question_again: this._translate.THONG_TIN.ban_co_chac_chan_xuat_hoa_don_khong
        };
        var initialState = {
            content_invoice: content_invoice,
        };
        this.bsModalRef = this.customeModalService.show(_shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_25__["PreviewInvoiceComponent"], {
            backdrop: 'static',
            keyboard: false,
            class: 'modal-xl prv-s-invoice v-s-invoice',
            initialState: initialState
        });
        var subModal = this.customeModalService.onHide.subscribe(function () {
            if (_this.bsModalRef.content.successSaveItem == _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].actionHander.DongY) {
                _this.confirmCheckPreview = true;
                _this.eSubmit(type);
            }
            subModal.unsubscribe();
        });
    };
    /* Xử lý ghi tạm hóa đơn */
    ReplaceInvoiceComponent.prototype.processGhiTam = function (type) {
        if (!this.isAccessExportInv) {
            if (type === 'TRINH_KY') {
                this.frmData.refuse_reason = '';
                this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet;
            }
            else {
                if (this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.TuChoi) {
                    this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChuaTrinhKy;
                }
            }
        }
        this.ghiTam(this.frmData);
    };
    ReplaceInvoiceComponent.prototype.handleFormData = function () {
        var _this = this;
        this.tempKiFile = 0;
        var invoice_products = [];
        this.invoice_products.load().then(function (dataSource) {
            var transport = "";
            dataSource.forEach(function (item, index) {
                if (item.product_code || item.product_name || (!item.product_name && item.is_promotion)) {
                    item.row_content = item.product_name;
                    invoice_products.push(item);
                    if (item.is_transport_number) {
                        transport += item.product_name + "; ";
                    }
                }
            });
            if (transport != "") {
                transport = transport.trim();
                transport = transport.slice(0, -1);
                _this.frmData.transport_number = transport;
            }
            if (_this.frmData.list_date) {
                _this.frmData.list_date = moment__WEBPACK_IMPORTED_MODULE_2__(_this.frmData.list_date).format('YYYY-MM-DD');
            }
            _this.frmData.is_outside_process = false;
            _this.frmData.invoice_files = JSON.parse(JSON.stringify(_this.fileData));
            var hoadon = "Hóa đơn";
            if (_this.isPXKNB || _this.isPXKDaiLy)
                hoadon = "Phiếu xuất kho";
            _this.frmData.note_view_on_invoice = hoadon + " " + "n\u00E0y thay th\u1EBF cho " + hoadon.toLowerCase() + " " + ("s\u1ED1 " + _this.oldForm.invoice_number + ", m\u1EABu s\u1ED1 " + _this.oldForm.template_code + ", k\u00FD hi\u1EC7u " + _this.oldForm.invoice_series + " ng\u00E0y " + moment__WEBPACK_IMPORTED_MODULE_2__(_this.oldForm.invoice_date).format('DD/MM/YYYY'));
            _this.frmData.invoice_products = invoice_products;
            _this.frmData.decimal_places_json = JSON.stringify(_core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getObjFormatterToColumn(_this.formatter));
        });
    };
    ReplaceInvoiceComponent.prototype.handleFormDataSub = function () {
        var _this = this;
        var wait = function (delay) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            return new Promise(function (resolve) { return setTimeout.apply(void 0, [resolve, delay].concat(args)); });
        };
        return wait(200).then(function () {
            _this.tempKiFile = 0;
            var invoice_products = [];
            _this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    //delete item.error;
                    if (item.product_code || item.product_name || (!item.product_name && item.is_promotion)) {
                        item.row_content = item.product_name;
                        invoice_products.push(item);
                        if (item.is_transport_number) {
                            _this.frmData.transport_number = item.product_name;
                        }
                    }
                });
            });
            _this.frmData.invoice_files = JSON.parse(JSON.stringify(_this.fileData));
            var hoadon = "Hóa đơn";
            if (_this.isPXKNB || _this.isPXKDaiLy)
                hoadon = "Phiếu xuất kho";
            _this.frmData.note_view_on_invoice = hoadon + " " + "n\u00E0y thay th\u1EBF cho " + hoadon.toLowerCase() + " " + ("s\u1ED1 " + _this.oldForm.invoice_number + ", m\u1EABu s\u1ED1 " + _this.oldForm.template_code + ", k\u00FD hi\u1EC7u " + _this.oldForm.invoice_series + " ng\u00E0y " + moment__WEBPACK_IMPORTED_MODULE_2__(_this.oldForm.invoice_date).format('DD/MM/YYYY'));
            _this.frmData.invoice_products = invoice_products;
            _this.frmData.decimal_places_json = JSON.stringify(_core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"].getObjFormatterToColumn(_this.formatter));
            return true;
        });
    };
    ReplaceInvoiceComponent.prototype.showModalHdck = function () {
        var _this = this;
        var initialState = {
            invoiceNumberOrigin: this.oldForm.invoice_number,
            invoiceReleaseId: this.oldForm.invoice_release_id,
            onSave: function (data) {
                _this.frmData.id = data.id;
                _this.frmData.invoice_date = data.invoice_date;
                _this.frmData.invoice_number = data.invoice_number;
            }
        };
        this.bsModalHdckRef = this.modalService.show(_modules_handle_invoice_components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_6__["ChooseHdckComponent"], {
            backdrop: 'static',
            keyboard: false,
            class: 'modal-lg full-modal',
            initialState: initialState
        });
    };
    ReplaceInvoiceComponent.prototype.test = function () {
        this.productGrip.createUpdateEvent();
        // this.handleFormData();
        // window.scrollTo(100, 100);
    };
    ReplaceInvoiceComponent.prototype.ngOnDestroy = function () {
        this.ioSignature.unsubscribe();
        this.routeSub.unsubscribe();
        // this.socketService.close();
    };
    ReplaceInvoiceComponent.prototype.xemlydotuchoi = function () {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var sub = this.vatService.showToSendInvoice(this.frmData.id).subscribe(function (rs) {
            if (rs.status === 'success') {
                var initialState = {
                    invoice: rs.data.invoice,
                    listDM: _this.listDM
                };
                _this.bsModalRef = _this.modalService.show(_modules_handle_invoice_components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_15__["SendInvoicesComponent"], {
                    class: 'modal-lg full-modal', initialState: initialState, backdrop: 'static',
                    keyboard: false
                });
                _this.modalService.onHide.subscribe(function () {
                    if (_this.bsModalRef.content.successSaveItem) {
                    }
                });
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    ReplaceInvoiceComponent.prototype.onSubmit = function () {
    };
    ReplaceInvoiceComponent.prototype.routeReport = function () {
        if (this.dataInvoice.origin_id !== null) {
            if (this.dataInvoice.status === 'GHI_TAM') {
                this.router.navigate(['/system/handle-report/create-report/', this.dataInvoice.origin_id, 'THAY_THE']);
            }
            else {
                this.router.navigate(['/system/handle-report/create-report/', this.dataInvoice.id, 'THAY_THE']);
            }
        }
        else {
            this.router.navigate(['/system/handle-report/create-report/', this.dataInvoice.id, 'THAY_THE']);
        }
    };
    ReplaceInvoiceComponent.prototype.onTemplateTypeChange = function (e) {
        this.invoicereleaseTempt = e;
    };
    ReplaceInvoiceComponent.prototype.onTemplateTT78TypeChange = function (e) {
        this.invoiceTemplateTT78 = e;
        this.is_multi_vat = e.is_multi_vat;
    };
    ReplaceInvoiceComponent.prototype.onNumberTicketChange = function () {
        if (!this.isTT78) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyItem(this.dataSource, this.invoice_products, this.frmData, this.formatter, !this.frmData.auto_value, this.frmData.auto_value_price, null, this._objTemplateSelect, this.configs.system_parameter);
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonVeMayBay
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonXangDau) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyTicket(this.frmData, this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._objTemplateSelect.template_type));
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyItem(this.dataSource, this.invoice_products, this.frmData, this.formatter, !this.frmData.auto_value, this.frmData.auto_value_price, null, this._oTemplateTT78, this.configs.system_parameter);
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonVeMayBay
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                || _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].templatetype.HoaDonXangDau) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._changeMoneyTicket(this.frmData, this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this._oTemplateTT78.template_type));
            }
        }
    };
    ReplaceInvoiceComponent.prototype.onNumberChange = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_3__["VChanggeMoneyService"]._calTotalMoney(this.frmData, this.formatter, !this.frmData.auto_value);
    };
    ReplaceInvoiceComponent.prototype.onVatChange = function () {
        var decimal_amount = this.getFormatterToNumber(this.formatter.thanh_tien);
        var decimal_amount_vat = this.getFormatterToNumber(this.formatter.tien_thue);
        var decimal_vat = this.getFormatterToNumber(this.formatter.vat);
        if (this.frmData.vat_service_ticket != null && this.frmData.vat_service_ticket != '-1') {
            this.frmData.total_vat_service_ticket = this.roundNumber((Number.parseInt(this.frmData.vat_service_ticket) * this.frmData.money_service_ticket) / 100, decimal_amount_vat);
        }
        else {
            this.frmData.total_vat_service_ticket = null;
        }
        this.frmData.total_service_ticket_with_vat = this.roundNumber(this.frmData.money_service_ticket + this.frmData.total_vat_service_ticket, decimal_amount);
    };
    ReplaceInvoiceComponent.prototype.getFormatterToNumber = function (formatter) {
        var s1 = formatter.replace('0,###', '');
        if (s1 === '') {
            return 0;
        }
        else {
            var s2 = s1.replace('.', '');
            return s2.split('').length;
        }
    };
    ReplaceInvoiceComponent.prototype.roundNumber = function (number, n) {
        if (number == null) {
            return number;
        }
        else {
            var p = Math.pow(10, n);
            return Math.round(number * p) / p;
        }
    };
    ReplaceInvoiceComponent.prototype.keyDown = function (e) {
        // setTimeout(() => {
        if (e.event.key === 'Delete') {
            e.event.srcElement.value = null;
        }
        // }, 100);
    };
    ReplaceInvoiceComponent.prototype.setDataSessionStorage = function (value) {
        this.valueChange = JSON.stringify(value);
    };
    ReplaceInvoiceComponent.prototype.checkDataFormChange = function (dataChange, dataForm) {
        var dataBefore = JSON.parse(dataChange);
        var dataAfter = JSON.parse(JSON.stringify(dataForm));
        return lodash__WEBPACK_IMPORTED_MODULE_16__["isEqual"](dataBefore, dataAfter);
    };
    ReplaceInvoiceComponent.prototype.subData = function (type, value) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var checkValid;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        checkValid = this.formInvoice.form.instance.validate();
                        if (!checkValid.isValid) {
                            return [2 /*return*/, false];
                        }
                        if (this.windowPreviewBeforeSubmit) {
                            this.windowPreviewBeforeSubmit.focus();
                            return [2 /*return*/, false];
                        }
                        return [4 /*yield*/, this.handleFormDataSub()];
                    case 1:
                        _a.sent();
                        if (this.frmData.invoice_options) {
                            this.frmData.invoice_options.forEach(function (item) {
                                delete item['is_show'];
                                delete item['type'];
                                delete item['width'];
                                delete item['statusData'];
                            });
                        }
                        if (this.frmData.total_payment > 20000000 && (this.frmData.payment_method_name === 'TM')) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.payment_method_more_than_20_million, 'error');
                            return [2 /*return*/, false];
                        }
                        if (!this.isAccessExportInv) {
                            if (type === 'TRINH_KY') {
                                this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChoDuyet;
                                this.frmData.refuse_reason = '';
                            }
                            else {
                                if (this.frmData.approve_status !== _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.TuChoi) {
                                    this.frmData.approve_status = _config_sEnum__WEBPACK_IMPORTED_MODULE_14__["sEnum"].statusApprove.ChuaTrinhKy;
                                }
                            }
                        }
                        if (!value.id) return [3 /*break*/, 6];
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                        if (!!this.isTT78) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.vatService.edit(this.frmData.id, value).toPromise().then(function (res) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                                if (res.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                    return true;
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                    return false;
                                }
                            })];
                    case 2: return [2 /*return*/, _a.sent()];
                    case 3: return [4 /*yield*/, this.vatService.editTT78(this.frmData.id, value).toPromise().then(function (res) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                            if (res.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                return true;
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                return false;
                            }
                        })];
                    case 4: return [2 /*return*/, _a.sent()];
                    case 5: return [3 /*break*/, 10];
                    case 6:
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                        if (!!this.isTT78) return [3 /*break*/, 8];
                        return [4 /*yield*/, this.vatService.ghiTam(value).toPromise().then(function (res) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                                if (res.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                    return true;
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                    return false;
                                }
                            })];
                    case 7: return [2 /*return*/, _a.sent()];
                    case 8: return [4 /*yield*/, this.vatService.ghiTamTT78(value).toPromise().then(function (res) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                            if (res.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.update_success, 'success');
                                return true;
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(res.message, 'error');
                                return false;
                            }
                        })];
                    case 9: return [2 /*return*/, _a.sent()];
                    case 10: return [2 /*return*/];
                }
            });
        });
    };
    ReplaceInvoiceComponent.prototype.canDeactivate = function () {
        var _this = this;
        if (!this.checkDataFormChange(this.valueChange, this.frmData)) {
            return new rxjs__WEBPACK_IMPORTED_MODULE_17__["Observable"](function (observer) {
                _this.confirmService.confirm().subscribe(function (value) {
                    switch (value) {
                        case 'yes':
                            _this.subData('GHI_TAM', _this.frmData).then(function (value1) {
                                observer.next(value1);
                                observer.complete();
                            });
                            break;
                        case 'no':
                            observer.next(true);
                            observer.complete();
                            break;
                        case 'cancel':
                            observer.next(false);
                            observer.complete();
                            break;
                        default:
                            observer.next(true);
                            observer.complete();
                            break;
                    }
                });
            });
        }
        return true;
    };
    ReplaceInvoiceComponent.prototype.guideSales = function () {
        this.isDisplayGuideSale = !this.isDisplayGuideSale;
    };
    ReplaceInvoiceComponent.prototype.onChangeSalePercen = function (e) {
        var _this = this;
        this.configs.system_parameter.value_rate_percent = e.value;
        var data = {
            config: {
                value: JSON.stringify(this.configs.system_parameter)
            }
        };
        this.configsService.update(this.configs.id.system_parameter, data).subscribe(function (response) {
            if (response.status == "success") {
                _this.configsService.getAll().subscribe(function (res) {
                    if (res.data && res.data.configs)
                        _this.authService.setConfigs(res.data.configs);
                    _this.configs = _this.authService.getConfigs();
                });
            }
            else {
            }
        }, function (err) { }, function () {
        });
        this.onNumberTicketChange();
    };
    ReplaceInvoiceComponent.prototype.startProcess_TBSaiSot = function () {
        var _this = this;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.getXml_TBSaiSot();
        }
        else {
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var ListSerialNumber = "DSCKS";
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_2__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
            }
            else
                this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
        }
    };
    ReplaceInvoiceComponent.prototype.getXml_TBSaiSot = function () {
        var _this = this;
        var invoices = [];
        var object = new Object;
        object["tax_authority_code"] = this.oldForm.tax_authority_code;
        object["template_code"] = this.oldForm.template_code;
        object["invoice_series"] = this.oldForm.invoice_series;
        object["invoice_date"] = this.oldForm.invoice_date;
        object["invoice_number"] = this.oldForm.invoice_number;
        object["reason"] = this.frmData.destroy_reason;
        object["notification_nature"] = "3";
        object["type_apply_invoice"] = 1;
        object["is_invoice_with_code"] = this.oldForm.is_invoice_with_code;
        object["invoice_id"] = this.oldForm.id;
        invoices.push(object);
        var data = {
            notification_type: 1,
            invoices: invoices
        };
        var xmlInvoice = "";
        var sub = this.handleInvoiceService.getXmlInvoiceWrong(data).subscribe(function (rs) {
            if (rs.status == 'success') {
                xmlInvoice = rs.data.xml_file;
                _this.invoices = rs.data.invoices;
                var sign_date = moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.sign_date).format('YYYY-MM-DD HH:mm:ss');
                if (xmlInvoice != "") {
                    if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                        || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing))
                        _this.sendData_TBSaiSot(xmlInvoice);
                    else
                        _this.signXml_TBSaiSot(xmlInvoice, sign_date);
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            sub.unsubscribe();
        });
    };
    ReplaceInvoiceComponent.prototype.sendData_TBSaiSot = function (xml_string) {
        var _this = this;
        var subXuatHoaDon = this.handleInvoiceService.sendXmlInvoiceWrong({
            xml_file: xml_string,
            invoices: this.invoices
        }).subscribe(function (rs) {
            if (rs.status == 'success') {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.export_success, 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            subXuatHoaDon.unsubscribe();
        });
    };
    ReplaceInvoiceComponent.prototype.signXml_TBSaiSot = function (xmlInvoice, signDate) {
        var _this = this;
        var nodeSign = "//TBao/DSCKS/NNT";
        var ListSerialNumber = "DSCKS";
        if (this.infoDangKy && this.infoDangKy.registration_signature) {
            var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
            if (signatures && signatures.length > 0)
                ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
        }
        this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', nodeSign, signDate, 'NotificationData', ListSerialNumber, true);
    };
    ReplaceInvoiceComponent.prototype.inChuyenDoiText = function () {
        if (this.frmData.time_print_conversion > 0) {
            return this._translate.CONTROLL.BUTTON.view_conversion;
        }
        else {
            return this._translate.CONTROLL.BUTTON.print_conversion;
        }
    };
    ReplaceInvoiceComponent.prototype.thukhoxuatky = function () {
        var _this = this;
        var ids = [];
        ids.push(this.frmData.id);
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var sub = this.vatService.thukhoxuatky(ids).subscribe(function (rs) {
            if (rs.status === 'success') {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_success, 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    ReplaceInvoiceComponent.prototype.huylenhdieudong = function () {
        var _this = this;
        var setInvoiceDate = _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirm(this._translate.NOTIFY.warning_the_dispatch_success, this._translate.NOTIFY.notify);
        setInvoiceDate.then(function (dialog) {
            if (!dialog) {
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                var ids = [];
                ids.push(_this.frmData.id);
                var sub_13 = _this.vatService.huylenhdieudong(ids).subscribe(function (rs) {
                    if (rs.status == 'success') {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.cancel_the_dispatch_success, 'success');
                        _this.isShowHuyLenhDD = false;
                        _this.enableScreen();
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) { }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_13.unsubscribe();
                });
            }
        });
    };
    ReplaceInvoiceComponent.prototype.enableScreen = function () {
        this.formInvoice.allowEditAllForm();
        this.productGrip.ttDaXuatHoaDon = false;
    };
    ReplaceInvoiceComponent.prototype.submitlenhdieudong = function () {
        var _this = this;
        var checkValid = this.formInvoice.form.instance.validate();
        if (!checkValid.isValid) {
            return;
        }
        if (this.windowPreviewBeforeSubmit) {
            this.windowPreviewBeforeSubmit.focus();
            return;
        }
        if (!this.isCheckLenhDieuDong)
            this.resultCompareData = this.checkDataFormChange(this.valueChange, this.frmData);
        setTimeout(function () {
            _this.handleFormData();
            if (!_this._validForm(false))
                return;
            if (_this.isCheckLenhDieuDong) {
                _this.kylenhdieudong();
                _this.isCheckLenhDieuDong = false;
            }
            else {
                _this.Reviewlenhdieudong();
            }
        }, 300);
    };
    ReplaceInvoiceComponent.prototype.handleAddNew = function () {
        var _this = this;
        if (this.isExportInvoice) {
            this.addNew();
        }
        else {
            if (!this.checkDataFormChange(this.valueChange, this.frmData)) {
                this.confirmService.confirm()
                    .subscribe(function (value) {
                    switch (value) {
                        case 'yes':
                            _this.subData('GHI_TAM', _this.frmData).then(function (res) {
                                if (res) {
                                    _this.addNew();
                                }
                                else {
                                    return;
                                }
                            });
                            break;
                        case 'no':
                            _this.addNew();
                            break;
                        case 'cancel':
                            _this.addNew();
                            break;
                        default:
                            break;
                    }
                });
            }
            else {
                this.addNew();
            }
        }
    };
    ReplaceInvoiceComponent.prototype.kylenhdieudong = function () {
        var _this = this;
        if (this.frmData.id) {
            var ids_1 = [];
            ids_1.push(this.frmData.id);
            if (!this.resultCompareData) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                if (!this.isTT78) {
                    var sub_14 = this.vatService.edit(this.frmData.id, this.frmData).subscribe(function (rs) {
                        if (rs.status == 'success') {
                            _this.frmData.id = rs.data.id;
                            _this.getDataToCompare();
                            var sub_15 = _this.vatService.kylenhdieudong(ids_1).subscribe(function (rs) {
                                if (rs.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                    _this.isShowHuyLenhDD = true;
                                    _this.disablleScreen();
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                                }
                            });
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                        }
                    }, function (err) { }, function () {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                        sub_14.unsubscribe();
                    });
                }
                else {
                    var sub_16 = this.vatService.editTT78(this.frmData.id, this.frmData).subscribe(function (rs) {
                        if (rs.status == 'success') {
                            _this.frmData.id = rs.data.id;
                            _this.getDataToCompare();
                            var sub_17 = _this.vatService.kylenhdieudong(ids_1).subscribe(function (rs) {
                                if (rs.status === 'success') {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                    _this.isShowHuyLenhDD = true;
                                    _this.disablleScreen();
                                }
                                else {
                                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                                }
                            });
                        }
                        else {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                        }
                    }, function (err) { }, function () {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                        sub_16.unsubscribe();
                    });
                }
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
                var sub_18 = this.vatService.kylenhdieudong(ids_1).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                        _this.isShowHuyLenhDD = true;
                        _this.disablleScreen();
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_18.unsubscribe();
                });
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            if (!this.isTT78) {
                var sub_19 = this.vatService.ghiTam(this.frmData).subscribe(function (rs) {
                    if (rs.status == 'success') {
                        _this.frmData.id = rs.data.id;
                        var ids = [];
                        ids.push(_this.frmData.id);
                        var sub_20 = _this.vatService.kylenhdieudong(ids).subscribe(function (rs) {
                            if (rs.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                _this.isShowHuyLenhDD = true;
                                _this.disablleScreen();
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                            }
                        });
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) { }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_19.unsubscribe();
                });
            }
            else {
                var sub_21 = this.vatService.ghiTamTT78(this.frmData).subscribe(function (rs) {
                    if (rs.status == 'success') {
                        _this.frmData.id = rs.data.id;
                        var ids = [];
                        ids.push(_this.frmData.id);
                        var sub_22 = _this.vatService.kylenhdieudong(ids).subscribe(function (rs) {
                            if (rs.status === 'success') {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(_this._translate.NOTIFY.sign_the_dispatch_success, 'success');
                                _this.isShowHuyLenhDD = true;
                                _this.disablleScreen();
                            }
                            else {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                            }
                        });
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) { }, function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                    sub_21.unsubscribe();
                });
            }
        }
    };
    ReplaceInvoiceComponent.prototype.Reviewlenhdieudong = function () {
        var _this = this;
        this.handleFormData();
        this.windowPreviewBeforeSubmit = window.open("", "", "width=" + screen.availWidth + ", height=" + screen.availHeight);
        this.windowPreviewBeforeSubmit.document.body.innerHTML = this._translate.NOTIFY.loading;
        this.windowPreviewBeforeSubmit.blur();
        var timer = setInterval(function () {
            if (_this.windowPreviewBeforeSubmit.closed) {
                clearInterval(timer);
                var isCheck = _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].getCookie('CK_LDD');
                _this.windowPreviewBeforeSubmit = undefined;
                if (isCheck == "CHECKED") {
                    document.cookie = "CK_LDD=; path=/";
                    _this.isCheckLenhDieuDong = true;
                    _this.submitlenhdieudong();
                }
            }
        }, 500);
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        if (!this.frmData.id || !this.isShowHuyLenhDD) {
            var sub_23 = this.vatService.xemtruoclenhdieudong(this.frmData).subscribe(function (rs) {
                if (rs.status == 'success') {
                    var pdf_file = rs.data.file_content;
                    var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_3__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                    _this.windowPreviewBeforeSubmit.document.write("\n          \n          <!DOCTYPE html>\n          <html lang=\"en\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Document</title>\n            <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\" />\n            <style type=\"text/css\" scoped>\n            .nhap-nhay {\n              background: red;\n              padding: 0.5px 9px;\n              margin-right: 5px;\n              border-radius: 57%;\n              -webkit-animation: flicker 1s infinite;\n            }\n            .ht-xuat{\n              width: 20%;\n              height: 100%;\n              background: #ffffff;\n              box-shadow: 0px 0px 8px 0px #888888;\n              \n            }\n            .ht-xuat > .right-nav{\n              display:flex;\n              justify-content: space-between;\n              align-items: center;\n              border-bottom: 1px solid #d5d5d5;\n              padding:20px;\n            }\n            @-webkit-keyframes flicker\n            {\n            0% {opacity:0;}\n            9% {opacity:0;}\n            10% {opacity:.5;}\n            13% {opacity:0;}\n            20% {opacity:.5;}\n            25% {opacity:1;}\n            }\n\n            .example {\n              padding: 20px;\n            }\n            \n            input[type=button] {\n              padding: 5px 10px;\n              margin: 10px 5px;\n              border-radius: 5px;\n              cursor: pointer;\n              background: #ddd;\n              border: 1px solid #ccc;\n            }\n            input[type=button]:hover {\n              background: #ccc;\n            }\n\n            .confirm {\n              display: none;\n            }\n            .confirm > div:first-of-type {\n              position: fixed;\n              width: 100%;\n              height: 100%;\n              background: rgba(0, 0, 0, 0.5);\n              top: 0px;\n              left: 0px;\n            }\n            .confirm > div:last-of-type {\n              padding: 10px 20px;\n              background: white;\n              position: absolute;\n              width: auto;\n              height: auto;\n              left: 50%;\n              top: 50%;\n              transform: translate(-50%, -50%);\n              border-radius: 5px;\n              border: 1px solid #333;\n            }\n            .confirm > div:last-of-type div:first-of-type {\n              min-width: 150px;\n              padding: 10px;\n            }\n            .confirm > div:last-of-type div:last-of-type {\n              text-align: right;\n            }\n          </style>\n          </head>\n          <body>\n          <div style=\"margin-left: 50px;\">\n          <h3 style=\"color: red; text-align: center;\">B\u1EA2N D\u1EF0 TH\u1EA2O H\u00D3A \u0110\u01A0N \u0110I\u1EC6N T\u1EEC</h3>\n          <p style=\"font-weight: 600;\"><span class=\"nhap-nhay\"></span><span style=\"font-size: 17px;\">L\u01B0u \u00FD: \n          </span>\u0110\u1EC1 ngh\u1ECB \u0111\u01A1n v\u1ECB ki\u1EC3m tra th\u1EADt k\u1EF9 c\u00E1c n\u1ED9i dung h\u00F3a \u0111\u01A1n \u0111\u00E3 nh\u1EADp tr\u01B0\u1EDBc khi xu\u1EA5t nh\u01B0: Ng\u00E0y h\u00F3a \u0111\u01A1n, B\u00EAn mua h\u00E0ng, T\u00EAn h\u00E0ng h\u00F3a d\u1ECBch v\u1EE5, T\u1ED5ng ti\u1EC1n,\u2026\u0111\u1EC3 tr\u00E1nh xu\u1EA5t sai.</>\n        </div>\n\n        <div style=\"display: flex; height:84vh; justify-content: center;\">\n          <iframe style=\"\" width=\"70%\" height=\"100%\" src=\"" + objectUrl + "\"></iframe>\n          <div class=\"ht-xuat\">\n            <div class=\"right-nav\">\n             <button style =\" background:#007BFF;color:#ffffff; padding: 10px 50px; border: none ; outline:none; border-radius: 30px\"> <a href=\"javascript:void(0)\" style=\"text-decoration: none; color:#ffffff; font-weight: bold; padding-right:10px\" onclick=\"setConfirmInvoice()\">\u0110\u1ED3ng \u00FD </a> <i class=\"fa fa-angle-right\"></i></button>\n              <a href=\"javascript:void(0)\" style=\"text-decoration: none; color: gray\" onclick=\"closeWin()\"><i class=\"fa fa-times\" style=\"font-size:25px\"></i></a>\n            </div>\n            <div style=\"display: flex; flex-direction: column; padding:10px;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding:10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\" font-weight: 600;\">Ng\u00E0y h\u00F3a \u0111\u01A1n : </p>\n                <p style=\"color: orange;font-weight: 600;\">" + moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice.invoice_date).format('DD/MM/YYYY') + "</p>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding: 10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\"font-weight: 600;\">Tr\u1EA1ng th\u00E1i : </p>\n                <p style=\"color: orange;font-weight: 600;\">Xu\u1EA5t  " + _this._translate.CONFIRM.confirm_sign_delivery + "</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"confirm\">\n            <div></div>\n            <div>\n              <div id=\"confirmMessage\">Confirm text</div>\n              <div>\n                <input id=\"confirmYes\" type=\"button\" value=\"\u0110\u1ED3ng \u00FD\" />\n                <input id=\"confirmNo\" type=\"button\" value=\"Quay l\u1EA1i\" />\n              </div>\n            </div>\n        </div>\n\n        <script type=\"text/javascript\">\n        const ui = {\n          confirm: async (message) => createConfirm(message)\n        }\n        \n        const createConfirm = (message) => {\n          return new Promise((complete, failed)=>{\n            $('#confirmMessage').text(message)\n        \n            $('#confirmYes').off('click');\n            $('#confirmNo').off('click');\n            \n            $('#confirmYes').on('click', ()=> { $('.confirm').hide(); complete(true); });\n            $('#confirmNo').on('click', ()=> { $('.confirm').hide(); complete(false); });\n            \n            $('.confirm').show();\n          });\n        }\n                             \n        const setConfirmInvoice = async () => {\n          const confirm = await ui.confirm(\" " + _this._translate.CONFIRM.confirm_sign_delivery + " \");\n          if(confirm){\n            document.cookie = \"CK_CFM_I=CHECKED; path=/\";\n            window.close();\n          } else{\n          }\n        } \n\n          function closeWin(){\n            window.close();\n          }\n        </script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n          </body>\n          </html>\n        ");
                    _this.windowPreviewBeforeSubmit.focus();
                }
                else {
                    _this.windowPreviewBeforeSubmit.close();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_23.unsubscribe();
            });
        }
        else {
            var ids = [];
            ids.push(this.frmData.id);
            var sub_24 = this.vatService.xemlenhdieudong(ids).subscribe(function (rs) {
                if (rs.status == 'success') {
                    var pdf_file = rs.data.file_content;
                    var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_3__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                    _this.windowPreviewBeforeSubmit.document.write("\n          <!DOCTYPE html>\n          <html lang=\"en\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Document</title>\n            <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\" />\n            <style type=\"text/css\" scoped>\n            .nhap-nhay {\n              background: red;\n              padding: 0.5px 9px;\n              margin-right: 5px;\n              border-radius: 57%;\n              -webkit-animation: flicker 1s infinite;\n            }\n            .ht-xuat{\n              width: 20%;\n              height: 100%;\n              background: #ffffff;\n              box-shadow: 0px 0px 8px 0px #888888;\n              \n            }\n            .ht-xuat > .right-nav{\n              display:flex;\n              justify-content: space-between;\n              align-items: center;\n              border-bottom: 1px solid #d5d5d5;\n              padding:20px;\n            }\n            @-webkit-keyframes flicker\n            {\n            0% {opacity:0;}\n            9% {opacity:0;}\n            10% {opacity:.5;}\n            13% {opacity:0;}\n            20% {opacity:.5;}\n            25% {opacity:1;}\n            }\n\n            .example {\n              padding: 20px;\n            }\n            \n            input[type=button] {\n              padding: 5px 10px;\n              margin: 10px 5px;\n              border-radius: 5px;\n              cursor: pointer;\n              background: #ddd;\n              border: 1px solid #ccc;\n            }\n            input[type=button]:hover {\n              background: #ccc;\n            }\n\n            .confirm {\n              display: none;\n            }\n            .confirm > div:first-of-type {\n              position: fixed;\n              width: 100%;\n              height: 100%;\n              background: rgba(0, 0, 0, 0.5);\n              top: 0px;\n              left: 0px;\n            }\n            .confirm > div:last-of-type {\n              padding: 10px 20px;\n              background: white;\n              position: absolute;\n              width: auto;\n              height: auto;\n              left: 50%;\n              top: 50%;\n              transform: translate(-50%, -50%);\n              border-radius: 5px;\n              border: 1px solid #333;\n            }\n            .confirm > div:last-of-type div:first-of-type {\n              min-width: 150px;\n              padding: 10px;\n            }\n            .confirm > div:last-of-type div:last-of-type {\n              text-align: right;\n            }\n          </style>\n          </head>\n          <body>\n          <div style=\"margin-left: 50px;\">\n          <h3 style=\"color: red; text-align: center;\">B\u1EA2N D\u1EF0 TH\u1EA2O H\u00D3A \u0110\u01A0N \u0110I\u1EC6N T\u1EEC</h3>\n          <p style=\"font-weight: 600;\"><span class=\"nhap-nhay\"></span><span style=\"font-size: 17px;\">L\u01B0u \u00FD: \n          </span>\u0110\u1EC1 ngh\u1ECB \u0111\u01A1n v\u1ECB ki\u1EC3m tra th\u1EADt k\u1EF9 c\u00E1c n\u1ED9i dung h\u00F3a \u0111\u01A1n \u0111\u00E3 nh\u1EADp tr\u01B0\u1EDBc khi xu\u1EA5t nh\u01B0: Ng\u00E0y h\u00F3a \u0111\u01A1n, B\u00EAn mua h\u00E0ng, T\u00EAn h\u00E0ng h\u00F3a d\u1ECBch v\u1EE5, T\u1ED5ng ti\u1EC1n,\u2026\u0111\u1EC3 tr\u00E1nh xu\u1EA5t sai.</>\n        </div>\n\n        <div style=\"display: flex; height:84vh; justify-content: center;\">\n          <iframe style=\"\" width=\"70%\" height=\"100%\" src=\"" + objectUrl + "\"></iframe>\n          <div class=\"ht-xuat\">\n            <div class=\"right-nav\">\n             <button style =\" background:#007BFF;color:#ffffff; padding: 10px 50px; border: none ; outline:none; border-radius: 30px\"> <a href=\"javascript:void(0)\" style=\"text-decoration: none; color:#ffffff; font-weight: bold; padding-right:10px\" onclick=\"setConfirmInvoice()\">\u0110\u1ED3ng \u00FD </a> <i class=\"fa fa-angle-right\"></i></button>\n              <a href=\"javascript:void(0)\" style=\"text-decoration: none; color: gray\" onclick=\"closeWin()\"><i class=\"fa fa-times\" style=\"font-size:25px\"></i></a>\n            </div>\n            <div style=\"display: flex; flex-direction: column; padding:10px;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding:10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\" font-weight: 600;\">Ng\u00E0y h\u00F3a \u0111\u01A1n : </p>\n                <p style=\"color: orange;font-weight: 600;\">" + moment__WEBPACK_IMPORTED_MODULE_2__(rs.data.invoice.invoice_date).format('DD/MM/YYYY') + "</p>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding: 10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\"font-weight: 600;\">Tr\u1EA1ng th\u00E1i : </p>\n                <p style=\"color: orange;font-weight: 600;\">Xu\u1EA5t  " + _this._translate.CONFIRM.confirm_sign_delivery + "</p>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;padding:10px; border-bottom: 1px solid #d5d5d5\">\n                <p style=\"font-weight: 600;\">T\u1ED5ng ti\u1EC1n : </p>\n                <p style=\"color: orange;font-weight: 600;\">" + rs.data.invoice.total_payment + "</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"confirm\">\n            <div></div>\n            <div>\n              <div id=\"confirmMessage\">Confirm text</div>\n              <div>\n                <input id=\"confirmYes\" type=\"button\" value=\"\u0110\u1ED3ng \u00FD\" />\n                <input id=\"confirmNo\" type=\"button\" value=\"Quay l\u1EA1i\" />\n              </div>\n            </div>\n        </div>\n\n        <script type=\"text/javascript\">\n        const ui = {\n          confirm: async (message) => createConfirm(message)\n        }\n        \n        const createConfirm = (message) => {\n          return new Promise((complete, failed)=>{\n            $('#confirmMessage').text(message)\n        \n            $('#confirmYes').off('click');\n            $('#confirmNo').off('click');\n            \n            $('#confirmYes').on('click', ()=> { $('.confirm').hide(); complete(true); });\n            $('#confirmNo').on('click', ()=> { $('.confirm').hide(); complete(false); });\n            \n            $('.confirm').show();\n          });\n        }\n                             \n        const setConfirmInvoice = async () => {\n          const confirm = await ui.confirm(\" " + _this._translate.CONFIRM.confirm_sign_delivery + " \");\n          if(confirm){\n            document.cookie = \"CK_CFM_I=CHECKED; path=/\";\n            window.close();\n          } else{\n          }\n        } \n\n          function closeWin(){\n            window.close();\n          }\n        </script>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\n          </body>\n          </html>\n        ");
                    _this.windowPreviewBeforeSubmit.focus();
                }
                else {
                    _this.windowPreviewBeforeSubmit.close();
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
                sub_24.unsubscribe();
            });
        }
    };
    ReplaceInvoiceComponent.prototype.addNew = function () {
        var inv = Object.assign({}, this.frmData);
        this.frmData = new _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__["InvoiceModel"](1);
        this.frmData.invoice_date = null;
        this.frmData.template_id = inv.template_id;
        this.frmData.invoice_release_id = inv.invoice_release_id;
        this.frmData.payment_method_name = inv.payment_method_name;
        this.frmData.payment_method_view_name = inv.payment_method_view_name;
        this.frmData.currency_code = inv.currency_code;
        this.frmData.template_code = inv.template_code;
        this.frmData.invoice_series = inv.invoice_series;
        this.invoice_products = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_9___default.a({
            key: "id",
            data: this.frmData.invoice_products_data()
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_10___default.a({
            store: this.invoice_products
        });
        this.productGrip.ttDaXuatHoaDon = false;
        this.productGrip.createUpdateEvent();
        this.formInvoice.removeReadonlyAllForm();
        this.formInvoice.emails = [];
        this.ttDaXuatHoaDon = false;
        this.getDataToCompare();
    };
    ReplaceInvoiceComponent.prototype.getDataToCompare = function () {
        var _this = this;
        this.handleFormData();
        this.valueChange = JSON.stringify(this.frmData);
        this.invoice_products.load().then(function (dataSource) {
            _this.jsonProductFirst = JSON.stringify(dataSource);
        });
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_replace_product_grip_replace_product_grip_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceProductGripComponent"]),
        __metadata("design:type", _replace_product_grip_replace_product_grip_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceProductGripComponent"])
    ], ReplaceInvoiceComponent.prototype, "productGrip", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(_replace_form_invoice_replace_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__["ReplaceFormInvoiceComponent"]),
        __metadata("design:type", _replace_form_invoice_replace_form_invoice_component__WEBPACK_IMPORTED_MODULE_5__["ReplaceFormInvoiceComponent"])
    ], ReplaceInvoiceComponent.prototype, "formInvoice", void 0);
    ReplaceInvoiceComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-replace-invoice',
            template: __webpack_require__(/*! ./replace-invoice.component.html */ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.html"),
            styles: [__webpack_require__(/*! ./replace-invoice.component.scss */ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.scss")]
        }),
        __metadata("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_8__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__["VatService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["SocketService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["AuthService"],
            _angular_core__WEBPACK_IMPORTED_MODULE_0__["ChangeDetectorRef"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_11__["TranslateService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            _shared_router_router_library_service__WEBPACK_IMPORTED_MODULE_18__["RouterLibraryService"],
            _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_19__["ConfirmService"],
            ngx_spinner__WEBPACK_IMPORTED_MODULE_22__["NgxSpinnerService"],
            _modules_configs_shared__WEBPACK_IMPORTED_MODULE_23__["ConfigsService"],
            _modules_handle_invoice_shared__WEBPACK_IMPORTED_MODULE_24__["HandleInvoiceService"],
            _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_26__["ViewInvoiceService"],
            _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_27__["MyBsModalService"],
            _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_28__["InvoiceService"]])
    ], ReplaceInvoiceComponent);
    return ReplaceInvoiceComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.html":
/*!********************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.html ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<!-- Phần không tự tính giá trị, nhập mẫu bảng kê -->\r\n<div class=\"row support-invoice\">\r\n  <div class=\"col-md-12\">\r\n    <div class=\"pull-left\">\r\n      <div style=\"float: left;width:  30%; padding-top: 4px\">{{ _translate.CONTROLL.BUTTON.add_row }}</div>\r\n      <div style=\"float: left; width: 30%\">\r\n        <dx-number-box #numberBox [max]=\"100\" [min]=\"1\" [showSpinButtons]=\"true\" [(value)]=\"rowData\"></dx-number-box>\r\n      </div>\r\n      <div>\r\n        <dx-button style=\"height: 27px\" icon=\"fa fa-plus-circle\" type=\"default\" text=\"\" (onClick)=\"addRow()\">\r\n        </dx-button>\r\n      </div>\r\n    </div>\r\n    <div class=\"pull-right\" *ngIf=\"!isPXKDaiLy && !isPXKNB\">\r\n      <!-- Hóa đơn bán hàng NĐ 92 -->\r\n      <dx-check-box *ngIf=\"!isHdGTGT\" [(value)]=\"frmData.is_exemption_decree\" text=\"Giảm thuế theo NĐ số 92/2021\"\r\n        (onValueChanged)=\"_changeND92($event)\"></dx-check-box>\r\n      <div *ngIf=\"!isHdGTGT\" class=\"toggle normal\"\r\n        style=\"display: inline-block; align-items: center;margin-right: 42px;margin-left: 7px;\">\r\n        <img id=\"link3\" style=\"cursor: pointer\" src=\"assets\\img\\icons\\Icon_Information.png\"\r\n          (click)=\"onClickGuidReduce()\" alt=\"efy.vn\" alt=\"Efy.vn\">\r\n      </div>\r\n      <!-- Hóa đơn bán hàng NQ 43 -->\r\n      <dx-check-box *ngIf=\"!isHdGTGT\" style=\"margin-right:20px\" [(value)]=\"frmData.is_resolution_43\"\r\n        text=\"{{ _translate.THONG_TIN.giam_thue_theo_nq43 }}\" (onValueChanged)=\"_changeNQ43($event)\"></dx-check-box>\r\n      <dx-check-box *ngIf=\"configs.system_parameter.view_sale_by_phone\" id=\"auto-input\"\r\n        text=\"{{ _translate.CONTROLL.LABEL.sale_by_phone }}\" [(value)]=\"frmData.sale_by_phone\"></dx-check-box>\r\n      <!-- Tổng tiền từ âm chuyển thành dương -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.BUTTON.total_money_from_negative_to_positive }}\"\r\n        [(value)]=\"frmData.is_total_amount_negative_to_positive\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- Không tự tính -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.no_calculation }}\" [(value)]=\"frmData.auto_value\"\r\n        (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- Tính thành tiền, tiền thuế theo số lượng và tổng tiền -->\r\n      <dx-check-box *ngIf=\"isHdGTGT\" id=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.auto_value_price }}\"\r\n        [(value)]=\"frmData.auto_value_price\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- <a href=\"javascript:void(0)\" (click)=\"layMauBangKe()\" class=\"support-link mgr-15\">\r\n        <img src=\"assets/img/icons/TaiMauBangKe.png\"><span>{{ _translate.CONTROLL.BUTTON.get_the_sample_file }}</span>\r\n      </a>\r\n      <a href=\"javascript:void(0)\" (click)=\"napDuLieuTuBangKe()\" [class.disabled-link]=\"ttDaXuatHoaDon\"\r\n        class=\"support-link\">\r\n        <input type=\"file\" id=\"file-bang-ke\" accept=\".xlsx\" (change)=\"onFileBangKeChange($event)\" multiple=\"false\"\r\n          style=\"display: none;\" />\r\n        <img src=\"assets/img/icons/NapDuLieuBangKe.png\"><span>{{ _translate.CONTROLL.BUTTON.import_data }}</span>\r\n      </a> -->\r\n      <dx-menu [dataSource]=\"extras\" displayExpr=\"name\" orientation=\"horizontal\" submenuDirection=\"auto\"\r\n        (onItemClick)=\"itemExtrasClick($event)\" cssClass='button-dropdown-extend'>\r\n      </dx-menu>\r\n      <input type=\"file\" id=\"file-bang-ke\" accept=\".xlsx\" (change)=\"onFileBangKeChange($event)\" multiple=\"false\"\r\n        style=\"display: none;\" />\r\n    </div>\r\n    <div class=\"pull-right\" *ngIf=\"isPXKDaiLy || isPXKNB\">\r\n      <!-- Tổng tiền từ âm chuyển thành dương -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.BUTTON.total_money_from_negative_to_positive }}\"\r\n        [(value)]=\"frmData.is_total_amount_negative_to_positive\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      <!-- Không tự tính -->\r\n      <dx-check-box id=\"auto-input\" text=\"{{ _translate.CONTROLL.LABEL.no_calculation }}\" [(value)]=\"frmData.auto_value\"\r\n        (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n    </div>\r\n  </div>\r\n</div>\r\n<!-- popup -->\r\n<dx-popup class=\"popup\" [width]=\"350\" [height]=\"175\" [showTitle]=\"true\" title=\"{{ _translate.NOTIFY.notify }}\"\r\n  [dragEnabled]=\"false\" [closeOnOutsideClick]=\"true\" [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <p style=\"margin-bottom: 35px;\">{{ _translate.CONFIRM.import_type }}</p>\r\n    <div class=\"pull-right\">\r\n      <dx-button (click)=\"thayTheToanBo()\" text=\"{{ _translate.CONTROLL.BUTTON.replace_all }}\" type=\"default\">\r\n      </dx-button>\r\n      <dx-button (click)=\"themTiep()\" text=\"{{ _translate.CONTROLL.BUTTON.add_more }}\" type=\"default\"></dx-button>\r\n      <dx-button (click)=\"huy()\" text=\"{{ _translate.CONTROLL.BUTTON.cancel }}\" type=\"default\"></dx-button>\r\n    </div>\r\n  </div>\r\n</dx-popup>\r\n<!-- <button type=\"button\" (click)=\"aa()\">aaa</button> -->\r\n\r\n<!-- phần table hiển thị -->\r\n<div class=\"row invoice-table\">\r\n  <div class=\"col-md-12\">\r\n    <dx-data-grid id=\"gridInvoice\" [dataSource]=\"dataSource\" [showBorders]=\"true\" [showRowLines]=\"true\"\r\n      [allowColumnResizing]=\"true\" [columnResizingMode]=\"true\" [wordWrapEnabled]=\"true\"\r\n      (onKeyDown)=\"onGripKeyDown($event)\" (onContextMenuPreparing)=\"onContextMenuPreparing($event)\"\r\n      (onEditorPrepared)=\"onEditorPrepared($event)\" (onEditorPreparing)=\"onEditorPreparing($event)\"\r\n      (onRowPrepared)=\"onRowPrepared($event)\" (onCellPrepared)=\"onCellPrepared($event)\" *ngIf=\"!isPXKDaiLy && !isPXKNB\" (onContentReady)=\"onContentReady($event)\">\r\n      <!-- [wordWrapEnabled]=\"true\" -->\r\n\r\n      <dxo-editing mode=\"cell\" [allowUpdating]=\"true\"></dxo-editing>\r\n      <!-- <dxo-selection showCheckBoxesMode=\"none\" mode=\"single\"></dxo-selection> -->\r\n      <dxo-sorting mode=\"false\"></dxo-sorting>\r\n      <dxi-column cellTemplate=\"deleteColumn\" [fixed]=\"true\" fixedPosition=\"left\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.delete }}\" minWidth=\"{{ _translate.GRID_WIDTH.delete_column }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"view_order\" [fixed]=\"true\" fixedPosition=\"left\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.view_order }}\" minWidth=\"{{ _translate.GRID_WIDTH.stt }}\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"(extentionGrid && extentionGrid.don_hang_hop_dong) || (configs && configs.system_parameter && configs.system_parameter.display_contract_order)\"\r\n        dataField=\"contract_order\" minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.po_no_contract_no }}\" alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"extentionGrid && extentionGrid.ma_quan_ly\" dataField=\"management_code\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.management_code }}\" alignment=\"left\"></dxi-column>\r\n      <dxi-column dataField=\"product_code\" [editorOptions]=\"editorOptionsForCode\" [fixed]=\"true\" fixedPosition=\"left\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_code }}\" minWidth=\"{{ _translate.GRID_WIDTH.ma_hang }}\"\r\n        alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.productsView\" displayExpr=\"mhvth\" valueExpr=\"code\" itemTemplate=\"item\">\r\n\r\n          <!-- <div *dxTemplate=\"let item of 'item'\">\r\n            <div>\r\n              <div style=\"width:30%; float: left;word-wrap: break-word\">{{item.code }}</div>\r\n              <div style=\"width:65%; float: left;margin-left :10px;word-wrap: break-word\">{{item.name}}</div>\r\n            </div>\r\n    </div> -->\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column dataField=\"product_name\" [fixed]=\"true\" fixedPosition=\"left\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.product_name }}\"\r\n        alignment=\"left\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.incurred_refund_ticket\" cellTemplate=\"PhiHoanVe\"\r\n        caption=\"{{ _translate.CONTROLL.LABEL.refund_fee }}\" minWidth=\"{{ _translate.GRID_WIDTH.cktm }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"((_objTemplateSelect.template_type=='HOA_DON_KINH_DOANH_XE')\r\n                        || (_oTemplateTT78.template_type=='HOA_DON_KINH_DOANH_XE'))\" dataField=\"engine_number\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.engine_number }}\" minWidth=\"{{ _translate.GRID_WIDTH.so_may }}\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect.template_type=='HOA_DON_KINH_DOANH_XE') || (_oTemplateTT78.template_type=='HOA_DON_KINH_DOANH_XE'))\"\r\n        dataField=\"chassis_number\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.chassis_number }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.so_khung }}\" alignment=\"center\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && (_objTemplateSelect.template_type=='HOA_DON_NHA_HANG_KHACH_SAN' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_CHUNG')) || (_oTemplateTT78 && (_oTemplateTT78.template_type=='HOA_DON_NHA_HANG_KHACH_SAN' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_CHUNG')))\"\r\n        cellTemplate=\"phi_dich_vu\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.money_service }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\" [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <!-- Diễn giải -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_promotion\" cellTemplate=\"dien_giai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.explain }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <!-- Khuyến mại -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.promotional_goods_on_the_invoice\" cellTemplate=\"khuyen_mai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.promotion }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_lot\" dataField=\"lot\" minWidth=\"{{ _translate.GRID_WIDTH.lot }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.lot }}\" alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_expiration_date\" dataField=\"expiration_date\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.expiration_date }}\" alignment=\"left\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_country\" [editorOptions]=\"{showClearButton: true}\"\r\n        dataField=\"country_code\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.country }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.country }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.countrys\" displayExpr=\"name\" valueExpr=\"code\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.display_transport_number_from_product\"\r\n        cellTemplate=\"is_transport_number\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.transport_number  }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.is_transport_number  }}\" [allowEditing]=\"false\" alignment=\"center\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.commercial_discount\" cellTemplate=\"cktm\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.commercial_discount }}\" minWidth=\"{{ _translate.GRID_WIDTH.cktm }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_provisions_on_accounts\" dataField=\"provisions_on_accounts\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.provisions_on_accounts }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.dinh_khoan }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.select_provisions_on_accounts\" displayExpr=\"name\" valueExpr=\"code\"\r\n          onValueChanged=\"b($event)\"></dxo-lookup>\r\n      </dxi-column>\r\n      <!-- Màu sắc/ chất liệu -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.color_material\" dataField=\"color_material\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.mau_sac }}\" caption=\"{{ _translate.CONFIGS.color_material }}\"\r\n        alignment=\"left\"></dxi-column>\r\n      <!-- Số tham chiếu -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.items_number\" dataField=\"items_number\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"{{ _translate.CONTROLL.LABEL.reference_number }}\"\r\n        alignment=\"left\"></dxi-column>\r\n      <!-- Ngày -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.complete_order_date\" dataField=\"complete_order_date\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"{{ _translate.CONFIGS.day }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <!-- mpq -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.mpq\" dataField=\"mpq\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"MPQ\" alignment=\"left\"></dxi-column>\r\n      <!-- Đơn vị tính -->\r\n      <dxi-column dataField=\"unit_code\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.unit_code }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.unit_code }}\" alignment=\"center\" [editorOptions]=\"lookupColumnOptions\">\r\n        <dxo-lookup [dataSource]=\"select.unit_codes\" displayExpr=\"name\" valueExpr=\"code\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <!-- Ngày -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.product_date\" dataField=\"product_date\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.han_su_dung }}\" caption=\"{{ _translate.CONFIGS.day }}\" alignment=\"left\">\r\n      </dxi-column>\r\n      <!-- Tỷ giá -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.product_exchange_rate\" dataField=\"product_exchange_rate\"\r\n        headerCellTemplate=\"exchangeRateHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        [editorOptions]=\"{ format: formatter.ty_gia,step: '0' }\" [format]=\"formatter.ty_gia\" dataType=\"number\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column dataField=\"quantity\" headerCellTemplate=\"quantityHeader\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.so_luong }}\" [editorOptions]=\"{ format: formatter.so_luong }\"\r\n        [format]=\"formatter.so_luong\" dataType=\"number\" alignment=\"center\"></dxi-column>\r\n      <!-- Đơn giá sau thuế -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.price_after_vat\" dataField=\"price_after_vat\"\r\n        headerCellTemplate=\"priceaftervatHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        [editorOptions]=\"{ format: formatter.don_gia_sau_thue,step: '0' }\" [format]=\"formatter.don_gia_sau_thue\"\r\n        dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.view_price_nte\" dataField=\"price_nte\"\r\n        headerCellTemplate=\"price_nteHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        [editorOptions]=\"{ format: formatter.don_gia_nte }\" [format]=\"formatter.don_gia_nte\" dataType=\"number\"\r\n        alignment=\"right\"></dxi-column>\r\n      <dxi-column dataField=\"price\" headerCellTemplate=\"priceHeader\" minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\"\r\n        [editorOptions]=\"{ format: formatter.don_gia }\" [format]=\"formatter.don_gia\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && _objTemplateSelect.template_type!='HOA_DON_BAN_GIAO_XE' && _objTemplateSelect.template_type!='HOA_DON_BAO_DUONG_XE')\r\n      || (_oTemplateTT78 && _oTemplateTT78.is_discount && _oTemplateTT78.template_type!='HOA_DON_BAN_GIAO_XE' && _oTemplateTT78.template_type!='HOA_DON_BAO_DUONG_XE'))\"\r\n        dataField=\"amount_without_discount\" headerCellTemplate=\"amountNoDiscountHeader\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.thanh_tien }}\" [editorOptions]=\"{ format: formatter.thanh_tien_chua_ck }\"\r\n        [format]=\"formatter.thanh_tien_chua_ck\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && _objTemplateSelect.template_type!='HOA_DON_BAN_GIAO_XE' && _objTemplateSelect.template_type!='HOA_DON_BAO_DUONG_XE')\r\n      || (_oTemplateTT78 && _oTemplateTT78.is_discount && _oTemplateTT78.template_type!='HOA_DON_BAN_GIAO_XE' && _oTemplateTT78.template_type!='HOA_DON_BAO_DUONG_XE'))\"\r\n        dataField=\"discount\" headerCellTemplate=\"discountHeader\" minWidth=\"{{ _translate.GRID_WIDTH.chiet_khau }}\"\r\n        [editorOptions]=\"{ format: formatter.ty_le_chiet_khau  }\" [format]=\"formatter.ty_le_chiet_khau \"\r\n        dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount) || (_oTemplateTT78 && _oTemplateTT78.is_discount))\"\r\n        dataField=\"amount_discount\" headerCellTemplate=\"amount_discountHeader\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tien_chiet_khau }}\" [editorOptions]=\"{ format: formatter.tien_chiet_khau }\"\r\n        [format]=\"formatter.tien_chiet_khau\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"configs.system_parameter.discount_on_price\" dataField=\"discount_on_price\"\r\n        headerCellTemplate=\"discount_on_priceHeader\" minWidth=\"{{ _translate.GRID_WIDTH.tien_chiet_khau }}\"\r\n        [editorOptions]=\"{ format: formatter.ck_theo_don_gia }\" [format]=\"formatter.ck_theo_don_gia\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && _objTemplateSelect.is_discount && (_objTemplateSelect.template_type=='HOA_DON_BAN_GIAO_XE' || _objTemplateSelect.template_type=='HOA_DON_BAO_DUONG_XE'))\r\n    || (_oTemplateTT78 && _oTemplateTT78.is_discount && (_oTemplateTT78.template_type=='HOA_DON_BAN_GIAO_XE' || _oTemplateTT78.template_type=='HOA_DON_BAO_DUONG_XE'))) || configs.system_parameter.discount_on_price\"\r\n        dataField=\"price_after_discount\" headerCellTemplate=\"priceHeaderAfterDiscount\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.don_gia }}\" [editorOptions]=\"{ format: formatter.don_gia,step: '0' }\"\r\n        [format]=\"formatter.don_gia\" dataType=\"number\" alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"amount\" headerCellTemplate=\"amountHeader\" minWidth=\"{{ _translate.GRID_WIDTH.thanh_tien }}\"\r\n        [editorOptions]=\"{ format: formatter.thanh_tien }\" [format]=\"formatter.thanh_tien\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column cssClass=\"vat-invoices\" *ngIf=\"isHdGTGT\" dataField=\"vat\" [editorOptions]=\"{showClearButton: true}\"\r\n        headerCellTemplate=\"vatHeader\" minWidth=\"{{ _translate.GRID_WIDTH.vat }}\" alignment=\"center\">\r\n        <dxo-lookup [dataSource]=\"select.vats\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"isHdGTGT\" dataField=\"amount_vat\" headerCellTemplate=\"amountVatHeader\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\" [editorOptions]=\"{ format: formatter.tien_thue }\"\r\n        [format]=\"formatter.tien_thue\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && (_objTemplateSelect.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')) || (_oTemplateTT78 && (_oTemplateTT78.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n        dataField=\"other_tax\" caption=\"{{ _translate.CONTROLL.LABEL.othertax  }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\" [editorOptions]=\"{ format: formatter.thanh_tien, step: '0' }\"\r\n        [format]=\"formatter.thanh_tien\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column\r\n        *ngIf=\"((_objTemplateSelect && (_objTemplateSelect.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _objTemplateSelect.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')) || (_oTemplateTT78 && (_oTemplateTT78.template_type=='HOA_DON_VE_MAY_TONG_HOP' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_CHUNG' || _oTemplateTT78.template_type=='HOA_DON_VE_MAY_BAY_HOAN_VE')))\"\r\n        dataField=\"other_charge\" caption=\"{{ _translate.CONTROLL.LABEL.money_other  }}\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tien_thue }}\" [editorOptions]=\"{ format: formatter.thanh_tien, step: '0' }\"\r\n        [format]=\"formatter.thanh_tien\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <dxi-column dataField=\"amount_after_vat\" headerCellTemplate=\"amountAfterVatHeader\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.tong_tien_sau_thue }}\" [editorOptions]=\"{ format: formatter.tong_tien }\"\r\n        [format]=\"formatter.tong_tien\" dataType=\"number\" alignment=\"right\"></dxi-column>\r\n      <!-- config column header -->\r\n      <div *dxTemplate=\"let d of 'exchangeRateHeader'\">\r\n        <p (click)=\"configDecimal('ty_gia')\" style=\"cursor: pointer;\">\r\n          {{ _translate.CONTROLL.LABEL.currency_rate }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'quantityHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.quantity }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeader'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.price }}<img\r\n            src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceaftervatHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_sau_thue')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.price_after_vat }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeaderAfterDiscount'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.price_after_discount }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'price_nteHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_nte')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.price_nte\r\n          }}<img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.amount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'discount_on_priceHeader'\">\r\n        <p (click)=\"configDecimal('ck_theo_don_gia')\" style=\"cursor: pointer;\">\r\n          {{ _translate.GRID.INVOICE_DETAILS.discount_on_price }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountNoDiscountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien_chua_ck')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.amount_without_discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'discountHeader'\">\r\n        <p (click)=\"configDecimal('ty_le_chiet_khau')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amount_discountHeader'\">\r\n        <p (click)=\"configDecimal('tien_chiet_khau')\" style=\"cursor: pointer;\">{{\r\n          _translate.GRID.INVOICE_DETAILS.amount_discount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'vatHeader'\">\r\n        <p>VAT</p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountVatHeader'\">\r\n        <p (click)=\"configDecimal('tien_thue')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.amount_vat\r\n          }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountAfterVatHeader'\">\r\n        <p (click)=\"configDecimal('tong_tien')\" style=\"cursor: pointer;\">{{ _translate.GRID.INVOICE_DETAILS.total_money\r\n          }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'dien_giai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion\" [disabled]=\"d.data.is_promotion_new\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'khuyen_mai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion_new\" [disabled]=\"d.data.is_promotion\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'is_transport_number'\">\r\n        <dx-check-box [(value)]=\"d.data.is_transport_number\" (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'phi_dich_vu'\">\r\n        <dx-check-box [(value)]=\"d.data.is_money_service\" (onValueChanged)=\"changePhiDV(d.data)\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'cktm'\">\r\n        <dx-check-box [(value)]=\"d.data.commercial_discount\" (onValueChanged)=\"changeCKTM(d.data)\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'PhiHoanVe'\">\r\n        <dx-check-box [(value)]=\"d.data.is_refund_ticket\" (onValueChanged)=\"changePhiHoanVe(d.data)\"></dx-check-box>\r\n      </div>\r\n      <!-- config column -->\r\n      <div id=\"context-table\" *dxTemplate=\"let d of 'deleteColumn'\">\r\n        <a class=\"delete-row\" href=\"javascript:void(0)\" (click)=\"deleteRow(d.data)\"><i class=\"fa fa-times\"></i></a>\r\n      </div>\r\n      <dxo-paging [enabled]=\"false\"></dxo-paging>\r\n      <!-- <dxo-scrolling columnRenderingMode=\"virtual\"></dxo-scrolling> -->\r\n      <dxo-remote-operations [sorting]=\"false\" [filtering]=\"false\"></dxo-remote-operations>\r\n    </dx-data-grid>\r\n    <dx-data-grid id=\"gridInvoice\" [dataSource]=\"dataSource\" [showBorders]=\"true\" [showRowLines]=\"true\"\r\n      [allowColumnResizing]=\"true\" [columnResizingMode]=\"true\" [wordWrapEnabled]=\"true\"\r\n      (onKeyDown)=\"onGripKeyDown($event)\" (onContextMenuPreparing)=\"onContextMenuPreparing($event)\"\r\n      (onEditorPrepared)=\"onEditorPrepared($event)\" (onEditorPreparing)=\"onEditorPreparing($event)\"\r\n      (onRowPrepared)=\"onRowPrepared($event)\" (onCellPrepared)=\"onCellPrepared($event)\" *ngIf=\"isPXKDaiLy || isPXKNB\" (onContentReady)=\"onContentReady($event)\">\r\n      <!-- [wordWrapEnabled]=\"true\" (onEditorPrepared)=\"onEditorPrepared($event)\" -->\r\n      <dxo-editing mode=\"cell\" [allowUpdating]=\"true\"></dxo-editing>\r\n      <dxo-sorting mode=\"false\"></dxo-sorting>\r\n      <dxi-column cellTemplate=\"deleteColumn\" caption=\"{{_translate.GRID.INVOICE_DETAILS.delete }}\" width=\"40\"\r\n        [allowEditing]=\"false\" alignment=\"center\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"view_order\" caption=\"{{_translate.GRID.INVOICE_DETAILS.view_order }}\" width=\"40\"\r\n        alignment=\"center\"></dxi-column>\r\n\r\n      <dxi-column dataField=\"product_code\" caption=\"{{_translate.GRID.INVOICE_DETAILS.product_code }}\"\r\n        alignment=\"center\" [editorOptions]=\"editorOptionsForCode\" minWidth=\"{{ _translate.GRID_WIDTH.ma_hang }}\">\r\n        <dxo-lookup [dataSource]=\"select.productsView\" displayExpr=\"mhvth\" valueExpr=\"code\">\r\n          <!-- \"id\" contains the same values as \"authorId\" -->\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column dataField=\"product_name\" caption=\"{{_translate.GRID.INVOICE_DETAILS.product_name }}\" alignment=\"left\"\r\n        minWidth=\"{{ _translate.GRID_WIDTH.ten_hang }}\"></dxi-column>\r\n      <!-- Đơn hàng/ Hợp đồng -->\r\n      <dxi-column\r\n        *ngIf=\"(extentionGrid && extentionGrid.don_hang_hop_dong) || (configs && configs.system_parameter && configs.system_parameter.display_contract_order)\"\r\n        dataField=\"contract_order\" minWidth=\"{{ _translate.GRID_WIDTH.don_hang_hop_dong }}\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.po_no_contract_no }}\" alignment=\"left\"></dxi-column>\r\n      <!-- <dxi-column dataField=\"number_code\" caption=\"{{_translate.GRID.INVOICE_DETAILS.code }}\"\r\n        alignment=\"left\"></dxi-column> -->\r\n      <!-- Diễn giải -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.is_promotion\" cellTemplate=\"dien_giai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.explain }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <!-- Khuyến mại -->\r\n      <dxi-column *ngIf=\"configs.system_parameter.promotional_goods_on_the_invoice\" cellTemplate=\"khuyen_mai\"\r\n        caption=\"{{ _translate.GRID.INVOICE_DETAILS.promotion }}\" minWidth=\"{{ _translate.GRID_WIDTH.dien_giai }}\"\r\n        [allowEditing]=\"false\" alignment=\"center\"></dxi-column>\r\n      <dxi-column dataField=\"unit_code\" caption=\"{{_translate.GRID.INVOICE_DETAILS.unit_code }}\" [width]=\"100\"\r\n        alignment=\"center\" [editorOptions]=\"lookupColumnOptions\">\r\n        <dxo-lookup [dataSource]=\"select.unit_codes\" displayExpr=\"name\" valueExpr=\"code\" onValueChanged=\"b($event)\">\r\n        </dxo-lookup>\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"isPXKDaiLy\" dataField=\"quantity\" headerCellTemplate=\"quantityHeader\" [width]=\"100\"\r\n        [editorOptions]=\"{ format: formatter.so_luong }\" [format]=\"formatter.so_luong\" dataType=\"number\"\r\n        alignment=\"center\"></dxi-column>\r\n      <dxi-column *ngIf=\"!isPXKDaiLy\" dataField=\"number_real_export\" headerCellTemplate=\"quantity_exportHeader\"\r\n        [width]=\"100\" [editorOptions]=\"{ format: formatter.so_luong }\" [format]=\"formatter.so_luong\" dataType=\"number\"\r\n        alignment=\"center\">\r\n      </dxi-column>\r\n      <dxi-column *ngIf=\"!isPXKDaiLy\" dataField=\"number_real_import\" headerCellTemplate=\"quantity_importHeader\"\r\n        [width]=\"100\" [editorOptions]=\"{ format: formatter.so_luong\t }\" [format]=\"formatter.so_luong\" dataType=\"number\"\r\n        alignment=\"center\">\r\n      </dxi-column>\r\n      <!-- <dxi-column *ngIf=\"configs.system_parameter.view_price_nte\" dataField=\"price_nte\" headerCellTemplate=\"price_nteHeader\"\r\n        [width]=\"110\" [editorOptions]=\"{ format: formatter.price_nte }\" [format]=\"formatter.price_nte\" dataType=\"number\"\r\n        alignment=\"right\"></dxi-column> -->\r\n      <dxi-column dataField=\"price\" headerCellTemplate=\"priceHeader\" [width]=\"90\"\r\n        [editorOptions]=\"{ format: formatter.don_gia }\" [format]=\"formatter.don_gia\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n      <dxi-column dataField=\"amount\" headerCellTemplate=\"amountHeader\" [width]=\"109\"\r\n        [editorOptions]=\"{ format: formatter.thanh_tien }\" [format]=\"formatter.thanh_tien\" dataType=\"number\"\r\n        alignment=\"right\">\r\n      </dxi-column>\r\n\r\n      <dxi-column dataField=\"amount_after_vat\" headerCellTemplate=\"amountAfterVatHeader\" [width]=\"150\"\r\n        [editorOptions]=\"{ format: formatter.tong_tien }\" [format]=\"formatter.tong_tien\" dataType=\"number\"\r\n        alignment=\"right\"></dxi-column>\r\n      <!-- config column header -->\r\n      <div *dxTemplate=\"let d of 'quantityHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.quantity }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'priceHeader'\">\r\n        <p (click)=\"configDecimal('don_gia')\" style=\"cursor: pointer;\">{{_translate.GRID.INVOICE_DETAILS.price }}<img\r\n            src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'quantity_exportHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.quantity_export }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'quantity_importHeader'\">\r\n        <p (click)=\"configDecimal('so_luong')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.quantity_import }}<img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'price_nteHeader'\">\r\n        <p (click)=\"configDecimal('don_gia_nte')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.price_nte }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountHeader'\">\r\n        <p (click)=\"configDecimal('thanh_tien')\" style=\"cursor: pointer;\">{{_translate.GRID.INVOICE_DETAILS.amount }}\r\n          <img src=\"assets/img/icons/SoThapPhan.png\">\r\n        </p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'vatHeader'\">\r\n        <p>VAT</p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'dien_giai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion\" [disabled]=\"d.data.is_promotion_new\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'khuyen_mai'\">\r\n        <dx-check-box [(value)]=\"d.data.is_promotion_new\" [disabled]=\"d.data.is_promotion\"\r\n          (onValueChanged)=\"_tinhGiaTri()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountVatHeader'\">\r\n        <p (click)=\"configDecimal('tien_thue')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.amount_vat }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'amountAfterVatHeader'\">\r\n        <p (click)=\"configDecimal('tong_tien')\" style=\"cursor: pointer;\">\r\n          {{_translate.GRID.INVOICE_DETAILS.amount_after_vat }} <img src=\"assets/img/icons/SoThapPhan.png\"></p>\r\n      </div>\r\n      <!-- config column -->\r\n      <div id=\"context-table\" *dxTemplate=\"let d of 'deleteColumn'\">\r\n        <a class=\"delete-row\" href=\"javascript:void(0)\" (click)=\"deleteRow(d.data)\"><i class=\"fa fa-times\"></i></a>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'cktm'\">\r\n        <dx-check-box [(value)]=\"d.data.commercial_discount\" (onValueChanged)=\"cktmChange()\"></dx-check-box>\r\n      </div>\r\n      <div *dxTemplate=\"let d of 'product_code'\">\r\n        <!-- <dx-autocomplete valueExpr=\"code\"\r\n          [dataSource]=\"select.products\" [(value)]=\"d.data.code\">\r\n          <div *dxTemplate=\"let item of 'item'\">\r\n            <span>{{item.mhvth}}</span>\r\n          </div>\r\n        </dx-autocomplete> -->\r\n        <dxi-item editorType=\"dxSelectBox\"\r\n          [editorOptions]=\"{items: select.productsView, displayExpr: 'name', valueExpr: 'code'}\">\r\n        </dxi-item>\r\n      </div>\r\n      <!-- <dxo-summary >\r\n        <dxi-total-item\r\n            summaryType=\"custom\" \r\n            [customizeText]=\"customizeText\"\r\n            showInColumn=\"amount\">\r\n        </dxi-total-item>\r\n      </dxo-summary> -->\r\n      <dxo-paging [enabled]=\"false\"></dxo-paging>\r\n      <dxo-remote-operations [sorting]=\"false\" [filtering]=\"false\"></dxo-remote-operations>\r\n\r\n    </dx-data-grid>\r\n  </div>\r\n</div>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.scss":
/*!********************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.scss ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".delete-row i{color:#0E77BB;font-size:18px}.support-invoice{margin-top:20px;margin-bottom:10px}.support-invoice .support-link{padding:6px 15px;border:1px solid #007bff;text-decoration:none}.support-invoice .support-link.mgr-15{margin-right:15px}.support-invoice .support-link img{margin-right:15px;margin-top:-2px}.support-invoice #auto-input{margin-right:20px !important}.button-dropdown-extend{display:inline-flex}::ng-deep .vat-invoices .dx-texteditor-buttons-container{display:-ms-inline-grid;display:inline-grid}::ng-deep .wrap-column-autoC{padding:0px !important}::ng-deep .wrap-column-autoC .wrap-code-template dx-autocomplete{border:none !important}::ng-deep .wrap-column-autoC .wrap-code-template dx-autocomplete input{text-align:center}::ng-deep .wrap-column-autoC .wrap-name-template dx-autocomplete{border:none !important}::ng-deep .wrap-column-autoC .wrap-name-template dx-autocomplete input{text-align:left}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.ts":
/*!******************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.ts ***!
  \******************************************************************************************************************/
/*! exports provided: ReplaceProductGripComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReplaceProductGripComponent", function() { return ReplaceProductGripComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! xlsx */ "./node_modules/xlsx/xlsx.js");
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(xlsx__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! devextreme/data/custom_store */ "./node_modules/devextreme/data/custom_store.js");
/* harmony import */ var devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _config_sEnum__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @config/sEnum */ "./src/app/config/sEnum.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _modules_products_shared__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @modules/products/shared */ "./src/app/modules/products/shared/index.ts");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @shared/service/invoice.service */ "./src/app/shared/service/invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};













var ReplaceProductGripComponent = /** @class */ (function () {
    function ReplaceProductGripComponent(authService, route, router, modalService, vatService, productsService, invoiceService) {
        var _this = this;
        this.authService = authService;
        this.route = route;
        this.router = router;
        this.modalService = modalService;
        this.vatService = vatService;
        this.productsService = productsService;
        this.invoiceService = invoiceService;
        this.contextMenu = [{ text: 'Thêm' }, { text: 'Xóa' }];
        this.select = {};
        // frmData: InvoiceModel = new InvoiceModel(1);
        this.amount_after_vat = 0;
        this.showPopup = false; // Popup
        this.dataExcelFile = null;
        this.ttDaXuatHoaDon = false;
        this.gripAllowEdit = false;
        this.isHdGTGT = true;
        this.dataExcelFileInfo = null;
        this.extras = [];
        this.rowData = 1;
        this.isPXKDaiLy = false;
        this.isPXKNB = false;
        this.productCodePattern = _config_index__WEBPACK_IMPORTED_MODULE_11__["pattern"].productCodePattern;
        this.gripChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.autoChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.lookupColumnOptions = {
            acceptCustomValue: true,
            showClearButton: true,
            onCustomItemCreating: function (args) {
                var _this = this;
                //
                //
                var newItem = {};
                newItem.code = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(args.text);
                newItem.name = args.text;
                this.select.unit_codes.unshift(newItem);
                setTimeout(function () {
                    _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                        dataSource: _this.select.unit_codes,
                        displayExpr: 'name',
                        valueExpr: 'code'
                    });
                });
                return newItem;
            }.bind(this)
        };
        this.onContentReady = function (e) {
            var arrFooter = [
                { name: _this._translate.GRID.INVOICE_DETAILS.amount_after_vat, class: 'table-footer-1' },
                { name: _this._translate.GRID.INVOICE_DETAILS.total_money, class: 'table-footer-1' },
                { name: _this._translate.GRID.INVOICE_DETAILS.amount_vat, class: 'table-footer-2' },
                { name: _this._translate.GRID.INVOICE_DETAILS.amount, class: 'table-footer-3' },
                { name: _this._translate.GRID.INVOICE_DETAILS.amount_without_discount, class: 'table-footer-4' },
            ];
            _this.invoiceService.formatSumColumnGrid(arrFooter);
        };
        this.editorOptionsForCode = {
            acceptCustomValue: true,
            showClearButton: true,
            onCustomItemCreating: function (args) {
                return _this.invoiceService.addProductInSelecBox(args, _this.select.productsView, _this.dataGrid);
            }
        };
        this._translate = this.authService.getTranslate();
        this.extras = [{
                id: '1',
                name: this._translate.CONTROLL.BUTTON.import_from_excel,
                items: [
                    {
                        id: 'LAY_MAU_BANG_KE',
                        name: this._translate.CONTROLL.BUTTON.get_the_sample_file,
                        icon: this._translate.ICONS.download
                    },
                    {
                        id: 'NAP_DU_LIEU_BANG_KE',
                        name: this._translate.CONTROLL.BUTTON.import_data,
                        icon: this._translate.ICONS.excel
                    }
                ]
            }];
    }
    ReplaceProductGripComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.loaiHoaDon = this.route.snapshot.data.type;
        if (this.loaiHoaDon == '03XKNB')
            this.isPXKNB = true;
        if (this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].loaihoadon.HGDL04)
            this.isPXKDaiLy = true;
        if (this.oldForm.template_code.indexOf('02GTTT') >= 0 || this.oldForm.template_code.indexOf('07KPTQ') >= 0 || this.oldForm.template_code == "2") {
            this.isHdGTGT = false;
        }
        this.configs = this.authService.getConfigs();
        this.routeSub = this.route.data.subscribe(function (data) {
            // put data DM for select
            _this.select.unit_codes = data.init[1].DM_DON_VI_TINH;
            _this.select.vats = data.init[1].DM_TY_LE_VAT;
            _this.select.select_provisions_on_accounts = data.init[1].DM_DINH_KHOAN;
            _this.select.countrys = data.init[1].DM_QUOC_GIA;
            // Hàng hóa dịch vụ
            _this.select.products = data.init[2];
            _this.select.products.forEach(function (item) {
                item.mhvth = item.code + ': ' + item.name;
                item.vat = item.vat != null ? item.vat.toString() : null;
            });
            if (data.init[4]) {
                if (data.init[4].invoice_products) {
                    _this.invoiceService.addProductInListP(_this.select.products, data.init[4].invoice_products, 'code', 'mhvth');
                    data.init[4].invoice_products.forEach(function (item) {
                        if (item.product_name && item.unit_code) {
                            var obj1 = _this.select.unit_codes.filter(function (p) { return p.code === item.unit_code; })[0];
                            if (!obj1) {
                                _this.select.unit_codes.push({
                                    id: _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].makeid(),
                                    code: item.unit_code,
                                    name: item.unit_name ? item.unit_name : item.unit_code
                                });
                            }
                        }
                    });
                }
            }
            _this.select.productsView = {
                store: new devextreme_data_custom_store__WEBPACK_IMPORTED_MODULE_5___default.a({
                    key: 'code',
                    loadMode: 'raw',
                    load: function (loadOptions) {
                        return _this.select.products;
                    },
                    byKey: function (key) {
                        var _data = data.init[2].filter(function (p) { return p.code === key.toString(); });
                        return _data;
                    }
                }),
                paginate: true,
                sort: 'name'
            };
        });
        // Event
        this.createUpdateEvent();
    };
    // khởi tạo sự kiện khi update
    ReplaceProductGripComponent.prototype.createUpdateEvent = function () {
        var _this = this;
        var product = this.invoice_products;
        setTimeout(function () {
            _this.invoice_products.on('updated', function (key, value) {
                var column = Object.keys(value)[0];
                _this.invoice_products.byKey(key).then(function (row) {
                    switch (column) {
                        case 'view_order':
                            _this.view_orderChange();
                            break;
                        case 'product_code':
                            _this.product_codeChange(row);
                            break;
                        case 'unit_code':
                            _this.unit_codeChange(row);
                            break;
                        case 'country_code':
                            _this.country_codeChange(row);
                            break;
                        case 'quantity':
                        case 'number_real_export':
                        case 'number_real_import':
                        case 'price':
                        case 'price_nte':
                        case 'amount':
                        case 'amount_vat':
                        case 'amount_after_vat':
                        case 'amount_discount':
                        case 'discount':
                        case 'amount_without_discount':
                        case 'other_tax':
                        case 'other_charge':
                            _this._tinhGiaTri();
                            break;
                        case 'price_after_vat':
                            if ((row.vat == 5 || row.vat == 10) && row.price_after_vat)
                                row.price = (row.price_after_vat / (1 + row.vat / 100));
                            else
                                row.price = row.price_after_vat;
                            _this._tinhGiaTri();
                            break;
                        case 'vat':
                            if (_this.configs.system_parameter.price_after_vat) {
                                if ((row.vat == 5 || row.vat == 10) && row.price_after_vat)
                                    row.price = (row.price_after_vat / (1 + row.vat / 100));
                                else
                                    row.price = row.price_after_vat;
                            }
                            _this._tinhGiaTri();
                            break;
                        default:
                            break;
                    }
                }, function (error) {
                    alert(error);
                });
            });
        }, 100);
    };
    ReplaceProductGripComponent.prototype.onGripKeyDown = function (e) {
        if (e.event.code === 'Delete') {
            e.event.srcElement.value = null;
        }
    };
    ReplaceProductGripComponent.prototype.onRowPrepared = function (e) {
        if (e.rowType === 'data') {
            e.rowElement.style.whiteSpace = 'pre-wrap';
            var eles = e.rowElement.getElementsByTagName('td');
            if (!e.isEditing) {
                eles[2].innerHTML = e.data.product_code;
            }
            if (e.data.error) {
                var ele = eles[eles.length - 1];
                ele.style.background = 'red url(\'assets/img/icons/fa-remove.png\') no-repeat 2% center';
                ele.title = e.data.error;
            }
        }
    };
    ReplaceProductGripComponent.prototype.onCellPrepared = function (e) {
        if (e.rowType == "data") {
            if (e.column.dataField == "product_code") {
                if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(e.data.product_code) != "" && !this.productCodePattern.test(e.data.product_code)) {
                    e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                    e.cellElement.title = this._translate.VALIDATION.required_productCode;
                }
            }
        }
    };
    ReplaceProductGripComponent.prototype.onEditorPreparing = function (e) {
        if (e.parentType === 'dataRow') {
            if (e.dataField === 'product_code') {
                e.editorOptions.onOpened = function (arg) {
                    var popupInstance = arg.component._popup;
                    popupInstance.option('width', 400);
                    popupInstance.option('minWidth', 400);
                    // popupInstance.off("optionChanged", this.optionChangedHandler);
                    // popupInstance.on("optionChanged", this.optionChangedHandler);
                };
            }
            if (e.dataField === 'product_name') {
                e.editorName = 'dxTextArea';
            }
            // e.editorOptions.onFocusOut = (args) => {
            //   if (e.dataField === 'unit_code') {
            //     if (this.select.unit_codes) {
            //       const _obj = this.select.unit_codes.filter(p => p.code === e.row.data.unit_code)[0];
            //       if (_obj) {
            //         e.row.data.unit_name = _obj.name;
            //       } else {
            //         e.row.data.unit_name = 'fdsfsd';
            //       }
            //     }
            //   }
            //   if (e.dataField === 'country_code') {
            //     const _obj = this.select.countrys.filter(p => p.code === e.row.data.country_code)[0];
            //     if (_obj) {
            //       e.row.data.country_name = _obj.name;
            //     } else {
            //       e.row.data.country_name = '';
            //     }
            //   }
            //   this.invoice_products.update(e.row.data.id, e.row.data);
            // };
        }
    };
    ReplaceProductGripComponent.prototype.onEditorPrepared = function (e) {
        if ((e.dataField === 'amount_without_discount' || e.dataField === 'discount' || e.dataField === 'amount_discount' || e.dataField === 'quantity' || e.dataField === 'price' || e.dataField === 'amount' || e.dataField === 'amount_vat' || e.dataField === 'amount_after_vat') && e.parentType === 'dataRow') {
            e.editorElement.childNodes[1].firstChild.onwheel = function (evt) {
                e.component.cancelEditData();
            };
            e.editorElement.childNodes[1].firstChild.addEventListener('select', function () {
                this.selectionStart = this.selectionEnd;
            }, false);
        }
    };
    ReplaceProductGripComponent.prototype.onContextMenuPreparing = function (e) {
        var _this = this;
        if (e.row && e.row.rowType === 'data') {
            e.items = [{
                    text: 'Thêm hàng',
                    onItemClick: function () {
                        _this.addRow(e.row.rowIndex);
                    }
                },
                {
                    text: 'Xóa hàng',
                    onItemClick: function () {
                        _this.deleteRow(e.row.data);
                    }
                }];
        }
    };
    /* Thêm dòng hàng hóa */
    ReplaceProductGripComponent.prototype.addRow = function (rowIndexFocus) {
        if (rowIndexFocus >= 0) {
            var rowIndex = rowIndexFocus + 1;
            var data = this.frmData.add_invoice_products_data(rowIndex, rowIndex);
            if (data) {
                this.invoice_products._array.splice(rowIndex, 0, data);
                var order_1 = 0;
                this.invoice_products._array.forEach(function (item) {
                    item.order = ++order_1;
                    item.view_order = item.order;
                });
            }
        }
        else {
            var len_1, order = void 0, orderLast_1;
            this.invoice_products.load().then(function (dataSource) {
                len_1 = dataSource.length;
                orderLast_1 = dataSource[len_1 - 1].order;
            });
            for (var i = 0; i < this.rowData; i++) {
                if (len_1 >= 1) {
                    order = ++orderLast_1;
                }
                else {
                    order = 1;
                }
                var data = this.frmData.add_invoice_products_data(order, order);
                this.invoice_products.insert(data);
            }
        }
        this.dataSource.reload();
    };
    ReplaceProductGripComponent.prototype.view_orderChange = function () {
        var _this = this;
        if (!this.isTT78) {
            var _index_1 = 0;
            this.dataSource.items().forEach(function (item) {
                if (item.view_order && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) != _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    item.view_order = ++_index_1;
                }
                if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    if (!item.is_money_service) {
                        item.view_order = ++_index_1;
                    }
                    else {
                        item.view_order = null;
                    }
                }
            });
        }
        else {
            var _index_2 = 0;
            this.dataSource.items().forEach(function (item) {
                if (item.view_order && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) != _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    item.view_order = ++_index_2;
                }
                if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonNhaHangKhachSan) {
                    if (!item.is_money_service) {
                        item.view_order = ++_index_2;
                    }
                    else {
                        item.view_order = null;
                    }
                }
            });
        }
    };
    // Thay đổi cột mã hàng
    ReplaceProductGripComponent.prototype.product_codeChange = function (row) {
        var _this = this;
        this.select.products.some(function (item) {
            if (item.code === row.product_code && !item.notCallApi) {
                _this.productsService.getProduct(item.id).subscribe(function (rs) {
                    if (rs.status == "success") {
                        var product = rs.data.product;
                        if (product) {
                            row.product_name = product.name;
                            row.unit_code = _this.checkUnitCode(product.unit_code);
                            row.quantity = null;
                            if (_this.isHdGTGT)
                                row.vat = product.vat != null ? product.vat.toString() : null;
                            if (_this.configs.system_parameter.price_after_vat) {
                                row.price_after_vat = product.price ? parseFloat(product.price) : product.price;
                                if ((row.vat == 5 || row.vat == 10) && row.price_after_vat)
                                    row.price = (row.price_after_vat / (1 + row.vat / 100));
                                else
                                    row.price = row.price_after_vat;
                            }
                            else
                                row.price = product.price ? parseFloat(product.price) : product.price;
                            row.amount = product.price ? parseFloat(product.price) : 0;
                            if (_this.isHdGTGT) {
                                row.amount_vat = (row.vat >= 0) ? _this.caculatorAmountVat(row.amount, row.vat) : null;
                                row.amount_after_vat = row.amount + row.amount_vat;
                            }
                            else {
                                row.amount_after_vat = row.amount;
                            }
                            _this.invoice_products.update(row.order, row);
                            _this._tinhGiaTri();
                            return true;
                        }
                    }
                    else {
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(rs.message, 'error');
                    }
                });
            }
        });
    };
    ReplaceProductGripComponent.prototype.unit_codeChange = function (row) {
        var _obj = this.select.unit_codes.filter(function (p) { return p.code === row.unit_code; })[0];
        if (_obj) {
            row.unit_name = _obj.name;
            this.invoice_products.update(row.id, row);
        }
        else {
            row.unit_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    ReplaceProductGripComponent.prototype.country_codeChange = function (row) {
        var _obj = this.select.countrys.filter(function (p) { return p.code === row.country_code; })[0];
        if (_obj) {
            row.country_name = _obj.name;
            this.invoice_products.update(row.id, row);
        }
        else {
            row.country_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    ReplaceProductGripComponent.prototype.checkUnitCode = function (unitCode) {
        var items = this.select.unit_codes;
        for (var i = 0; i < items.length; i++) {
            if (items[i].code === unitCode) {
                return unitCode;
            }
        }
        return null;
    };
    ReplaceProductGripComponent.prototype._tinhGiaTri = function () {
        var _this = this;
        // this.dataSource.store().reload();
        if (!this.isTT78) {
            if (this.loaiHoaDon == '03XKNB' || this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].loaihoadon.HGDL04) {
                setTimeout(function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, null, _this.configs.system_parameter);
                    _this.amount_after_vat = _this.frmData.amount_after_vat;
                }, 100);
            }
            else {
                setTimeout(function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._objTemplateSelect, _this.configs.system_parameter);
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBay
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayChung
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayHoanVe
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonXangDau) {
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._objTemplateSelect.template_type));
                    }
                }, 100);
            }
        }
        else {
            if (this.loaiHoaDon == '03XKNB' || this.loaiHoaDon == _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].loaihoadon.HGDL04) {
                setTimeout(function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, null, _this.configs.system_parameter);
                    _this.amount_after_vat = _this.frmData.amount_after_vat;
                }, 100);
            }
            else {
                setTimeout(function () {
                    _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyItem(_this.dataSource, _this.invoice_products, _this.frmData, _this.formatter, !_this.frmData.auto_value, _this.frmData.auto_value_price, _this.select, _this._oTemplateTT78, _this.configs.system_parameter);
                    if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBay
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayHoanTien
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayThuTien
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayChung
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayHoanVe
                        || _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type) === _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonXangDau) {
                        _core_index__WEBPACK_IMPORTED_MODULE_7__["VChanggeMoneyService"]._changeMoneyTicket(_this.frmData, _this.formatter, _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(_this._oTemplateTT78.template_type));
                    }
                }, 100);
            }
        }
        // this.invoice_products = this.dataSource.items();
    };
    ReplaceProductGripComponent.prototype.caculatorAmountVat = function (amount, vat) {
        var temp = amount / 100 * vat;
        return this.roundNumber(temp, 5);
    };
    ReplaceProductGripComponent.prototype.roundNumber = function (number, n) {
        var p = Math.pow(10, n);
        return Math.round(number * p) / p;
    };
    // Bật modal thay đổi số thập phân
    ReplaceProductGripComponent.prototype.configDecimal = function (n) {
        var _this = this;
        var initialState = {
            column: n,
            formatter: this.formatter,
            showDonGiaNte: this.configs.system_parameter.view_price_nte
        };
        this.bsModalRef = this.modalService.show(_shared_index__WEBPACK_IMPORTED_MODULE_8__["ConfigDecimalComponent"], {
            class: 'modal-lg', initialState: initialState, backdrop: 'static',
            keyboard: false
        });
        this.modalService.onHide.subscribe(function () {
            var data = _this.bsModalRef.content.successSaveItem;
            if (data) {
                _this.formatter[data.column] = data.character;
                _this._tinhGiaTri();
            }
        });
    };
    // Xóa hàng
    ReplaceProductGripComponent.prototype.deleteRow = function (item) {
        var _this = this;
        // setTimeout(() => {
        var check = confirm('Bạn có đồng ý xóa không?');
        if (check && !this.ttDaXuatHoaDon) {
            setTimeout(function () {
                _this.invoice_products.remove(item.id);
                // this.dataSource.store().remove(item.id);
                _this.dataSource.reload();
                _this._tinhGiaTri();
            });
        }
        // }, 200);
    };
    ReplaceProductGripComponent.prototype.updateSomeTotalInputNotCheckCktm = function () {
        var _this = this;
        setTimeout(function () {
            _this.gripChange.emit([_this.dataSource, _this.invoice_products, _this.formatter]);
        }, 200);
    };
    // Lấy mẫu bảng kê
    ReplaceProductGripComponent.prototype.layMauBangKe = function () {
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].showloading();
        var fields = [];
        if (!this.isTT78) {
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayChung
                && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayHoanVe) {
                fields.push("other_tax");
                fields.push("other_charge");
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._objTemplateSelect.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonKinhDoanhXe) {
                fields.push("engine_number");
                fields.push("chassis_number");
            }
        }
        else {
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayTongHop
                && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayChung
                && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonVeMayBayHoanVe) {
                fields.push("other_tax");
                fields.push("other_charge");
            }
            if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(this._oTemplateTT78.template_type) !== _config_sEnum__WEBPACK_IMPORTED_MODULE_6__["sEnum"].templatetype.HoaDonKinhDoanhXe) {
                fields.push("engine_number");
                fields.push("chassis_number");
            }
            if (!this.configs.system_parameter.view_expiration_date)
                fields.push("expiration_date");
            if (!this.configs.system_parameter.view_lot)
                fields.push("lot");
            if (!this.configs.system_parameter.promotional_goods_on_the_invoice)
                fields.push("is_promotion_new");
            if (!this.configs.system_parameter.is_promotion)
                fields.push("is_promotion");
        }
        if (!this.configs.system_parameter.product_exchange_rate)
            fields.push("product_exchange_rate");
        if (!this.configs.system_parameter.product_date)
            fields.push("product_date");
        // if (this.configs && this.configs.system_parameter && this.configs.system_parameter.display_contract_order)
        //   fields.push("contract_order");
        if (!this.extentionGrid || (this.extentionGrid && !this.extentionGrid.ma_quan_ly)) {
            fields.push("management_code");
        }
        this.vatService.layFileMau({
            customer_name: this.frmData.customer_name,
            buyer_tax_code: this.frmData.buyer_tax_code,
            buyer_address: this.frmData.buyer_address,
            buyer_name: this.frmData.buyer_name,
            invoice_type_name: "",
            hiddens: fields
        }).subscribe(function (rs) {
            if (rs.status === 'success') {
                var file = rs.data.invoice;
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify(rs.message, 'error');
            }
        }, function (err) {
        }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
        });
    };
    // Nạp dữ liệu bảng kê
    ReplaceProductGripComponent.prototype.napDuLieuTuBangKe = function () {
        document.getElementById('file-bang-ke').click();
    };
    ReplaceProductGripComponent.prototype.onFileBangKeChange = function (evt) {
        var _this = this;
        var target = (evt.target);
        if (target.files.length !== 1) {
            throw new Error('Không thể chọn nhiều file');
        }
        var reader = new FileReader();
        reader.onload = function (e) {
            /* read workbook */
            var bstr = e.target.result;
            var wb = xlsx__WEBPACK_IMPORTED_MODULE_4__["read"](bstr, { type: 'binary' });
            /* grab first sheet */
            var wsname = wb.SheetNames[0];
            var ws = wb.Sheets[wsname];
            /* save data */
            var data = (xlsx__WEBPACK_IMPORTED_MODULE_4__["utils"].sheet_to_json(ws, { header: 'A', range: 9 }));
            var account = (xlsx__WEBPACK_IMPORTED_MODULE_4__["utils"].sheet_to_json(ws, { header: 'A', range: 0 }));
            var fileBangKe = document.getElementById('file-bang-ke');
            fileBangKe.value = '';
            var _arrData = [];
            if (data && data[0]) {
                var columnsName = data.map(function (e) { return e.A; });
                var _index = columnsName.indexOf("view_order");
                if (_index == -1) {
                    _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].notify("File mẫu không đúng định dạng. Vui lòng nhấn vào Tại đây để lấy lại file mẫu", "error");
                    return false;
                }
                else {
                    if (_index > 0) {
                        data.splice(0, _index);
                    }
                    for (var i = 1; i < data.length; i++) {
                        var _row = {};
                        for (var key in data[i]) {
                            if (data[i].hasOwnProperty(key)) {
                                var column = data[0][key];
                                var value = data[i][key];
                                _row[column] = value;
                            }
                        }
                        _arrData.push(_row);
                    }
                }
            }
            _this.dataExcelFile = _arrData;
            _this.dataExcelFileInfo = account.slice(0, 4);
            _this.showPopup = true;
        };
        reader.readAsBinaryString(target.files[0]);
    };
    ReplaceProductGripComponent.prototype.thayTheToanBo = function () {
        this.fillData(this.dataExcelFile, this.dataExcelFileInfo, 'thaythe');
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    ReplaceProductGripComponent.prototype.themTiep = function () {
        this.fillData(this.dataExcelFile, this.dataExcelFileInfo, 'themtiep');
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    ReplaceProductGripComponent.prototype.huy = function () {
        this.showPopup = false;
        this.dataExcelFile = null;
    };
    ReplaceProductGripComponent.prototype.fillData = function (fileData, info, status) {
        var _this = this;
        if (info.length === 4) {
            var customer_name = info[0].A.split(':');
            if (customer_name.length > 1 && customer_name[1].trim() != '') {
                this.frmData.customer_name = customer_name[1].trim();
            }
            ////
            var buyer_tax_code = info[1].A.split(':');
            if (buyer_tax_code.length > 1 && buyer_tax_code[1].trim() != '') {
                this.frmData.buyer_tax_code = buyer_tax_code[1].trim();
            }
            ////
            var buyer_name = info[2].A.split(':');
            if (buyer_name.length > 1 && buyer_name[1].trim() != '') {
                this.frmData.buyer_name = buyer_name[1].trim();
            }
            ////
            var buyer_address = info[3].A.split(':');
            if (buyer_address.length > 1 && buyer_address[1].trim() != '') {
                this.frmData.buyer_address = buyer_address[1].trim();
            }
        }
        if (status === 'thaythe') {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    _this.invoice_products.remove(item.id);
                });
            });
        }
        else {
            this.invoice_products.load().then(function (dataSource) {
                dataSource.forEach(function (item, index) {
                    if (!item.product_code && !item.product_name && !item.quantity && !item.price && !item.amount && !item.amount_vat && !item.amount_after_vat) {
                        _this.invoice_products.remove(item.id);
                    }
                });
            });
        }
        fileData.forEach(function (element) {
            if (element.product_name) {
                var invoice_1 = new Object;
                invoice_1["id"] = _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].makeid();
                invoice_1["view_order"] = element.view_order ? parseInt(element.view_order) : null;
                invoice_1["product_code"] = element.product_code ? element.product_code : "";
                invoice_1["product_name"] = element.product_name ? element.product_name : "";
                invoice_1["unit_code"] = element.unit_name ? _this.getUnitCodeByUnitName(element.unit_name) : "";
                invoice_1["unit_name"] = element.unit_name ? element.unit_name : "";
                invoice_1["quantity"] = element.quantity ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.quantity) : null;
                invoice_1["vat"] = (element.vat && _this.isHdGTGT) ? element.vat : null;
                invoice_1["contract_order"] = element.contract_order ? element.contract_order : "";
                invoice_1["is_refund_ticket"] = element.is_refund_ticket && (element.is_refund_ticket == "X" || element.is_refund_ticket == "x") ? true : false;
                invoice_1["is_promotion"] = element.is_promotion && (element.is_promotion == "X" || element.is_promotion == "x") ? true : false;
                invoice_1["is_promotion_new"] = element.is_promotion_new && (element.is_promotion_new == "X" || element.is_promotion_new == "x") ? true : false;
                invoice_1["lot"] = element.lot ? element.lot : null;
                invoice_1["expiration_date"] = element.expiration_date ? element.expiration_date : null;
                if (element.price) {
                    if (_this.configs.system_parameter.price_after_vat) {
                        invoice_1["price_after_vat"] = element.price ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.price) : null;
                        if ((invoice_1["vat"] == 5 || invoice_1["vat"] == 10 || invoice_1["vat"] == 7 || invoice_1["vat"] == 3.5) && invoice_1["price_after_vat"] !== null)
                            invoice_1["price"] = (invoice_1["price_after_vat"] / (1 + invoice_1["vat"] / 100));
                        else
                            invoice_1["price"] = invoice_1["price_after_vat"];
                    }
                    else
                        invoice_1["price"] = element.price ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.price) : null;
                }
                invoice_1["amount"] = element.amount ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.amount) : null;
                invoice_1["amount_vat"] = element.amount_vat ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.amount_vat) : null;
                // invoice["note"] = element.note ? element.note : null;
                invoice_1["other_tax"] = element.other_tax ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.other_tax) : null;
                invoice_1["other_charge"] = element.other_charge ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.other_charge) : null;
                invoice_1["product_exchange_rate"] = element.product_exchange_rate ? _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].toNumber(element.product_exchange_rate) : null;
                invoice_1["product_date"] = element.product_date ? element.product_date : null;
                invoice_1["engine_number"] = element.engine_number ? element.engine_number : null;
                invoice_1["chassis_number"] = element.chassis_number ? element.chassis_number : null;
                invoice_1["management_code"] = element.management_code ? element.management_code : null;
                if (invoice_1["amount_vat"] !== null && invoice_1["amount"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_vat"] + invoice_1["amount"];
                else if (invoice_1["amount"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount"];
                else if (invoice_1["amount_vat"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_vat"];
                else
                    invoice_1["amount_after_vat"] = null;
                if (invoice_1["other_tax"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_after_vat"] + invoice_1["other_tax"];
                if (invoice_1["other_charge"] !== null)
                    invoice_1["amount_after_vat"] = invoice_1["amount_after_vat"] + invoice_1["other_charge"];
                var _obj = _this.select.products.filter(function (p) { return p.code === invoice_1["product_code"]; })[0];
                if (!_obj && invoice_1["product_code"] !== '') {
                    var _objPush = {
                        code: invoice_1["product_code"],
                        name: invoice_1["product_name"],
                        mhvth: invoice_1["product_code"] + ': ' + invoice_1["product_name"],
                    };
                    _this.select.products.push(_objPush);
                }
                invoice_1["commercial_discount"] = false;
                _this.invoice_products.insert(invoice_1);
            }
        });
        setTimeout(function () {
            _this.dataGrid.instance.columnOption('unit_code', 'lookup', {
                dataSource: _this.select.unit_codes,
                displayExpr: 'name',
                valueExpr: 'code'
            });
        });
        this.dataGrid.instance.refresh();
        this._tinhGiaTri();
        _core_index__WEBPACK_IMPORTED_MODULE_7__["Library"].hideloading();
    };
    ReplaceProductGripComponent.prototype.getUnitCodeByUnitName = function (unitName) {
        if (_core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(unitName) !== '') {
            if (this.select.unit_codes && this.select.unit_codes.length > 0) {
                var _obj = this.select.unit_codes.filter(function (p) { return p.name === unitName; })[0];
                if (_obj) {
                    return _obj.code;
                }
                else {
                    var code_1 = _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._convertToViKdau(unitName);
                    var oDuplicate = this.select.unit_codes.filter(function (p) { return p.code === code_1; })[0];
                    if (oDuplicate)
                        code_1 = code_1 + _core_index__WEBPACK_IMPORTED_MODULE_7__["Helper"].addtionalUnitCode();
                    this.select.unit_codes.push({ code: code_1, name: unitName });
                    return code_1;
                }
            }
            else {
                this.select.unit_codes = [];
            }
        }
        return null;
    };
    ReplaceProductGripComponent.prototype.ngOnDestroy = function () {
        this.routeSub.unsubscribe();
    };
    ReplaceProductGripComponent.prototype.changePhiDV = function (row) {
        this.view_orderChange();
        if (row.is_money_service) {
            row.commercial_discount = false;
        }
        if (row.is_money_service && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(row.product_name) === '') {
            row.product_name = 'Phí dịch vụ';
            this.invoice_products.update(row.id, row);
        }
        else if (!row.is_money_service && _core_index__WEBPACK_IMPORTED_MODULE_7__["VStringService"]._getValueToString(row.product_name) === 'Phí dịch vụ') {
            row.product_name = '';
            this.invoice_products.update(row.id, row);
        }
    };
    ReplaceProductGripComponent.prototype.changeCKTM = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    ReplaceProductGripComponent.prototype.changePhiHoanVe = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    ReplaceProductGripComponent.prototype.itemExtrasClick = function (e) {
        if (e.itemData.id === 'LAY_MAU_BANG_KE') {
            this.layMauBangKe();
        }
        else if (e.itemData.id === 'NAP_DU_LIEU_BANG_KE') {
            this.napDuLieuTuBangKe();
        }
    };
    ReplaceProductGripComponent.prototype.onClickGuidReduce = function () {
        this.router.navigate([]).then(function (result) { window.open('https://ihoadon.vn/hddt/danh-muc-hang-hoa-dich-vu-duoc-giam-thue-gtgt-theo-nghi-quyet-so-406-nq-ubtvqh15.html', '_blank'); });
    };
    ReplaceProductGripComponent.prototype._changeND92 = function (e) {
        if (e.value)
            this.frmData.is_resolution_43 = !e.value;
        this._tinhGiaTri();
    };
    ReplaceProductGripComponent.prototype._changeNQ43 = function (e) {
        if (e.value) {
            this.frmData.is_exemption_decree = !e.value;
            if (this.frmData.sales_percentage == null && parseInt(this.configs.system_parameter.value_rate_percent) > 0) {
                this.frmData.sales_percentage = parseInt(this.configs.system_parameter.value_rate_percent);
            }
        }
        else {
            this.frmData.sales_percentage = null;
        }
        this._tinhGiaTri();
    };
    ReplaceProductGripComponent.prototype.cktmChange = function (row) {
        if (row.commercial_discount) {
            row.is_money_service = false;
        }
        this._tinhGiaTri();
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxDataGridComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_3__["DxDataGridComponent"])
    ], ReplaceProductGripComponent.prototype, "dataGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "dataSource", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "invoice_products", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "formatter", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "_objTemplateSelect", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "oldForm", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "frmData", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "extentionGrid", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Boolean)
    ], ReplaceProductGripComponent.prototype, "isTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Input"])(),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "_oTemplateTT78", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('gripChange'),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "gripChange", void 0);
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Output"])('autoChange'),
        __metadata("design:type", Object)
    ], ReplaceProductGripComponent.prototype, "autoChange", void 0);
    ReplaceProductGripComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'replace-vat-product-grip',
            template: __webpack_require__(/*! ./replace-product-grip.component.html */ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.html"),
            styles: [__webpack_require__(/*! ./replace-product-grip.component.scss */ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_7__["AuthService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["ActivatedRoute"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_2__["BsModalService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_9__["VatService"],
            _modules_products_shared__WEBPACK_IMPORTED_MODULE_10__["ProductsService"],
            _shared_service_invoice_service__WEBPACK_IMPORTED_MODULE_12__["InvoiceService"]])
    ], ReplaceProductGripComponent);
    return ReplaceProductGripComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.html":
/*!******************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.html ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<form (ngSubmit)=\"onSubmit($event)\">\r\n    <div class=\"modal-header\">\r\n      <h4 class=\"modal-title pull-left\">BIÊN BẢN ĐIỀU CHỈNH HÓA ĐƠN SAI SÓT</h4>\r\n      <button type=\"button\" class=\"close pull-right\" aria-label=\"Close\" (click)=\"dong()\">\r\n        <span aria-hidden=\"true\">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"modal-body\">\r\n      <h3 class=\"title\">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</h3>\r\n      <h3 class=\"title\">Độc lập – Tự do – Hạnh phúc</h3>\r\n      <h3 class=\"title\">—oOo—</h3>\r\n      <h3 class=\"title\">BIÊN BẢN ĐIỀU CHỈNH HÓA ĐƠN SAI SÓT</h3>\r\n      <h3 class=\"title\">Số: {{frmData.doc_relate_symbol}} / BBSS</h3>\r\n      <ul>\r\n        <li>\r\n            - Căn cứ  Điều 20, Thông tư: 39/2014/TT-BTC của Bộ Tài chính.\r\n        </li>\r\n        <li>\r\n            - Căn cứ Điều 9, Thông tư 32/2011/TT-BTC của Bộ Tài chính\r\n        </li>\r\n        <li>\r\n          Hôm nay, {{ngayVB}} đại diện hai bên gồm có:\r\n        </li>\r\n      </ul>\r\n      <dx-form [formData]=\"oldForm\" validationGroup=\"formData\">\r\n        <dxi-item class=\"label-text\" dataField=\"customer_name\" [label]=\"{text: 'Bên A'}\">\r\n        </dxi-item>\r\n        <dxi-item dataField=\"buyer_address\" [label]=\"{text: 'Địa chỉ'}\">\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item class=\"label-text\" dataField=\"buyer_tax_code\" [label]=\"{text: 'Mã số thuế'}\">\r\n          </dxi-item>\r\n          <dxi-item class=\"label-text\" dataField=\"buyer_mobile\" [label]=\"{text: 'Điện thoại'}\" [editorOptions]=\"{disabled: false}\">\r\n          </dxi-item>\r\n          <dxi-item class=\"label-text\" dataField=\"\" [label]=\"{text: 'Người đại diện'}\" [editorOptions]=\"{disabled: true}\">\r\n          </dxi-item>\r\n          <dxi-item class=\"label-text\" dataField=\"\" [label]=\"{text: 'Chức vụ'}\" [editorOptions]=\"{disabled: true}\">\r\n          </dxi-item>\r\n        </dxi-item>\r\n        \r\n      </dx-form>\r\n      <br/>\r\n      <dx-form [formData]=\"benB\" validationGroup=\"formData\">\r\n      <dxi-item class=\"label-text\" dataField=\"name\" [label]=\"{text: 'Bên B'}\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"business_address\" [label]=\"{text: 'Địa chỉ' }\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n          <dxi-item class=\"label-text\" dataField=\"tax_code\" [label]=\"{text: 'Mã số thuế', class:'label-text' }\" [editorOptions]=\"{disabled: true}\">\r\n          </dxi-item>\r\n          <dxi-item class=\"label-text\" dataField=\"contact_mobile\" [label]=\"{text: 'Điện thoại'}\" [editorOptions]=\"{disabled: true}\">\r\n          </dxi-item>\r\n          <dxi-item class=\"label-text\" dataField=\"surrogate_name\" [label]=\"{text: 'Người đại diện'}\" [editorOptions]=\"{disabled: true}\">\r\n          </dxi-item>\r\n          <dxi-item class=\"label-text\" dataField=\"surrogate_position\" [label]=\"{text: 'Chức vụ'}\" [editorOptions]=\"{disabled: true}\">\r\n          </dxi-item>\r\n        </dxi-item>\r\n      </dx-form>\r\n      <br/>\r\n      <p>Hai bên, thống nhất lập biên bản này để điều chỉnh hóa đơn (GTGT) như sau:</p>\r\n      <ul>\r\n          <li>\r\n              - Mẫu số: {{oldForm.template_code}}\r\n          </li>\r\n          <li>\r\n              - Ký hiệu: {{oldForm.invoice_series}} số {{oldForm.invoice_number}} ngày {{invoice_date}}\r\n          </li>\r\n        </ul>\r\n        <p>Chúng tôi cam kết và hoàn toàn chịu trách nhiệm về việc ghi nhận sai sót này. Đồng thời, bên Bán (Bên B) sẽ xuất hóa đơn điều chỉnh mẫu số: {{_objTemplateSelect.template_code}}, ký hiệu {{_objTemplateSelect.invoice_series}} </p>\r\n      <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n          <dxi-item itemType=\"group\" [colCount]=\"5\">\r\n            <dxi-item dataField=\"invoice_number\" [label]=\"{text: 'Số hóa đơn'}\">\r\n            <dxi-validation-rule  type=\"required\" message=\"Số hóa đơn {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n            </dxi-item>\r\n            <dxi-item dataField=\"invoice_date\" [label]=\"{text: 'Ngày hóa đơn' }\" editorType=\"dxDateBox\"\r\n            [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n          </dxi-item>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"destroy_reason\" [label]=\"{text: 'Lý do điều chỉnh'}\">\r\n            <dxi-validation-rule  type=\"required\" message=\"Lý do điều chỉnh {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n        </dx-form>\r\n        <p>để hai bên làm căn cứ kê khai thuế, hạch toán kế toán.</p>\r\n        <br/>\r\n      <ul>\r\n          <li>\r\n              Biên bản này lập thành 02 bản, mỗi bên giữ 01 bản có giá trị pháp lý như nhau.\r\n          </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <dx-button text=\"{{_translate.CONTROLL.BUTTON.sign}}\" icon=\"{{_translate.ICONS.pencil}}\" type=\"default\" validationGroup=\"formData\"\r\n      (click)=\"onSubmit(null)\">\r\n      </dx-button>\r\n      <dx-button text=\"{{_translate.CONTROLL.BUTTON.close}}\" icon=\"{{_translate.ICONS.come_back}}\" type=\"default\" (click)=\"dong()\">\r\n      </dx-button>\r\n    </div>\r\n  </form>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.scss":
/*!******************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.scss ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".modal-body{line-height:1.5}.modal-body .title{font-weight:bold;margin-bottom:5px;text-align:center}.modal-body ul{list-style-type:none;padding-left:5px}.modal-body ul li{margin-bottom:5px}.modal-body .m-bold{font-weight:bold}.modal-body .view-document{margin-top:5px;margin-bottom:5px}.label-text{float:left}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.ts":
/*!****************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.ts ***!
  \****************************************************************************************************/
/*! exports provided: ReportAdjustInvComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReportAdjustInvComponent", function() { return ReportAdjustInvComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var _modules_info_unit_shared__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @modules/info-unit/shared */ "./src/app/modules/info-unit/shared/index.ts");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};






var ReportAdjustInvComponent = /** @class */ (function () {
    function ReportAdjustInvComponent(authService, bsModalRef, infoUnitService, vatService) {
        this.authService = authService;
        this.bsModalRef = bsModalRef;
        this.infoUnitService = infoUnitService;
        this.vatService = vatService;
        this.benB = {};
        this.invoice_date = "";
        this.ngayVB = "";
        this._translate = this.authService.getTranslate();
    }
    ReportAdjustInvComponent.prototype.ngOnInit = function () {
        this.frmDataClone = Object.assign({}, this.frmData);
        //this.customer.name = "CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM";
        this.invoice_date = moment__WEBPACK_IMPORTED_MODULE_4__(this.oldForm.invoice_date).format('DD/MM/YYYY');
        this.ngayVB = "ngày " + moment__WEBPACK_IMPORTED_MODULE_4__(this.frmData.doc_relate_date).format('DD')
            + " tháng " + moment__WEBPACK_IMPORTED_MODULE_4__(this.frmData.doc_relate_date).format('MM')
            + " năm " + moment__WEBPACK_IMPORTED_MODULE_4__(this.frmData.doc_relate_date).format('YYYY');
        this.getUnitInfo();
    };
    ReportAdjustInvComponent.prototype.getUnitInfo = function () {
        var _this = this;
        var accountId = this.authService.getCurrentUser().account.id;
        if (accountId) {
            this.infoUnitService.getInfo(accountId).subscribe(function (res) {
                delete res.data.account.van_account_info;
                _this.benB = res.data.account;
            });
        }
    };
    ReportAdjustInvComponent.prototype.onSubmit = function (e) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].showloading();
        var inv = Object.assign({}, this.oldForm);
        inv.doc_relate_date = this.frmData.doc_relate_date;
        inv.doc_relate_symbol = this.frmData.doc_relate_symbol;
        inv.destroy_reason = this.frmData.destroy_reason;
        inv.invoice_date_new = this.frmData.invoice_date;
        inv.invoice_number_new = this.frmData.invoice_number;
        inv.template_code_new = this._objTemplateSelect.template_code;
        inv.invoice_series_new = this._objTemplateSelect.invoice_series;
        inv.adjustment_type = "1";
        inv.auto_value_price = inv.auto_value_price == null ? false : inv.auto_value_price;
        //inv.invoice_products =this.oldForm.invoice_products;
        // this.dataSource.items().forEach(item => {
        //   if (item.product_name)
        //     inv.invoice_products.push(item);
        // });
        inv.invoice_files = [];
        this.vatService.xuatMauBienBanDc(inv).subscribe(function (rs) {
            if (rs.status == 'success') {
                var file = rs.data.invoice;
                var _attachFile = _this.fileData.map(function (e) { return e.file_name; });
                var _index = _attachFile.indexOf(file.file_name);
                if (_index == -1) {
                    _this.fileData.push({ type: "DK", file_name: file.file_name, file_content: file.file_content });
                    //Helper.dowloadFile(file.file_name, 'xlsx', file.file_content);
                }
                else {
                    _this.fileData.splice(_index, 1);
                    _this.fileData.push({ type: "DK", file_name: file.file_name, file_content: file.file_content });
                }
                _this.bsModalRef.hide();
                _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].notify("Xuất biên bản điều chỉnh thành công", 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].hideloading();
        });
    };
    ReportAdjustInvComponent.prototype.dong = function () {
        //this.isValid = false;
        this.frmData.invoice_date = this.frmDataClone.invoice_date;
        this.frmData.invoice_number = this.frmDataClone.invoice_number;
        this.bsModalRef.hide();
    };
    ReportAdjustInvComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-report-adjust-inv',
            template: __webpack_require__(/*! ./report-adjust-inv.component.html */ "./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.html"),
            styles: [__webpack_require__(/*! ./report-adjust-inv.component.scss */ "./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_1__["AuthService"],
            ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__["BsModalRef"],
            _modules_info_unit_shared__WEBPACK_IMPORTED_MODULE_3__["InfoUnitService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_5__["VatService"]])
    ], ReportAdjustInvComponent);
    return ReportAdjustInvComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.html":
/*!******************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.html ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<form (ngSubmit)=\"onSubmit($event)\">\r\n  <div class=\"modal-header\">\r\n    <h4 class=\"modal-title pull-left\">BIÊN BẢN THU HỒI HÓA ĐƠN</h4>\r\n    <button type=\"button\" class=\"close pull-right\" aria-label=\"Close\" (click)=\"dong()\">\r\n      <span aria-hidden=\"true\">&times;</span>\r\n    </button>\r\n  </div>\r\n  <div class=\"modal-body\">\r\n    <h3 class=\"title\">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</h3>\r\n    <h3 class=\"title\">Độc lập – Tự do – Hạnh phúc</h3>\r\n    <h3 class=\"title\">—oOo—</h3>\r\n    <h3 class=\"title\">BIÊN BẢN THU HỒI HÓA ĐƠN ĐÃ LẬP</h3>\r\n    <h3 class=\"title\">Số: {{frmData.doc_relate_symbol}} / BBTHHĐ</h3>\r\n    <ul>\r\n      <li>\r\n        - Căn cứ Thông tư số 39/2014/TT-BTC ngày 31/3/2014 của Bộ Tài chính hướng dẫn thi hành Nghị định số\r\n        51/2010/NĐ-CP.\r\n      </li>\r\n      <li>\r\n        Hôm nay, {{ngayVB}} đại diện hai bên gồm có:\r\n      </li>\r\n    </ul>\r\n    <dx-form [formData]=\"oldForm\" validationGroup=\"formData\">\r\n      <dxi-item class=\"label-text\" dataField=\"customer_name\" [label]=\"{text: 'Bên A'}\">\r\n      </dxi-item>\r\n      <dxi-item dataField=\"buyer_address\" [label]=\"{text: 'Địa chỉ'}\">\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item class=\"label-text\" dataField=\"buyer_tax_code\" [label]=\"{text: 'Mã số thuế'}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"buyer_mobile\" [label]=\"{text: 'Điện thoại'}\" [editorOptions]=\"{disabled: false}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"\" [label]=\"{text: 'Người đại diện'}\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"\" [label]=\"{text: 'Chức vụ'}\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n      \r\n    </dx-form>\r\n    <br/>\r\n    <dx-form [formData]=\"benB\" validationGroup=\"formData\">\r\n    <dxi-item class=\"label-text\" dataField=\"name\" [label]=\"{text: 'Bên B'}\" [editorOptions]=\"{disabled: true}\">\r\n      </dxi-item>\r\n      <dxi-item class=\"label-text\" dataField=\"business_address\" [label]=\"{text: 'Địa chỉ' }\" [editorOptions]=\"{disabled: true}\">\r\n      </dxi-item>\r\n      <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n        <dxi-item class=\"label-text\" dataField=\"tax_code\" [label]=\"{text: 'Mã số thuế', class:'label-text' }\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"contact_mobile\" [label]=\"{text: 'Điện thoại'}\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"surrogate_name\" [label]=\"{text: 'Người đại diện'}\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n        <dxi-item class=\"label-text\" dataField=\"surrogate_position\" [label]=\"{text: 'Chức vụ'}\" [editorOptions]=\"{disabled: true}\">\r\n        </dxi-item>\r\n      </dxi-item>\r\n    </dx-form>\r\n    <br/>\r\n    <p>Hai bên, thống nhất lập biên bản thu hồi hóa đơn số: {{oldForm.template_code}} đã lập, có ký hiệu {{oldForm.invoice_series}} số {{oldForm.invoice_number}} do {{benB.name}} phát hành {{invoice_date}}  để xóa bỏ theo quy định, và sẽ xuất thay thế bằng hóa đơn số {{_objTemplateSelect.template_code}}, ký hiệu {{_objTemplateSelect.invoice_series}}</p>\r\n    <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n        <dxi-item itemType=\"group\" [colCount]=\"5\">\r\n          <dxi-item dataField=\"invoice_number\" [label]=\"{text: 'Số hóa đơn'}\">\r\n          <dxi-validation-rule  type=\"required\" message=\"Số hóa đơn {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n          </dxi-item>\r\n          <dxi-item dataField=\"invoice_date\" [label]=\"{text: 'Ngày hóa đơn' }\" editorType=\"dxDateBox\"\r\n          [editorOptions]=\"{useMaskBehavior:true, displayFormat: 'dd/MM/yyyy', dateSerializationFormat: 'yyyy-MM-dd HH:mm:ss'}\">\r\n        </dxi-item>\r\n        </dxi-item>\r\n        <dxi-item dataField=\"destroy_reason\" [label]=\"{text: 'Lý do thu hồi hóa đơn'}\">\r\n          <dxi-validation-rule  type=\"required\" message=\"Lý do thu hồi hóa đơn {{ _translate.VALIDATION.required }}\"></dxi-validation-rule>\r\n        </dxi-item>\r\n      </dx-form>\r\n      <br/>\r\n    <ul>\r\n        <li>\r\n            Chúng tôi cam kết và hoàn toàn chịu trách nhiệm về việc thu hồi và xóa bỏ hóa đơn này.\r\n        </li>\r\n        <li>\r\n            Biên bản này lập thành 02 bản, Bên A giữ 01 bản, bên B giữ 01 bản.\r\n        </li>\r\n      </ul>\r\n  </div>\r\n  <div class=\"modal-footer\">\r\n    <dx-button text=\"{{_translate.CONTROLL.BUTTON.sign}}\" icon=\"{{_translate.ICONS.pencil}}\" type=\"default\" validationGroup=\"formData\"\r\n    (click)=\"onSubmit(null)\">\r\n    </dx-button>\r\n    <dx-button text=\"{{_translate.CONTROLL.BUTTON.close}}\" icon=\"{{_translate.ICONS.come_back}}\" type=\"default\" (click)=\"dong()\">\r\n    </dx-button>\r\n  </div>\r\n</form>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.scss":
/*!******************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.scss ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".modal-body{line-height:1.5}.modal-body .title{font-weight:bold;margin-bottom:5px;text-align:center}.modal-body ul{list-style-type:none;padding-left:5px}.modal-body ul li{margin-bottom:5px}.modal-body .m-bold{font-weight:bold}.modal-body .view-document{margin-top:5px;margin-bottom:5px}.label-text{float:left}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.ts":
/*!****************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.ts ***!
  \****************************************************************************************************/
/*! exports provided: ReportCancelInvComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReportCancelInvComponent", function() { return ReportCancelInvComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var _modules_info_unit_shared__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @modules/info-unit/shared */ "./src/app/modules/info-unit/shared/index.ts");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};






var ReportCancelInvComponent = /** @class */ (function () {
    function ReportCancelInvComponent(authService, bsModalRef, infoUnitService, vatService) {
        this.authService = authService;
        this.bsModalRef = bsModalRef;
        this.infoUnitService = infoUnitService;
        this.vatService = vatService;
        this.benB = {};
        this.invoice_date = "";
        this.ngayVB = "";
        this._translate = this.authService.getTranslate();
    }
    ReportCancelInvComponent.prototype.ngOnInit = function () {
        this.frmDataClone = Object.assign({}, this.frmData);
        //this.customer.name = "CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM";
        this.invoice_date = "ngày " + moment__WEBPACK_IMPORTED_MODULE_4__(this.oldForm.invoice_date).format('DD')
            + " tháng " + moment__WEBPACK_IMPORTED_MODULE_4__(this.oldForm.invoice_date).format('MM')
            + " năm " + moment__WEBPACK_IMPORTED_MODULE_4__(this.oldForm.invoice_date).format('YYYY');
        this.ngayVB = "ngày " + moment__WEBPACK_IMPORTED_MODULE_4__(this.frmData.doc_relate_date).format('DD')
            + " tháng " + moment__WEBPACK_IMPORTED_MODULE_4__(this.frmData.doc_relate_date).format('MM')
            + " năm " + moment__WEBPACK_IMPORTED_MODULE_4__(this.frmData.doc_relate_date).format('YYYY');
        this.getUnitInfo();
    };
    ReportCancelInvComponent.prototype.getUnitInfo = function () {
        var _this = this;
        var accountId = this.authService.getCurrentUser().account.id;
        if (accountId) {
            this.infoUnitService.getInfo(accountId).subscribe(function (res) {
                delete res.data.account.van_account_info;
                _this.benB = res.data.account;
            });
        }
    };
    ReportCancelInvComponent.prototype.onSubmit = function (e) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].showloading();
        var inv = Object.assign({}, this.oldForm);
        inv.doc_relate_date = this.frmData.doc_relate_date;
        inv.doc_relate_symbol = this.frmData.doc_relate_symbol;
        inv.destroy_reason = this.frmData.destroy_reason;
        inv.invoice_date_new = this.frmData.invoice_date;
        inv.invoice_number_new = this.frmData.invoice_number;
        inv.template_code_new = this._objTemplateSelect.template_code;
        inv.invoice_series_new = this._objTemplateSelect.invoice_series;
        inv.adjustment_type = "1";
        inv.auto_value_price = inv.auto_value_price == null ? false : inv.auto_value_price;
        //inv.invoice_products =this.oldForm.invoice_products;
        // this.dataSource.items().forEach(item => {
        //   if (item.product_name)
        //     inv.invoice_products.push(item);
        // });
        inv.invoice_files = [];
        this.vatService.xuatMauBienBanThuHoi(inv).subscribe(function (rs) {
            if (rs.status == 'success') {
                var file = rs.data.invoice;
                var _attachFile = _this.fileData.map(function (e) { return e.file_name; });
                var _index = _attachFile.indexOf(file.file_name);
                if (_index == -1) {
                    _this.fileData.push({ type: "DK", file_name: file.file_name, file_content: file.file_content });
                    //Helper.dowloadFile(file.file_name, 'xlsx', file.file_content);
                }
                else {
                    _this.fileData.splice(_index, 1);
                    _this.fileData.push({ type: "DK", file_name: file.file_name, file_content: file.file_content });
                }
                _this.bsModalRef.hide();
                _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].notify("Xuất biên bản thu hồi thành công", 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_1__["Library"].hideloading();
        });
    };
    ReportCancelInvComponent.prototype.dong = function () {
        //this.isValid = false;
        this.frmData.invoice_date = this.frmDataClone.invoice_date;
        this.frmData.invoice_number = this.frmDataClone.invoice_number;
        this.bsModalRef.hide();
    };
    ReportCancelInvComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-report-cancel-inv',
            template: __webpack_require__(/*! ./report-cancel-inv.component.html */ "./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.html"),
            styles: [__webpack_require__(/*! ./report-cancel-inv.component.scss */ "./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.scss")]
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_1__["AuthService"],
            ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__["BsModalRef"],
            _modules_info_unit_shared__WEBPACK_IMPORTED_MODULE_3__["InfoUnitService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_5__["VatService"]])
    ], ReportCancelInvComponent);
    return ReportCancelInvComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.html":
/*!********************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.html ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "\r\n<div class=\"modal-body\">\r\n  <div class=\"row search-section\">\r\n    <div class=\"col-md-8\" style=\"padding-right: 0px\">\r\n      <h4 class=\"modal-title pull-left\">THÔNG BÁO HÓA ĐƠN SAI SÓT VỚI CƠ QUAN THUẾ</h4>\r\n    </div>\r\n    <div class=\"col-md-4\" style=\"max-height: 70px\">\r\n      <div class=\"list-header row\">\r\n        <div class=\"col-md-12\">\r\n          <div class=\"pull-right button-panel\">\r\n            <dx-button (click)=\"addRow()\" icon=\"fa fa-plus-circle\"\r\n                       text=\"Thêm dòng\" type=\"default\"></dx-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <dx-data-grid\r\n    id=\"invoiceHistoryGrid\"\r\n    [dataSource]=\"dataSource\"\r\n    [showBorders]=\"true\"\r\n    [wordWrapEnabled]=\"true\"\r\n    (onCellPrepared)=\"onCellPrepared($event)\"\r\n    [showRowLines]=\"true\">\r\n    <dxo-editing mode=\"cell\" [allowUpdating]=\"true\"></dxo-editing>\r\n    <!-- Xóa -->\r\n    <dxi-column cellTemplate=\"deleteColumn\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.delete }}\"\r\n    [width]=\"45\" [allowEditing]=\"false\" alignment=\"center\">\r\n    </dxi-column>\r\n    <!-- STT -->\r\n    <dxi-column [allowEditing]=\"false\" dataField=\"order\" caption=\"{{ _translate.GRID.INVOICE_DETAILS.view_order }}\"\r\n    [width]=\"53\" alignment=\"center\"></dxi-column>\r\n    <!-- Loại áp dụng HĐ ĐT -->\r\n    <dxi-column [allowEditing]=\"false\" caption=\"Loại áp dụng HĐ ĐT\" dataField=\"type_apply_invoice\"\r\n              alignment=\"left\" minWidth=\"200\">\r\n      <dxo-lookup [dataSource]=\"typeInvoices\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n    </dxi-column>\r\n    <!-- Mẫu số-->\r\n    <dxi-column [allowEditing]=\"false\" dataField=\"template_code\"\r\n              caption=\"{{ 'GRID.INVOICE.template_code' | translate }}\"\r\n              [width]=\"113\" alignment=\"center\" >\r\n    </dxi-column>\r\n    <!-- Ký hiệu -->\r\n    <dxi-column [allowEditing]=\"false\" dataField=\"invoice_series\"\r\n              caption=\"{{ 'GRID.INVOICE.invoice_series' | translate }}\"\r\n              [width]=\"113\" alignment=\"center\" >\r\n    </dxi-column>\r\n    <!-- Số hóa đơn -->\r\n    <dxi-column [allowEditing]=\"false\" cellTemplate=\"invoiceNumber\" dataField=\"invoice_number\"\r\n              caption=\"{{ 'GRID.INVOICE.invoice_number' | translate }}\" minWidth=\"{{_translate.GRID_WIDTH.so_hoa_don}}\"\r\n              alignment=\"center\" >\r\n    </dxi-column>\r\n    <!-- Ngày hóa đơn -->\r\n    <dxi-column [allowEditing]=\"false\" dataField=\"invoice_date\" caption=\"{{ 'GRID.INVOICE.invoice_date' | translate }}\"\r\n              minWidth=\"{{_translate.GRID_WIDTH.ngay_hoa_don}}\" [editorOptions]=\"{useMaskBehavior:true}\" dataType=\"date\"\r\n              format=\"dd/MM/yyyy\" dateSerializationFormat=\"yyyy-MM-dd\" alignment=\"center\" >\r\n    </dxi-column>\r\n    <!-- Mã CQT cấp -->\r\n     <dxi-column [allowEditing]=\"false\" dataField=\"tax_authority_code\" caption=\"Mã CQT cấp\"\r\n              minWidth=\"{{_translate.GRID_WIDTH.ma_so_thue}}\" alignment=\"left\" >\r\n    </dxi-column>\r\n    <!-- Tính chất thông báo -->\r\n    <dxi-column [allowEditing]=\"true\" dataField=\"notification_nature\" caption=\"Tính chất thông báo\"\r\n                 alignment=\"center\"\r\n                [editorOptions]=\"{showClearButton: true ,step: '0'}\">\r\n    <dxo-lookup [dataSource]=\"tinhchatTB\" displayExpr=\"name\" valueExpr=\"code\"></dxo-lookup>\r\n    </dxi-column>\r\n    <!-- Lý do -->\r\n    <dxi-column [allowEditing]=\"true\" dataField=\"reason\"\r\n                caption=\"Lý do\" alignment=\"left\" minWidth=\"150\">\r\n    </dxi-column>\r\n    <dxi-column [visible]=\"false\" dataField=\"is_invoice_with_code\" caption=\"Mã CQT cấp\"\r\n                minWidth=\"{{_translate.GRID_WIDTH.ma_so_thue}}\" alignment=\"left\" >\r\n   </dxi-column>\r\n    <div *dxTemplate=\"let d of 'cktm'\">\r\n      <dx-check-box [(value)]=\"d.data.commercial_discount\"></dx-check-box>\r\n    </div>\r\n    <div id=\"context-table\" *dxTemplate=\"let d of 'deleteColumn'\">\r\n      <a class=\"delete-row\" href=\"javascript:void(0)\" (click)=\"deleteRow(d.data)\"><i class=\"fa fa-times\"></i></a>\r\n    </div>\r\n    <div *dxTemplate=\"let d of 'templateCode'\">\r\n      <p>{{ d.data.template_code }}</p>\r\n      <p>{{ d.data.invoice_series }}</p>\r\n    </div>\r\n    <div *dxTemplate=\"let d of 'invoiceNumber'\">\r\n      <a class=\"gach-chan\" (click)=\"viewDetailInvoice(d.data)\" href=\"javascript:void(0)\">{{ d.data.invoice_number }}<span\r\n        *ngIf=\"d.data.time_print_conversion\">-CĐ ({{ d.data.time_print_conversion }})</span></a>\r\n    </div>\r\n      <div *dxTemplate=\"let data of 'DinhKemFile'\">\r\n          <a href=\"javascript:void(0)\" (click)=\"dinhKemFile($event)\">\r\n            <input type=\"file\" id=\"file-dinh-kem\" [attr.data-rowindex]=\"data.rowIndex\" accept=\".xlsx, .docx, .doc, .pdf, .xls, .xml\" (change)=\"onDinhKemFile($event)\" multiple=\"false\" style=\"display: none;\"/>\r\n             <p *ngIf=\"!isView || adjustment_type == '7'\">Chọn file</p>\r\n            <p *ngIf=\"data.data.invoice_files&&data.data.invoice_files.length\" (click)=\"downloadFile(data.data.invoice_files[0])\">{{data.data.invoice_files[0].file_name}}</p>\r\n          </a>\r\n        </div>\r\n      <!-- <div *dxTemplate=\"let d of 'downloadBB'\">\r\n          <a href=\"javascript:void(0)\" (click)=\"xuatMauBienBan(d.data)\"><img src=\"assets\\img\\icons\\TaiMauBangKe.png\"></a>\r\n        </div> -->\r\n  </dx-data-grid>\r\n</div>\r\n<div class=\"modal-footer\">\r\n  <dx-form [formData]=\"frmData\" validationGroup=\"formData\" style=\"margin-right: 162px;\">\r\n    <dxi-item itemType=\"group\" [colCount]=\"3\">\r\n      <dxi-item dataField=\"notification_type\" editorType=\"dxCheckBox\" [template]=\"'unitRisk'\">\r\n        <dxo-label [visible]=\"false\"></dxo-label>\r\n      </dxi-item>\r\n      <dxi-item dataField=\"notification_number\" [editorOptions]=\"{readOnly: isReadOnly }\">\r\n        <dxo-label text=\"Số TB của CQT\"></dxo-label>\r\n      </dxi-item>\r\n      <dxi-item dataField=\"notification_date\" [template]=\"'notifydate'\">\r\n        <dxo-label text=\"Ngày TB của CQT\"></dxo-label>\r\n      </dxi-item>\r\n    </dxi-item>\r\n    <div *dxTemplate = \"let d of 'notifydate'\">\r\n      <dx-date-box [(value)]=\"frmData.notification_date\" type=\"date\" [useMaskBehavior]=\"true\" [displayFormat]=\"'dd/MM/yyyy'\" [(readOnly)] = \"isReadOnly\">\r\n      </dx-date-box>\r\n    </div>\r\n    <div *dxTemplate=\"let d of 'unitRisk'\">\r\n      <dx-check-box [(value)]=\"frmData.notification_type\" text=\"HĐ CQT yêu cầu rà soát\" (onValueChanged)=\"changedUnitRisk($event)\"></dx-check-box>\r\n      <div class=\"toggle normal\" style=\"display: flex; align-items: center;margin-top: -17px;margin-left: 180px;\">\r\n        <img id=\"link3\" style=\"padding-bottom: 6px;cursor: pointer\" src=\"assets\\img\\icons\\Icon_Information.png\" (click)=\"onClickUnitType()\" alt=\"efy.vn\" alt=\"Efy.vn\">\r\n      </div>\r\n      <dx-popover\r\n      target=\"#link3\"\r\n              position=\"top\"\r\n              [width]=\"327\"\r\n              [(visible)]=\"isDisplayUnitRisk\">\r\n              <div *dxTemplate=\"let data of 'content'\">\r\n                  <p>Chọn vào đây với các hóa đơn mà Cơ quan Thuế gửi thông báo yêu cầu đơn vị rà soát và giải trình</p>\r\n                  <p>Yêu cầu nhập số thông báo và ngày thông báo của CQT</p>\r\n              </div>\r\n          </dx-popover>\r\n    </div>\r\n  </dx-form>\r\n  <dx-button text=\"Gửi thông báo cho CQT \" (click)=\"GuiThongBao()\" icon=\"{{_translate.ICONS.save }}\" type=\"default\" validationGroup=\"formData\">\r\n  </dx-button>\r\n  <dx-button text=\"Đóng\" icon=\"{{_translate.ICONS.come_back }}\" type=\"default\" (click)=\"dong()\">\r\n  </dx-button>\r\n</div>\r\n\r\n\r\n<!-- popup -->\r\n<dx-popup\r\n  class=\"popup\"\r\n  [width]=\"400\"\r\n  [height]=\"120\"\r\n  [showTitle]=\"true\"\r\n  title=\"{{_translate.NOTIFY.processing}}\"\r\n  [dragEnabled]=\"false\"\r\n  (onShowing)=\"onImportShowing($event)\"\r\n  (onHiding)=\"onImportHiding($event)\"\r\n  [(visible)]=\"showPopup\">\r\n  <div *dxTemplate=\"let data of 'content'\">\r\n    <div style=\"height: 30px;\">\r\n      <dx-progress-bar \r\n        [min]=\"0\" \r\n        [max]=\"100\" \r\n        [value]=\"valueProgress\"\r\n        [statusFormat]=\"format\">\r\n      </dx-progress-bar>\r\n    </div>\r\n    <!-- <p style=\"height: 25px;\">\r\n        <span>{{thongbao}}</span>\r\n    </p> -->\r\n  </div>\r\n</dx-popup>\r\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.scss":
/*!********************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.scss ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ".gach-chan{text-decoration:underline}.img-upload-second{text-align:center}.img-upload-second i{margin-top:10px;width:40px;height:auto;cursor:pointer}.img-upload-second p{margin-top:10px}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.ts":
/*!******************************************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.ts ***!
  \******************************************************************************************************************/
/*! exports provided: ReportTaxInvoiceErrorComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReportTaxInvoiceErrorComponent", function() { return ReportTaxInvoiceErrorComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @core/library/invoice/invoices.service */ "./src/app/core/library/invoice/invoices.service.ts");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! typescript-string-operations */ "./node_modules/typescript-string-operations/dist/index.min.js");
/* harmony import */ var typescript_string_operations__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(typescript_string_operations__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! devextreme/data/array_store */ "./node_modules/devextreme/data/array_store.js");
/* harmony import */ var devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! devextreme/data/data_source */ "./node_modules/devextreme/data/data_source.js");
/* harmony import */ var devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11__);
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var ngx_spinner__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ngx-spinner */ "./node_modules/ngx-spinner/fesm5/ngx-spinner.js");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
/* harmony import */ var _modules_search_shared__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @modules/search/shared */ "./src/app/modules/search/shared/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};

















var ReportTaxInvoiceErrorComponent = /** @class */ (function () {
    function ReportTaxInvoiceErrorComponent(bsModalRef, socketService, handleInvoiceService, authService, vatService, translate, router, spinner, vPreviewInvService, searchService) {
        var _this = this;
        this.bsModalRef = bsModalRef;
        this.socketService = socketService;
        this.handleInvoiceService = handleInvoiceService;
        this.authService = authService;
        this.vatService = vatService;
        this.translate = translate;
        this.router = router;
        this.spinner = spinner;
        this.vPreviewInvService = vPreviewInvService;
        this.searchService = searchService;
        this.valueProgress = 0;
        this.errorImport = false;
        this.showPopup = false;
        this.invoiceIndex = 0;
        this.tempKiFile = 0;
        this.emailPattern = _config_index__WEBPACK_IMPORTED_MODULE_12__["pattern"].email;
        this.isDisplayUnitRisk = false;
        this.maskTemplateCode = "XX/XX/XXXX";
        this.rulesTemplateCode = { 'X': /[0-9]/ };
        this.isReadOnly = true;
        this.isSchool = false;
        //{ 'h': /^([0]?[0-9]|[12][0-9]|[3][01])[./-]([0]?[1-9]|[1][0-2])[./-]([0-9]{4}|[0-9]{2})/ };
        this.tinhchatTB = [
            {
                name: "Hủy",
                code: "1"
            },
            {
                name: "Điều chỉnh",
                code: "2"
            },
            {
                name: "Thay thế",
                code: "3"
            },
            {
                name: "Giải trình",
                code: "4"
            }
        ];
        this.format = function (value) {
            var percent = Math.round(value * 100);
            return _this._translate.NOTIFY.finish + ": " + percent + '%';
        };
        this.frmData = {
            notification_number: "",
            notification_type: false,
            notification_date: "",
            invoices: []
        };
        this._language = this.authService.getLanguage();
        this._translate = this.authService.getTranslate();
        translate.use(this._language);
    }
    ReportTaxInvoiceErrorComponent.prototype.ngOnInit = function () {
        var account_type = this.authService.getCurrentUser().account.account_type;
        if (account_type == _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].khoidonvi.HSSV) {
            this.isSchool = true;
        }
        else {
            this.isSchool = false;
        }
        this.typeInvoices = _core_index__WEBPACK_IMPORTED_MODULE_3__["VSelectBoxService"].typeEInvoice(this._translate);
        this.invoicesStore = new devextreme_data_array_store__WEBPACK_IMPORTED_MODULE_10___default.a({
            key: 'id',
            data: []
        });
        this.dataSource = new devextreme_data_data_source__WEBPACK_IMPORTED_MODULE_11___default.a({
            store: this.invoicesStore
        });
        this.convertData();
        this.connectWebsocket();
    };
    ReportTaxInvoiceErrorComponent.prototype.convertData = function () {
        var _this = this;
        if (this.data && this.data.length > 0) {
            var order_1 = 0;
            this.data.forEach(function (invoice) {
                var rowInvoice = new Object;
                rowInvoice["id"] = invoice.id;
                /* Loại áp dụng hóa đơn điện tử
                    - HĐ theo TT78 (Vào XML thẻ LADHDDT giá trị là 1)
                    - HĐ có mã xác thực theo NĐ 51/2010/NĐ-CP (Vào XML thẻ LADHDDT giá trị là 2)
                    - HĐĐT theo TT32 hoặc HĐ giấy theo TT39 (Vào XML thẻ LADHDDT giá trị là 3)
                    - HĐ đặt in theo NĐ 123/2020/NĐ-CP (Vào XML thẻ LADHDDT giá trị là 4)
               */
                if (invoice.xml_type == 3)
                    rowInvoice["type_apply_invoice"] = 1;
                else
                    rowInvoice["type_apply_invoice"] = 3;
                rowInvoice["template_code"] = invoice.template_code;
                rowInvoice["invoice_series"] = invoice.invoice_series;
                rowInvoice["invoice_number"] = invoice.invoice_number;
                rowInvoice["invoice_date"] = invoice.invoice_date;
                rowInvoice["tax_authority_code"] = invoice.tax_authority_code;
                rowInvoice["adjustment_type"] = invoice.adjustment_type;
                rowInvoice["is_invoice_with_code"] = invoice.is_invoice_with_code;
                rowInvoice["notification_nature"] = "";
                rowInvoice["reason"] = "";
                rowInvoice["invoice_id"] = invoice.id;
                rowInvoice["order"] = ++order_1;
                rowInvoice["row_edit"] = false;
                _this.invoicesStore.insert(rowInvoice);
            });
        }
        else {
            this.addRow();
        }
    };
    /* Thêm dòng hàng hóa */
    ReportTaxInvoiceErrorComponent.prototype.addRow = function () {
        var len, order;
        this.invoicesStore.load().then(function (dataSource) {
            if (dataSource.length >= 1) {
                len = dataSource.length;
                order = dataSource[len - 1].order + 1;
            }
            else {
                order = 1;
            }
        });
        var data = this.add_invoice(order);
        this.invoicesStore.insert(data);
        if (this.dataGrid && this.dataGrid.instance)
            this.dataGrid.instance.refresh();
    };
    ReportTaxInvoiceErrorComponent.prototype.add_invoice = function (order) {
        return {
            id: _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].makeid(),
            order: order,
            template_code: "",
            invoice_series: "",
            invoice_number: "",
            type_apply_invoice: null,
            invoice_date: "",
            tax_authority_code: "",
            notification_nature: "",
            adjustment_type: "",
            reason: "",
            is_invoice_with_code: null,
            row_edit: true,
            invoice_id: null
        };
    };
    // Xóa hàng
    ReportTaxInvoiceErrorComponent.prototype.deleteRow = function (item) {
        var _this = this;
        setTimeout(function () {
            var check = confirm(_this._translate.CONFIRM.delete);
            if (check) {
                setTimeout(function () {
                    _this.invoicesStore.remove(item.id);
                    if (_this.dataGrid && _this.dataGrid.instance)
                        _this.dataGrid.instance.refresh();
                }, 100);
            }
        }, 200);
    };
    ReportTaxInvoiceErrorComponent.prototype.createDocRelateNumber = function () {
        var number_report = "";
        if (this.countReport < 10)
            number_report = '0' + this.countReport + '/' + new Date().getFullYear() + '/BB-HBHĐ';
        else
            number_report = this.countReport + '/' + new Date().getFullYear() + '/BB-HBHĐ';
        this.countReport++;
        return number_report;
    };
    ReportTaxInvoiceErrorComponent.prototype.connectWebsocket = function () {
        var _this = this;
        this.ioSignature = this.socketService.lapHoaDon().subscribe(function (message) {
            var data = message;
            if (data.SvcName === 'efy_Sign') {
                if (data.Data.Name === 'hoadon.xml') {
                    _this.goiApiXuatHoaDon(data.Data.Content);
                }
                else if (data.Data.Name === 'ten_filek_the_trung-dc-nhi.xml') {
                    _this.xuLiApiKhiXuat();
                }
            }
        });
    };
    ReportTaxInvoiceErrorComponent.prototype._validGrid = function () {
        var _this = this;
        var invalid = true;
        this.invoicesStore.load().then(function (dataSource) {
            dataSource.forEach(function (item, index) {
                if (!item.notification_nature && invalid) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Tính chất thông báo" + " " + _this._translate.VALIDATION.required, 'error');
                    _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'notification_nature'));
                    invalid = false;
                    return false;
                }
                else {
                    if (!item.row_edit) {
                        // Gốc và bị điều chỉnh
                        if (item.adjustment_type == "1" || item.adjustment_type == "4") {
                            if (item.notification_nature != "2" && item.notification_nature != "4") {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Chỉ được chọn tính chất thông báo là Giải trình và Điều chỉnh", 'error');
                                _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'notification_nature'));
                                invalid = false;
                                return false;
                            }
                        }
                        // Bị thay thế
                        if (item.adjustment_type == "2") {
                            if (item.notification_nature != "3" && item.notification_nature != "4") {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Chỉ được chọn tính chất thông báo là Giải trình và Thay thế", 'error');
                                _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'notification_nature'));
                                invalid = false;
                                return false;
                            }
                        }
                        // thay thế/điều chỉnh
                        if (item.adjustment_type == "3" || item.adjustment_type == "5") {
                            if (item.notification_nature != "4") {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Chỉ được chọn tính chất thông báo là Giải trình", 'error');
                                _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'notification_nature'));
                                invalid = false;
                                return false;
                            }
                        }
                        // xoá bỏ
                        if (item.adjustment_type == "7") {
                            if (item.notification_nature != "4" && item.notification_nature != "1") {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Chỉ được chọn tính chất thông báo là Giải trình và Huỷ", 'error');
                                _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'notification_nature'));
                                invalid = false;
                                return false;
                            }
                        }
                    }
                }
                if (!item.reason && invalid) {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Lý do ' + _this._translate.VALIDATION.required, 'error');
                    _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'reason'));
                    invalid = false;
                    return false;
                }
                if (item.row_edit && invalid) {
                    if (!item.type_apply_invoice && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Loại áp dụng HĐ ĐT" + " " + _this._translate.VALIDATION.required, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'type_apply_invoice'));
                        invalid = false;
                        return false;
                    }
                    if (!item.template_code && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Mẫu số" + " " + _this._translate.VALIDATION.required, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'template_code'));
                        invalid = false;
                        return false;
                    }
                    else {
                        if (invalid) {
                            var validTemplateCode = false;
                            /* Thông tư 78 */
                            if (item.type_apply_invoice == 1) {
                                if (item.template_code != "1" && item.template_code != "2" && item.template_code != "3" && item.template_code != "4"
                                    && item.template_code != "5" && item.template_code != "6") {
                                    validTemplateCode = true;
                                }
                            }
                            else if (item.type_apply_invoice == 4) {
                                if (item.template_code.length == 11) {
                                    var char1 = item.template_code.substring(0, 6);
                                    var char2 = item.template_code.substring(7, 6);
                                    var char3 = item.template_code.substring(8, 7);
                                    var char4 = item.template_code.substring(8);
                                    if (char1 != "01GTKT" && char1 != "02GTTT" && char1 != "03XKNB" && char1 != "04HGDL" && char1 != "07KPTQ") {
                                        validTemplateCode = true;
                                    }
                                    else {
                                        if (isNaN(+Number(char2)))
                                            validTemplateCode = true;
                                        else {
                                            if (item.type_apply_invoice == 4 && Number(char2) == 0)
                                                validTemplateCode = true;
                                        }
                                    }
                                    if (char3.length != 1 || char3 != "/")
                                        validTemplateCode = true;
                                    if (char4.length != 3 || isNaN(+Number(char4)))
                                        validTemplateCode = true;
                                }
                                else
                                    validTemplateCode = true;
                            }
                            if (validTemplateCode) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Mẫu số" + " " + "không đúng định dạng", 'error');
                                _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'template_code'));
                                invalid = false;
                                return false;
                            }
                        }
                    }
                    if (!item.invoice_series && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ký hiệu" + " " + _this._translate.VALIDATION.required, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'invoice_series'));
                        invalid = false;
                        return false;
                    }
                    else {
                        if (invalid) {
                            var validInvoiceSeries = false;
                            /* Thông tư 78 */
                            if (item.type_apply_invoice == 1) {
                                if (item.invoice_series.length == 6) {
                                    var char1 = item.invoice_series.substring(1, 0);
                                    var char2 = item.invoice_series.substring(3, 1);
                                    var char3 = item.invoice_series.substring(4, 3);
                                    var char4 = item.invoice_series.substring(5, 4);
                                    var char5 = item.invoice_series.substring(6, 5);
                                    if (char1 != "C" && char1 != "K")
                                        validInvoiceSeries = true;
                                    if (char2.length != 2 || isNaN(+Number(char2)))
                                        validInvoiceSeries = true;
                                    if (char3 != "T" && char3 != "D" && char3 != "L" && char3 != "M"
                                        && char3 != "N" && char3 != "B" && char3 != "G" && char3 != "H")
                                        validInvoiceSeries = true;
                                    if (!isNaN(+Number(char4)) || !isNaN(+Number(char5)))
                                        validInvoiceSeries = true;
                                }
                                else {
                                    validInvoiceSeries = true;
                                }
                            }
                            else if (item.type_apply_invoice == 4) {
                                if (item.invoice_series.length == 8) {
                                    var char1 = item.invoice_series.substring(3, 2);
                                    var char2 = item.invoice_series.substring(4, 3);
                                    var char3 = item.invoice_series.substring(5, 4);
                                    var char4 = item.invoice_series.substring(7, 5);
                                    var char5 = item.invoice_series.substring(8, 7);
                                    var char6 = item.invoice_series.substring(2, 0);
                                    if (!isNaN(+Number(char1)) || !isNaN(+Number(char2)))
                                        validInvoiceSeries = true;
                                    if (char3.length != 1 || char3 != "/")
                                        validInvoiceSeries = true;
                                    if (char4.length != 2 || isNaN(+Number(char4)))
                                        validInvoiceSeries = true;
                                    if (char5 != "P")
                                        validInvoiceSeries = true;
                                    if (isNaN(+Number(char6))) {
                                        validInvoiceSeries = true;
                                    }
                                    else {
                                        if (Number(char6) == 0 || Number(char6) > 65)
                                            validInvoiceSeries = true;
                                    }
                                }
                                else
                                    validInvoiceSeries = true;
                            }
                            if (validInvoiceSeries) {
                                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ký hiệu" + " " + "không đúng định dạng", 'error');
                                _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'invoice_series'));
                                invalid = false;
                                return false;
                            }
                        }
                    }
                    if (!item.invoice_number && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Số hóa đơn" + " " + _this._translate.VALIDATION.required, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'invoice_number'));
                        invalid = false;
                        return false;
                    }
                    if (!item.invoice_date && invalid) {
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ngày hóa đơn" + " " + _this._translate.VALIDATION.required, 'error');
                        _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'invoice_date'));
                        invalid = false;
                        return false;
                    }
                    /* Bắt mẫu số ký hiệu vs p/m */
                    if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.template_code) != "" && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(item.invoice_series) != "") {
                        var obj = _this.listTemplate.filter(function (p) { return p.template_code == item.template_code && p.invoice_series == item.invoice_series; })[0];
                        if (obj) {
                            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Mẫu số - ký hiệu đang có hóa đơn xuất ở hệ thống iHOADON. Vui lòng chọn hóa đơn ở phần mềm để gửi thông báo.", 'error');
                            _this.dataGrid.instance.focus(_this.dataGrid.instance.getCellElement(index, 'invoice_date'));
                            invalid = false;
                            return false;
                        }
                    }
                }
            });
        });
        if (this.frmData.notification_type) {
            if (_core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(this.frmData.notification_number) == "") {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Số TB của CQT không được để trống", 'error');
                invalid = false;
                return false;
            }
            if (!this.frmData.notification_date) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Ngày TB của CQT không được để trống", 'error');
                invalid = false;
                return false;
            }
        }
        return invalid;
    };
    ReportTaxInvoiceErrorComponent.prototype.xoaBo = function () {
        var _this = this;
        if (!_core_library_invoice_invoices_service__WEBPACK_IMPORTED_MODULE_7__["InvoicesService"].checkTimeExportInv(this.configs.system_parameter)) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(typescript_string_operations__WEBPACK_IMPORTED_MODULE_8__["String"].Format(this._translate.NOTIFY.time_export_inv, moment__WEBPACK_IMPORTED_MODULE_1__(this.configs.system_parameter.time_start).format('HH:mm'), moment__WEBPACK_IMPORTED_MODULE_1__(this.configs.system_parameter.time_end).format('HH:mm')), 'error');
            return;
        }
        setTimeout(function () {
            if (_this._validGrid()) {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].confirmVA(_this._translate.CONFIRM.acction_function, _this._translate.NOTIFY.notify, function () {
                    _this.showPopup = true;
                    _this.invoicesStore.load().then(function (dataSource) {
                        if (dataSource.length > 0) {
                            _this.invoices = dataSource.filter(function (p) { return p.adjustment_type != '7'; });
                            _this.totalInvoice = _this.invoices.length;
                            _this.invoiceIndex = 0;
                            _this.tempKiFile = 0;
                            _this.xuatHoaDon();
                        }
                    });
                });
            }
        }, 300);
    };
    ReportTaxInvoiceErrorComponent.prototype.xuatHoaDon = function () {
        var _this = this;
        if (this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
            || (this.configs.integrate_parameter.remote_signing && this.configs.integrate_parameter.remote_signing.is_remote_signing)) {
            this.xuLiApiKhiXuat();
        }
        else {
            this.connectWebsocket();
            if (this.infoDangKy && this.infoDangKy.registration_signature) {
                var ListSerialNumber = "DSCKS";
                var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
                if (signatures && signatures.length > 0)
                    ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
                var invoiceDate = moment__WEBPACK_IMPORTED_MODULE_1__(new Date()).format('YYYY-MM-DD HH:mm:ss');
                this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice', invoiceDate, "", ListSerialNumber, true);
            }
            else
                this.socketService.kiSo(function () { return _this.connectWebsocket(); }, 'PHRlbXBJbnZvaWNlPjwvdGVtcEludm9pY2U+', 'ten_filek_the_trung-dc-nhi.xml', '//tempInvoice');
        }
    };
    ReportTaxInvoiceErrorComponent.prototype.xuLiApiKhiXuat = function () {
        var _this = this;
        var notification_type;
        if (this.frmData.notification_type)
            notification_type = 2;
        else
            notification_type = 1;
        var data = {
            notification_number: this.frmData.notification_number,
            notification_type: notification_type,
            notification_date: this.frmData.notification_date,
            invoices: this.invoices
        };
        var xmlInvoice = "";
        var sub = this.handleInvoiceService.getXmlInvoiceWrong(data).subscribe(function (rs) {
            if (rs.status == 'success') {
                xmlInvoice = rs.data.xml_file;
                _this.frmData.invoices = rs.data.invoices;
                var sign_date = moment__WEBPACK_IMPORTED_MODULE_1__(rs.data.sign_date).format('YYYY-MM-DD HH:mm:ss');
                if (xmlInvoice != "") {
                    if (_this.configs.integrate_parameter.concentrate_signature.is_concentrate_signature
                        || (_this.configs.integrate_parameter.remote_signing && _this.configs.integrate_parameter.remote_signing.is_remote_signing))
                        _this.goiApiXuatHoaDon(xmlInvoice);
                    else
                        _this.xuLyKiFile(xmlInvoice, sign_date);
                }
            }
            else {
                _this.showPopup = false;
                _this.errorImport = true;
                //this.onImportHiding();
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            sub.unsubscribe();
        });
    };
    ReportTaxInvoiceErrorComponent.prototype.xuLyKiFile = function (xmlInvoice, invoiceDate) {
        var _this = this;
        var nodeSign = "//TBao/DSCKS/NNT";
        var ListSerialNumber = "DSCKS";
        if (this.infoDangKy && this.infoDangKy.registration_signature) {
            var signatures = this.infoDangKy.registration_signature.filter(function (p) { return p.register_form == "THEM_MOI" || p.register_form == "GIA_HAN"; });
            if (signatures && signatures.length > 0)
                ListSerialNumber = signatures.map(function (obj) { return obj.cert_serial; }).join(';');
        }
        this.socketService.kiSo(function () { return _this.connectWebsocket(); }, xmlInvoice, 'hoadon.xml', nodeSign, invoiceDate, 'NotificationData', ListSerialNumber, true);
    };
    ReportTaxInvoiceErrorComponent.prototype.goiApiXuatHoaDon = function (xml_string) {
        var _this = this;
        this.subXuatHoaDon = this.handleInvoiceService.sendXmlInvoiceWrong({
            xml_file: xml_string,
            invoices: this.frmData.invoices
        }).subscribe(function (rs) {
            if (rs.status == 'success') {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("Gửi thông báo hóa đơn sai sót thành công", 'success');
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            _this.subXuatHoaDon.unsubscribe();
        });
    };
    ReportTaxInvoiceErrorComponent.prototype.dinhKemFile = function (evt) {
        evt.srcElement.firstChild.click();
        // document.getElementById("file-dinh-kem").click();
        // console.log(e)
    };
    ReportTaxInvoiceErrorComponent.prototype.choseFile = function (evt) {
        //evt.srcElement.firstChild.click();
        document.getElementById("file-input").click();
    };
    ReportTaxInvoiceErrorComponent.prototype.fileChanged = function (e) {
        var _this = this;
        setTimeout(function () {
            //let rowIndex = e.target.dataset.rowindex;
            var fileAttachData = [];
            var fileReader = new FileReader();
            var file = e.target.files[0];
            var pattFile = /(\.xlsx|\.docx|\.doc|\.pdf|\.xls|\.xml)$/i;
            // console.log(file)
            if (pattFile.test(file.name)) {
                fileReader.readAsDataURL(file);
                fileReader.onload = function (e) {
                    var base64result = fileReader.result.toString().split(',')[1];
                    fileAttachData.unshift({
                        type: "DK",
                        file_name: file.name,
                        file_content: base64result,
                    });
                    // if (document.getElementById('list-file')) {
                    //   document.getElementById('list-file').scrollTop = 0;
                    // }
                    var _lstAttach = [];
                    _lstAttach = _this.dataSource[0]["invoice_files"];
                    if (_lstAttach == null) {
                        _lstAttach = [];
                    }
                    else {
                        _lstAttach.push(fileAttachData[0]);
                    }
                    _this.dataSource[0]["invoice_files"] = _lstAttach;
                    // this.dataSource[rowIndex]["report_cancel_invoice_file_name"] = file.name;
                    //this.dataSource.reload();
                };
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("File bạn chọn không đúng định dạng xls, xlsx, doc, docx, pdf, xml", "error");
            }
        }, 200);
    };
    ReportTaxInvoiceErrorComponent.prototype.onDinhKemFile = function (e) {
        var _this = this;
        var rowIndex = e.target.dataset.rowindex;
        var fileAttachData = [];
        var fileReader = new FileReader();
        var file = e.target.files[0];
        var pattFile = /(\.xlsx|\.docx|\.doc|\.pdf|\.xls|\.xml)$/i;
        // console.log(file)
        if (pattFile.test(file.name)) {
            fileReader.readAsDataURL(file);
            fileReader.onload = function (e) {
                var test = fileReader.result;
                var base64result = fileReader.result.toString().split(',')[1];
                fileAttachData.unshift({
                    type: "DK",
                    file_name: file.name,
                    file_content: base64result,
                });
                if (document.getElementById('list-file')) {
                    document.getElementById('list-file').scrollTop = 0;
                }
                _this.invoicesStore.load().then(function (dataSource) {
                    dataSource.forEach(function (item, index) {
                        if (index == rowIndex)
                            item.invoice_files = fileAttachData;
                    });
                });
                // this.dataSource[rowIndex]["invoice_files"] = fileAttachData;
                // this.dataSource[rowIndex]["report_cancel_invoice_file_content"] = base64result;
                // this.dataSource[rowIndex]["report_cancel_invoice_file_name"] = file.name;
            };
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify("File bạn chọn không đúng định dạng xls, xlsx, doc, docx, pdf, xml", "error");
        }
    };
    ReportTaxInvoiceErrorComponent.prototype.removeFile = function (i) {
        var _lstAttach = [];
        _lstAttach = this.dataSource[0]["invoice_files"];
        _lstAttach.splice(i, 1);
    };
    ReportTaxInvoiceErrorComponent.prototype.downloadFile = function (data) {
        var re = /(?:\.([^.]+))?$/;
        var fileType = re.exec(data.file_name)[1];
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].dowloadFile(data.file_name, fileType, data.file_content);
    };
    ReportTaxInvoiceErrorComponent.prototype.xuatMauBienBan = function (data) {
        if (this._validGrid()) {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
            var inv = Object.assign({}, data);
            inv.adjustment_type = "1";
            inv.auto_value_price = inv.auto_value_price == null ? false : inv.auto_value_price;
            inv.invoice_files = [];
            inv.doc_relate_date = moment__WEBPACK_IMPORTED_MODULE_1__(data.doc_relate_date).format('YYYY-MM-DD');
            this.vatService.xuatMauBienBan(inv).subscribe(function (rs) {
                if (rs.status == 'success') {
                    var file = rs.data.invoice;
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Helper"].dowloadFile(file.file_name, 'xlsx', file.file_content);
                }
                else {
                    _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                }
            }, function (err) { }, function () {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            });
        }
    };
    ReportTaxInvoiceErrorComponent.prototype.viewDetailInvoice = function (data) {
        var _this = this;
        if (data) {
            if (data.xml_type == 4 && _core_index__WEBPACK_IMPORTED_MODULE_3__["VStringService"]._getValueToString(data.link_pdf_file) != "") {
                var oData = {
                    url: data.link_pdf_file,
                    type: 'pdf'
                };
                var popup_1 = window.open('about:blank', 'name', "width=200, height=100");
                setTimeout(function () {
                    popup_1.document.body.innerHTML = _this._translate.NOTIFY.loading;
                    popup_1.blur();
                }, 30);
                this.spinner.show();
                var sub_1 = this.searchService.getFilePdf(oData).subscribe(function (rs) {
                    if (rs.status === 'success') {
                        var w = 1920, h = 900;
                        w = window.screen.availWidth * 100 / 100;
                        h = window.screen.availHeight * 93 / 100;
                        var pdf_file = rs.data.file_content;
                        var objectUrl = _core_index__WEBPACK_IMPORTED_MODULE_3__["VPreviewInvService"]._getUrlInvoice(pdf_file);
                        var win = window.open(objectUrl, 'name', 'width=' + w + ', height=' + h);
                        win.resizeTo(screen.availWidth, screen.availHeight);
                        win.focus();
                        _this.spinner.hide();
                    }
                    else {
                        popup_1.close();
                        _this.spinner.hide();
                        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
                    }
                }, function (err) {
                    _this.spinner.hide();
                }, function () {
                    sub_1.unsubscribe();
                });
            }
            else {
                var ids = [];
                ids.push(data.id);
                if (this.configs.system_parameter.view_multi_invoice) {
                    var data_1 = this.vatService.taodulieuXemMau(ids);
                    data_1['configs'] = _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].cauhinhxemmau.hoadon;
                    this.vPreviewInvService.xemMau(data_1);
                }
                else {
                    var initialState = {
                        items: ids,
                        isXuatHD: false,
                        hinhthucxuat: '',
                        typeAction: _core_index__WEBPACK_IMPORTED_MODULE_3__["sEnum"].typeCode.xem_hoa_don
                    };
                    this.vPreviewInvService.xemMauPhanTrang(initialState);
                }
            }
        }
        else {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(this._translate.NOTIFY.no_record_selected, 'error');
        }
    };
    ReportTaxInvoiceErrorComponent.prototype.onImportShowing = function (e) {
        this.valueProgress = 0;
    };
    ReportTaxInvoiceErrorComponent.prototype.onImportHiding = function (e) {
        var r = true;
        if (this.valueProgress < 100 && this.errorImport == false) {
            r = confirm(this._translate.CONFIRM.sign_stop);
        }
        if (r) {
            if (this.subXuatHoaDon) {
                this.subXuatHoaDon.unsubscribe();
            }
            this.valueProgress = 0;
        }
        else {
            e.cancel = true;
        }
    };
    ReportTaxInvoiceErrorComponent.prototype.dong = function () {
        this.bsModalRef.hide();
        if (this.isSchool) {
            this.router.navigate(['/system/handle-invoice-student/']);
        }
        else {
            this.router.navigate(['/system/handle-invoice/']);
        }
    };
    // onEditorPreparing(e) {
    //   if (e.parentType === 'dataRow') {
    //     if (e.dataField != 'notification_nature' && e.dataField != 'reason') {
    //       if (!e.row.data.row_edit)
    //         e.editorOptions.disabled = true;
    //       else
    //         e.editorOptions.disabled = false;
    //     }
    //   }
    // }
    ReportTaxInvoiceErrorComponent.prototype.onCellPrepared = function (e) {
        if (e.rowType == "data") {
            /* Bôi đỏ các trường bắt buộc */
            if (e.column.dataField == "notification_nature") {
                if (!e.data.notification_nature) {
                    e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                    e.cellElement.title = "Tính chất thông báo" + " " + this._translate.VALIDATION.required;
                }
                else {
                    if (!e.data.row_edit) {
                        // Gốc và bị điều chỉnh
                        if (e.data.adjustment_type == "1" || e.data.adjustment_type == "4") {
                            if (e.data.notification_nature != "2" && e.data.notification_nature != "4") {
                                e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                                e.cellElement.title = "Chỉ được chọn tính chất thông báo là Giải trình và Điều chỉnh";
                            }
                        }
                        // Bị thay thế
                        if (e.data.adjustment_type == "2") {
                            if (e.data.notification_nature != "3" && e.data.notification_nature != "4") {
                                e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                                e.cellElement.title = "Chỉ được chọn tính chất thông báo là Giải trình và Thay thế";
                            }
                        }
                        // thay thế/điều chỉnh
                        if (e.data.adjustment_type == "3" || e.data.adjustment_type == "5") {
                            if (e.data.notification_nature != "4") {
                                e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                                e.cellElement.title = "Chỉ được chọn tính chất thông báo là Giải trình";
                            }
                        }
                        // xoá bỏ
                        if (e.data.adjustment_type == "7") {
                            if (e.data.notification_nature != "1" && e.data.notification_nature != "4") {
                                e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                                e.cellElement.title = "Chỉ được chọn tính chất thông báo là Giải trình và Huỷ";
                            }
                        }
                    }
                }
            }
            if (e.column.dataField == "reason") {
                if (!e.data.reason) {
                    e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                    e.cellElement.title = "Lý do" + " " + this._translate.VALIDATION.required;
                }
            }
            /* Valid nhập tay */
            if (e.data.row_edit) {
                if (e.column.dataField == "type_apply_invoice") {
                    if (!e.data.type_apply_invoice) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = "Loại áp dụng HĐ ĐT" + " " + this._translate.VALIDATION.required;
                    }
                }
                if (e.column.dataField == "template_code") {
                    if (!e.data.template_code) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = "Mẫu số" + " " + this._translate.VALIDATION.required;
                    }
                    else {
                        var validTemplateCode = false;
                        if (e.data.type_apply_invoice == 1) {
                            if (e.data.template_code != "1" && e.data.template_code != "2" && e.data.template_code != "3" && e.data.template_code != "4"
                                && e.data.template_code != "5" && e.data.template_code != "6") {
                                validTemplateCode = true;
                            }
                        }
                        else if (e.data.type_apply_invoice == 4) {
                            if (e.data.template_code.length == 11) {
                                var char1 = e.data.template_code.substring(0, 6);
                                var char2 = e.data.template_code.substring(7, 6);
                                var char3 = e.data.template_code.substring(8, 7);
                                var char4 = e.data.template_code.substring(8);
                                if (char1 != "01GTKT" && char1 != "02GTTT" && char1 != "03XKNB" && char1 != "04HGDL" && char1 != "07KPTQ") {
                                    validTemplateCode = true;
                                }
                                else {
                                    if (isNaN(+Number(char2)))
                                        validTemplateCode = true;
                                    else {
                                        if (e.data.type_apply_invoice == 4 && Number(char2) == 0)
                                            validTemplateCode = true;
                                    }
                                }
                                if (char3.length != 1 || char3 != "/")
                                    validTemplateCode = true;
                                if (char4.length != 3 || isNaN(+Number(char4)))
                                    validTemplateCode = true;
                            }
                            else
                                validTemplateCode = true;
                        }
                        if (validTemplateCode) {
                            e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                            e.cellElement.title = "Mẫu số" + " " + "không đúng định dạng";
                        }
                    }
                }
                if (e.column.dataField == "invoice_series") {
                    if (!e.data.invoice_series) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = "Ký hiệu" + " " + this._translate.VALIDATION.required;
                    }
                    else {
                        var validInvoiceSeries = false;
                        /* Thông tư 78 */
                        if (e.data.type_apply_invoice == 1) {
                            if (e.data.invoice_series.length == 6) {
                                var char1 = e.data.invoice_series.substring(1, 0);
                                var char2 = e.data.invoice_series.substring(3, 1);
                                var char3 = e.data.invoice_series.substring(4, 3);
                                var char4 = e.data.invoice_series.substring(5, 4);
                                var char5 = e.data.invoice_series.substring(6, 5);
                                if (char1 != "C" && char1 != "K")
                                    validInvoiceSeries = true;
                                if (char2.length != 2 || isNaN(+Number(char2)))
                                    validInvoiceSeries = true;
                                if (char3 != "T" && char3 != "D" && char3 != "L" && char3 != "M"
                                    && char3 != "N" && char3 != "B" && char3 != "G" && char3 != "H")
                                    validInvoiceSeries = true;
                                if (!isNaN(+Number(char4)) || !isNaN(+Number(char5)))
                                    validInvoiceSeries = true;
                            }
                            else {
                                validInvoiceSeries = true;
                            }
                        }
                        else if (e.data.type_apply_invoice == 4) {
                            if (e.data.invoice_series.length == 8) {
                                var char1 = e.data.invoice_series.substring(3, 2);
                                var char2 = e.data.invoice_series.substring(4, 3);
                                var char3 = e.data.invoice_series.substring(5, 4);
                                var char4 = e.data.invoice_series.substring(7, 5);
                                var char5 = e.data.invoice_series.substring(8, 7);
                                var char6 = e.data.invoice_series.substring(2, 0);
                                if (!isNaN(+Number(char1)) || !isNaN(+Number(char2)))
                                    validInvoiceSeries = true;
                                if (char3.length != 1 || char3 != "/")
                                    validInvoiceSeries = true;
                                if (char4.length != 2 || isNaN(+Number(char4)))
                                    validInvoiceSeries = true;
                                if (char5 != "P")
                                    validInvoiceSeries = true;
                                if (isNaN(+Number(char6))) {
                                    validInvoiceSeries = true;
                                }
                                else {
                                    if (Number(char6) == 0 || Number(char6) > 65)
                                        validInvoiceSeries = true;
                                }
                            }
                            else
                                validInvoiceSeries = true;
                        }
                        if (validInvoiceSeries) {
                            e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                            e.cellElement.title = "Ký hiệu" + " " + "không đúng định dạng";
                        }
                    }
                }
                if (e.column.dataField == "invoice_number") {
                    if (!e.data.invoice_number) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = "Số hóa đơn" + " " + this._translate.VALIDATION.required;
                    }
                }
                if (e.column.dataField == "invoice_date") {
                    if (!e.data.invoice_date) {
                        e.cellElement.style.background = "red url('assets/img/icons/fa-remove.png') no-repeat 2% center";
                        e.cellElement.title = "Ngày hóa đơn" + " " + this._translate.VALIDATION.required;
                    }
                }
            }
        }
    };
    ReportTaxInvoiceErrorComponent.prototype.GuiThongBao = function () {
        var _this = this;
        setTimeout(function () {
            if (_this._validGrid()) {
                _this.invoicesStore.load().then(function (dataSource) {
                    if (dataSource.length > 0) {
                        _this.invoices = [];
                        dataSource.forEach(function (item) {
                            var object = new Object;
                            object["tax_authority_code"] = item.tax_authority_code;
                            object["template_code"] = item.template_code;
                            object["invoice_series"] = item.invoice_series;
                            object["invoice_date"] = item.invoice_date;
                            object["invoice_number"] = item.invoice_number;
                            object["reason"] = item.reason;
                            object["notification_nature"] = item.notification_nature;
                            object["type_apply_invoice"] = item.type_apply_invoice;
                            object["is_invoice_with_code"] = item.is_invoice_with_code;
                            object["invoice_id"] = item.invoice_id;
                            _this.invoices.push(object);
                        });
                        _this.xuatHoaDon();
                    }
                });
            }
        }, 300);
    };
    ReportTaxInvoiceErrorComponent.prototype.onClickUnitType = function () {
        this.isDisplayUnitRisk = !this.isDisplayUnitRisk;
    };
    ReportTaxInvoiceErrorComponent.prototype.changedUnitRisk = function (data) {
        this.isReadOnly = !data.value;
    };
    __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ViewChild"])(devextreme_angular__WEBPACK_IMPORTED_MODULE_2__["DxDataGridComponent"]),
        __metadata("design:type", devextreme_angular__WEBPACK_IMPORTED_MODULE_2__["DxDataGridComponent"])
    ], ReportTaxInvoiceErrorComponent.prototype, "dataGrid", void 0);
    ReportTaxInvoiceErrorComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-report-tax-invoice-error',
            template: __webpack_require__(/*! ./report-tax-invoice-error.component.html */ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.html"),
            styles: [__webpack_require__(/*! ./report-tax-invoice-error.component.scss */ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.scss")]
        }),
        __metadata("design:paramtypes", [ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_5__["BsModalRef"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["SocketService"],
            _shared__WEBPACK_IMPORTED_MODULE_4__["HandleInvoiceService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["AuthService"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_6__["VatService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_9__["TranslateService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_13__["Router"],
            ngx_spinner__WEBPACK_IMPORTED_MODULE_14__["NgxSpinnerService"],
            _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_15__["ViewInvoiceService"],
            _modules_search_shared__WEBPACK_IMPORTED_MODULE_16__["SearchService"]])
    ], ReportTaxInvoiceErrorComponent);
    return ReportTaxInvoiceErrorComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.html":
/*!**********************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.html ***!
  \**********************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<form>\r\n    <div class=\"modal-header\">\r\n      <h4 class=\"modal-title pull-left\">THEO DÕI GỬI - NHẬN HÓA ĐƠN ĐIỆN TỬ</h4>\r\n      <button type=\"button\" class=\"close pull-right\" aria-label=\"Close\" (click)=\"bsModalRef.hide()\">\r\n        <span aria-hidden=\"true\">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"modal-body\">\r\n      <div class=\"container-fluid\">\r\n        <div class=\"row\">\r\n          <div class=\"col-lg-8\">\r\n            <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n              <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n                <dxi-item [label]=\"{text: 'Mẫu hóa đơn'}\" dataField=\"template\"  [editorOptions]=\"{readOnly: true}\">\r\n                </dxi-item>\r\n              </dxi-item>\r\n              <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n                <dxi-item dataField=\"invoice_date\" [label]=\"{text: 'Ngày hóa đơn'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item cssClass=\"invoice-number-create-invoice\" dataField=\"invoice_number\" [label]=\"{text: 'Số hóa đơn'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item dataField=\"customer_code\" [label]=\"{text: 'Mã khách hàng'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item dataField=\"buyer_tax_code\" [label]=\"{text: 'MST'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item dataField=\"buyer_name\" [label]=\"{text: 'Họ tên người mua'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item dataField=\"buyer_mobile\" [label]=\"{text: 'Điện thoại liên hệ'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n              </dxi-item>\r\n              <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n                <dxi-item dataField=\"buyer_name\" [label]=\"{text: 'Tên khách hàng'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n              </dxi-item>\r\n            </dx-form>\r\n          </div>\r\n          <div class=\"col-lg-4\">\r\n            <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n              <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n                <dxi-item cssClass=\"form-input-visibility\" dataField=\"invoice_date\" [label]=\"{text: 'temp'}\"></dxi-item>\r\n                <dxi-item dataField=\"a\" [label]=\"{text: 'Số xác thực'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n              </dxi-item>\r\n              <dxi-item itemType=\"group\" [colCount]=\"2\">\r\n                  <dxi-item dataField=\"currency_code\" [label]=\"{text: 'Loại tiền'}\"  [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item dataField=\"currency_rate\" [label]=\"{text: 'Tỉ giá'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n              </dxi-item>\r\n              <dxi-item itemType=\"group\" [colCount]=\"1\">\r\n                  <dxi-item dataField=\"payment_method_name\" [label]=\"{text: 'HTTH'}\"  [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n                <dxi-item dataField=\"buyer_email\" [label]=\"{text: 'Email'}\" [editorOptions]=\"{disabled: true}\"></dxi-item>\r\n              </dxi-item>\r\n            </dx-form>\r\n          </div>\r\n          <div class=\"col-lg-12 link-send-invoice\">\r\n            <div class=\"pull-right\">\r\n              <a *ngIf=\"invoice.status == 'DA_XUAT'\" (click)=\"sendMail()\" href=\"javascript:void(0)\">Gửi hóa đơn</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <dx-data-grid\r\n        id=\"invoiceHistoryGrid\"\r\n        [dataSource]=\"invoice_process\"\r\n        [showBorders]=\"true\"\r\n        [showRowLines]=\"true\"\r\n        [allowColumnResizing]=\"true\"\r\n        [columnResizingMode]=\"true\"\r\n        [wordWrapEnabled]=\"true\"\r\n      >\r\n        <dxo-scrolling mode=\"virtual\"></dxo-scrolling>\r\n        <dxi-column cellTemplate=\"stt\" caption=\"STT\" width=\"80\" alignment=\"center\"></dxi-column>\r\n        <dxi-column dataField=\"process_time\" caption=\"Ngày thực hiện\" width=\"180\" dataType=\"datetime\" format=\"dd/MM/yyyy HH:mm:ss\" dateSerializationFormat=\"yyyy-MM-dd HH:mm:ss\" alignment=\"center\"></dxi-column>\r\n        <dxi-column dataField=\"content\" caption=\"Công việc\" alignment=\"left\"></dxi-column>\r\n        <dxi-column dataField=\"user.name\" [width]=\"150\"  caption=\"Người thực hiện\" alignment=\"left\"></dxi-column>\r\n        <div *dxTemplate=\"let d of 'stt'\">\r\n          <p>{{ d.rowIndex + 1 }}</p>\r\n        </div>\r\n      </dx-data-grid>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <dx-button text=\"Quay lại\" icon=\"assets\\img\\icons\\QuayLai.png\" type=\"default\" (click)=\"bsModalRef.hide()\">\r\n      </dx-button>\r\n    </div>\r\n  </form>\r\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.scss":
/*!**********************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.scss ***!
  \**********************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "::ng-deep .form-input-visibility{visibility:hidden}::ng-deep .invoice-number-create-invoice input{color:red;font-weight:bold}.link-send-invoice{margin-top:10px}.link-send-invoice a{text-decoration:underline}#invoiceHistoryGrid{margin-top:15px}\n"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.ts":
/*!********************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.ts ***!
  \********************************************************************************************/
/*! exports provided: SendInvoicesComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SendInvoicesComponent", function() { return SendInvoicesComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ngx-bootstrap/modal */ "./node_modules/ngx-bootstrap/modal/index.js");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _send_mail_send_mail_component__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../send-mail/send-mail.component */ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.ts");
/* harmony import */ var _modules_customers_shared__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/customers/shared */ "./src/app/modules/customers/shared/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};







var SendInvoicesComponent = /** @class */ (function () {
    function SendInvoicesComponent(bsModalRef, vatService, modalService, bsModalSendMail, customersService) {
        this.bsModalRef = bsModalRef;
        this.vatService = vatService;
        this.modalService = modalService;
        this.bsModalSendMail = bsModalSendMail;
        this.customersService = customersService;
        this.frmData = {};
    }
    SendInvoicesComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.loadTableContent();
        console.log(this.invoice);
        var invoice = this.invoice;
        this.frmData.template = invoice.template_code + " - " + invoice.invoice_series;
        this.frmData.invoice_date = moment__WEBPACK_IMPORTED_MODULE_1__(invoice.invoice_date).format('DD/MM/YYYY');
        this.frmData.invoice_number = invoice.invoice_number;
        this.frmData.customer_code = invoice.customer_code;
        this.frmData.buyer_tax_code = invoice.buyer_tax_code;
        this.frmData.buyer_name = invoice.buyer_name;
        this.frmData.buyer_mobile = invoice.buyer_mobile;
        this.frmData.buyer_email = invoice.buyer_email;
        this.frmData.currency_code = invoice.currency_code;
        this.frmData.payment_method_name = invoice.payment_method_view_name;
        this.customersService.getCustomer(this.frmData.customer_id).subscribe(function (response) {
            if (response.status == "success") {
                var customer = response.data.customer;
                if (customer)
                    _this.email = customer.email;
            }
        });
    };
    SendInvoicesComponent.prototype.loadTableContent = function () {
        var _this = this;
        this.invoice_process = {};
        var sub = this.vatService.getInvoiceProccess(this.invoice.id).subscribe(function (rs) {
            _this.invoice_process = rs.data.invoice_process;
        }, function (err) { }, function () {
            sub.unsubscribe();
        });
    };
    SendInvoicesComponent.prototype.sendMail = function () {
        var _this = this;
        var initialState = {
            invoice_id: this.invoice.id,
            email: this.email
        };
        this.bsModalSendMail = this.modalService.show(_send_mail_send_mail_component__WEBPACK_IMPORTED_MODULE_5__["SendMailComponent"], { class: 'modal-md', initialState: initialState, backdrop: 'static', keyboard: false });
        this.modalService.onHide.subscribe(function () {
            if (_this.bsModalRef.content.successSaveItem == 'success_mail') {
                _this.loadTableContent();
            }
        });
    };
    SendInvoicesComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-send-invoices',
            template: __webpack_require__(/*! ./send-invoices.component.html */ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.html"),
            styles: [__webpack_require__(/*! ./send-invoices.component.scss */ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.scss")]
        }),
        __metadata("design:paramtypes", [ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__["BsModalRef"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__["VatService"],
            ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_3__["BsModalService"],
            ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_2__["BsModalRef"],
            _modules_customers_shared__WEBPACK_IMPORTED_MODULE_6__["CustomersService"]])
    ], SendInvoicesComponent);
    return SendInvoicesComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.html":
/*!**************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/send-mail/send-mail.component.html ***!
  \**************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<form (ngSubmit)=\"onSubmit($event)\">\r\n    <div class=\"modal-header\">\r\n      <h4 class=\"modal-title pull-left\">GỬI EMAIL</h4>\r\n      <button type=\"button\" class=\"close pull-right\" aria-label=\"Close\" (click)=\"bsModalRef.hide()\">\r\n        <span aria-hidden=\"true\">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"modal-body\">\r\n      <dx-form [formData]=\"frmData\" validationGroup=\"formData\">\r\n        <dxi-item dataField=\"email\" [label]=\"{text: 'Email'}\">\r\n          <dxi-validation-rule type=\"required\" message=\"Email không được để trống\"></dxi-validation-rule>\r\n          <!-- <dxi-validation-rule type=\"pattern\" [pattern]=\"pattern.email\" message=\"Email không đúng định dạng\"></dxi-validation-rule> -->\r\n        </dxi-item>\r\n      </dx-form>\r\n      <div style=\"margin-top: 10px;\">\r\n          <a style=\"color: silver;text-decoration: underline;font-size: 90%;\">{{_translate.CONTROLL.LABEL.note1}}: </a><a style=\"color: silver;font-size: 90%;\"> Nhập danh sách email. Mỗi email cách nhau bởi dấu ;</a>\r\n        </div>\r\n        <div style=\"margin-top: 5px;\">\r\n            <a style=\"color: silver;font-size: 90%;\">Ví dụ: admin@efy.com.vn;sale@efy.com.vn</a>\r\n          </div>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <dx-button text=\"{{_translate.CONTROLL.BUTTON.send}}\" icon=\"{{_translate.ICONS.send_email}}\" type=\"default\" validationGroup=\"formData\" [useSubmitBehavior]=\"true\">\r\n      </dx-button>\r\n      <dx-button text=\"{{_translate.CONTROLL.BUTTON.come_back}}\" icon=\"{{_translate.ICONS.come_back}}\" type=\"default\" (click)=\"bsModalRef.hide()\">\r\n      </dx-button>\r\n    </div>\r\n  </form>"

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.scss":
/*!**************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/send-mail/send-mail.component.scss ***!
  \**************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ""

/***/ }),

/***/ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.ts":
/*!************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/components/send-mail/send-mail.component.ts ***!
  \************************************************************************************/
/*! exports provided: SendMailComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SendMailComponent", function() { return SendMailComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ngx-bootstrap/modal/bs-modal-ref.service */ "./node_modules/ngx-bootstrap/modal/bs-modal-ref.service.js");
/* harmony import */ var _config_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @config/index */ "./src/app/config/index.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};





var SendMailComponent = /** @class */ (function () {
    function SendMailComponent(bsModalRef, vatService, authService) {
        this.bsModalRef = bsModalRef;
        this.vatService = vatService;
        this.authService = authService;
        this.frmData = {};
        this.pattern = _config_index__WEBPACK_IMPORTED_MODULE_2__["pattern"];
        this._translate = this.authService.getTranslate();
    }
    SendMailComponent.prototype.ngOnInit = function () {
        this.frmData.email = this.email;
    };
    SendMailComponent.prototype.onSubmit = function (e) {
        var _this = this;
        var data = [{
                id: this.invoice_id,
                email: this.frmData.email
            }];
        _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].showloading();
        var sub = this.vatService.sendMail(data).subscribe(function (rs) {
            if (rs.status == 'success') {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify('Gửi mail thành công', 'success');
                _this.bsModalRef.content.successSaveItem = "success_mail";
                _this.bsModalRef.hide();
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].notify(rs.message, 'error');
            }
        }, function (err) { }, function () {
            _core_index__WEBPACK_IMPORTED_MODULE_3__["Library"].hideloading();
            sub.unsubscribe();
        });
    };
    SendMailComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-send-mail',
            template: __webpack_require__(/*! ./send-mail.component.html */ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.html"),
            styles: [__webpack_require__(/*! ./send-mail.component.scss */ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.scss")]
        }),
        __metadata("design:paramtypes", [ngx_bootstrap_modal_bs_modal_ref_service__WEBPACK_IMPORTED_MODULE_1__["BsModalRef"],
            _modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__["VatService"],
            _core_index__WEBPACK_IMPORTED_MODULE_3__["AuthService"]])
    ], SendMailComponent);
    return SendMailComponent;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/handle-invoice.module.ts":
/*!*****************************************************************!*\
  !*** ./src/app/modules/handle-invoice/handle-invoice.module.ts ***!
  \*****************************************************************/
/*! exports provided: HandleInvoiceModule */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HandleInvoiceModule", function() { return HandleInvoiceModule; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/common */ "./node_modules/@angular/common/fesm5/common.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var _shared_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @shared/index */ "./src/app/shared/index.ts");
/* harmony import */ var _shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var _shared_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./shared/adjust-multiple-invoice.resolver */ "./src/app/modules/handle-invoice/shared/adjust-multiple-invoice.resolver.ts");
/* harmony import */ var _shared_show_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./shared/show-adjust-multiple-invoice.resolver */ "./src/app/modules/handle-invoice/shared/show-adjust-multiple-invoice.resolver.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _handle_invoice_routing__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./handle-invoice.routing */ "./src/app/modules/handle-invoice/handle-invoice.routing.ts");
/* harmony import */ var _components_index_index_component__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./components/index/index.component */ "./src/app/modules/handle-invoice/components/index/index.component.ts");
/* harmony import */ var _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./components/adjust/adjust-invoice/adjust-invoice.component */ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.ts");
/* harmony import */ var _components_adjust_adjust_form_invoice_adjust_form_invoice_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./components/adjust/adjust-form-invoice/adjust-form-invoice.component */ "./src/app/modules/handle-invoice/components/adjust/adjust-form-invoice/adjust-form-invoice.component.ts");
/* harmony import */ var _components_adjust_adjust_product_grip_adjust_product_grip_component__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./components/adjust/adjust-product-grip/adjust-product-grip.component */ "./src/app/modules/handle-invoice/components/adjust/adjust-product-grip/adjust-product-grip.component.ts");
/* harmony import */ var _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./components/replace/replace-invoice/replace-invoice.component */ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.ts");
/* harmony import */ var _components_replace_replace_form_invoice_replace_form_invoice_component__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./components/replace/replace-form-invoice/replace-form-invoice.component */ "./src/app/modules/handle-invoice/components/replace/replace-form-invoice/replace-form-invoice.component.ts");
/* harmony import */ var _components_replace_replace_product_grip_replace_product_grip_component__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./components/replace/replace-product-grip/replace-product-grip.component */ "./src/app/modules/handle-invoice/components/replace/replace-product-grip/replace-product-grip.component.ts");
/* harmony import */ var _components_remove_remove_component__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./components/remove/remove.component */ "./src/app/modules/handle-invoice/components/remove/remove.component.ts");
/* harmony import */ var _components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./components/send-invoices/send-invoices.component */ "./src/app/modules/handle-invoice/components/send-invoices/send-invoices.component.ts");
/* harmony import */ var _components_send_mail_send_mail_component__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./components/send-mail/send-mail.component */ "./src/app/modules/handle-invoice/components/send-mail/send-mail.component.ts");
/* harmony import */ var _components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./components/choose-hdck/choose-hdck.component */ "./src/app/modules/handle-invoice/components/choose-hdck/choose-hdck.component.ts");
/* harmony import */ var _core_module_v_translate_module__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @core/module/v-translate.module */ "./src/app/core/module/v-translate.module.ts");
/* harmony import */ var _shared_modules_vat_shared_components_view_attach_file_view_attach_file_component__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @shared/modules/vat-shared/components/view-attach-file/view-attach-file.component */ "./src/app/shared/modules/vat-shared/components/view-attach-file/view-attach-file.component.ts");
/* harmony import */ var _components_report_cancel_inv_report_cancel_inv_component__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./components/report-cancel-inv/report-cancel-inv.component */ "./src/app/modules/handle-invoice/components/report-cancel-inv/report-cancel-inv.component.ts");
/* harmony import */ var _components_report_adjust_inv_report_adjust_inv_component__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./components/report-adjust-inv/report-adjust-inv.component */ "./src/app/modules/handle-invoice/components/report-adjust-inv/report-adjust-inv.component.ts");
/* harmony import */ var _modules_handle_report_hanlde_report_service__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @modules/handle-report/hanlde-report.service */ "./src/app/modules/handle-report/hanlde-report.service.ts");
/* harmony import */ var _modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @modules/vat/deactivate/vat-deactivate.guard */ "./src/app/modules/vat/deactivate/vat-deactivate.guard.ts");
/* harmony import */ var _shared_router_router_library_service__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @shared/router/router-library.service */ "./src/app/shared/router/router-library.service.ts");
/* harmony import */ var _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @shared/service/confirm.service */ "./src/app/shared/service/confirm.service.ts");
/* harmony import */ var devextreme_angular__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! devextreme-angular */ "./node_modules/devextreme-angular/fesm5/devextreme-angular.js");
/* harmony import */ var _modules_products_shared__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! @modules/products/shared */ "./src/app/modules/products/shared/index.ts");
/* harmony import */ var _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.ts");
/* harmony import */ var _components_adjust_multiple_adjust_multipl_form_invoice_adjust_multipl_form_invoice_component__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-form-invoice/adjust-multipl-form-invoice.component.ts");
/* harmony import */ var _components_adjust_multiple_adjust_multipl_product_grip_adjust_multipl_product_grip_component__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-product-grip/adjust-multipl-product-grip.component.ts");
/* harmony import */ var _modules_customers_shared__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! @modules/customers/shared */ "./src/app/modules/customers/shared/index.ts");
/* harmony import */ var _modules_template_shared__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! @modules/template/shared */ "./src/app/modules/template/shared/index.ts");
/* harmony import */ var _components_report_tax_invoice_error_report_tax_invoice_error_component__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./components/report-tax-invoice-error/report-tax-invoice-error.component */ "./src/app/modules/handle-invoice/components/report-tax-invoice-error/report-tax-invoice-error.component.ts");
/* harmony import */ var ngx_spinner__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ngx-spinner */ "./node_modules/ngx-spinner/fesm5/ngx-spinner.js");
/* harmony import */ var _shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! @shared/modules/some/components/add-wavehourse/add-wavehourse.component */ "./src/app/shared/modules/some/components/add-wavehourse/add-wavehourse.component.ts");
/* harmony import */ var _shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! @shared/components/preview-invoice/preview-invoice.component */ "./src/app/shared/components/preview-invoice/preview-invoice.component.ts");
/* harmony import */ var _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! @core/library/invoice/my-bsmodel.service */ "./src/app/core/library/invoice/my-bsmodel.service.ts");
/* harmony import */ var _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! @shared/service/view-invoice.service */ "./src/app/shared/service/view-invoice.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};


//library

//general







































var HandleInvoiceModule = /** @class */ (function () {
    function HandleInvoiceModule() {
    }
    HandleInvoiceModule = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["NgModule"])({
            imports: [
                _angular_common__WEBPACK_IMPORTED_MODULE_1__["CommonModule"],
                _handle_invoice_routing__WEBPACK_IMPORTED_MODULE_8__["routing"],
                _shared_index__WEBPACK_IMPORTED_MODULE_3__["SharedModule"],
                _shared_index__WEBPACK_IMPORTED_MODULE_3__["VatSharedModule"],
                _core_index__WEBPACK_IMPORTED_MODULE_2__["devextremeModule"],
                _core_module_v_translate_module__WEBPACK_IMPORTED_MODULE_20__["vTranslateModule"],
                devextreme_angular__WEBPACK_IMPORTED_MODULE_28__["DxPopoverModule"],
                ngx_spinner__WEBPACK_IMPORTED_MODULE_36__["NgxSpinnerModule"],
                _shared_index__WEBPACK_IMPORTED_MODULE_3__["SomeModule"]
            ],
            declarations: [
                _components_index_index_component__WEBPACK_IMPORTED_MODULE_9__["IndexComponent"],
                _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_10__["AdjustInvoiceComponent"],
                _components_adjust_adjust_form_invoice_adjust_form_invoice_component__WEBPACK_IMPORTED_MODULE_11__["AdjustFormInvoiceComponent"],
                _components_adjust_adjust_product_grip_adjust_product_grip_component__WEBPACK_IMPORTED_MODULE_12__["AdjustProductGripComponent"],
                _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_13__["ReplaceInvoiceComponent"],
                _components_replace_replace_form_invoice_replace_form_invoice_component__WEBPACK_IMPORTED_MODULE_14__["ReplaceFormInvoiceComponent"],
                _components_replace_replace_product_grip_replace_product_grip_component__WEBPACK_IMPORTED_MODULE_15__["ReplaceProductGripComponent"],
                _components_remove_remove_component__WEBPACK_IMPORTED_MODULE_16__["RemoveComponent"],
                _components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_17__["SendInvoicesComponent"],
                _components_send_mail_send_mail_component__WEBPACK_IMPORTED_MODULE_18__["SendMailComponent"],
                _components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_19__["ChooseHdckComponent"],
                _components_report_cancel_inv_report_cancel_inv_component__WEBPACK_IMPORTED_MODULE_22__["ReportCancelInvComponent"],
                _components_report_adjust_inv_report_adjust_inv_component__WEBPACK_IMPORTED_MODULE_23__["ReportAdjustInvComponent"],
                _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_30__["AdjustMultiplInvoiceComponent"],
                _components_adjust_multiple_adjust_multipl_form_invoice_adjust_multipl_form_invoice_component__WEBPACK_IMPORTED_MODULE_31__["AdjustMultiplFormInvoiceComponent"],
                _components_adjust_multiple_adjust_multipl_product_grip_adjust_multipl_product_grip_component__WEBPACK_IMPORTED_MODULE_32__["AdjustMultiplProductGripComponent"],
                _components_report_tax_invoice_error_report_tax_invoice_error_component__WEBPACK_IMPORTED_MODULE_35__["ReportTaxInvoiceErrorComponent"],
            ],
            entryComponents: [
                _components_remove_remove_component__WEBPACK_IMPORTED_MODULE_16__["RemoveComponent"],
                _components_send_invoices_send_invoices_component__WEBPACK_IMPORTED_MODULE_17__["SendInvoicesComponent"],
                _components_send_mail_send_mail_component__WEBPACK_IMPORTED_MODULE_18__["SendMailComponent"],
                _components_choose_hdck_choose_hdck_component__WEBPACK_IMPORTED_MODULE_19__["ChooseHdckComponent"],
                _shared_modules_vat_shared_components_view_attach_file_view_attach_file_component__WEBPACK_IMPORTED_MODULE_21__["ViewAttachFileComponent"],
                _components_report_cancel_inv_report_cancel_inv_component__WEBPACK_IMPORTED_MODULE_22__["ReportCancelInvComponent"],
                _components_report_adjust_inv_report_adjust_inv_component__WEBPACK_IMPORTED_MODULE_23__["ReportAdjustInvComponent"],
                _shared_index__WEBPACK_IMPORTED_MODULE_3__["NotifyReduceTaxComponent"],
                _components_report_tax_invoice_error_report_tax_invoice_error_component__WEBPACK_IMPORTED_MODULE_35__["ReportTaxInvoiceErrorComponent"],
                _shared_index__WEBPACK_IMPORTED_MODULE_3__["SendDataForTaxComponent"],
                _shared_modules_some_components_add_wavehourse_add_wavehourse_component__WEBPACK_IMPORTED_MODULE_37__["AddWavehourseComponent"],
                _shared_index__WEBPACK_IMPORTED_MODULE_3__["ViewInvoiceMultipageComponent"],
                _shared_components_preview_invoice_preview_invoice_component__WEBPACK_IMPORTED_MODULE_38__["PreviewInvoiceComponent"]
            ],
            providers: [
                _shared__WEBPACK_IMPORTED_MODULE_4__["HandleInvoiceService"],
                _modules_vat_shared__WEBPACK_IMPORTED_MODULE_7__["VatService"],
                _shared__WEBPACK_IMPORTED_MODULE_4__["AdjustInvoiceResolver"],
                _shared__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceResolver"],
                _shared__WEBPACK_IMPORTED_MODULE_4__["AdjustSaleInvoiceResolver"],
                _shared__WEBPACK_IMPORTED_MODULE_4__["ReplaceSaleInvoiceResolver"],
                _modules_handle_report_hanlde_report_service__WEBPACK_IMPORTED_MODULE_24__["HanldeReportService"],
                _modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_25__["VatDeactivateGuard"],
                _shared_router_router_library_service__WEBPACK_IMPORTED_MODULE_26__["RouterLibraryService"],
                _shared_service_confirm_service__WEBPACK_IMPORTED_MODULE_27__["ConfirmService"],
                _modules_products_shared__WEBPACK_IMPORTED_MODULE_29__["ProductsService"],
                _shared_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_5__["AdjustMultipleInvoiceResolver"],
                _shared_show_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_6__["ShowAdjustMultipleInvoiceResolver"],
                _modules_customers_shared__WEBPACK_IMPORTED_MODULE_33__["CustomersService"],
                _modules_template_shared__WEBPACK_IMPORTED_MODULE_34__["TemplateService"],
                _core_library_invoice_my_bsmodel_service__WEBPACK_IMPORTED_MODULE_39__["MyBsModalService"],
                _shared_service_view_invoice_service__WEBPACK_IMPORTED_MODULE_40__["ViewInvoiceService"]
            ]
        })
    ], HandleInvoiceModule);
    return HandleInvoiceModule;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/handle-invoice.routing.ts":
/*!******************************************************************!*\
  !*** ./src/app/modules/handle-invoice/handle-invoice.routing.ts ***!
  \******************************************************************/
/*! exports provided: routing */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "routing", function() { return routing; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var _components_index_index_component__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/index/index.component */ "./src/app/modules/handle-invoice/components/index/index.component.ts");
/* harmony import */ var _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./components/adjust/adjust-invoice/adjust-invoice.component */ "./src/app/modules/handle-invoice/components/adjust/adjust-invoice/adjust-invoice.component.ts");
/* harmony import */ var _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./components/replace/replace-invoice/replace-invoice.component */ "./src/app/modules/handle-invoice/components/replace/replace-invoice/replace-invoice.component.ts");
/* harmony import */ var _shared__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./shared */ "./src/app/modules/handle-invoice/shared/index.ts");
/* harmony import */ var _modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @modules/vat/deactivate/vat-deactivate.guard */ "./src/app/modules/vat/deactivate/vat-deactivate.guard.ts");
/* harmony import */ var _shared_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./shared/adjust-multiple-invoice.resolver */ "./src/app/modules/handle-invoice/shared/adjust-multiple-invoice.resolver.ts");
/* harmony import */ var _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component */ "./src/app/modules/handle-invoice/components/adjust-multiple/adjust-multipl-invoice/adjust-multipl-invoice.component.ts");
/* harmony import */ var _shared_show_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./shared/show-adjust-multiple-invoice.resolver */ "./src/app/modules/handle-invoice/shared/show-adjust-multiple-invoice.resolver.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};










var routes = [
    { path: '', component: _components_index_index_component__WEBPACK_IMPORTED_MODULE_2__["IndexComponent"] },
    {
        path: 'adjust/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        data: {
            type: '01GTKT',
            brec: 'create_invoice_adjustment',
            status: 'dieuchinhmoi'
        }
    },
    {
        path: 'replace/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: {
            type: '01GTKT',
            brec: 'create_invoice_instead',
            status: 'thaythemoi'
        }
    },
    {
        path: 'edit-adjust/:invoiceId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        data: {
            type: '01GTKT',
            brec: 'create_invoice_adjustment'
        }
    },
    {
        path: 'edit-replace/:invoiceId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: {
            type: '01GTKT',
            brec: 'create_invoice_instead'
        }
    },
    {
        path: 'sale-adjust/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        data: {
            type: '02GTTT',
            brec: 'create_invoice_adjustment',
            status: 'dieuchinhmoi'
        }
    },
    {
        path: 'non-tariff-adjust/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        data: {
            type: '07KPTQ',
            brec: 'create_invoice_adjustment',
            status: 'dieuchinhmoi'
        }
    },
    {
        path: 'sale-replace/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: { type: '02GTTT', brec: 'create_invoice_instead', status: 'thaythemoi' }
    },
    {
        path: 'non-tariff-replace/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: { type: '07KPTQ', brec: 'create_invoice_instead', status: 'thaythemoi' }
    },
    {
        path: 'edit-sale-adjust/:invoiceId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        data: { type: '02GTTT', brec: 'create_invoice_adjustment' }
    },
    {
        path: 'edit-non-tariff-adjust/:invoiceId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        data: { type: '07KPTQ', brec: 'create_invoice_adjustment' }
    },
    {
        path: 'edit-sale-replace/:invoiceId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: { type: '02GTTT', brec: 'create_invoice_instead' }
    },
    {
        path: 'edit-non-tariff-replace/:invoiceId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: { type: '07KPTQ', brec: 'create_invoice_instead' }
    },
    {
        path: 'multiple-adjust',
        component: _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__["AdjustMultiplInvoiceComponent"],
        resolve: { init: _shared_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_7__["AdjustMultipleInvoiceResolver"] },
        data: { type: 'dieu-chinh-nhieu', brec: 'Lập hóa đơn điều chỉnh' }
    },
    {
        path: 'multiple-adjust/:invoiceId',
        component: _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__["AdjustMultiplInvoiceComponent"],
        resolve: { init: _shared_show_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_9__["ShowAdjustMultipleInvoiceResolver"] },
        data: { type: 'dieu-chinh-nhieu', brec: 'Lập hóa đơn điều chỉnh' }
    },
    {
        path: 'adjust-without-software',
        component: _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__["AdjustMultiplInvoiceComponent"],
        resolve: { init: _shared_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_7__["AdjustMultipleInvoiceResolver"] },
        data: { type: 'dieu-chinh-khac', brec: 'Lập hóa đơn điều chỉnh' }
    },
    {
        path: 'adjust-without-software/:invoiceId',
        component: _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__["AdjustMultiplInvoiceComponent"],
        resolve: { init: _shared_show_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_9__["ShowAdjustMultipleInvoiceResolver"] },
        data: { type: 'dieu-chinh-khac', brec: 'Lập hóa đơn điều chỉnh' }
    },
    {
        path: 'replace-without-software',
        component: _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__["AdjustMultiplInvoiceComponent"],
        resolve: { init: _shared_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_7__["AdjustMultipleInvoiceResolver"] },
        data: { type: 'thay-the-khac', brec: 'Lập hóa đơn thay thế' }
    },
    {
        path: 'replace-without-software/:invoiceId',
        component: _components_adjust_multiple_adjust_multipl_invoice_adjust_multipl_invoice_component__WEBPACK_IMPORTED_MODULE_8__["AdjustMultiplInvoiceComponent"],
        resolve: { init: _shared_show_adjust_multiple_invoice_resolver__WEBPACK_IMPORTED_MODULE_9__["ShowAdjustMultipleInvoiceResolver"] },
        data: { type: 'thay-the-khac', brec: 'Lập hóa đơn thay thế' }
    },
    {
        path: 'adjust-warehouse/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        data: {
            type: '03XKNB',
            brec: 'create_invoice_adjustment',
            status: 'dieuchinhmoi'
        }
    },
    {
        path: 'replace-warehouse/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: {
            type: '03XKNB',
            brec: 'create_invoice_instead',
            status: 'thaythemoi'
        }
    },
    {
        path: 'adjust-agent/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        data: {
            type: '04HGDL',
            brec: 'create_invoice_adjustment',
            status: 'dieuchinhmoi'
        }
    },
    {
        path: 'replace-agent/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: {
            type: '04HGDL',
            brec: 'create_invoice_instead',
            status: 'thaythemoi'
        }
    },
    {
        path: 'edit-adjust-warehouse/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        data: {
            type: '03XKNB',
            brec: 'create_invoice_adjustment',
        }
    },
    {
        path: 'edit-adjust-agent/:originId',
        component: _components_adjust_adjust_invoice_adjust_invoice_component__WEBPACK_IMPORTED_MODULE_3__["AdjustInvoiceComponent"],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["AdjustInvoiceResolver"] },
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        data: {
            type: '04HGDL',
            brec: 'create_invoice_adjustment',
        }
    },
    {
        path: 'edit-replace-warehouse/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: {
            type: '03XKNB',
            brec: 'create_invoice_instead',
        }
    },
    {
        path: 'edit-replace-agent/:originId',
        component: _components_replace_replace_invoice_replace_invoice_component__WEBPACK_IMPORTED_MODULE_4__["ReplaceInvoiceComponent"],
        canDeactivate: [_modules_vat_deactivate_vat_deactivate_guard__WEBPACK_IMPORTED_MODULE_6__["VatDeactivateGuard"]],
        resolve: { init: _shared__WEBPACK_IMPORTED_MODULE_5__["ReplaceInvoiceResolver"] },
        data: {
            type: '04HGDL',
            brec: 'create_invoice_instead',
        }
    },
];
var routing = /** @class */ (function () {
    function routing() {
    }
    routing = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["NgModule"])({
            imports: [_angular_router__WEBPACK_IMPORTED_MODULE_1__["RouterModule"].forChild(routes)],
            exports: [_angular_router__WEBPACK_IMPORTED_MODULE_1__["RouterModule"]]
        })
    ], routing);
    return routing;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/shared/adjust-multiple-invoice.resolver.ts":
/*!***********************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/shared/adjust-multiple-invoice.resolver.ts ***!
  \***********************************************************************************/
/*! exports provided: AdjustMultipleInvoiceResolver */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdjustMultipleInvoiceResolver", function() { return AdjustMultipleInvoiceResolver; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _modules_lists_shared__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @modules/lists/shared */ "./src/app/modules/lists/shared/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};







var AdjustMultipleInvoiceResolver = /** @class */ (function () {
    function AdjustMultipleInvoiceResolver(vatService, router, listsService, authService) {
        this.vatService = vatService;
        this.router = router;
        this.listsService = listsService;
        this.authService = authService;
    }
    AdjustMultipleInvoiceResolver.prototype.resolve = function (route, state) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        var isTT78 = false;
        var infoDangKy = this.authService.getInfoRegister();
        if (infoDangKy && infoDangKy.id) {
            if (infoDangKy.status == "CHAP_NHAN")
                isTT78 = true;
        }
        var loaiHoaDon = route.data.type;
        var _countDm = 0;
        var dataJoin = [];
        var dataDM;
        /**
         * Thiếu bên học sinh sinh viên, rà soát lại các hàm liên quan
         */
        var arr = [
            {
                "code": "DM_NHOM_KHACH_HANG",
                "order": 0
            },
            {
                "code": "DM_LOAI_TIEN",
                "order": 0
            },
            {
                "code": "DM_HINH_THUC_THANH_TOAN",
                "order": 0
            },
            {
                "code": "DM_DON_VI_TINH",
                "order": 0
            },
            {
                "code": "DM_TY_LE_VAT",
                "order": 0
            },
            {
                "code": "DM_DINH_KHOAN",
                "order": 0
            },
            {
                "code": "DM_NOI_XUAT_HOA_DON",
                "order": 0
            },
            {
                "code": "DM_QUOC_GIA",
                "order": 0
            },
            {
                "code": "DM_TAI_KHOAN_NGAN_HANG",
                "order": 0
            },
        ];
        dataDM = this.listsService.getDMBy(arr);
        if (dataDM.length > 0) {
            dataDM.forEach(function (element) {
                dataJoin.push(element);
            });
        }
        _countDm = dataDM.length;
        var dataRecord;
        /* Thông tư 78 */
        if (isTT78) {
            dataRecord = this.vatService.getInvoiceOtherResolverTT78(loaiHoaDon);
            if (dataRecord.length > 0) {
                dataRecord.forEach(function (element) {
                    dataJoin.push(element);
                });
            }
            var dataForkJoin = Object(rxjs__WEBPACK_IMPORTED_MODULE_6__["forkJoin"])(dataJoin);
            return dataForkJoin.pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["map"])(function (rs) {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                var status = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success;
                var isEdit = false;
                for (var index = 0; index < rs.length; index++) {
                    if (rs[index].status != _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs[index].message, "error");
                        if (loaiHoaDon == "01GTKT")
                            _this.router.navigate(['/system/vat-invoice']);
                        else if (loaiHoaDon == "02GTTT")
                            _this.router.navigate(['/system/sale-invoice']);
                        break;
                    }
                }
                if (status == _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                    if (dataDM.length > 0) {
                        var _data_1 = [];
                        rs.forEach(function (element, i) {
                            if (i < dataDM.length) {
                                _data_1.push(element);
                            }
                        });
                        _this.authService.setDMLocal(_data_1);
                    }
                    /* Thông tư 78 */
                    var templates = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].convertTemplatesToInvoiceResolver(rs[dataJoin.length - 1]);
                    return [
                        rs[_countDm].data.products,
                        templates,
                        isEdit,
                    ];
                }
                else
                    return null;
            }));
        }
        else {
            dataRecord = this.vatService.getMultipleAdjustResolver();
            if (dataRecord.length > 0) {
                dataRecord.forEach(function (element) {
                    dataJoin.push(element);
                });
            }
            var dataForkJoin = Object(rxjs__WEBPACK_IMPORTED_MODULE_6__["forkJoin"])(dataJoin);
            return dataForkJoin.pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["map"])(function (rs) {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                var status = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success;
                var isEdit = false;
                for (var index = 0; index < rs.length; index++) {
                    if (rs[index].status != _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs[index].message, "error");
                        if (loaiHoaDon == "01GTKT")
                            _this.router.navigate(['/system/vat-invoice']);
                        else if (loaiHoaDon == "02GTTT")
                            _this.router.navigate(['/system/sale-invoice']);
                        break;
                    }
                }
                if (status == _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                    var invoice_releases = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].convertDataToInvoiceResolver(rs[_countDm]);
                    if (dataDM.length > 0) {
                        var _data_2 = [];
                        rs.forEach(function (element, i) {
                            if (i < dataDM.length) {
                                _data_2.push(element);
                            }
                        });
                        _this.authService.setDMLocal(_data_2);
                    }
                    return [
                        invoice_releases,
                        rs[dataJoin.length - 1].data.products,
                        isEdit
                    ];
                }
                else
                    return null;
            }));
        }
    };
    AdjustMultipleInvoiceResolver = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__["VatService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            _modules_lists_shared__WEBPACK_IMPORTED_MODULE_3__["ListsService"],
            _core_index__WEBPACK_IMPORTED_MODULE_5__["AuthService"]])
    ], AdjustMultipleInvoiceResolver);
    return AdjustMultipleInvoiceResolver;
}());



/***/ }),

/***/ "./src/app/modules/handle-invoice/shared/show-adjust-multiple-invoice.resolver.ts":
/*!****************************************************************************************!*\
  !*** ./src/app/modules/handle-invoice/shared/show-adjust-multiple-invoice.resolver.ts ***!
  \****************************************************************************************/
/*! exports provided: ShowAdjustMultipleInvoiceResolver */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ShowAdjustMultipleInvoiceResolver", function() { return ShowAdjustMultipleInvoiceResolver; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _modules_lists_shared__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @modules/lists/shared */ "./src/app/modules/lists/shared/index.ts");
/* harmony import */ var _modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @modules/vat/shared */ "./src/app/modules/vat/shared/index.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};







var ShowAdjustMultipleInvoiceResolver = /** @class */ (function () {
    function ShowAdjustMultipleInvoiceResolver(vatService, router, listsService, authService) {
        this.vatService = vatService;
        this.router = router;
        this.listsService = listsService;
        this.authService = authService;
    }
    ShowAdjustMultipleInvoiceResolver.prototype.resolve = function (route, state) {
        var _this = this;
        var invoice_id = route.paramMap.get('invoiceId');
        var isViewTT32 = false;
        if (route.queryParams['status'] === 'viewInvTT32') {
            isViewTT32 = true;
        }
        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].showloading();
        var isTT78 = false;
        var infoDangKy = this.authService.getInfoRegister();
        if (infoDangKy && infoDangKy.id) {
            if (infoDangKy.status == "CHAP_NHAN")
                isTT78 = true;
        }
        if (isTT78 == true && isViewTT32)
            isTT78 = false;
        var loaiHoaDon = route.data.type;
        var _countDm = 0;
        var dataJoin = [];
        var dataDM;
        /**
         * Thiếu bên học sinh sinh viên, rà soát lại các hàm liên quan
         */
        var arr = [
            {
                "code": "DM_NHOM_KHACH_HANG",
                "order": 0
            },
            {
                "code": "DM_LOAI_TIEN",
                "order": 0
            },
            {
                "code": "DM_HINH_THUC_THANH_TOAN",
                "order": 0
            },
            {
                "code": "DM_DON_VI_TINH",
                "order": 0
            },
            {
                "code": "DM_TY_LE_VAT",
                "order": 0
            },
            {
                "code": "DM_DINH_KHOAN",
                "order": 0
            },
            {
                "code": "DM_NOI_XUAT_HOA_DON",
                "order": 0
            },
            {
                "code": "DM_QUOC_GIA",
                "order": 0
            },
            {
                "code": "DM_TAI_KHOAN_NGAN_HANG",
                "order": 0
            },
        ];
        dataDM = this.listsService.getDMBy(arr);
        if (dataDM.length > 0) {
            dataDM.forEach(function (element) {
                dataJoin.push(element);
            });
        }
        _countDm = dataDM.length;
        var dataRecord;
        if (isTT78) {
            dataRecord = this.vatService.showInvoiceOtherResolverTT78(invoice_id, loaiHoaDon);
            if (dataRecord.length > 0) {
                dataRecord.forEach(function (element) {
                    dataJoin.push(element);
                });
            }
            var dataForkJoin = Object(rxjs__WEBPACK_IMPORTED_MODULE_6__["forkJoin"])(dataJoin);
            return dataForkJoin.pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["map"])(function (rs) {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                var isEdit = true;
                var status = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success;
                for (var index = 0; index < rs.length; index++) {
                    if (rs[index].status != _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs[index].message, "error");
                        if (loaiHoaDon == "01GTKT")
                            _this.router.navigate(['/system/vat-invoice']);
                        else if (loaiHoaDon == "02GTTT")
                            _this.router.navigate(['/system/sale-invoice']);
                        break;
                    }
                }
                if (status == _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                    if (dataDM.length > 0) {
                        var _data_1 = [];
                        rs.forEach(function (element, i) {
                            if (i < dataDM.length) {
                                _data_1.push(element);
                            }
                        });
                        _this.authService.setDMLocal(_data_1);
                    }
                    var templates = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].convertTemplatesToInvoiceResolver(rs[dataJoin.length - 1]);
                    return [
                        rs[_countDm].data.products,
                        rs[dataJoin.length - 2].data.invoice,
                        isEdit,
                        templates,
                    ];
                }
                else
                    return null;
            }));
        }
        else {
            dataRecord = this.vatService.showMultipleAdjustResolver(invoice_id);
            if (dataRecord.length > 0) {
                dataRecord.forEach(function (element) {
                    dataJoin.push(element);
                });
            }
            var dataForkJoin = Object(rxjs__WEBPACK_IMPORTED_MODULE_6__["forkJoin"])(dataJoin);
            return dataForkJoin.pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["map"])(function (rs) {
                _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].hideloading();
                var isEdit = true;
                var status = _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success;
                for (var index = 0; index < rs.length; index++) {
                    if (rs[index].status != _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                        _core_index__WEBPACK_IMPORTED_MODULE_5__["Library"].notify(rs[index].message, "error");
                        if (loaiHoaDon == "01GTKT")
                            _this.router.navigate(['/system/vat-invoice']);
                        else if (loaiHoaDon == "02GTTT")
                            _this.router.navigate(['/system/sale-invoice']);
                        break;
                    }
                }
                if (status == _core_index__WEBPACK_IMPORTED_MODULE_5__["sEnum"].statusApi.success) {
                    var invoice_releases = _core_index__WEBPACK_IMPORTED_MODULE_5__["Helper"].convertDataToInvoiceResolver(rs[_countDm]);
                    if (dataDM.length > 0) {
                        var _data_2 = [];
                        rs.forEach(function (element, i) {
                            if (i < dataDM.length) {
                                _data_2.push(element);
                            }
                        });
                        _this.authService.setDMLocal(_data_2);
                    }
                    return [
                        invoice_releases,
                        rs[_countDm + 1].data.products,
                        isEdit,
                        rs[dataJoin.length - 1].data.invoice,
                    ];
                }
                else
                    return null;
            }));
        }
    };
    ShowAdjustMultipleInvoiceResolver = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_modules_vat_shared__WEBPACK_IMPORTED_MODULE_4__["VatService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"],
            _modules_lists_shared__WEBPACK_IMPORTED_MODULE_3__["ListsService"],
            _core_index__WEBPACK_IMPORTED_MODULE_5__["AuthService"]])
    ], ShowAdjustMultipleInvoiceResolver);
    return ShowAdjustMultipleInvoiceResolver;
}());



/***/ }),

/***/ "./src/app/modules/info-unit/shared/index.ts":
/*!***************************************************!*\
  !*** ./src/app/modules/info-unit/shared/index.ts ***!
  \***************************************************/
/*! exports provided: InfoUnitService, InfoUnitResolver, InfoUnit */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _info_unit_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./info-unit.service */ "./src/app/modules/info-unit/shared/info-unit.service.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "InfoUnitService", function() { return _info_unit_service__WEBPACK_IMPORTED_MODULE_0__["InfoUnitService"]; });

/* harmony import */ var _info_unit_resolver__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./info-unit.resolver */ "./src/app/modules/info-unit/shared/info-unit.resolver.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "InfoUnitResolver", function() { return _info_unit_resolver__WEBPACK_IMPORTED_MODULE_1__["InfoUnitResolver"]; });

/* harmony import */ var _info_unit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./info-unit */ "./src/app/modules/info-unit/shared/info-unit.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "InfoUnit", function() { return _info_unit__WEBPACK_IMPORTED_MODULE_2__["InfoUnit"]; });






/***/ }),

/***/ "./src/app/modules/info-unit/shared/info-unit.resolver.ts":
/*!****************************************************************!*\
  !*** ./src/app/modules/info-unit/shared/info-unit.resolver.ts ***!
  \****************************************************************/
/*! exports provided: InfoUnitResolver */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InfoUnitResolver", function() { return InfoUnitResolver; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _info_unit_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./info-unit.service */ "./src/app/modules/info-unit/shared/info-unit.service.ts");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};





var InfoUnitResolver = /** @class */ (function () {
    function InfoUnitResolver(infoUnitService, router) {
        this.infoUnitService = infoUnitService;
        this.router = router;
    }
    InfoUnitResolver.prototype.resolve = function (route, state) {
        var _this = this;
        _core_index__WEBPACK_IMPORTED_MODULE_4__["Library"].showloading();
        return this.infoUnitService.getDataSelect().pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["map"])(function (rs) {
            _core_index__WEBPACK_IMPORTED_MODULE_4__["Library"].hideloading();
            if (rs.status == "success") {
                return rs.data;
            }
            else {
                _core_index__WEBPACK_IMPORTED_MODULE_4__["Library"].notify(rs.message, "error");
                _this.router.navigate(['/']);
                return null;
            }
        }));
    };
    InfoUnitResolver = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])(),
        __metadata("design:paramtypes", [_info_unit_service__WEBPACK_IMPORTED_MODULE_3__["InfoUnitService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"]])
    ], InfoUnitResolver);
    return InfoUnitResolver;
}());



/***/ }),

/***/ "./src/app/modules/info-unit/shared/info-unit.service.ts":
/*!***************************************************************!*\
  !*** ./src/app/modules/info-unit/shared/info-unit.service.ts ***!
  \***************************************************************/
/*! exports provided: InfoUnitService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InfoUnitService", function() { return InfoUnitService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @core/index */ "./src/app/core/index.ts");
/* harmony import */ var rxjs_add_observable_forkJoin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/add/observable/forkJoin */ "./node_modules/rxjs-compat/_esm5/add/observable/forkJoin.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};



var InfoUnitService = /** @class */ (function () {
    function InfoUnitService(apiService, coreService) {
        this.apiService = apiService;
        this.coreService = coreService;
    }
    InfoUnitService.prototype.getInfo = function (id) {
        return this.apiService.get('/accounts/' + id);
    };
    InfoUnitService.prototype.getDataSelect = function () {
        return this.apiService.get('/get-lists-by-listtype-code/DM_TINH_THANH,DM_CO_QUAN_THUE');
    };
    InfoUnitService.prototype.updateInfo = function (data, id) {
        return this.apiService.put('/accounts/' + id, data);
    };
    InfoUnitService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_core_index__WEBPACK_IMPORTED_MODULE_1__["ApiService"],
            _core_index__WEBPACK_IMPORTED_MODULE_1__["CoreService"]])
    ], InfoUnitService);
    return InfoUnitService;
}());



/***/ }),

/***/ "./src/app/modules/info-unit/shared/info-unit.ts":
/*!*******************************************************!*\
  !*** ./src/app/modules/info-unit/shared/info-unit.ts ***!
  \*******************************************************/
/*! exports provided: InfoUnit */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InfoUnit", function() { return InfoUnit; });
var InfoUnit = /** @class */ (function () {
    function InfoUnit() {
        this['name'] = '';
        this['account_type'] = '';
        this['tax_province_code'] = '';
        this['tax_district_code'] = '';
        this['business_address'] = '';
        this['transaction_address'] = '';
        this['phone'] = '';
        this['email'] = '';
        this['fax'] = '';
        this['website'] = '';
        this['surrogate_name'] = '';
        this['surrogate_position'] = '';
        this['submitted_person_name'] = '';
        this['contact_person_name'] = '';
        this['contact_mobile'] = '';
        this['tax_department'] = '';
        this['company_type'] = '';
        this['bank_name'] = '';
        this['bank_account_number'] = '';
        this['company_email'] = '';
        this['cert_serial'] = '';
        this['cert_valid_from'] = '';
        this['cert_valid_to'] = '';
        this['cert_provider'] = '';
        this['cert_content'] = '';
        this['icc_token'] = '';
        this['report_period'] = '';
        this['time_study'] = 0;
        this['start_time_study'] = 0;
        this['end_time_study'] = 0;
        this['time_used_xml_new'] = '';
        this['xml_type'] = 1;
        this['tax_code'] = '';
        this['verify_code'] = '';
    }
    return InfoUnit;
}());



/***/ }),

/***/ "./src/app/modules/vat/deactivate/vat-deactivate.guard.ts":
/*!****************************************************************!*\
  !*** ./src/app/modules/vat/deactivate/vat-deactivate.guard.ts ***!
  \****************************************************************/
/*! exports provided: VatDeactivateGuard */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "VatDeactivateGuard", function() { return VatDeactivateGuard; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var VatDeactivateGuard = /** @class */ (function () {
    function VatDeactivateGuard() {
    }
    VatDeactivateGuard.prototype.canDeactivate = function (component) {
        return component.canDeactivate && component.canDeactivate();
    };
    VatDeactivateGuard = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        })
    ], VatDeactivateGuard);
    return VatDeactivateGuard;
}());



/***/ }),

/***/ "./src/app/shared/router/router-library.service.ts":
/*!*********************************************************!*\
  !*** ./src/app/shared/router/router-library.service.ts ***!
  \*********************************************************/
/*! exports provided: RouterLibraryService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RouterLibraryService", function() { return RouterLibraryService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};

var RouterLibraryService = /** @class */ (function () {
    function RouterLibraryService() {
        this.url = '/system/handle-invoice/';
    }
    RouterLibraryService.prototype.setUrl = function (data, router) {
        if (sessionStorage.hasOwnProperty(data)) {
            sessionStorage.setItem(data, router);
        }
        else {
            sessionStorage.setItem(data, router);
        }
    };
    RouterLibraryService.prototype.getUrl = function (data) {
        if (sessionStorage.hasOwnProperty(data)) {
            return sessionStorage.getItem(data);
        }
        return null;
    };
    RouterLibraryService.prototype.setRouterPreviousHandleInvoice = function (type, path, value) {
        if (type === 'GHI') {
            if (path === 'adjust') {
                this.url += "edit-adjust/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
            else if (path === 'replace') {
                this.url += "edit-replace/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
            else if (path === 'sale-adjust') {
                this.url += "edit-sale-adjust/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
            else if (path === 'sale-replace') {
                this.url += "edit-sale-replace/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
        }
        else {
            if (path === 'adjust') {
                this.url += "adjust/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
            else if (path === 'replace') {
                this.url += "replace/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
            else if (path === 'sale-adjust') {
                this.url += "sale-adjust/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
            else if (path === 'sale-replace') {
                this.url += "sale-replace/" + value;
                this.setUrl('keyCreateHandleReport', this.url);
            }
        }
    };
    RouterLibraryService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [])
    ], RouterLibraryService);
    return RouterLibraryService;
}());



/***/ })

}]);
//# sourceMappingURL=handle-invoice-handle-invoice-module~handle-invoice-student-handle-invoice-student-module.js.map